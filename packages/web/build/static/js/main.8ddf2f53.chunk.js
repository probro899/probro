(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{112:function(e,t,a){e.exports=a.p+"static/media/notification.abf5aa80.mp3"},130:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logout=t.login=void 0;var n=o(a(184)),r=o(a(185));function o(e){return e&&e.__esModule?e:{default:e}}t.login=n.default,t.logout=r.default},140:function(e,t,a){e.exports=a.p+"static/media/logo.938bb86b.png"},142:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAI6AAACOgH+NilRAAACI0lEQVR4nO2bQU7CQBSGH4bIFDuRG8jKNTeQlWtvIEfwBnIEvAFewxW9AW5d4Q0wRTorMJNMTDMOtS3TeQ/6voQQWob876PlDUzp7Pd7wEDGcgIAUwBY6ft0ky4wcgQXIGM5NoXfWbsSAHhKN+kyZJ5gAgoKt3k1R8QqRK7GBchYDk3hjxWHBhHRmIAjCs/zBQAzfUs36dp/ygYEyFgO9LlsbteeXrYxEd4ENFS4zac5Lea+XtCLgFxLu/GS6n+8iThKgIzlgzk0QxVu825aZ+05RC0BFVpaKJK6k6lKAmQsR+Ydp1K4jRYxqdI6Swnw1NJCUnoOUSjAfLLPTqhwmxcj4mDrdAoI1NJCUTiHcAro96/eAOD2xAu3+dhuv+/tjV3XM3e73SVia2sK5+fBxVmUdgQsgEAGVFovAO03QSq0/ghovQDnPMBGiEh/F5g4ds2Vypz9teYY/S1zbG9XKpsWZKs8Jk8pAQCgi3l2bF8cmmDUHDM+MKaomDpjfmn9KcACCGRAhQUQyIAKCyCQARUWQCADKiyAQAZUWACBDKiwAAIZUGEBBDKgwgIIZECFBRDIgAoLIJABldYLKLU4KkSkrxkaOXYtlcq8XbtrVpOG9nalssb+TMGrwwQyoOJcGxQiWhC+GrQuiVLZn0XU1h8BLIBABlRYAIEMqHSFiPQEZ2CFsB+fAwNzOU2edafXE+fY8sqStP4UYAEEMqDSbgEA8APWFsDV0MiozQAAAABJRU5ErkJggg=="},143:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAALCAAACwgHbktmQAAACQElEQVR4nO2bu04CQRSGD8ZCagqxxEt8AREq5AWIhWEBjdFWE02gFkVMNFoQExNtQaNBfQmkEcEHwAZKsVhbCM2YtSABNrszsMscmPmSKSY5w/zzZ65ng4MQAkY4HI4qALQMg+zjghDybGcH0xQxyzYP0og5uzuYsrsD7AhvAM0S6LC3fwA+v980rlarQTqV7NRDoXXYCCum7X5VFRLxQxZJQ8NkgMvlgp3tTdO43MNTV33G6aRqV/qoWD0+U4RfAtIABBq4wrQHFN8KoESqpnGtZrOr/lkpgxKJoTSA5iZoHGAvcULItZ09CL8EpAEINHBFeANA2wSNihYyISWvN06mYzAW24KFxSXTOFVV4e72plMPBIIQWAuatmu323B1ec4iiQX9nAbLDDhKpggN2fvHrlkTVqJU7d5LZTtnW1ZvfMLvAUxLgDdhJQqJRIJKRSaTgdeX/GQZoOH3eS39PeHfAmwGFAsDdVKv1/4LRsZqCWgzqzfbZBRLhUAXIXkM6iENQKCBKyK9BfSRbwHBkQYg0MAV4d8C2L8LdOHxzMOKd5UqVjO95/2RI4Ts9gWO01WY9jTR0GLlKUCBNACBBq6MVT7gp9GA5PEpdSwNlp8CNPd+7TgdNLs0BLqngOUzYNbthrP0iWEMzV1iVAi/B0gDEGjgijQAgQauSAMQaOCKNACBBq5IAxBo4Io0AIEGrkgDEGjgivAG9GWEhv0OQJO718nZ8yJuuQFjRlz4JSANQKCBK3pZ4S+Of5cfLQDff0KbAPdutvZ1AAAAAElFTkSuQmCC"},144:function(e,t,a){e.exports=a.p+"static/media/default-cover.c700728d.jpg"},150:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAACXBIWXMAAAU9AAAFPQFsmqclAAAKfUlEQVR4Ae2dW2wjVxnH52aP7bHXuTi2s5us7WT3odsVDRepEgh4QCsqCmLbp4qV2qLCPiBALbcHhHho+1AkEIjyUFWq2CItKqISElTVcnkoLELqQ9EKLbQiiT1OsolvcWLHY8/YPjPoc+xlN7tJfBv7m5nze221/n85//nOmXPOfB9rGAZDcS4cHXtnQw3gcKgBHA41gMOhBnA41AAOhxrA4VADOBxqAIdDDeBwqAEcDjWAw6EGcDjUAA6HGsDhUAM4HGoAh0MN4HCoARwONYDDEZwU/vr6xudVVV1yi+4zjXo9fud/c7ndcl2rr3g8nhvz83NvjU/laLH1rWA5nb5s6PolQsicqqqntFpN1HWdqVar9/3/fT4fw3EcI3q9msfjucXz/AbLcVfjsdirIxc/ImxngNXV5Id4nv9xs9n86F65NFXZ22Ng0PsBzOAPBJjAiWBREIT3CCHfWVxc+Ne4YxwmtjEADDzHsa8qirJULpXERr0+1H/f5XYzJ4JBTZKkG7puXLaLESxvgEw2N1GrKldUVXukkMuK/T7t3QJZIRSOaB6PeM3rk56ORsK7pv6gyVjaAMvLK58TBOH1bGYrpKnqSH9b9HiYSHS2wDDGNxKJxBsj/fEhYlkDJJOp1zRNu5TLbInj1BGOzmqiKF5dWEg8M04d/WJJA6RSqb/u7ux8qlwqIVDDwNqAmZic/Fsikfg0Ajk9YTkDrKys/qeQzz0w6pR/HDAlhGbC7585s3gOlbBjsNROINbBB0ATaAONCOR0jWUMAGkf6+B36JgAtOJQdDyWMAAs+GDOxzz4HUAjaAXNOBQdDXoDwKserPaxLPi6AbSCZtCOXSvqReD+Jk91eU1OhRDI6ZnT8UTB6/OdxbxZhDoDwA4fbPIgkNIXoB1iwKwRrQFgbx+2d60w7x8GaIcYIBacChEbAA52YG8fgZSBgBggFqz6UBoAnhg41TP7YGcUQAwQC9YsgNIAHMe+vLO9bfmnvwPEAjHhUHM36AwAK39Nq3/YDk9/B4gFYoLYcCj6P+gMoNaq39zdKQYQSBkqEBPEhk0XOgMQoj9m5ZX/YUBMEBs2XegM0Gg0FhHIMAWMsaEyQCqVekLZK9su/XeA2CBGHGr2wZYBnjjsyrYdaMdGDXAEUTut/g/Sji2KSRMqA9QbjTkEMkwFW4yoDGAQ0kQgw1SwxYjKAI0miSGQYSrYYkRjAIy7ZGaBKVZMGWBJrSoIZJhLO8YlLHpofQCHg8kAu4LLhUCGubRjRHNFDI0BopHwDcHlRqDEXCBGiBWLHlRTAMex1rn62yfYYkRlAMHlqiCQYSrYYsS1CDSYAgIV5oIsRlQGcLtd9rsIcABsMaIygG4Y78BXtnYFYoMYMYWHygCS5H/F6/UiUGIOEBvEiEkTKgNEI2FZ8vuTCKSYAsQGMWLShG4nUBBcq1CIyW5ATBAbtrDw/aVZ5gWozWc3WjGxzAvYwkJngHgsdn1ichLdkzIok9PT6xAbNl0oc61uGG9C2Va7ALEQQn6NMRy09QFWV5OZjbV0BIGUgZk7HcsuLi6gugvYAe9qi2Wu2CELtGJgGbQ1AlBXCJFleSudSqF8crollkhk4vH4LFZ9qN+3DMN4bnpmRkMgpS9AO8SAWSNqA0ANXkmS3rXi9jBoBu3Y6whbolIoTAXr6bRlPhqBTZ/5WAx16u9giS03QvTPzp2OWeayCGgFzQikHIslDADNGZrN5pegMjcCOUcCGkGrVRpKWGbT/ezZM2/rhv4UZhOANtAIWhHI6QpLnbo8eO7cb+APHJk9uYfpwAi0gCbQBhoRSOoaS/YLkNPpTxq68YetzVvBYfcG6hXoJTR78lSJ5dgvYNzrPw7Ldgxpl5H9R7GQf6BSGc89S7/fz0yFZt73+nwft2rvIMs3jUql5F8Q0nwql836R5UN4KkPRyIVnhdeTyTiXx/Jj5qELdrGtTuHXYOCjFCTz6z9ApjrJ6enW63jvD7pEat3DGPs1jiy0zuQEPJgIZ/3D6va2H47mJkKz/P/tlPPQMaurWMhI1QV5Sccz12oVWvhSrkk9lp7CE7x/CeCmtfnzelE/7NPkr5thyf+ILbuHcy0zaAoypcZw4CduUiTNGegSsfBQg0ugU+zPC8IvJCHSu8My/5RkqRf2nHQ78T2BqAcDa0P4HCoARyOYNfw23V4lnaL20suUYwKghDVCZkghBxZn8fldrc+3Kgpyg3R48l4fdIHmL7nHzaWXwPAtjAh5FHGaNXdaS3yms2moBM90qk5RKBcew+vhPC+72lfQoGKHi63W3O53QVD1yuiKO6yLCs36o2/BILBN2n38BHSWdFzLHOxXm8EDcNYqFWVgKZpPQ3woHQM4vFJjFt034I3B5Zl/8nx3BWrnQegN8B+i3j+sm4wH6lVlXBNUXp+px8FsD0MH3/6JKngdot53dB/L0n+l7BnCJQGgIraHMd/S1VriaqihCp7e4zVagjD7mFwYhL9RhIaA7S3cZ+vNxofq1Yqp6w46IfRMYPL5UoKAv9GPB5/Hou2sRtATqcvG7r+PUVR5sqlkjju832zgSPk4ORUkee5616f9Oy4PxcfmwFWk8mXGIN5ulzajVipL/CwgDXDiWCwdbLIctx3x7V4HKkB9juCqT/Tif5oIZcN2bk5RLd0jpj9gUAOMuGovyMYmQE6T3yxkI/Qgb+X20bwBz4ghDw5qiNn0w2w3yOHfZk+8d1xx6WTd70+6YtmvzmYZgBY1fM8/6ud4vZDTpzjB2VU185MMQDc09M07cl8NhOwcw+gUbB/8TS0quvG42ZMC0M1QKtBMsu+Vczn5mm6Hx4wLYTCEU0UxasLC4lnhvlvD80AsMhr1Btfo0+9ecA1tXB0NtlsNh8bVjYY2ACdG7m7OzsP07nefCAbzJ6aK7Ic9+LiQuKng/7gQAZoHcU2yW/zuWzEjv1+MQPFJyRJupZIJC4OIrNvAyz/d/krLMf9aOvWxhRN+eMBpoRQODLQl0l9GQDm+7pWfzaX2RJR/mUcBBw0RaLRVUVRPnP+/Pl0r5H3bABZTv9pp7h9gc73eIB1ARSl6OcD1Z4MsLa2/vftQv4TdPDx0a8JujYAPPn5bOYCfb/HTfTkyYLo8TzerQm6MgAMfmZr8wJd6VuDXkxw7HcBkPZhzqeDbx0ym5shhmHehtf040QfaYCVlZWf0znfmqzLsh+qqNy8efPIZtWHGkCW5R9WFeWrdPCtCezNbKylg/5A4PpRzarvawBIHbWa+v2dYtG+HZwcAJggs7k5D1v1h0V7jwHALZA66CaPPYC1W7FQeFiW5fteNbvHAJqqvgfVt5z+h7MTUESrUqlc3L+ddTd3GSCZTL2Wy2wt2P1qthPZzudFhmFfObgeuG0AmPc1TbtEN3rsC2R2tVa7q3HlbQMQol8t5LJ03rcxkNm387mHlpdXftCJsmUAWCDANS56rGt/YD3AsuxznamAg3t8tZp6kaZ+55DLZqY6r4acIAi/o6nfWcBUAEU1W19hl8vlBZr6ncf+WwHzIi0S5WAqFWWRGsDhUAM4HGoAh0MN4HAEn8+XdUWj9LqPA3G5Rc//APahc62IWCuAAAAAAElFTkSuQmCC"},166:function(e,t,a){e.exports=a(308)},175:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="schema.init";function r(e,t){return{type:n,schema:e,payload:t}}r.TYPE=n,t.default=r},176:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="schema.add";function r(e,t){return{schema:e,type:n,payload:t}}r.TYPE=n,t.default=r},177:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="schema.remove";function r(e,t){return{schema:e,type:n,payload:t}}r.TYPE=n,t.default=r},178:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="schema.update";function r(e,t){return{type:n,schema:e,payload:t}}r.TYPE=n,t.default=r},179:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.allIds.map(function(t){return e.byId[t]})}},180:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.allIds.map(function(a){return t(e.byId[a])})}},181:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return e.byId[t]}},184:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return{type:"LOGIN",payload:e}};n.TYPE="LOGIN",t.default=n},185:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return{type:"LOGOUT"}};n.TYPE="LOGOUT",t.default=n},20:function(e,t){n.sessions={},n.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||n.extension.isInstalled()}return!0};var a={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout(function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)},1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var a=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",a(n)}else a(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))})}};function n(e){if((e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:n.noop,!n.initDone)return e.error("Library not initialized"),{};if(!n.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(n.log("Library initialized: "+n.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,a=null,r={},o=null,i=null,c=0,s=e.server;n.isArray(s)?(n.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,n.debug(i)):0===s.indexOf("ws")?(t=!0,n.log("Using WebSockets to contact Janus: "+s)):(t=!1,n.log("Using REST API to contact Janus: "+s));var l=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],u=e.iceTransportPolicy,d=e.bundlePolicy,m=!0===e.ipv6,p=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(p=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var v=null;void 0!==e.token&&null!==e.token&&(v=e.token);var b=null;void 0!==e.apisecret&&null!==e.apisecret&&(b=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var h=6e4;function y(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(h=e.longPollTimeout),isNaN(h)&&(h=6e4);var C=!1,w=null,E={},S=this,O=0,k={};function I(){if(null!=w)if(n.debug("Long poll..."),C){var t=s+"/"+w+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),v&&(t=t+"&token="+encodeURIComponent(v)),b&&(t=t+"&apisecret="+encodeURIComponent(b)),n.httpAPICall(t,{verb:"GET",withCredentials:p,success:j,timeout:h,error:function(t,a){if(n.error(t+":",a),++O>3)return C=!1,void e.error("Lost connection to the server (is it down?)");I()}})}else n.warn("Is the server down? (connected=false)")}function j(e,r){if(O=0,t||void 0===w||null===w||!0===r||I(),t||!n.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");var o=e.candidate;n.debug("Got a trickled candidate on session "+w),n.debug(o);var i=d.webrtcStuff;i.pc&&i.remoteSdp?(n.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(n.endOfCandidates)):(n.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(o),n.debug(i.candidates))}else{if("webrtcup"===e.janus)return n.debug("Got a webrtcup event on session "+w),n.debug(e),(l=e.sender)?(d=E[l])?void d.webrtcState(!0):void n.debug("This handle is not attached to this session"):void n.warn("Missing sender...");if("hangup"===e.janus){if(n.debug("Got a hangup event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");d.webrtcState(!1,e.reason),d.hangup()}else if("detached"===e.janus){if(n.debug("Got a detached event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return;d.detached=!0,d.ondetached(),d.detach()}else if("media"===e.janus){if(n.debug("Got a media event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");d.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(n.debug("Got a slowlink event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");d.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var c,s;if(n.error("Ooops: "+e.error.code+" "+e.error.reason),n.debug(e),c=e.transaction)(s=k[c])&&s(e),delete k[c];return}if("event"===e.janus){var l;if(n.debug("Got a plugin event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");var u=e.plugindata;if(!u)return void n.warn("Missing plugindata...");n.debug("  -- Event is coming from "+l+" ("+u.plugin+")");var d,m=u.data;if(n.debug(m),!(d=E[l]))return void n.warn("This handle is not attached to this session");var p=e.jsep;p&&(n.debug("Handling SDP as well..."),n.debug(p));var f=d.onmessage;f?(n.debug("Notifying application..."),f(m,p)):n.debug("No provided notification callback")}else{if("timeout"===e.janus)return n.error("Timeout on session "+w),n.debug(e),void(t&&a.close(3504,"Gateway timeout"));n.warn("Unknown message/event  '"+e.janus+"' on session "+w),n.debug(e)}}}else n.debug("Got a success on session "+w),n.debug(e),(c=e.transaction)&&((s=k[c])&&s(e),delete k[c]);else n.debug("Got an ack on session "+w),n.debug(e),(c=e.transaction)&&((s=k[c])&&s(e),delete k[c]);else n.vdebug("Got a keepalive on session "+w);else for(var v=0;v<e.length;v++)j(e[v],!0)}function x(){if(s&&t&&C){o=setTimeout(x,g);var e={janus:"keepalive",session_id:w,transaction:n.randomString(12)};v&&(e.token=v),b&&(e.apisecret=b),a.send(JSON.stringify(e))}}function N(l){var u=n.randomString(12),d={janus:"create",transaction:u};if(l.reconnect&&(C=!1,d.janus="claim",d.session_id=w,a&&(a.onopen=null,a.onerror=null,a.onclose=null,o&&(clearTimeout(o),o=null))),v&&(d.token=v),b&&(d.apisecret=b),!s&&n.isArray(i)&&(0===(s=i[c]).indexOf("ws")?(t=!0,n.log("Server #"+(c+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,n.log("Server #"+(c+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var m in a=n.newWebSocket(s,"janus-protocol"),r={error:function(){if(n.error("Error connecting to the Janus WebSockets server... "+s),n.isArray(i)&&!l.reconnect)return++c===i.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout(function(){N(l)},200));l.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){k[u]=function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void l.error(e.error.reason);o=setTimeout(x,g),C=!0,w=e.session_id?e.session_id:e.data.id,l.reconnect?n.log("Claimed session: "+w):n.log("Created session: "+w),n.sessions[w]=S,l.success()},a.send(JSON.stringify(d))},message:function(e){j(JSON.parse(e.data))},close:function(){s&&C&&(C=!1,e.error("Lost connection to the server (is it down?)"))}})a.addEventListener(m,r[m]);else n.httpAPICall(s,{verb:"POST",withCredentials:p,body:d,success:function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void l.error(e.error.reason);C=!0,w=e.session_id?e.session_id:e.data.id,l.reconnect?n.log("Claimed session: "+w):n.log("Created session: "+w),n.sessions[w]=S,I(),l.success()},error:function(e,t){if(n.error(e+":",t),n.isArray(i)&&!l.reconnect)return++c===i.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout(function(){N(l)},200));""===t?l.error(e+": Is the server down?"):l.error(e+": "+t)}})}function D(e,r){if((r=r||{}).success="function"==typeof r.success?r.success:n.noop,r.error="function"==typeof r.error?r.error:n.noop,!C)return n.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var o=E[e];if(!o||!o.webrtcStuff)return n.warn("Invalid handle"),void r.error("Invalid handle");var i=r.message,c=r.jsep,l=n.randomString(12),u={janus:"message",body:i,transaction:l};if(o.token&&(u.token=o.token),b&&(u.apisecret=b),c&&(u.jsep=c),n.debug("Sending message to plugin (handle="+e+"):"),n.debug(u),t)return u.session_id=w,u.handle_id=e,k[l]=function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return n.warn("Request succeeded, but missing plugindata..."),void r.success();n.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return n.debug(a),void r.success(a)}"ack"===e.janus?r.success():e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),r.error("Unknown error"))},void a.send(JSON.stringify(u));n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:u,success:function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return n.warn("Request succeeded, but missing plugindata..."),void r.success();n.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return n.debug(a),void r.success(a)}"ack"===e.janus?r.success():e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),r.error("Unknown error"))},error:function(e,t){n.error(e+":",t),r.error(e+": "+t)}})}function A(e,r){if(C){var o=E[e];if(o&&o.webrtcStuff){var i={janus:"trickle",candidate:r,transaction:n.randomString(12)};if(o.token&&(i.token=o.token),b&&(i.apisecret=b),n.vdebug("Sending trickle candidate (handle="+e+"):"),n.vdebug(i),t)return i.session_id=w,i.handle_id=e,void a.send(JSON.stringify(i));n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:i,success:function(e){n.vdebug("Candidate sent!"),n.vdebug(e),"ack"===e.janus||n.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){n.error(e+":",t)}})}else n.warn("Invalid handle")}else n.warn("Is the server down? (connected=false)")}function T(e,t,a,r){var o=E[e];if(o&&o.webrtcStuff){var i=o.webrtcStuff,c=function(e){n.log("Received state change on data channel:",e);var t=e.target.label,a=i.dataChannel[t]?i.dataChannel[t].readyState:"null";if(n.log("State change on <"+t+"> data channel: "+a),"open"===a){if(i.dataChannel[t].pending&&i.dataChannel[t].pending.length>0){n.log("Sending pending messages on <"+t+">:",i.dataChannel[t].pending.length);var r=!0,c=!1,s=void 0;try{for(var l,u=i.dataChannel[t].pending[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;n.log("Sending data on data channel <"+t+">"),n.debug(d),i.dataChannel[t].send(d)}}catch(m){c=!0,s=m}finally{try{r||null==u.return||u.return()}finally{if(c)throw s}}i.dataChannel[t].pending=[]}o.ondataopen(t)}};i.dataChannel[t]=a||i.pc.createDataChannel(t,{ordered:!0}),i.dataChannel[t].onmessage=function(e){n.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},i.dataChannel[t].onopen=c,i.dataChannel[t].onclose=c,i.dataChannel[t].onerror=function(e){n.error("Got error on data channel:",e)},i.dataChannel[t].pending=[],r&&i.dataChannel[t].pending.push(r)}else n.warn("Invalid handle")}function R(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff,o=t.text||t.data;if(!o)return n.warn("Invalid data"),void t.error("Invalid data");var i=t.label?t.label:n.dataChanDefaultLabel;return r.dataChannel[i]?"open"!==r.dataChannel[i].readyState?(r.dataChannel[i].pending.push(o),void t.success()):(n.log("Sending data on data channel <"+i+">"),n.debug(o),r.dataChannel[i].send(o),void t.success()):(T(e,i,!1,o),void t.success())}function P(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff;if(!r.dtmfSender){if(r.pc){var o=r.pc.getSenders().find(function(e){return e.track&&"audio"===e.track.kind});if(!o)return n.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");r.dtmfSender=o.dtmf,r.dtmfSender&&(n.log("Created DTMF Sender"),r.dtmfSender.ontonechange=function(e){n.debug("Sent DTMF tone: "+e.tone)})}if(!r.dtmfSender)return n.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var i=t.dtmf;if(!i)return n.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var c=i.tones;if(!c)return n.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"===typeof i.duration?i.duration:500,l="number"===typeof i.gap?i.gap:50;n.debug("Sending DTMF string "+c+" (duration "+s+"ms, gap "+l+"ms)"),r.dtmfSender.insertDTMF(c,s,l),t.success()}function M(e,r){(r=r||{}).success="function"==typeof r.success?r.success:n.noop,r.error="function"==typeof r.error?r.error:n.noop;var o=!0===r.noRequest;n.log("Destroying handle "+e+" (only-locally="+o+")"),q(e);var i=E[e];if(!i||i.detached)return delete E[e],void r.success();if(o)return delete E[e],void r.success();if(!C)return n.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var c={janus:"detach",transaction:n.randomString(12)};if(i.token&&(c.token=i.token),b&&(c.apisecret=b),t)return c.session_id=w,c.handle_id=e,a.send(JSON.stringify(c)),delete E[e],void r.success();n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:c,success:function(t){n.log("Destroyed handle:"),n.debug(t),"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),delete E[e],r.success()},error:function(t,a){n.error(t+":",a),delete E[e],r.success()}})}function H(e,t,a,r,o){var i=E[e];if(!i||!i.webrtcStuff)return n.warn("Invalid handle"),void r.error("Invalid handle");var c=i.webrtcStuff;n.debug("streamsDone:",o),o&&(n.debug("  -- Audio tracks:",o.getAudioTracks()),n.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(c.myStream&&a.update&&!c.streamExternal){if((!a.update&&G(a)||a.update&&(a.addAudio||a.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(c.myStream.addTrack(o.getAudioTracks()[0]),n.unifiedPlan){n.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var p=null;if((C=c.pc.getTransceivers())&&C.length>0){var f=!0,v=!1,b=void 0;try{for(var g,h=C[Symbol.iterator]();!(f=(g=h.next()).done);f=!0){if((x=g.value).sender&&x.sender.track&&"audio"===x.sender.track.kind||x.receiver&&x.receiver.track&&"audio"===x.receiver.track.kind){p=x;break}}}catch(M){v=!0,b=M}finally{try{f||null==h.return||h.return()}finally{if(v)throw b}}}p&&p.sender?p.sender.replaceTrack(o.getAudioTracks()[0]):c.pc.addTrack(o.getAudioTracks()[0],o)}else n.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),c.pc.addTrack(o.getAudioTracks()[0],o);if((!a.update&&Y(a)||a.update&&(a.addVideo||a.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(c.myStream.addTrack(o.getVideoTracks()[0]),n.unifiedPlan){n.log((a.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var C,w=null;if((C=c.pc.getTransceivers())&&C.length>0){var S=!0,O=!1,k=void 0;try{for(var I,j=C[Symbol.iterator]();!(S=(I=j.next()).done);S=!0){var x;if((x=I.value).sender&&x.sender.track&&"video"===x.sender.track.kind||x.receiver&&x.receiver.track&&"video"===x.receiver.track.kind){w=x;break}}}catch(M){O=!0,k=M}finally{try{S||null==j.return||j.return()}finally{if(O)throw k}}}w&&w.sender?w.sender.replaceTrack(o.getVideoTracks()[0]):c.pc.addTrack(o.getVideoTracks()[0],o)}else n.log((a.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),c.pc.addTrack(o.getVideoTracks()[0],o)}else c.myStream=o,s=!0;if(!c.pc){var N={iceServers:l,iceTransportPolicy:u,bundlePolicy:d};"chrome"===n.webRTCAdapter.browserDetails.browser&&(N.sdpSemantics=n.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var D={optional:[{DtlsSrtpKeyAgreement:!0}]};if(m&&D.optional.push({googIPv6:!0}),r.rtcConstraints&&"object"===typeof r.rtcConstraints)for(var R in n.debug("Adding custom PeerConnection constraints:",r.rtcConstraints),r.rtcConstraints)D.optional.push(r.rtcConstraints[R]);"edge"===n.webRTCAdapter.browserDetails.browser&&(N.bundlePolicy="max-bundle"),n.log("Creating PeerConnection"),n.debug(D),c.pc=new RTCPeerConnection(N,D),n.debug(c.pc),c.pc.getStats&&(c.volume={},c.bitrate.value="0 kbits/sec"),n.log("Preparing local SDP and gathering candidates (trickle="+c.trickle+")"),c.pc.oniceconnectionstatechange=function(e){c.pc&&i.iceState(c.pc.iceConnectionState)},c.pc.onicecandidate=function(t){if(!t.candidate||"edge"===n.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)n.log("End of candidates."),c.iceDone=!0,!0===c.trickle?A(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=E[e];if(!a||!a.webrtcStuff)return void n.warn("Invalid handle, not sending anything");var r=a.webrtcStuff;if(n.log("Sending offer/answer SDP..."),!r.mySdp)return void n.warn("Local SDP instance is invalid, not sending anything...");r.mySdp={type:r.pc.localDescription.type,sdp:r.pc.localDescription.sdp},!1===r.trickle&&(r.mySdp.trickle=!1);n.debug(t),r.sdpSent=!0,t.success(r.mySdp)}(e,r);else{var a={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===c.trickle&&A(e,a)}},c.pc.ontrack=function(e){if(n.log("Handling Remote Track"),n.debug(e),e.streams&&(c.remoteStream=e.streams[0],i.onremotestream(c.remoteStream),!e.track.onended)){var t=null;n.log("Adding onended callback to track:",e.track),e.track.onended=function(e){n.log("Remote track removed:",e),c.remoteStream&&(clearTimeout(t),c.remoteStream.removeTrack(e.target),i.onremotestream(c.remoteStream))},e.track.onmute=function(e){n.log("Remote track muted:",e),c.remoteStream&&null==t&&(t=setTimeout(function(){n.log("Removing remote track"),c.remoteStream&&(c.remoteStream.removeTrack(e.target),i.onremotestream(c.remoteStream),t=null)},2520))},e.track.onunmute=function(e){if(n.log("Remote track flowing again:",e),null!=t)clearTimeout(t),t=null;else try{c.remoteStream.addTrack(e.target),i.onremotestream(c.remoteStream)}catch(a){n.error(a)}}}}}if(s&&o){n.log("Adding local stream");var P=!0===r.simulcast2;o.getTracks().forEach(function(e){if(n.log("Adding local track:",e),P)if("audio"===e.kind)c.pc.addTrack(e,o);else{n.log("Enabling rid-based simulcasting:",e);var t=y(r.simulcastMaxBitrates);c.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else c.pc.addTrack(e,o)})}(function(e){if(n.debug("isDataEnabled:",e),"edge"===n.webRTCAdapter.browserDetails.browser)return n.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(a)&&!c.dataChannel[n.dataChanDefaultLabel]&&(n.log("Creating data channel"),T(e,n.dataChanDefaultLabel,!1),c.pc.ondatachannel=function(t){n.log("Data channel created by Janus:",t),T(e,t.channel.label,t.channel)}),c.myStream&&i.onlocalstream(c.myStream),t?c.pc.setRemoteDescription(t).then(function(){if(n.log("Remote description accepted!"),c.remoteSdp=t.sdp,c.candidates&&c.candidates.length>0){for(var o=0;o<c.candidates.length;o++){var i=c.candidates[o];n.debug("Adding remote candidate:",i),i&&!0!==i.completed?c.pc.addIceCandidate(i):c.pc.addIceCandidate(n.endOfCandidates)}c.candidates=[]}!function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:n.noop;var r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var o=r.webrtcStuff,i=!0===a.simulcast;i?n.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):n.log("Creating answer (iceDone="+o.iceDone+")");var c=null;if(n.unifiedPlan){c={};var s=null,l=null,u=o.pc.getTransceivers();if(u&&u.length>0){var d=!0,m=!1,p=void 0;try{for(var f,v=u[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;b.sender&&b.sender.track&&"audio"===b.sender.track.kind||b.receiver&&b.receiver.track&&"audio"===b.receiver.track.kind?s||(s=b):(b.sender&&b.sender.track&&"video"===b.sender.track.kind||b.receiver&&b.receiver.track&&"video"===b.receiver.track.kind)&&(l||(l=b))}}catch(M){m=!0,p=M}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}}var g=G(t),h=J(t);if(g||h){if(g&&h){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",n.log("Setting audio transceiver to sendrecv:",s)}catch(j){n.error(j)}}else if(g&&!h)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",n.log("Setting audio transceiver to sendonly:",s))}catch(j){n.error(j)}else if(!g&&h)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",n.log("Setting audio transceiver to recvonly:",s)}catch(j){n.error(j)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),n.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",n.log("Setting audio transceiver to inactive:",s)}catch(j){n.error(j)}var C=Y(t),w=K(t);if(C||w){if(C&&w){if(l)try{l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",n.log("Setting video transceiver to sendrecv:",l)}catch(j){n.error(j)}}else if(C&&!w){if(l)try{l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",n.log("Setting video transceiver to sendonly:",l)}catch(j){n.error(j)}}else if(!C&&w)if(l)try{l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",n.log("Setting video transceiver to recvonly:",l)}catch(j){n.error(j)}else l=o.pc.addTransceiver("video",{direction:"recvonly"}),n.log("Adding recvonly video transceiver:",l)}else if(t.removeVideo&&l)try{l.setDirection?l.setDirection("inactive"):l.direction="inactive",n.log("Setting video transceiver to inactive:",l)}catch(j){n.error(j)}}else c="firefox"===n.webRTCAdapter.browserDetails.browser||"edge"===n.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:J(t),offerToReceiveVideo:K(t)}:{mandatory:{OfferToReceiveAudio:J(t),OfferToReceiveVideo:K(t)}};n.debug(c);var S=Y(t);if(S&&i&&"firefox"===n.webRTCAdapter.browserDetails.browser){n.log("Enabling Simulcasting for Firefox (RID)");var O=o.pc.getSenders()[1];n.log(O);var k=O.getParameters();n.log(k);var I=y(a.simulcastMaxBitrates);O.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:I.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:I.medium},{rid:"low",active:!0,priority:"low",maxBitrate:I.low}]})}o.pc.createAnswer(c).then(function(e){n.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,n.log("Setting local description"),S&&i&&("chrome"===n.webRTCAdapter.browserDetails.browser?n.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==n.webRTCAdapter.browserDetails.browser&&n.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(a.error),o.mediaConstraints=c,o.iceDone||o.trickle?a.success(e):n.log("Waiting for all candidates...")},a.error)}(e,a,r)},r.error):function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:n.noop;var r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var o=r.webrtcStuff,i=!0===a.simulcast;i?n.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):n.log("Creating offer (iceDone="+o.iceDone+")");var c={};if(n.unifiedPlan){var s=null,l=null,u=o.pc.getTransceivers();if(u&&u.length>0){var d=!0,m=!1,p=void 0;try{for(var f,v=u[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;b.sender&&b.sender.track&&"audio"===b.sender.track.kind||b.receiver&&b.receiver.track&&"audio"===b.receiver.track.kind?s||(s=b):(b.sender&&b.sender.track&&"video"===b.sender.track.kind||b.receiver&&b.receiver.track&&"video"===b.receiver.track.kind)&&(l||(l=b))}}catch(M){m=!0,p=M}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}}var g=G(t),h=J(t);g||h?g&&h?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",n.log("Setting audio transceiver to sendrecv:",s)):g&&!h?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",n.log("Setting audio transceiver to sendonly:",s)):!g&&h&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",n.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),n.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",n.log("Setting audio transceiver to inactive:",s));var C=Y(t),w=K(t);C||w?C&&w?l&&(l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",n.log("Setting video transceiver to sendrecv:",l)):C&&!w?l&&(l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",n.log("Setting video transceiver to sendonly:",l)):!C&&w&&(l?(l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",n.log("Setting video transceiver to recvonly:",l)):(l=o.pc.addTransceiver("video",{direction:"recvonly"}),n.log("Adding recvonly video transceiver:",l))):t.removeVideo&&l&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive",n.log("Setting video transceiver to inactive:",l))}else c.offerToReceiveAudio=J(t),c.offerToReceiveVideo=K(t);!0===a.iceRestart&&(c.iceRestart=!0);n.debug(c);var S=Y(t);if(S&&i&&"firefox"===n.webRTCAdapter.browserDetails.browser){n.log("Enabling Simulcasting for Firefox (RID)");var O=o.pc.getSenders().find(function(e){return"video"===e.track.kind});if(O){var k=O.getParameters();k||(k={});var I=y(a.simulcastMaxBitrates);k.encodings=[{rid:"h",active:!0,maxBitrate:I.high},{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:I.low,scaleResolutionDownBy:4}],O.setParameters(k)}}o.pc.createOffer(c).then(function(e){n.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,n.log("Setting local description"),S&&i&&("chrome"===n.webRTCAdapter.browserDetails.browser||"safari"===n.webRTCAdapter.browserDetails.browser?(n.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),a=!1,r=[-1],o=[-1],i=null,c=null,s=null,l=null,u=-1,d=0;d<t.length;d++){var m=t[d].match(/m=(\w+) */);if(m){var p=m[1];if("video"===p){if(!(r[0]<0)){u=d;break}a=!0}else if(r[0]>-1){u=d;break}}else if(a){var f=t[d].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)r[0]=f[1],o[0]=f[2],t.splice(d,1),d--;else{if(r[0]){var v=t[d].match("a=ssrc:"+r[0]+" cname:(.+)");if(v&&(i=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(c=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" label:(.+)"))&&(l=v[1]),0===t[d].indexOf("a=ssrc:"+o[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}}0!=t[d].length||(t.splice(d,1),d--)}}}if(r[0]<0){u=-1,a=!1;for(var d=0;d<t.length;d++){var m=t[d].match(/m=(\w+) */);if(m){var p=m[1];if("video"===p){if(!(r[0]<0)){u=d;break}a=!0}else if(r[0]>-1){u=d;break}}else if(a){if(r[0]<0){var b=t[d].match(/a=ssrc:(\d+)/);if(b){r[0]=b[1],t.splice(d,1),d--;continue}}else{var v=t[d].match("a=ssrc:"+r[0]+" cname:(.+)");if(v&&(i=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(c=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" label:(.+)"))&&(l=v[1]),0===t[d].indexOf("a=ssrc:"+o[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}}0!==t[d].length||(t.splice(d,1),d--)}}}if(r[0]<0)return n.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;u<0&&(u=t.length);r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(var d=0;d<r.length;d++)i&&(t.splice(u,0,"a=ssrc:"+r[d]+" cname:"+i),u++),c&&(t.splice(u,0,"a=ssrc:"+r[d]+" msid:"+c),u++),s&&(t.splice(u,0,"a=ssrc:"+r[d]+" mslabel:"+s),u++),l&&(t.splice(u,0,"a=ssrc:"+r[d]+" label:"+l),u++),i&&(t.splice(u,0,"a=ssrc:"+o[d]+" cname:"+i),u++),c&&(t.splice(u,0,"a=ssrc:"+o[d]+" msid:"+c),u++),s&&(t.splice(u,0,"a=ssrc:"+o[d]+" mslabel:"+s),u++),l&&(t.splice(u,0,"a=ssrc:"+o[d]+" label:"+l),u++);t.splice(u,0,"a=ssrc-group:FID "+r[2]+" "+o[2]),t.splice(u,0,"a=ssrc-group:FID "+r[1]+" "+o[1]),t.splice(u,0,"a=ssrc-group:FID "+r[0]+" "+o[0]),t.splice(u,0,"a=ssrc-group:SIM "+r[0]+" "+r[1]+" "+r[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==n.webRTCAdapter.browserDetails.browser&&n.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(a.error),o.mediaConstraints=c,o.iceDone||o.trickle?(n.log("Offer ready"),n.debug(a),a.success(e)):n.log("Waiting for all candidates...")},a.error)}(e,a,r)}function U(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:F;var r=a.jsep;if(t&&r)return n.error("Provided a JSEP to a createOffer"),void a.error("Provided a JSEP to a createOffer");if(!t&&(!r||!r.type||!r.sdp))return n.error("A valid JSEP is required for createAnswer"),void a.error("A valid JSEP is required for createAnswer");a.media="object"===typeof a.media&&a.media?a.media:{audio:!0,video:!0};var o=a.media,i=E[e];if(!i||!i.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var c,s=i.webrtcStuff;if(s.trickle=(c=a.trickle,n.debug("isTrickleEnabled:",c),!1!==c),s.pc){if(n.log("Updating existing media session"),o.update=!0,a.stream)a.stream!==s.myStream&&n.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return n.error("Can't add audio stream, there already is one"),void a.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!G(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),G(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return n.error("Can't add video stream, there already is one"),void a.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!Y(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Y(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(G(o)&&o.keepAudio&&Y(o)&&o.keepVideo)return i.consentDialog(!1),void H(e,r,o,a,s.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&!s.streamExternal){if(o.removeAudio||o.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var l=s.myStream.getAudioTracks()[0];n.log("Removing audio track:",l),s.myStream.removeTrack(l);try{l.stop()}catch(_){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var u=!0;if(o.replaceAudio&&n.unifiedPlan&&(u=!1),u){var d=!0,m=!1,p=void 0;try{for(var f,v=s.pc.getSenders()[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;b&&b.track&&"audio"===b.track.kind&&(n.log("Removing audio sender:",b),s.pc.removeTrack(b))}}catch(Z){m=!0,p=Z}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}}}}if(o.removeVideo||o.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var g=s.myStream.getVideoTracks()[0];n.log("Removing video track:",g),s.myStream.removeTrack(g);try{g.stop()}catch(_){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var h=!0;if(o.replaceVideo&&n.unifiedPlan&&(h=!1),h){var y=!0,C=!1,w=void 0;try{for(var S,O=s.pc.getSenders()[Symbol.iterator]();!(y=(S=O.next()).done);y=!0){var k=S.value;k&&k.track&&"video"===k.track.kind&&(n.log("Removing video sender:",k),s.pc.removeTrack(k))}}catch(Z){C=!0,w=Z}finally{try{y||null==O.return||O.return()}finally{if(C)throw w}}}}}}if(a.stream){var I=a.stream;if(n.log("MediaStream provided by the application"),n.debug(I),o.update&&s.myStream&&s.myStream!==a.stream&&!s.streamExternal){try{var j=s.myStream.getTracks(),x=!0,N=!1,D=void 0;try{for(var A,T=j[Symbol.iterator]();!(x=(A=T.next()).done);x=!0){var R=A.value;n.log(R),R&&R.stop()}}catch(Z){N=!0,D=Z}finally{try{x||null==T.return||T.return()}finally{if(N)throw D}}}catch(_){}s.myStream=null}return s.streamExternal=!0,i.consentDialog(!1),void H(e,r,o,a,I)}if(G(o)||Y(o)){if(!n.isGetUserMediaAvailable())return void a.error("getUserMedia not available");var P={mandatory:{},optional:[]};i.consentDialog(!0);var M=G(o);M&&o&&"object"===typeof o.audio&&(M=o.audio);var U=Y(o);if(U&&o){var B=!0===a.simulcast,L=!0===a.simulcast2;if(!B&&!L||r||o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===typeof o.video)U=o.video;else{var W=0,V=0;"lowres"===o.video?(V=240,W=320):"lowres-16:9"===o.video?(V=180,W=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(V=720,W=1280):"fhdres"===o.video?(V=1080,W=1920):"4kres"===o.video?(V=2160,W=3840):"stdres"===o.video?(V=480,W=640):"stdres-16:9"===o.video?(V=360,W=640):(n.log("Default video setting is stdres 4:3"),V=480,W=640),n.log("Adding media constraint:",o.video),U={height:{ideal:V},width:{ideal:W}},n.log("Adding video constraint:",U)}else if("screen"===o.video||"window"===o.video){var z=function(t,n){i.consentDialog(!1),t?a.error(t):H(e,r,o,a,n)},q=function(e,t,a){n.log("Adding media constraint (screen capture)"),n.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){a?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(a){e.addTrack(a.getAudioTracks()[0]),t(null,e)}):t(null,e)}).catch(function(e){i.consentDialog(!1),t(e)})};if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return P.video={},o.screenshareFrameRate&&(P.video.frameRate=o.screenshareFrameRate),o.screenshareHeight&&(P.video.height=o.screenshareHeight),o.screenshareWidth&&(P.video.width=o.screenshareWidth),P.audio=o.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(P).then(function(t){i.consentDialog(!1),G(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(n){t.addTrack(n.getAudioTracks()[0]),H(e,r,o,a,t)}):H(e,r,o,a,t)},function(e){i.consentDialog(!1),a.error(e)});if("chrome"===n.webRTCAdapter.browserDetails.browser){var J=n.webRTCAdapter.browserDetails.version,K=33;window.navigator.userAgent.match("Linux")&&(K=35),J>=26&&J<=K?(P={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:G(o)&&!o.keepAudio},q(P,z)):n.extension.getScreen(function(e,t){if(e)return i.consentDialog(!1),a.error(e);(P={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,q(P,z,G(o)&&!o.keepAudio)})}else if("firefox"===n.webRTCAdapter.browserDetails.browser){if(!(n.webRTCAdapter.browserDetails.version>=33)){var Q=new Error("NavigatorUserMediaError");return Q.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void a.error(Q)}P={video:{mozMediaSource:o.video,mediaSource:o.video},audio:G(o)&&!o.keepAudio},q(P,function(e,t){if(z(e,t),!e)var a=t.currentTime,n=window.setInterval(function(){t||window.clearInterval(n),t.currentTime==a&&(window.clearInterval(n),t.onended&&t.onended()),a=t.currentTime},500)})}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then(function(t){var c=t.some(function(e){return"audioinput"===e.kind}),s=function(e){if(n.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(o)||t.some(function(e){return"videoinput"===e.kind}),l=G(o),u=Y(o),d=function(e){return n.debug("isAudioSendRequired:",e),!!e&&!1!==e.audio&&!1!==e.audioSend&&void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio}(o),m=function(e){return n.debug("isVideoSendRequired:",e),!!e&&!1!==e.video&&!1!==e.videoSend&&void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo}(o);if(l||u||d||m){var p=!!l&&c,f=!!u&&s;if(!p&&!f)return i.consentDialog(!1),a.error("No capture device found"),!1;if(!p&&d)return i.consentDialog(!1),a.error("Audio capture is required, but no capture device found"),!1;if(!f&&m)return i.consentDialog(!1),a.error("Video capture is required, but no capture device found"),!1}var v={audio:!(!c||o.keepAudio)&&M,video:!(!s||o.keepVideo)&&U};n.debug("getUserMedia constraints",v),v.audio||v.video?navigator.mediaDevices.getUserMedia(v).then(function(t){i.consentDialog(!1),H(e,r,o,a,t)}).catch(function(e){i.consentDialog(!1),a.error({code:e.code,name:e.name,message:e.message})}):(i.consentDialog(!1),H(e,r,o,a,I))}).catch(function(e){i.consentDialog(!1),a.error("enumerateDevices error",e)})}else H(e,r,o,a)}function B(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:F;var a=t.jsep,r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var o=r.webrtcStuff;if(a){if(!o.pc)return n.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(a).then(function(){if(n.log("Remote description accepted!"),o.remoteSdp=a.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var r=o.candidates[e];n.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(n.endOfCandidates)}o.candidates=[]}t.success()},t.error)}else t.error("Invalid JSEP")}function L(e,t){var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),0;var r=t?"remote":"local",o=a.webrtcStuff;return o.volume[r]||(o.volume[r]={value:0}),!o.pc.getStats||"chrome"!==n.webRTCAdapter.browserDetails.browser&&"safari"!==n.webRTCAdapter.browserDetails.browser?(n.warn("Getting the "+r+" volume unsupported by browser"),0):t&&!o.remoteStream?(n.warn("Remote stream unavailable"),0):t||o.myStream?o.volume[r].timer?o.volume[r].value:(n.log("Starting "+r+" volume monitor"),o.volume[r].timer=setInterval(function(){o.pc.getStats().then(function(e){e.forEach(function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(o.volume[r].value=e.audioLevel?e.audioLevel:0))})})},200),0):(n.warn("Local stream unavailable"),0)}function W(e,t){var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),!0;var r=a.webrtcStuff;return r.pc?r.myStream?t?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?!r.myStream.getVideoTracks()[0].enabled:(n.warn("No video track"),!0):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?!r.myStream.getAudioTracks()[0].enabled:(n.warn("No audio track"),!0):(n.warn("Invalid local MediaStream"),!0):(n.warn("Invalid PeerConnection"),!0)}function V(e,t,a){var r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),!1;var o=r.webrtcStuff;return o.pc?o.myStream?t?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?(o.myStream.getVideoTracks()[0].enabled=!a,!0):(n.warn("No video track"),!1):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?(o.myStream.getAudioTracks()[0].enabled=!a,!0):(n.warn("No audio track"),!1):(n.warn("Invalid local MediaStream"),!1):(n.warn("Invalid PeerConnection"),!1)}function z(e){var t=E[e];if(!t||!t.webrtcStuff)return n.warn("Invalid handle"),"Invalid handle";var a=t.webrtcStuff;return a.pc?a.pc.getStats?a.bitrate.timer?a.bitrate.value:(n.log("Starting bitrate timer (via getStats)"),a.bitrate.timer=setInterval(function(){a.pc.getStats().then(function(e){e.forEach(function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(a.bitrate.bsnow=e.bytesReceived,a.bitrate.tsnow=e.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var r=a.bitrate.tsnow-a.bitrate.tsbefore;"safari"===n.webRTCAdapter.browserDetails.browser&&(r/=1e3);var o=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/r);"safari"===n.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),a.bitrate.value=o+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):(n.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function F(e){n.error("WebRTC error:",e)}function q(e,r){n.log("Cleaning WebRTC stuff");var o=E[e];if(o){var i=o.webrtcStuff;if(i){if(!0===r){var c={janus:"hangup",transaction:n.randomString(12)};o.token&&(c.token=o.token),b&&(c.apisecret=b),n.debug("Sending hangup request (handle="+e+"):"),n.debug(c),t?(c.session_id=w,c.handle_id=e,a.send(JSON.stringify(c))):n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:c})}i.remoteStream=null,i.volume&&(i.volume.local&&i.volume.local.timer&&clearInterval(i.volume.local.timer),i.volume.remote&&i.volume.remote.timer&&clearInterval(i.volume.remote.timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null;try{if(!i.streamExternal&&i.myStream){n.log("Stopping local stream tracks");var l=i.myStream.getTracks(),u=!0,d=!1,m=void 0;try{for(var f,v=l[Symbol.iterator]();!(u=(f=v.next()).done);u=!0){var g=f.value;n.log(g),g&&g.stop()}}catch(h){d=!0,m=h}finally{try{u||null==v.return||v.return()}finally{if(d)throw m}}}}catch(y){}i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(y){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null}o.oncleanup()}}function G(e){return n.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function J(e){return n.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function Y(e){return n.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function K(e){return n.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}N(e),this.getServer=function(){return s},this.isConnected=function(){return C},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.reconnect=!0,N(e)},this.getSessionId=function(){return w},this.destroy=function(i){!function(i){(i=i||{}).success="function"==typeof i.success?i.success:n.noop,i.error="function"==typeof i.error?i.error:n.noop;var c=!0===i.unload,l=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(l=!0===i.notifyDestroyed);var u=!0===i.cleanupHandles;if(n.log("Destroying session "+w+" (unload="+c+")"),!w)return n.warn("No session to destroy"),i.success(),void(l&&e.destroyed());if(u)for(var d in E)M(d,{noRequest:!0});if(!C)return n.warn("Is the server down? (connected=false)"),w=null,void i.success();var m={janus:"destroy",transaction:n.randomString(12)};v&&(m.token=v);b&&(m.apisecret=b);if(c)return t?(a.onclose=null,a.close(),a=null):navigator.sendBeacon(s+"/"+w,JSON.stringify(m)),n.log("Destroyed session:"),w=null,C=!1,i.success(),void(l&&e.destroyed());if(t){m.session_id=w;var f=function(){for(var e in r)a.removeEventListener(e,r[e]);a.removeEventListener("message",g),a.removeEventListener("error",h),o&&clearTimeout(o),a.close()},g=function(t){var a=JSON.parse(t.data);a.session_id==m.session_id&&a.transaction==m.transaction&&(f(),i.success(),l&&e.destroyed())},h=function(t){f(),i.error("Failed to destroy the server: Is the server down?"),l&&e.destroyed()};return a.addEventListener("message",g),a.addEventListener("error",h),void a.send(JSON.stringify(m))}n.httpAPICall(s+"/"+w,{verb:"POST",withCredentials:p,body:m,success:function(t){n.log("Destroyed session:"),n.debug(t),w=null,C=!1,"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),i.success(),l&&e.destroyed()},error:function(t,a){n.error(t+":",a),w=null,C=!1,i.success(),l&&e.destroyed()}})}(i)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:n.noop,e.iceState="function"==typeof e.iceState?e.iceState:n.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:n.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:n.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:n.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:n.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:n.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:n.noop,e.ondata="function"==typeof e.ondata?e.ondata:n.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:n.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:n.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:n.noop,!C)return n.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var r=e.plugin;if(!r)return n.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.token?e.token:v,c=n.randomString(12),l={janus:"attach",plugin:r,opaque_id:o,transaction:c};i&&(l.token=i);b&&(l.apisecret=b);if(t)return k[c]=function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;n.log("Created handle: "+a);var o={session:S,plugin:r,id:a,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return r},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return W(a,!1)},muteAudio:function(){return V(a,!1,!0)},unmuteAudio:function(){return V(a,!1,!1)},isVideoMuted:function(){return W(a,!0)},muteVideo:function(){return V(a,!0,!0)},unmuteVideo:function(){return V(a,!0,!1)},getBitrate:function(){return z(a)},send:function(e){D(a,e)},data:function(e){R(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(a,!0,e)},createAnswer:function(e){U(a,!1,e)},handleRemoteJsep:function(e){B(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(a,!0===e)},detach:function(e){M(a,e)}};E[a]=o,e.success(o)},l.session_id=w,void a.send(JSON.stringify(l));n.httpAPICall(s+"/"+w,{verb:"POST",withCredentials:p,body:l,success:function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;n.log("Created handle: "+a);var o={session:S,plugin:r,id:a,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return r},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return W(a,!1)},muteAudio:function(){return V(a,!1,!0)},unmuteAudio:function(){return V(a,!1,!1)},isVideoMuted:function(){return W(a,!0)},muteVideo:function(){return V(a,!0,!0)},unmuteVideo:function(){return V(a,!0,!1)},getBitrate:function(){return z(a)},send:function(e){D(a,e)},data:function(e){R(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(a,!0,e)},createAnswer:function(e){U(a,!1,e)},handleRemoteJsep:function(e){B(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(a,!0===e)},detach:function(e){M(a,e)}};E[a]=o,e.success(o)},error:function(t,a){n.error(t+":",a),""===a?e.error(t+": Is the server down?"):e.error(t+": "+a)}})}(e)}}n.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,o=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new o(e,t)},extension:e&&e.extension||a,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,a){var o={method:a.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===a.verb&&(o.headers["Content-Type"]="application/json"),void 0!==a.withCredentials&&(o.credentials=!0===a.withCredentials?"include":a.withCredentials?a.withCredentials:"omit"),a.body&&(o.body=JSON.stringify(a.body));var i=t(e,o).catch(function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})});if(a.timeout){var c=new r(function(e,t){var n=setTimeout(function(){return clearTimeout(n),t({message:"Request timed out",timeout:a.timeout})},a.timeout)});i=r.race([i,c])}return i.then(function(e){return e.ok?typeof a.success===typeof n.noop?e.json().then(function(e){a.success(e)}).catch(function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})}):void 0:r.reject({message:"API call failed",response:e})}).catch(function(e){typeof a.error===typeof n.noop&&a.error(e.message||"<< internal error >>",e)}),i}}},n.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||a,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,a){var r=void 0!==a.body?{contentType:"application/json",data:JSON.stringify(a.body)}:{},o=void 0!==a.withCredentials?{xhrFields:{withCredentials:a.withCredentials}}:{};return t.ajax(t.extend(r,o,{url:e,type:a.verb,cache:!1,dataType:"json",async:a.async,timeout:a.timeout,success:function(e){typeof a.success===typeof n.noop&&a.success(e)},error:function(e,t,r){typeof a.error===typeof n.noop&&a.error(t,r)}}))}}},n.noop=function(){},n.dataChanDefaultLabel="JanusDataChannel",n.endOfCandidates=null,n.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:n.noop,n.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),n.trace=n.noop,n.debug=n.noop,n.vdebug=n.noop,n.log=n.noop,n.warn=n.noop,n.error=n.noop,!0===e.debug||"all"===e.debug)n.trace=console.trace.bind(console),n.debug=console.debug.bind(console),n.vdebug=console.debug.bind(console),n.log=console.log.bind(console),n.warn=console.warn.bind(console),n.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t=!0,a=!1,r=void 0;try{for(var o,i=e.debug[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var c=o.value;switch(c){case"trace":n.trace=console.trace.bind(console);break;case"debug":n.debug=console.debug.bind(console);break;case"vdebug":n.vdebug=console.debug.bind(console);break;case"log":n.log=console.log.bind(console);break;case"warn":n.warn=console.warn.bind(console);break;case"error":n.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+c+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(y){a=!0,r=y}finally{try{t||null==i.return||i.return()}finally{if(a)throw r}}}n.log("Initializing library");var s=e.dependencies||n.useDefaultDependencies();n.isArray=s.isArray,n.webRTCAdapter=s.webRTCAdapter,n.httpAPICall=s.httpAPICall,n.newWebSocket=s.newWebSocket,n.extension=s.extension,n.extension.init(),n.listDevices=function(e,t){e="function"==typeof e?e:n.noop,null==t&&(t={audio:!0,video:!0}),n.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(a){n.debug(a),e(a);try{var r=t.getTracks(),o=!0,i=!1,c=void 0;try{for(var s,l=r[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value;u&&u.stop()}}catch(y){i=!0,c=y}finally{try{o||null==l.return||l.return()}finally{if(i)throw c}}}catch(d){}})}).catch(function(t){n.error(t),e([])}):(n.warn("navigator.mediaDevices unavailable"),e([]))},n.attachMediaStream=function(e,t){try{e.srcObject=t}catch(a){try{e.src=URL.createObjectURL(t)}catch(a){n.error("Error attaching stream to element")}}},n.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(a){try{e.src=t.src}catch(a){n.error("Error reattaching stream to element")}}};var l=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",u=window["on"+l];if(window.addEventListener(l,function(e){for(var t in n.log("Closing window"),n.sessions)n.sessions[t]&&n.sessions[t].destroyOnUnload&&(n.log("Destroying session "+t),n.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));u&&"function"==typeof u&&u()}),n.safariVp8=!1,"safari"===n.webRTCAdapter.browserDetails.browser&&n.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var d=!0,m=!1,p=void 0;try{for(var f,v=RTCRtpSender.getCapabilities("video").codecs[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;if(b&&b.mimeType&&"video/vp8"===b.mimeType.toLowerCase()){n.safariVp8=!0;break}}}catch(y){m=!0,p=y}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}n.safariVp8?n.log("This version of Safari supports VP8"):n.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var g=new RTCPeerConnection({});g.createOffer({offerToReceiveVideo:!0}).then(function(e){n.safariVp8=-1!==e.sdp.indexOf("VP8"),n.safariVp8?n.log("This version of Safari supports VP8"):n.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),g.close(),g=null})}if(n.unifiedPlan=!1,"firefox"===n.webRTCAdapter.browserDetails.browser&&n.webRTCAdapter.browserDetails.version>=59)n.unifiedPlan=!0;else if("chrome"===n.webRTCAdapter.browserDetails.browser&&n.webRTCAdapter.browserDetails.version<72)n.unifiedPlan=!1;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var h=new RTCPeerConnection;try{h.addTransceiver("audio"),n.unifiedPlan=!0}catch(C){}h.close()}else n.unifiedPlan=!1;n.initDone=!0,e.callback()}},n.isWebrtcSupported=function(){return!!window.RTCPeerConnection},n.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},n.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++){var r=Math.floor(Math.random()*t.length);a+=t.substring(r,r+1)}return a},e.exports=n},267:function(e,t,a){e.exports=a.p+"static/media/index.b4cb6006.png"},268:function(e,t,a){e.exports=a.p+"static/media/class.9d40f54e.png"},269:function(e,t,a){e.exports=a.p+"static/media/insight.f068a8c1.png"},274:function(e,t){},275:function(e,t){},276:function(e,t){},281:function(e,t,a){e.exports=a.p+"static/media/outgoing.c176c843.mp3"},283:function(e,t,a){e.exports=a.p+"static/media/ringtone.da570d5f.mp3"},296:function(e,t,a){e.exports=a.p+"static/media/404error.6695af99.svg"},30:function(e,t){n.sessions={},n.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||n.extension.isInstalled()}return!0};var a={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout(function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)},1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var a=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",a(n)}else a(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))})}};function n(e){if((e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:n.noop,!n.initDone)return e.error("Library not initialized"),{};if(!n.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(n.log("Library initialized: "+n.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,a=null,r={},o=null,i=null,c=0,s=e.server;n.isArray(s)?(n.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,n.debug(i)):0===s.indexOf("ws")?(t=!0,n.log("Using WebSockets to contact Janus: "+s)):(t=!1,n.log("Using REST API to contact Janus: "+s));var l=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],u=e.iceTransportPolicy,d=e.bundlePolicy,m=!0===e.ipv6,p=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(p=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var v=null;void 0!==e.token&&null!==e.token&&(v=e.token);var b=null;void 0!==e.apisecret&&null!==e.apisecret&&(b=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var h=6e4;function y(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(h=e.longPollTimeout),isNaN(h)&&(h=6e4);var C=!1,w=null,E={},S=this,O=0,k={};function I(){if(null!=w)if(n.debug("Long poll..."),C){var t=s+"/"+w+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),v&&(t=t+"&token="+encodeURIComponent(v)),b&&(t=t+"&apisecret="+encodeURIComponent(b)),n.httpAPICall(t,{verb:"GET",withCredentials:p,success:j,timeout:h,error:function(t,a){if(n.error(t+":",a),++O>3)return C=!1,void e.error("Lost connection to the server (is it down?)");I()}})}else n.warn("Is the server down? (connected=false)")}function j(e,r){if(O=0,t||void 0===w||null===w||!0===r||I(),t||!n.isArray(e))if("keepalive"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");var o=e.candidate;n.debug("Got a trickled candidate on session "+w),n.debug(o);var i=d.webrtcStuff;i.pc&&i.remoteSdp?(n.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(n.endOfCandidates)):(n.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(o),n.debug(i.candidates))}else{if("webrtcup"===e.janus)return n.debug("Got a webrtcup event on session "+w),n.debug(e),(l=e.sender)?(d=E[l])?void d.webrtcState(!0):void n.debug("This handle is not attached to this session"):void n.warn("Missing sender...");if("hangup"===e.janus){if(n.debug("Got a hangup event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");d.webrtcState(!1,e.reason),d.hangup()}else if("detached"===e.janus){if(n.debug("Got a detached event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return;d.detached=!0,d.ondetached(),d.detach()}else if("media"===e.janus){if(n.debug("Got a media event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");d.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(n.debug("Got a slowlink event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");if(!(d=E[l]))return void n.debug("This handle is not attached to this session");d.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var c,s;if(n.error("Ooops: "+e.error.code+" "+e.error.reason),n.debug(e),c=e.transaction)(s=k[c])&&s(e),delete k[c];return}if("event"===e.janus){var l;if(n.debug("Got a plugin event on session "+w),n.debug(e),!(l=e.sender))return void n.warn("Missing sender...");var u=e.plugindata;if(!u)return void n.warn("Missing plugindata...");n.debug("  -- Event is coming from "+l+" ("+u.plugin+")");var d,m=u.data;if(n.debug(m),!(d=E[l]))return void n.warn("This handle is not attached to this session");var p=e.jsep;p&&(n.debug("Handling SDP as well..."),n.debug(p));var f=d.onmessage;f?(n.debug("Notifying application..."),f(m,p)):n.debug("No provided notification callback")}else{if("timeout"===e.janus)return n.error("Timeout on session "+w),n.debug(e),void(t&&a.close(3504,"Gateway timeout"));n.warn("Unknown message/event  '"+e.janus+"' on session "+w),n.debug(e)}}}else n.debug("Got a success on session "+w),n.debug(e),(c=e.transaction)&&((s=k[c])&&s(e),delete k[c]);else n.debug("Got an ack on session "+w),n.debug(e),(c=e.transaction)&&((s=k[c])&&s(e),delete k[c]);else n.vdebug("Got a keepalive on session "+w);else for(var v=0;v<e.length;v++)j(e[v],!0)}function x(){if(s&&t&&C){o=setTimeout(x,g);var e={janus:"keepalive",session_id:w,transaction:n.randomString(12)};v&&(e.token=v),b&&(e.apisecret=b),a.send(JSON.stringify(e))}}function N(l){var u=n.randomString(12),d={janus:"create",transaction:u};if(l.reconnect&&(C=!1,d.janus="claim",d.session_id=w,a&&(a.onopen=null,a.onerror=null,a.onclose=null,o&&(clearTimeout(o),o=null))),v&&(d.token=v),b&&(d.apisecret=b),!s&&n.isArray(i)&&(0===(s=i[c]).indexOf("ws")?(t=!0,n.log("Server #"+(c+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,n.log("Server #"+(c+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var m in a=n.newWebSocket(s,"janus-protocol"),r={error:function(){if(n.error("Error connecting to the Janus WebSockets server... "+s),n.isArray(i)&&!l.reconnect)return++c===i.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout(function(){N(l)},200));l.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){k[u]=function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void l.error(e.error.reason);o=setTimeout(x,g),C=!0,w=e.session_id?e.session_id:e.data.id,l.reconnect?n.log("Claimed session: "+w):n.log("Created session: "+w),n.sessions[w]=S,l.success()},a.send(JSON.stringify(d))},message:function(e){j(JSON.parse(e.data))},close:function(){s&&C&&(C=!1,e.error("Lost connection to the server (is it down?)"))}})a.addEventListener(m,r[m]);else n.httpAPICall(s,{verb:"POST",withCredentials:p,body:d,success:function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void l.error(e.error.reason);C=!0,w=e.session_id?e.session_id:e.data.id,l.reconnect?n.log("Claimed session: "+w):n.log("Created session: "+w),n.sessions[w]=S,I(),l.success()},error:function(e,t){if(n.error(e+":",t),n.isArray(i)&&!l.reconnect)return++c===i.length?void l.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout(function(){N(l)},200));""===t?l.error(e+": Is the server down?"):l.error(e+": "+t)}})}function D(e,r){if((r=r||{}).success="function"==typeof r.success?r.success:n.noop,r.error="function"==typeof r.error?r.error:n.noop,!C)return n.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var o=E[e];if(!o||!o.webrtcStuff)return n.warn("Invalid handle"),void r.error("Invalid handle");var i=r.message,c=r.jsep,l=n.randomString(12),u={janus:"message",body:i,transaction:l};if(o.token&&(u.token=o.token),b&&(u.apisecret=b),c&&(u.jsep=c),n.debug("Sending message to plugin (handle="+e+"):"),n.debug(u),t)return u.session_id=w,u.handle_id=e,k[l]=function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return n.warn("Request succeeded, but missing plugindata..."),void r.success();n.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return n.debug(a),void r.success(a)}"ack"===e.janus?r.success():e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),r.error("Unknown error"))},void a.send(JSON.stringify(u));n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:u,success:function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return n.warn("Request succeeded, but missing plugindata..."),void r.success();n.log("Synchronous transaction successful ("+t.plugin+")");var a=t.data;return n.debug(a),void r.success(a)}"ack"===e.janus?r.success():e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),r.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),r.error("Unknown error"))},error:function(e,t){n.error(e+":",t),r.error(e+": "+t)}})}function A(e,r){if(C){var o=E[e];if(o&&o.webrtcStuff){var i={janus:"trickle",candidate:r,transaction:n.randomString(12)};if(o.token&&(i.token=o.token),b&&(i.apisecret=b),n.vdebug("Sending trickle candidate (handle="+e+"):"),n.vdebug(i),t)return i.session_id=w,i.handle_id=e,void a.send(JSON.stringify(i));n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:i,success:function(e){n.vdebug("Candidate sent!"),n.vdebug(e),"ack"===e.janus||n.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){n.error(e+":",t)}})}else n.warn("Invalid handle")}else n.warn("Is the server down? (connected=false)")}function T(e,t,a,r){var o=E[e];if(o&&o.webrtcStuff){var i=o.webrtcStuff,c=function(e){n.log("Received state change on data channel:",e);var t=e.target.label,a=i.dataChannel[t]?i.dataChannel[t].readyState:"null";if(n.log("State change on <"+t+"> data channel: "+a),"open"===a){if(i.dataChannel[t].pending&&i.dataChannel[t].pending.length>0){n.log("Sending pending messages on <"+t+">:",i.dataChannel[t].pending.length);var r=!0,c=!1,s=void 0;try{for(var l,u=i.dataChannel[t].pending[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;n.log("Sending data on data channel <"+t+">"),n.debug(d),i.dataChannel[t].send(d)}}catch(m){c=!0,s=m}finally{try{r||null==u.return||u.return()}finally{if(c)throw s}}i.dataChannel[t].pending=[]}o.ondataopen(t)}};i.dataChannel[t]=a||i.pc.createDataChannel(t,{ordered:!0}),i.dataChannel[t].onmessage=function(e){n.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},i.dataChannel[t].onopen=c,i.dataChannel[t].onclose=c,i.dataChannel[t].onerror=function(e){n.error("Got error on data channel:",e)},i.dataChannel[t].pending=[],r&&i.dataChannel[t].pending.push(r)}else n.warn("Invalid handle")}function R(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff,o=t.text||t.data;if(!o)return n.warn("Invalid data"),void t.error("Invalid data");var i=t.label?t.label:n.dataChanDefaultLabel;return r.dataChannel[i]?"open"!==r.dataChannel[i].readyState?(r.dataChannel[i].pending.push(o),void t.success()):(n.log("Sending data on data channel <"+i+">"),n.debug(o),r.dataChannel[i].send(o),void t.success()):(T(e,i,!1,o),void t.success())}function P(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=a.webrtcStuff;if(!r.dtmfSender){if(r.pc){var o=r.pc.getSenders().find(function(e){return e.track&&"audio"===e.track.kind});if(!o)return n.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");r.dtmfSender=o.dtmf,r.dtmfSender&&(n.log("Created DTMF Sender"),r.dtmfSender.ontonechange=function(e){n.debug("Sent DTMF tone: "+e.tone)})}if(!r.dtmfSender)return n.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var i=t.dtmf;if(!i)return n.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var c=i.tones;if(!c)return n.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"===typeof i.duration?i.duration:500,l="number"===typeof i.gap?i.gap:50;n.debug("Sending DTMF string "+c+" (duration "+s+"ms, gap "+l+"ms)"),r.dtmfSender.insertDTMF(c,s,l),t.success()}function M(e,r){(r=r||{}).success="function"==typeof r.success?r.success:n.noop,r.error="function"==typeof r.error?r.error:n.noop;var o=!0===r.noRequest;n.log("Destroying handle "+e+" (only-locally="+o+")"),q(e);var i=E[e];if(!i||i.detached)return delete E[e],void r.success();if(o)return delete E[e],void r.success();if(!C)return n.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var c={janus:"detach",transaction:n.randomString(12)};if(i.token&&(c.token=i.token),b&&(c.apisecret=b),t)return c.session_id=w,c.handle_id=e,a.send(JSON.stringify(c)),delete E[e],void r.success();n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:c,success:function(t){n.log("Destroyed handle:"),n.debug(t),"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),delete E[e],r.success()},error:function(t,a){n.error(t+":",a),delete E[e],r.success()}})}function H(e,t,a,r,o){var i=E[e];if(!i||!i.webrtcStuff)return n.warn("Invalid handle"),void r.error("Invalid handle");var c=i.webrtcStuff;n.debug("streamsDone:",o),o&&(n.debug("  -- Audio tracks:",o.getAudioTracks()),n.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(c.myStream&&a.update&&!c.streamExternal){if((!a.update&&G(a)||a.update&&(a.addAudio||a.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(c.myStream.addTrack(o.getAudioTracks()[0]),n.unifiedPlan){n.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var p=null;if((C=c.pc.getTransceivers())&&C.length>0){var f=!0,v=!1,b=void 0;try{for(var g,h=C[Symbol.iterator]();!(f=(g=h.next()).done);f=!0){if((x=g.value).sender&&x.sender.track&&"audio"===x.sender.track.kind||x.receiver&&x.receiver.track&&"audio"===x.receiver.track.kind){p=x;break}}}catch(M){v=!0,b=M}finally{try{f||null==h.return||h.return()}finally{if(v)throw b}}}p&&p.sender?p.sender.replaceTrack(o.getAudioTracks()[0]):c.pc.addTrack(o.getAudioTracks()[0],o)}else n.log((a.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),c.pc.addTrack(o.getAudioTracks()[0],o);if((!a.update&&Y(a)||a.update&&(a.addVideo||a.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(c.myStream.addTrack(o.getVideoTracks()[0]),n.unifiedPlan){n.log((a.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var C,w=null;if((C=c.pc.getTransceivers())&&C.length>0){var S=!0,O=!1,k=void 0;try{for(var I,j=C[Symbol.iterator]();!(S=(I=j.next()).done);S=!0){var x;if((x=I.value).sender&&x.sender.track&&"video"===x.sender.track.kind||x.receiver&&x.receiver.track&&"video"===x.receiver.track.kind){w=x;break}}}catch(M){O=!0,k=M}finally{try{S||null==j.return||j.return()}finally{if(O)throw k}}}w&&w.sender?w.sender.replaceTrack(o.getVideoTracks()[0]):c.pc.addTrack(o.getVideoTracks()[0],o)}else n.log((a.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),c.pc.addTrack(o.getVideoTracks()[0],o)}else c.myStream=o,s=!0;if(!c.pc){var N={iceServers:l,iceTransportPolicy:u,bundlePolicy:d};"chrome"===n.webRTCAdapter.browserDetails.browser&&(N.sdpSemantics=n.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var D={optional:[{DtlsSrtpKeyAgreement:!0}]};if(m&&D.optional.push({googIPv6:!0}),r.rtcConstraints&&"object"===typeof r.rtcConstraints)for(var R in n.debug("Adding custom PeerConnection constraints:",r.rtcConstraints),r.rtcConstraints)D.optional.push(r.rtcConstraints[R]);"edge"===n.webRTCAdapter.browserDetails.browser&&(N.bundlePolicy="max-bundle"),n.log("Creating PeerConnection"),n.debug(D),c.pc=new RTCPeerConnection(N,D),n.debug(c.pc),c.pc.getStats&&(c.volume={},c.bitrate.value="0 kbits/sec"),n.log("Preparing local SDP and gathering candidates (trickle="+c.trickle+")"),c.pc.oniceconnectionstatechange=function(e){c.pc&&i.iceState(c.pc.iceConnectionState)},c.pc.onicecandidate=function(t){if(!t.candidate||"edge"===n.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)n.log("End of candidates."),c.iceDone=!0,!0===c.trickle?A(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=E[e];if(!a||!a.webrtcStuff)return void n.warn("Invalid handle, not sending anything");var r=a.webrtcStuff;if(n.log("Sending offer/answer SDP..."),!r.mySdp)return void n.warn("Local SDP instance is invalid, not sending anything...");r.mySdp={type:r.pc.localDescription.type,sdp:r.pc.localDescription.sdp},!1===r.trickle&&(r.mySdp.trickle=!1);n.debug(t),r.sdpSent=!0,t.success(r.mySdp)}(e,r);else{var a={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===c.trickle&&A(e,a)}},c.pc.ontrack=function(e){if(n.log("Handling Remote Track"),n.debug(e),e.streams&&(c.remoteStream=e.streams[0],i.onremotestream(c.remoteStream),!e.track.onended)){var t=null;n.log("Adding onended callback to track:",e.track),e.track.onended=function(e){n.log("Remote track removed:",e),c.remoteStream&&(clearTimeout(t),c.remoteStream.removeTrack(e.target),i.onremotestream(c.remoteStream))},e.track.onmute=function(e){n.log("Remote track muted:",e),c.remoteStream&&null==t&&(t=setTimeout(function(){n.log("Removing remote track"),c.remoteStream.removeTrack(e.target),i.onremotestream(c.remoteStream),t=null},2520))},e.track.onunmute=function(e){if(n.log("Remote track flowing again:",e),null!=t)clearTimeout(t),t=null;else try{c.remoteStream.addTrack(e.target),i.onremotestream(c.remoteStream)}catch(a){n.error(a)}}}}}if(s&&o){n.log("Adding local stream");var P=!0===r.simulcast2;o.getTracks().forEach(function(e){if(n.log("Adding local track:",e),P)if("audio"===e.kind)c.pc.addTrack(e,o);else{n.log("Enabling rid-based simulcasting:",e);var t=y(r.simulcastMaxBitrates);c.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else c.pc.addTrack(e,o)})}(function(e){if(n.debug("isDataEnabled:",e),"edge"===n.webRTCAdapter.browserDetails.browser)return n.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(a)&&!c.dataChannel[n.dataChanDefaultLabel]&&(n.log("Creating data channel"),T(e,n.dataChanDefaultLabel,!1),c.pc.ondatachannel=function(t){n.log("Data channel created by Janus:",t),T(e,t.channel.label,t.channel)}),c.myStream&&i.onlocalstream(c.myStream),t?c.pc.setRemoteDescription(t).then(function(){if(n.log("Remote description accepted!"),c.remoteSdp=t.sdp,c.candidates&&c.candidates.length>0){for(var o=0;o<c.candidates.length;o++){var i=c.candidates[o];n.debug("Adding remote candidate:",i),i&&!0!==i.completed?c.pc.addIceCandidate(i):c.pc.addIceCandidate(n.endOfCandidates)}c.candidates=[]}!function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:n.noop;var r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var o=r.webrtcStuff,i=!0===a.simulcast;i?n.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):n.log("Creating answer (iceDone="+o.iceDone+")");var c=null;if(n.unifiedPlan){c={};var s=null,l=null,u=o.pc.getTransceivers();if(u&&u.length>0){var d=!0,m=!1,p=void 0;try{for(var f,v=u[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;b.sender&&b.sender.track&&"audio"===b.sender.track.kind||b.receiver&&b.receiver.track&&"audio"===b.receiver.track.kind?s||(s=b):(b.sender&&b.sender.track&&"video"===b.sender.track.kind||b.receiver&&b.receiver.track&&"video"===b.receiver.track.kind)&&(l||(l=b))}}catch(M){m=!0,p=M}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}}var g=G(t),h=J(t);if(g||h){if(g&&h){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",n.log("Setting audio transceiver to sendrecv:",s)}catch(j){n.error(j)}}else if(g&&!h)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",n.log("Setting audio transceiver to sendonly:",s))}catch(j){n.error(j)}else if(!g&&h)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",n.log("Setting audio transceiver to recvonly:",s)}catch(j){n.error(j)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),n.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",n.log("Setting audio transceiver to inactive:",s)}catch(j){n.error(j)}var C=Y(t),w=K(t);if(C||w){if(C&&w){if(l)try{l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",n.log("Setting video transceiver to sendrecv:",l)}catch(j){n.error(j)}}else if(C&&!w){if(l)try{l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",n.log("Setting video transceiver to sendonly:",l)}catch(j){n.error(j)}}else if(!C&&w)if(l)try{l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",n.log("Setting video transceiver to recvonly:",l)}catch(j){n.error(j)}else l=o.pc.addTransceiver("video",{direction:"recvonly"}),n.log("Adding recvonly video transceiver:",l)}else if(t.removeVideo&&l)try{l.setDirection?l.setDirection("inactive"):l.direction="inactive",n.log("Setting video transceiver to inactive:",l)}catch(j){n.error(j)}}else c="firefox"===n.webRTCAdapter.browserDetails.browser||"edge"===n.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:J(t),offerToReceiveVideo:K(t)}:{mandatory:{OfferToReceiveAudio:J(t),OfferToReceiveVideo:K(t)}};n.debug(c);var S=Y(t);if(S&&i&&"firefox"===n.webRTCAdapter.browserDetails.browser){n.log("Enabling Simulcasting for Firefox (RID)");var O=o.pc.getSenders()[1];n.log(O);var k=O.getParameters();n.log(k);var I=y(a.simulcastMaxBitrates);O.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:I.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:I.medium},{rid:"low",active:!0,priority:"low",maxBitrate:I.low}]})}o.pc.createAnswer(c).then(function(e){n.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,n.log("Setting local description"),S&&i&&("chrome"===n.webRTCAdapter.browserDetails.browser?n.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==n.webRTCAdapter.browserDetails.browser&&n.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(a.error),o.mediaConstraints=c,o.iceDone||o.trickle?a.success(e):n.log("Waiting for all candidates...")},a.error)}(e,a,r)},r.error):function(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop,a.customizeSdp="function"==typeof a.customizeSdp?a.customizeSdp:n.noop;var r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var o=r.webrtcStuff,i=!0===a.simulcast;i?n.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):n.log("Creating offer (iceDone="+o.iceDone+")");var c={};if(n.unifiedPlan){var s=null,l=null,u=o.pc.getTransceivers();if(u&&u.length>0){var d=!0,m=!1,p=void 0;try{for(var f,v=u[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;b.sender&&b.sender.track&&"audio"===b.sender.track.kind||b.receiver&&b.receiver.track&&"audio"===b.receiver.track.kind?s||(s=b):(b.sender&&b.sender.track&&"video"===b.sender.track.kind||b.receiver&&b.receiver.track&&"video"===b.receiver.track.kind)&&(l||(l=b))}}catch(M){m=!0,p=M}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}}var g=G(t),h=J(t);g||h?g&&h?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",n.log("Setting audio transceiver to sendrecv:",s)):g&&!h?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",n.log("Setting audio transceiver to sendonly:",s)):!g&&h&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",n.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),n.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",n.log("Setting audio transceiver to inactive:",s));var C=Y(t),w=K(t);C||w?C&&w?l&&(l.setDirection?l.setDirection("sendrecv"):l.direction="sendrecv",n.log("Setting video transceiver to sendrecv:",l)):C&&!w?l&&(l.setDirection?l.setDirection("sendonly"):l.direction="sendonly",n.log("Setting video transceiver to sendonly:",l)):!C&&w&&(l?(l.setDirection?l.setDirection("recvonly"):l.direction="recvonly",n.log("Setting video transceiver to recvonly:",l)):(l=o.pc.addTransceiver("video",{direction:"recvonly"}),n.log("Adding recvonly video transceiver:",l))):t.removeVideo&&l&&(l.setDirection?l.setDirection("inactive"):l.direction="inactive",n.log("Setting video transceiver to inactive:",l))}else c.offerToReceiveAudio=J(t),c.offerToReceiveVideo=K(t);!0===a.iceRestart&&(c.iceRestart=!0);n.debug(c);var S=Y(t);if(S&&i&&"firefox"===n.webRTCAdapter.browserDetails.browser){n.log("Enabling Simulcasting for Firefox (RID)");var O=o.pc.getSenders().find(function(e){return"video"===e.track.kind});if(O){var k=O.getParameters();k||(k={});var I=y(a.simulcastMaxBitrates);k.encodings=[{rid:"h",active:!0,maxBitrate:I.high},{rid:"m",active:!0,maxBitrate:I.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:I.low,scaleResolutionDownBy:4}],O.setParameters(k)}}o.pc.createOffer(c).then(function(e){n.debug(e);var t={type:e.type,sdp:e.sdp};a.customizeSdp(t),e.sdp=t.sdp,n.log("Setting local description"),S&&i&&("chrome"===n.webRTCAdapter.browserDetails.browser||"safari"===n.webRTCAdapter.browserDetails.browser?(n.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var t=e.split("\r\n"),a=!1,r=[-1],o=[-1],i=null,c=null,s=null,l=null,u=-1,d=0;d<t.length;d++){var m=t[d].match(/m=(\w+) */);if(m){var p=m[1];if("video"===p){if(!(r[0]<0)){u=d;break}a=!0}else if(r[0]>-1){u=d;break}}else if(a){var f=t[d].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)r[0]=f[1],o[0]=f[2],t.splice(d,1),d--;else{if(r[0]){var v=t[d].match("a=ssrc:"+r[0]+" cname:(.+)");if(v&&(i=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(c=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" label:(.+)"))&&(l=v[1]),0===t[d].indexOf("a=ssrc:"+o[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}}0!=t[d].length||(t.splice(d,1),d--)}}}if(r[0]<0){u=-1,a=!1;for(var d=0;d<t.length;d++){var m=t[d].match(/m=(\w+) */);if(m){var p=m[1];if("video"===p){if(!(r[0]<0)){u=d;break}a=!0}else if(r[0]>-1){u=d;break}}else if(a){if(r[0]<0){var b=t[d].match(/a=ssrc:(\d+)/);if(b){r[0]=b[1],t.splice(d,1),d--;continue}}else{var v=t[d].match("a=ssrc:"+r[0]+" cname:(.+)");if(v&&(i=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" msid:(.+)"))&&(c=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" mslabel:(.+)"))&&(s=v[1]),(v=t[d].match("a=ssrc:"+r[0]+" label:(.+)"))&&(l=v[1]),0===t[d].indexOf("a=ssrc:"+o[0])){t.splice(d,1),d--;continue}if(0===t[d].indexOf("a=ssrc:"+r[0])){t.splice(d,1),d--;continue}}0!==t[d].length||(t.splice(d,1),d--)}}}if(r[0]<0)return n.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;u<0&&(u=t.length);r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(var d=0;d<r.length;d++)i&&(t.splice(u,0,"a=ssrc:"+r[d]+" cname:"+i),u++),c&&(t.splice(u,0,"a=ssrc:"+r[d]+" msid:"+c),u++),s&&(t.splice(u,0,"a=ssrc:"+r[d]+" mslabel:"+s),u++),l&&(t.splice(u,0,"a=ssrc:"+r[d]+" label:"+l),u++),i&&(t.splice(u,0,"a=ssrc:"+o[d]+" cname:"+i),u++),c&&(t.splice(u,0,"a=ssrc:"+o[d]+" msid:"+c),u++),s&&(t.splice(u,0,"a=ssrc:"+o[d]+" mslabel:"+s),u++),l&&(t.splice(u,0,"a=ssrc:"+o[d]+" label:"+l),u++);t.splice(u,0,"a=ssrc-group:FID "+r[2]+" "+o[2]),t.splice(u,0,"a=ssrc-group:FID "+r[1]+" "+o[1]),t.splice(u,0,"a=ssrc-group:FID "+r[0]+" "+o[0]),t.splice(u,0,"a=ssrc-group:SIM "+r[0]+" "+r[1]+" "+r[2]),(e=t.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==n.webRTCAdapter.browserDetails.browser&&n.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(a.error),o.mediaConstraints=c,o.iceDone||o.trickle?(n.log("Offer ready"),n.debug(a),a.success(e)):n.log("Waiting for all candidates...")},a.error)}(e,a,r)}function U(e,t,a){(a=a||{}).success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:F;var r=a.jsep;if(t&&r)return n.error("Provided a JSEP to a createOffer"),void a.error("Provided a JSEP to a createOffer");if(!t&&(!r||!r.type||!r.sdp))return n.error("A valid JSEP is required for createAnswer"),void a.error("A valid JSEP is required for createAnswer");a.media="object"===typeof a.media&&a.media?a.media:{audio:!0,video:!0};var o=a.media,i=E[e];if(!i||!i.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var c,s=i.webrtcStuff;if(s.trickle=(c=a.trickle,n.debug("isTrickleEnabled:",c),!1!==c),s.pc){if(n.log("Updating existing media session"),o.update=!0,a.stream)a.stream!==s.myStream&&n.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return n.error("Can't add audio stream, there already is one"),void a.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!G(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),G(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return n.error("Can't add video stream, there already is one"),void a.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!Y(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Y(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(G(o)&&o.keepAudio&&Y(o)&&o.keepVideo)return i.consentDialog(!1),void H(e,r,o,a,s.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&!s.streamExternal){if(o.removeAudio||o.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var l=s.myStream.getAudioTracks()[0];n.log("Removing audio track:",l),s.myStream.removeTrack(l);try{l.stop()}catch(_){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var u=!0;if(o.replaceAudio&&n.unifiedPlan&&(u=!1),u){var d=!0,m=!1,p=void 0;try{for(var f,v=s.pc.getSenders()[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;b&&b.track&&"audio"===b.track.kind&&(n.log("Removing audio sender:",b),s.pc.removeTrack(b))}}catch(Z){m=!0,p=Z}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}}}}if(o.removeVideo||o.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var g=s.myStream.getVideoTracks()[0];n.log("Removing video track:",g),s.myStream.removeTrack(g);try{g.stop()}catch(_){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var h=!0;if(o.replaceVideo&&n.unifiedPlan&&(h=!1),h){var y=!0,C=!1,w=void 0;try{for(var S,O=s.pc.getSenders()[Symbol.iterator]();!(y=(S=O.next()).done);y=!0){var k=S.value;k&&k.track&&"video"===k.track.kind&&(n.log("Removing video sender:",k),s.pc.removeTrack(k))}}catch(Z){C=!0,w=Z}finally{try{y||null==O.return||O.return()}finally{if(C)throw w}}}}}}if(a.stream){var I=a.stream;if(n.log("MediaStream provided by the application"),n.debug(I),o.update&&s.myStream&&s.myStream!==a.stream&&!s.streamExternal){try{var j=s.myStream.getTracks(),x=!0,N=!1,D=void 0;try{for(var A,T=j[Symbol.iterator]();!(x=(A=T.next()).done);x=!0){var R=A.value;n.log(R),R&&R.stop()}}catch(Z){N=!0,D=Z}finally{try{x||null==T.return||T.return()}finally{if(N)throw D}}}catch(_){}s.myStream=null}return s.streamExternal=!0,i.consentDialog(!1),void H(e,r,o,a,I)}if(G(o)||Y(o)){if(!n.isGetUserMediaAvailable())return void a.error("getUserMedia not available");var P={mandatory:{},optional:[]};i.consentDialog(!0);var M=G(o);M&&o&&"object"===typeof o.audio&&(M=o.audio);var U=Y(o);if(U&&o){var B=!0===a.simulcast,L=!0===a.simulcast2;if(!B&&!L||r||o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===typeof o.video)U=o.video;else{var W=0,V=0;"lowres"===o.video?(V=240,W=320):"lowres-16:9"===o.video?(V=180,W=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(V=720,W=1280):"fhdres"===o.video?(V=1080,W=1920):"4kres"===o.video?(V=2160,W=3840):"stdres"===o.video?(V=480,W=640):"stdres-16:9"===o.video?(V=360,W=640):(n.log("Default video setting is stdres 4:3"),V=480,W=640),n.log("Adding media constraint:",o.video),U={height:{ideal:V},width:{ideal:W}},n.log("Adding video constraint:",U)}else if("screen"===o.video||"window"===o.video){var z=function(t,n){i.consentDialog(!1),t?a.error(t):H(e,r,o,a,n)},q=function(e,t,a){n.log("Adding media constraint (screen capture)"),n.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){a?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(a){e.addTrack(a.getAudioTracks()[0]),t(null,e)}):t(null,e)}).catch(function(e){i.consentDialog(!1),t(e)})};if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return P.video={},o.screenshareFrameRate&&(P.video.frameRate=o.screenshareFrameRate),o.screenshareHeight&&(P.video.height=o.screenshareHeight),o.screenshareWidth&&(P.video.width=o.screenshareWidth),P.audio=o.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(P).then(function(t){i.consentDialog(!1),G(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(n){t.addTrack(n.getAudioTracks()[0]),H(e,r,o,a,t)}):H(e,r,o,a,t)},function(e){i.consentDialog(!1),a.error(e)});if("chrome"===n.webRTCAdapter.browserDetails.browser){var J=n.webRTCAdapter.browserDetails.version,K=33;window.navigator.userAgent.match("Linux")&&(K=35),J>=26&&J<=K?(P={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:G(o)&&!o.keepAudio},q(P,z)):n.extension.getScreen(function(e,t){if(e)return i.consentDialog(!1),a.error(e);(P={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t,q(P,z,G(o)&&!o.keepAudio)})}else if("firefox"===n.webRTCAdapter.browserDetails.browser){if(!(n.webRTCAdapter.browserDetails.version>=33)){var Q=new Error("NavigatorUserMediaError");return Q.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void a.error(Q)}P={video:{mozMediaSource:o.video,mediaSource:o.video},audio:G(o)&&!o.keepAudio},q(P,function(e,t){if(z(e,t),!e)var a=t.currentTime,n=window.setInterval(function(){t||window.clearInterval(n),t.currentTime==a&&(window.clearInterval(n),t.onended&&t.onended()),a=t.currentTime},500)})}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then(function(t){var c=t.some(function(e){return"audioinput"===e.kind}),s=function(e){if(n.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(o)||t.some(function(e){return"videoinput"===e.kind}),l=G(o),u=Y(o),d=function(e){return n.debug("isAudioSendRequired:",e),!!e&&!1!==e.audio&&!1!==e.audioSend&&void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio}(o),m=function(e){return n.debug("isVideoSendRequired:",e),!!e&&!1!==e.video&&!1!==e.videoSend&&void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo}(o);if(l||u||d||m){var p=!!l&&c,f=!!u&&s;if(!p&&!f)return i.consentDialog(!1),a.error("No capture device found"),!1;if(!p&&d)return i.consentDialog(!1),a.error("Audio capture is required, but no capture device found"),!1;if(!f&&m)return i.consentDialog(!1),a.error("Video capture is required, but no capture device found"),!1}var v={audio:!(!c||o.keepAudio)&&M,video:!(!s||o.keepVideo)&&U};n.debug("getUserMedia constraints",v),v.audio||v.video?navigator.mediaDevices.getUserMedia(v).then(function(t){i.consentDialog(!1),H(e,r,o,a,t)}).catch(function(e){i.consentDialog(!1),a.error({code:e.code,name:e.name,message:e.message})}):(i.consentDialog(!1),H(e,r,o,a,I))}).catch(function(e){i.consentDialog(!1),a.error("enumerateDevices error",e)})}else H(e,r,o,a)}function B(e,t){(t=t||{}).success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:F;var a=t.jsep,r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var o=r.webrtcStuff;if(a){if(!o.pc)return n.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(a).then(function(){if(n.log("Remote description accepted!"),o.remoteSdp=a.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var r=o.candidates[e];n.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(n.endOfCandidates)}o.candidates=[]}t.success()},t.error)}else t.error("Invalid JSEP")}function L(e,t){var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),0;var r=t?"remote":"local",o=a.webrtcStuff;return o.volume[r]||(o.volume[r]={value:0}),!o.pc.getStats||"chrome"!==n.webRTCAdapter.browserDetails.browser&&"safari"!==n.webRTCAdapter.browserDetails.browser?(n.warn("Getting the "+r+" volume unsupported by browser"),0):t&&!o.remoteStream?(n.warn("Remote stream unavailable"),0):t||o.myStream?o.volume[r].timer?o.volume[r].value:(n.log("Starting "+r+" volume monitor"),o.volume[r].timer=setInterval(function(){o.pc.getStats().then(function(e){e.forEach(function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(o.volume[r].value=e.audioLevel?e.audioLevel:0))})})},200),0):(n.warn("Local stream unavailable"),0)}function W(e,t){var a=E[e];if(!a||!a.webrtcStuff)return n.warn("Invalid handle"),!0;var r=a.webrtcStuff;return r.pc?r.myStream?t?r.myStream.getVideoTracks()&&0!==r.myStream.getVideoTracks().length?!r.myStream.getVideoTracks()[0].enabled:(n.warn("No video track"),!0):r.myStream.getAudioTracks()&&0!==r.myStream.getAudioTracks().length?!r.myStream.getAudioTracks()[0].enabled:(n.warn("No audio track"),!0):(n.warn("Invalid local MediaStream"),!0):(n.warn("Invalid PeerConnection"),!0)}function V(e,t,a){var r=E[e];if(!r||!r.webrtcStuff)return n.warn("Invalid handle"),!1;var o=r.webrtcStuff;return o.pc?o.myStream?t?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?(o.myStream.getVideoTracks()[0].enabled=!a,!0):(n.warn("No video track"),!1):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?(o.myStream.getAudioTracks()[0].enabled=!a,!0):(n.warn("No audio track"),!1):(n.warn("Invalid local MediaStream"),!1):(n.warn("Invalid PeerConnection"),!1)}function z(e){var t=E[e];if(!t||!t.webrtcStuff)return n.warn("Invalid handle"),"Invalid handle";var a=t.webrtcStuff;return a.pc?a.pc.getStats?a.bitrate.timer?a.bitrate.value:(n.log("Starting bitrate timer (via getStats)"),a.bitrate.timer=setInterval(function(){a.pc.getStats().then(function(e){e.forEach(function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(a.bitrate.bsnow=e.bytesReceived,a.bitrate.tsnow=e.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var r=a.bitrate.tsnow-a.bitrate.tsbefore;"safari"===n.webRTCAdapter.browserDetails.browser&&(r/=1e3);var o=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/r);"safari"===n.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),a.bitrate.value=o+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):(n.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function F(e){n.error("WebRTC error:",e)}function q(e,r){n.log("Cleaning WebRTC stuff");var o=E[e];if(o){var i=o.webrtcStuff;if(i){if(!0===r){var c={janus:"hangup",transaction:n.randomString(12)};o.token&&(c.token=o.token),b&&(c.apisecret=b),n.debug("Sending hangup request (handle="+e+"):"),n.debug(c),t?(c.session_id=w,c.handle_id=e,a.send(JSON.stringify(c))):n.httpAPICall(s+"/"+w+"/"+e,{verb:"POST",withCredentials:p,body:c})}i.remoteStream=null,i.volume&&(i.volume.local&&i.volume.local.timer&&clearInterval(i.volume.local.timer),i.volume.remote&&i.volume.remote.timer&&clearInterval(i.volume.remote.timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null;try{if(!i.streamExternal&&i.myStream){n.log("Stopping local stream tracks");var l=i.myStream.getTracks(),u=!0,d=!1,m=void 0;try{for(var f,v=l[Symbol.iterator]();!(u=(f=v.next()).done);u=!0){var g=f.value;n.log(g),g&&g.stop()}}catch(h){d=!0,m=h}finally{try{u||null==v.return||v.return()}finally{if(d)throw m}}}}catch(y){}i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(y){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null}o.oncleanup()}}function G(e){return n.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function J(e){return n.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function Y(e){return n.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function K(e){return n.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}N(e),this.getServer=function(){return s},this.isConnected=function(){return C},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.reconnect=!0,N(e)},this.getSessionId=function(){return w},this.destroy=function(i){!function(i){(i=i||{}).success="function"==typeof i.success?i.success:n.noop,i.error="function"==typeof i.error?i.error:n.noop;var c=!0===i.unload,l=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(l=!0===i.notifyDestroyed);var u=!0===i.cleanupHandles;if(n.log("Destroying session "+w+" (unload="+c+")"),!w)return n.warn("No session to destroy"),i.success(),void(l&&e.destroyed());if(u)for(var d in E)M(d,{noRequest:!0});if(!C)return n.warn("Is the server down? (connected=false)"),w=null,void i.success();var m={janus:"destroy",transaction:n.randomString(12)};v&&(m.token=v);b&&(m.apisecret=b);if(c)return t?(a.onclose=null,a.close(),a=null):navigator.sendBeacon(s+"/"+w,JSON.stringify(m)),n.log("Destroyed session:"),w=null,C=!1,i.success(),void(l&&e.destroyed());if(t){m.session_id=w;var f=function(){for(var e in r)a.removeEventListener(e,r[e]);a.removeEventListener("message",g),a.removeEventListener("error",h),o&&clearTimeout(o),a.close()},g=function(t){var a=JSON.parse(t.data);a.session_id==m.session_id&&a.transaction==m.transaction&&(f(),i.success(),l&&e.destroyed())},h=function(t){f(),i.error("Failed to destroy the server: Is the server down?"),l&&e.destroyed()};return a.addEventListener("message",g),a.addEventListener("error",h),void a.send(JSON.stringify(m))}n.httpAPICall(s+"/"+w,{verb:"POST",withCredentials:p,body:m,success:function(t){n.log("Destroyed session:"),n.debug(t),w=null,C=!1,"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),i.success(),l&&e.destroyed()},error:function(t,a){n.error(t+":",a),w=null,C=!1,i.success(),l&&e.destroyed()}})}(i)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:n.noop,e.iceState="function"==typeof e.iceState?e.iceState:n.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:n.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:n.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:n.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:n.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:n.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:n.noop,e.ondata="function"==typeof e.ondata?e.ondata:n.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:n.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:n.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:n.noop,!C)return n.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var r=e.plugin;if(!r)return n.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.token?e.token:v,c=n.randomString(12),l={janus:"attach",plugin:r,opaque_id:o,transaction:c};i&&(l.token=i);b&&(l.apisecret=b);if(t)return k[c]=function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;n.log("Created handle: "+a);var o={session:S,plugin:r,id:a,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return r},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return W(a,!1)},muteAudio:function(){return V(a,!1,!0)},unmuteAudio:function(){return V(a,!1,!1)},isVideoMuted:function(){return W(a,!0)},muteVideo:function(){return V(a,!0,!0)},unmuteVideo:function(){return V(a,!0,!1)},getBitrate:function(){return z(a)},send:function(e){D(a,e)},data:function(e){R(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(a,!0,e)},createAnswer:function(e){U(a,!1,e)},handleRemoteJsep:function(e){B(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(a,!0===e)},detach:function(e){M(a,e)}};E[a]=o,e.success(o)},l.session_id=w,void a.send(JSON.stringify(l));n.httpAPICall(s+"/"+w,{verb:"POST",withCredentials:p,body:l,success:function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var a=t.data.id;n.log("Created handle: "+a);var o={session:S,plugin:r,id:a,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return r},getVolume:function(){return L(a,!0)},getRemoteVolume:function(){return L(a,!0)},getLocalVolume:function(){return L(a,!1)},isAudioMuted:function(){return W(a,!1)},muteAudio:function(){return V(a,!1,!0)},unmuteAudio:function(){return V(a,!1,!1)},isVideoMuted:function(){return W(a,!0)},muteVideo:function(){return V(a,!0,!0)},unmuteVideo:function(){return V(a,!0,!1)},getBitrate:function(){return z(a)},send:function(e){D(a,e)},data:function(e){R(a,e)},dtmf:function(e){P(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(a,!0,e)},createAnswer:function(e){U(a,!1,e)},handleRemoteJsep:function(e){B(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(a,!0===e)},detach:function(e){M(a,e)}};E[a]=o,e.success(o)},error:function(t,a){n.error(t+":",a),""===a?e.error(t+": Is the server down?"):e.error(t+": "+a)}})}(e)}}n.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,o=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new o(e,t)},extension:e&&e.extension||a,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,a){var o={method:a.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===a.verb&&(o.headers["Content-Type"]="application/json"),void 0!==a.withCredentials&&(o.credentials=!0===a.withCredentials?"include":a.withCredentials?a.withCredentials:"omit"),a.body&&(o.body=JSON.stringify(a.body));var i=t(e,o).catch(function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})});if(a.timeout){var c=new r(function(e,t){var n=setTimeout(function(){return clearTimeout(n),t({message:"Request timed out",timeout:a.timeout})},a.timeout)});i=r.race([i,c])}return i.then(function(e){return e.ok?typeof a.success===typeof n.noop?e.json().then(function(e){a.success(e)}).catch(function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})}):void 0:r.reject({message:"API call failed",response:e})}).catch(function(e){typeof a.error===typeof n.noop&&a.error(e.message||"<< internal error >>",e)}),i}}},n.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||a,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,a){var r=void 0!==a.body?{contentType:"application/json",data:JSON.stringify(a.body)}:{},o=void 0!==a.withCredentials?{xhrFields:{withCredentials:a.withCredentials}}:{};return t.ajax(t.extend(r,o,{url:e,type:a.verb,cache:!1,dataType:"json",async:a.async,timeout:a.timeout,success:function(e){typeof a.success===typeof n.noop&&a.success(e)},error:function(e,t,r){typeof a.error===typeof n.noop&&a.error(t,r)}}))}}},n.noop=function(){},n.dataChanDefaultLabel="JanusDataChannel",n.endOfCandidates=null,n.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:n.noop,n.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),n.trace=n.noop,n.debug=n.noop,n.vdebug=n.noop,n.log=n.noop,n.warn=n.noop,n.error=n.noop,!0===e.debug||"all"===e.debug)n.trace=console.trace.bind(console),n.debug=console.debug.bind(console),n.vdebug=console.debug.bind(console),n.log=console.log.bind(console),n.warn=console.warn.bind(console),n.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t=!0,a=!1,r=void 0;try{for(var o,i=e.debug[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var c=o.value;switch(c){case"trace":n.trace=console.trace.bind(console);break;case"debug":n.debug=console.debug.bind(console);break;case"vdebug":n.vdebug=console.debug.bind(console);break;case"log":n.log=console.log.bind(console);break;case"warn":n.warn=console.warn.bind(console);break;case"error":n.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+c+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(y){a=!0,r=y}finally{try{t||null==i.return||i.return()}finally{if(a)throw r}}}n.log("Initializing library");var s=e.dependencies||n.useDefaultDependencies();n.isArray=s.isArray,n.webRTCAdapter=s.webRTCAdapter,n.httpAPICall=s.httpAPICall,n.newWebSocket=s.newWebSocket,n.extension=s.extension,n.extension.init(),n.listDevices=function(e,t){e="function"==typeof e?e:n.noop,null==t&&(t={audio:!0,video:!0}),n.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(a){n.debug(a),e(a);try{var r=t.getTracks(),o=!0,i=!1,c=void 0;try{for(var s,l=r[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value;u&&u.stop()}}catch(y){i=!0,c=y}finally{try{o||null==l.return||l.return()}finally{if(i)throw c}}}catch(d){}})}).catch(function(t){n.error(t),e([])}):(n.warn("navigator.mediaDevices unavailable"),e([]))},n.attachMediaStream=function(e,t){try{e.srcObject=t}catch(a){try{e.src=URL.createObjectURL(t)}catch(a){n.error("Error attaching stream to element")}}},n.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(a){try{e.src=t.src}catch(a){n.error("Error reattaching stream to element")}}};var l=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",u=window["on"+l];if(window.addEventListener(l,function(e){for(var t in n.log("Closing window"),n.sessions)n.sessions[t]&&n.sessions[t].destroyOnUnload&&(n.log("Destroying session "+t),n.sessions[t].destroy({unload:!0,notifyDestroyed:!1}));u&&"function"==typeof u&&u()}),n.safariVp8=!1,"safari"===n.webRTCAdapter.browserDetails.browser&&n.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var d=!0,m=!1,p=void 0;try{for(var f,v=RTCRtpSender.getCapabilities("video").codecs[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var b=f.value;if(b&&b.mimeType&&"video/vp8"===b.mimeType.toLowerCase()){n.safariVp8=!0;break}}}catch(y){m=!0,p=y}finally{try{d||null==v.return||v.return()}finally{if(m)throw p}}n.safariVp8?n.log("This version of Safari supports VP8"):n.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var g=new RTCPeerConnection({});g.createOffer({offerToReceiveVideo:!0}).then(function(e){n.safariVp8=-1!==e.sdp.indexOf("VP8"),n.safariVp8?n.log("This version of Safari supports VP8"):n.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),g.close(),g=null})}if(n.unifiedPlan=!1,"firefox"===n.webRTCAdapter.browserDetails.browser&&n.webRTCAdapter.browserDetails.version>=59)n.unifiedPlan=!0;else if("chrome"===n.webRTCAdapter.browserDetails.browser&&n.webRTCAdapter.browserDetails.version<72)n.unifiedPlan=!1;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var h=new RTCPeerConnection;try{h.addTransceiver("audio"),n.unifiedPlan=!0}catch(C){}h.close()}else n.unifiedPlan=!1;n.initDone=!0,e.callback()}},n.isWebrtcSupported=function(){return!!window.RTCPeerConnection},n.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},n.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++){var r=Math.floor(Math.random()*t.length);a+=t.substring(r,r+1)}return a},e.exports=n},305:function(e,t,a){},308:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"updateNav",function(){return V}),a.d(n,"updateWebRtc",function(){return z}),a.d(n,"addDatabaseSchema",function(){return F}),a.d(n,"updateDatabaseSchema",function(){return q}),a.d(n,"deleteDatabaseSchema",function(){return G});var r=a(1),o=a.n(r),i=a(27),c=a.n(i),s=a(5),l=a(6),u=a(8),d=a(7),m=a(9),p=a(15),f=a(132),v=a(87),b=a(153),g=a(21),h=a(12),y=a(3),C=a(51),w=a.n(C);var E=a(111),S=a.n(E),O=a(130),k=function(e){var t="".concat(e.trim(),"="),a=document.cookie.split(";").find(function(e){return 0===e.trim().indexOf(t)});return a?a.trim().substr(t.length):null},I=function(e,t){document.cookie="".concat(e.trim(),"=").concat(t,"; max-age=").concat(604800,";")},j=function(e){document.cookie="".concat(e.trim(),"= ;expires=").concat(new Date(Date.now()-1).toUTCString())},x={sessionId:k("pc-session"),slug:S()().substring(1,10),online:!1,user:null},N={sideNav:{name:""},mainNav:{name:""},popNotification:{message:"Welcome to Properclass",active:!1,intent:"Success"},search:{key:"",country:"",industry:""}},D={localCallHistory:{},showCommunication:null,showIncommingCall:!1,showOutgoingCall:!1,isConnecting:!1,communicationContainer:"list",peerType:"",connectionId:null,outGoingCallType:null,messages:[],peerConnections:{},pendingOffers:{},streams:{},connectedUsers:{},currentOffer:null,iceCandidates:{},liveIncomingCall:!1,isLive:!1,mediaRecording:null,recordedBlobs:[],lastStreamId:null,chatHistoryType:null},A=Object(v.c)({account:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"VERIFIED":return Object(y.a)({},e,{sessionId:t.payload,user:null});case O.login.TYPE:return Object(y.a)({},e,{user:t.payload});case O.logout.TYPE:return j("pc-session"),Object(y.a)({},e,{user:null,online:!1,sessionId:null});case"CONNECT":return Object(y.a)({},e,{online:!0});case"DISCONNECT":return Object(y.a)({},e,{online:!1});default:return e}},webRtc:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"updateWebRtc":return Object(y.a)({},e,Object(h.a)({},t.schema,t.payload));default:return e}},navigate:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"updateNav":return Object(y.a)({},e,Object(h.a)({},t.payload.schema,Object(y.a)({},e[t.payload.schema],t.payload.data)));default:return e}},database:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var n=t.reduce(function(e,t){return e[t]={byId:{},allIds:[]},e},{});return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,t=arguments.length>1?arguments[1]:void 0,a=t.schema;if(!a||!e[a])return e;switch(t.type){case w.a.init.TYPE:return Object(y.a)({},e,Object(h.a)({},a,t.payload.reduce(function(e,t){return e.byId[t.id]=t,e.allIds.push(t.id),e},{byId:{},allIds:[]})));case w.a.add.TYPE:return Array.isArray(t.payload)?Object(y.a)({},e,Object(h.a)({},a,{allIds:[].concat(Object(g.a)(e[a].allIds),Object(g.a)(t.payload.map(function(e){return e.id}))),byId:Object(y.a)({},e[a].byId,t.payload.reduce(function(e,t){return e[t.id]=t,e},{}))})):Object(y.a)({},e,Object(h.a)({},a,{byId:Object(y.a)({},e[a].byId,Object(h.a)({},t.payload.id,t.payload)),allIds:e[a].allIds.concat(t.payload.id)}));case w.a.remove.TYPE:var r=Object.assign({},e[a].byId),o=[];return Array.isArray(t.payload)?(t.payload.forEach(function(e){delete r[e.id]}),o=e[a].allIds.filter(function(e){return!t.payload.find(function(t){return t.id===e})})):(delete r[t.payload.id],o=e[a].allIds.filter(function(e){return e!==t.payload.id})),Object(y.a)({},e,Object(h.a)({},a,{allIds:o,byId:r}));case w.a.update.TYPE:return Object(y.a)({},e,Object(h.a)({},a,{byId:Object(y.a)({},e[a].byId,Object(h.a)({},t.payload.id,Object(y.a)({},e[a].byId[t.payload.id],t.payload))),allIds:e[a].allIds}));default:return e}}}("User","UserDetail","Board","BoardColumn","BoardColumnCard","BoardColumnCardAttachment","BoardColumnCardComment","BoardColumnCardDescription","BoardColumnCardTag","Blog","BlogDetail","BlogComment","BlogLike","Notification","BoardMember","UserEducation","UserWorkExperience","UserSkill","UserPortal","BoardMessage","UserConnection","UserMessage","UserCarrierInterest","BoardMessageSeenStatus","UserMessageSeenStatus","NotificationReadStatus")}),T=[b.a],R=Object(v.d)(A,{},v.a.apply(void 0,T)),P=a(345),M=a(346),H=a(347),U=a(344),B=a(2),L=a.n(B),W=a(4),V=function(e){return function(){var t=Object(W.a)(L.a.mark(function t(a,n){return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a({type:"updateNav",payload:e});case 1:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()},z=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r){return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n({type:"updateWebRtc",payload:t,schema:e});case 1:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}()},F=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r){return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n(w.a.add(e,t));case 1:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}()},q=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r){return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n(w.a.update(e,t));case 1:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}()},G=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r){return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n(w.a.remove(e,t));case 1:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}()},J=a(22),Y=a.n(J),K=a(330),Q=a(310),_=a(252),Z=a(37),X=a(29),$=a(204),ee=a.n($),te=a(89),ae=function(e,t){return e},ne=function(){},re=function(e,t){var a=WebSocket,n=Object(te.createParser)(),r=0,o=0,i={},c={},s={},l={},u=[],d=function(e,t){var a=l[e];a&&a.forEach(function(e){return e.call(v,t)})},m=function(e){return u.push(e),function(){var t=u.indexOf(e);t>=0&&u.splice(t,1)}},p=function(e){if(null===e)return null;var t=new a(e);return t.onopen=function(){u.forEach(function(e){return t.send(e)}),u.length=0,d("connect")},t.onmessage=function(e){n.parse(e.data)},t.onclose=function(){u.length=0,Object.values(i).concat(Object.values(c)),i={},c={},s={},d("disconnect")},t.onerror=function(e){var t=Object.values(i).concat(Object.values(c));i={},c={},u.length=0,t.forEach(function(t){(0,ae(t)[1])(e.message)}),d("error",e.message)},t};n.onEvent=d,n.onAction=function(e){t.dispatch(e)},n.onRpcResponse=function(e,t,a){var n=ae(i[e]),r=n[0],o=n[1];delete i[e],t?r(a):o(a)},n.onScopeResponse=function(e,t,a){var n=ae(c[e]),r=n[0],o=n[1],i=n[2],l=n[3];if(delete c[e],t){var u=(a||l.api).reduce(function(e,t){return e[t]=function(){for(var e=arguments.length,a=new Array(e),n=0;n<e;n++)a[n]=arguments[n];for(var r=[a].length,o=Array(r),c=0;c<r;c+=1)o[c]=a[c];return v.rpc.apply(v,[i,t].concat(o))},e},{});s[i]=u,r(u)}else o(a)};var f=p(e),v={isConnected:function(){return f&&f.readyState===a.OPEN},reconnect:function(){var e=arguments.length>0&&void 0!==(arguments.length<=0?void 0:arguments[0])?arguments.length<=0?void 0:arguments[0]:null;if(null===e&&null===f)return!1;var t=e||f.url;return(null===f||f.url!==t||f.readyState!==a.OPEN)&&(null!==f&&f.close(),f=p(t),!0)},close:function(){f.close(),f=null},on:function(e,t){var a=l[e];return a?a.push(t):l[e]=[t],function(){l[e]=l[e].filter(function(e){return e===t})}},call:function(e,t){for(var a=arguments.length<=2?0:arguments.length-2,n=Array(a>2?a-2:0),r=2;r<a;r+=1)n[r-2]=r+2<2||arguments.length<=r+2?void 0:arguments[r+2];var o=Object(te.PKT_CALL)(e,t,n);return v.isConnected()?(f.send(o),ne):m(o)},rpc:function(e,t){for(var a=arguments.length,n=new Array(a>2?a-2:0),o=2;o<a;o++)n[o-2]=arguments[o];for(var c=n.length,s=Array(c>2?c-2:0),l=2;l<c;l+=1)s[l-2]=n[l];return new Promise(function(a,o){i[r+=1]=[a,o];var c=Object(te.PKT_RPC_REQUEST)(r,e,t,n);if(!v.isConnected())return m(c);f.send(c)})},scope:function(e){var t=(arguments.length<=1?0:arguments.length-1)>1&&void 0!==(arguments.length<=2?void 0:arguments[2])?arguments.length<=2?void 0:arguments[2]:null;return new Promise(function(a,n){if(s[e])return a(s[e]);c[o+=1]=[a,n,e,t];var r=Object(te.PKT_SCOPE_REQUEST)(o,e,!t);return v.isConnected()?(f.send(r),ne):m(r)})}};return v},oe="https://properclass.com",ie=function(){var e=R.getState().account.sessionId;return e?"".concat("wss","://").concat("properclass.com",":").concat(443,"/shocked/web/").concat(e):null},ce=re(ie(),R),se=!0,le=null;ce.on("connect",function(){se=!0,R.dispatch({type:"CONNECT"})});ce.on("disconnect",function(){R.dispatch({type:"DISSCONNECT"}),se&&(le||(le=setTimeout(function(){le=null,ce.reconnect()},1e3)))}),ce.on("logout",function(){se=!1,R.dispatch({type:"updateWebRtc",payload:null,schema:"showCommunication"}),R.dispatch({type:"updateWebRtc",payload:null,schema:"showIncommingCall"})}),ce.on("error",function(e){console.error("socket Error",e)});var ue=ce,de=a(331),me=a(28),pe=a.n(me),fe=a(322),ve=a(82),be=a(213),ge=a(34),he=a(79),ye=a(316),Ce=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={hidden:!1},a.componentWillMount=function(){var e=a.props.data;a.setState({hidden:e.hidden})},a.handleLockClick=function(){var e=a.state.hidden;a.setState({hidden:!e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.hidden,t=this.props,a=t.data,n=t.onChange,r=t.value,i={};return a.icon&&(i=function(e,t,a){return"left"===e.side?{leftIcon:o.a.createElement(X.a,{onClick:t,icon:e.name,iconSize:X.a.SIZE_LARGE}),rightIcon:null}:"right"===e.side?{leftIcon:null,rightIcon:o.a.createElement(be.a,{content:!0===a?o.a.createElement("span",{style:{color:"#1d4354"}},"Show"):o.a.createElement("span",{style:{color:"#1d4354"}},"Hide"),position:ge.a.RIGHT},o.a.createElement(X.a,{style:{marginTop:3,marginRight:5,color:"#757575"},icon:e.name,onClick:t,iconSize:"20"}))}:{leftIcon:null,rightIcon:null}}(a.icon,this.handleLockClick,e)),o.a.createElement(he.c,null,o.a.createElement("span",{className:"label-text"},a.name),a.required&&o.a.createElement("span",{style:{color:"red"}}," *"),o.a.createElement(ye.a,Object.assign({onChange:function(e){return n(a.id,e.target.value)},value:r,type:e?"password":"text",leftIcon:i.leftIcon,rightElement:i.rightIcon},a)))}}]),t}(o.a.Component);Ce.defaultProps={value:""};var we=Ce,Ee=function(e){var t=e.onSubmit,a=e.data,n=e.state;return o.a.createElement("div",{className:"btn-group"},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",alignItems:"center"}},n.error&&o.a.createElement(he.c,{style:{fontSize:16,color:"red"}},n.error),n.message&&o.a.createElement(he.c,{style:{fontSize:16,color:"green"}},n.message)),o.a.createElement(ve.b,Object.assign({fill:!0,large:!0,onClick:t,loading:n.loading,disabled:n.loading},a)))},Se=a(321),Oe=a(317),ke=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.onChange,n=e.value;return o.a.createElement(he.c,null,o.a.createElement("span",{className:"label-text"},t.name),t.required&&o.a.createElement("span",{style:{color:"red"}}," *"),o.a.createElement(Oe.a,Object.assign({onAdd:function(e){return a(t.id,e)},onChange:function(e){return a(t.id,e)}},t,{className:"tag-input",values:n})))}}]),t}(o.a.Component),Ie=a(318),je=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.onChange,n=e.value;return o.a.createElement(he.c,null,o.a.createElement("span",{className:"label-text"},t.name),t.required&&o.a.createElement("span",{style:{color:"red"}}," *"),o.a.createElement(Ie.a,Object.assign({onChange:function(e){return a(t.id,e.target.value)},value:n,options:t.options.sort(function(e,t){return e.value>t.value?1:-1})},t)))}}]),t}(o.a.Component);je.defaultProps={value:""};var xe=je,Ne=a(340),De=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.onChange,n=e.value;return o.a.createElement(he.c,null,o.a.createElement("span",{className:"label-text"},t.name),t.required&&o.a.createElement("span",{style:{color:"red"}}," *"),o.a.createElement(Ne.a,Object.assign({className:"pc-date-picker",formatDate:function(e){return e.toLocaleDateString()},parseDate:function(e){return new Date(e)},placeholder:"MM/DD/YYYY",maxDate:new Date(2030,12,30),onChange:function(e){return a(t.id,e)},value:n,closeOnSelection:!0,popoverProps:{usePortal:!1},rightElement:o.a.createElement(X.a,{icon:"calendar",intent:"primary"})},t)))}}]),t}(o.a.Component);De.defaultProps={value:new Date};var Ae=De,Te=a(319),Re=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.onChange,n=e.value;return o.a.createElement(he.c,null,o.a.createElement("span",{className:"label-text"},t.name),t.required&&o.a.createElement("span",{style:{color:"red"}}," *"),o.a.createElement(Te.a,Object.assign({growVertically:!0,large:!0,onChange:function(e){return a(t.id,e.target.value)},value:n,options:t.options,fill:!0,style:{resize:"none"}},t)))}}]),t}(o.a.Component);Re.defaultProps={value:""};var Pe=Re,Me=a(320),He=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={fileInputText:"Choose a file..."},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,a=e.onChange,n=e.value,r=this.state.fileInputText;return o.a.createElement(he.c,null,o.a.createElement("span",{className:"label-text"},t.name),t.required&&o.a.createElement("span",{style:{color:"red"}}," *"),o.a.createElement("br",null),o.a.createElement(Me.a,Object.assign({onInputChange:function(e){return a(t.id,e.target.files[0])},value:n,text:n.name||r},t)))}}]),t}(o.a.Component);He.defaultProps={value:{}};var Ue=He,Be=function(e){var t=e.data;if(!t.fieldtype)return null;switch(t.fieldtype){case"input":return o.a.createElement(we,e);case"button":return o.a.createElement(Ee,e);case"tagInput":return o.a.createElement(ke,e);case"select":return o.a.createElement(xe,e);case"date":return o.a.createElement(Ae,e);case"textarea":return o.a.createElement(Pe,e);case"image":return o.a.createElement(Ue,e);default:return null}},Le=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={error:null,loading:!1,message:null,fields:{},data:[]},a.componentWillMount=function(){var e=a.props.data,t=e.filter(function(e){if("input"===e.fieldtype||"select"===e.fieldtype||"tagInput"===e.fieldtype||"image"===e.fieldtype||"textarea"===e.fieldtype||"date"===e.fieldtype)return e}).map(function(e){return"tagInput"===e.fieldtype?Object(h.a)({},e.id,e.val?e.val:[]):"date"===e.fieldtype?Object(h.a)({},e.id,e.val?e.val:new Date):"image"===e.fieldtype?Object(h.a)({},e.id,e.val?e.val:{}):Object(h.a)({},e.id,e.val?e.val:"")}).reduce(function(e,t){return e[Object.keys(t)[0]]=Object.values(t)[0],e},{});a.setState({fields:t,data:e})},a.onChange=function(e,t){var n=a.state.fields;a.setState({fields:Object(y.a)({},n,Object(h.a)({},e,t))})},a.onSubmit=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=a.props.callback,r=a.state,o=r.fields,i=r.data,c=!1,i.map(function(e){return e.required&&0===o[e.id].replace(/\s/g,"").length&&(c=!0,a.setState({error:"Fill the required field(*)"})),e}),!c){e.next=7;break}return e.abrupt("return");case 7:return a.setState({loading:!0}),e.next=10,n(o);case 10:200===(s=e.sent).response?a.setState({loading:!1,error:null,message:s.message}):a.setState({loading:!1,error:s.error});case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.data,n=t.fields;return o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement(Se.a,null,a.map(function(t,a){return o.a.createElement(Be,{key:a,data:t,onChange:e.onChange,onSubmit:e.onSubmit,value:n[t.id],state:e.state})})))}}]),t}(o.a.Component),We=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.action,a=e.isOpen,n=e.name;return o.a.createElement(fe.a,{isOpen:a,onClose:function(){return t("cancle")}},o.a.createElement("div",{className:"delete-popover"},o.a.createElement("div",{className:"top"},"Are you sure you want to delete"," ",o.a.createElement("span",{style:{color:"red"}},n),"?"),o.a.createElement("div",{className:"popover-button"},o.a.createElement(ve.b,{text:"Delete",intent:"danger",onClick:function(){return t("confirm")}}),o.a.createElement(ve.b,{text:"Cancle",onClick:function(){return t("cancle")}}))))}}]),t}(o.a.Component),Ve=a(156),ze={left:"50%",top:"50%",position:"absolute"},Fe=function(){return o.a.createElement(Ve.ScaleLoader,{css:ze,sizeUnit:"10px",size:1,color:"#36D7B7",loading:!0})},qe=a(323),Ge=function(e){var t=e.data;if(!t.fieldtype)return null;switch(t.fieldtype){case"input":return o.a.createElement(we,e);case"button":return o.a.createElement(Ee,e);case"tagInput":return o.a.createElement(ke,e);case"select":return o.a.createElement(xe,e);case"date":return o.a.createElement(Ae,e);case"textarea":return o.a.createElement(Pe,e);case"image":return o.a.createElement(Ue,e);default:return null}},Je=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={error:null,loading:!1,message:null,fields:{},data:[]},a.componentWillMount=function(){var e=a.props.data,t=e.filter(function(e){if("input"===e.fieldtype||"select"===e.fieldtype||"tagInput"===e.fieldtype||"textarea"===e.fieldtype||"date"===e.fieldtype)return e}).map(function(e){return"tagInput"===e.fieldtype?Object(h.a)({},e.id,e.val?e.val:[]):"date"===e.fieldtype?Object(h.a)({},e.id,e.val?e.val:new Date):"image"===e.fieldtype?Object(h.a)({},e.id,e.val?e.val:{}):Object(h.a)({},e.id,e.val?e.val:"")}).reduce(function(e,t){return e[Object.keys(t)[0]]=Object.values(t)[0],e},{});a.setState({fields:t,data:e})},a.onChange=function(e,t){var n=a.state.fields;a.setState({fields:Object(y.a)({},n,Object(h.a)({},e,t))})},a.onSubmit=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),n=a.props.callback,r=a.state,o=r.fields,i=r.data,c=!1,i.map(function(e){return e.required&&0===o[e.id].replace(/\s/g,"").length&&(c=!0,a.setState({error:"Fill the required field(*)"})),e}),!c){e.next=7;break}return e.abrupt("return");case 7:return a.setState({loading:!0}),e.next=10,n(o);case 10:200===(s=e.sent).response?a.setState({loading:!1,error:null,message:s.message}):a.setState({loading:!1,error:s.error});case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.data,n=t.fields;return o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement(qe.a,{fill:!0},a.map(function(t,a){return o.a.createElement(Ge,{key:a,data:t,onChange:e.onChange,onSubmit:e.onSubmit,value:n[t.id],state:e.state})})))}}]),t}(o.a.Component),Ye=a(324),Ke=a(325),Qe=a(326),_e=a(327),Ze=a(328),Xe=a(329),$e=function(e){var t=e.url;return o.a.createElement("div",{className:"social-madia-share",style:{display:"flex"}},o.a.createElement(Ye.a,{url:t,style:{margin:5}},o.a.createElement(Ke.a,{size:30})),o.a.createElement(Qe.a,{url:t,style:{margin:5}},o.a.createElement(_e.a,{size:30})),o.a.createElement(Ze.a,{url:t,style:{margin:5}},o.a.createElement(Xe.a,{size:30})))},et=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={deletePopover:!1},a.toggleDeletePopup=function(e){var t=a.state.deletePopover,n=a.props.onDelete;a.setState({deletePopover:!t}),"confirm"===e&&n()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.isOpen,a=e.onClose,n=e.structure,r=e.callback,i=e.del,c=this.state.deletePopover;return o.a.createElement(fe.a,{isOpen:t,onClose:a},o.a.createElement("div",{className:"popover-form"},o.a.createElement("div",{className:"top"},"Enter the Credentials"),o.a.createElement(Le,{data:n,callback:r}),i&&o.a.createElement("div",{className:"pc-pop-delete-button"},o.a.createElement(We,{action:this.toggleDeletePopup,isOpen:c,name:" "}),o.a.createElement(ve.b,{onClick:this.toggleDeletePopup,minimal:!0,text:"Delete",icon:"delete",large:!0,fill:!0}))))}}]),t}(o.a.Component);et.defaultProps={onDelete:null,del:null};var tt=et,at=a(123),nt=function(e,t){return o.a.createElement(Q.a,null,o.a.createElement(_.a,{icon:"edit",text:"Edit",onClick:function(){return e("edit",t)}}),o.a.createElement(Q.a.Divider,null),o.a.createElement(_.a,{icon:"delete",intent:"danger",text:"Delete",onClick:function(){return e("delete",t)}}))},rt=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.onMore,a=e.id;return o.a.createElement(at.a,{content:nt(t,a),position:"right",className:"more-button"},o.a.createElement(ve.b,{icon:"more",minimal:!0}))}}]),t}(o.a.Component),ot=function(e){var t=e.number,a=e.size,n=e.top,r=t;return t>9&&(r="9+"),o.a.createElement("span",{style:{position:"absolute",left:a,top:n||4,textAlign:"center",padding:"2px",borderRadius:"50%",backgroundColor:"#e92821",color:"white",fontSize:"10px",width:"15px",height:"15px"}},r)},it=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).checkOrientation=function(e){var t=new Image;t.onload=function(){t.height>t.width&&a.setState({portrait:!0})},t.src=e},a.componentWillReceiveProps=function(e){var t=a.props.imgUrl;e.imgUrl!==t&&a.checkOrientation(e.imgUrl)},a.state={portrait:!1};var n=a.props.imgUrl;return a.checkOrientation(n),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.imgUrl,t=this.state.portrait;return o.a.createElement("img",{className:t?"portrait":"landscape",src:e,alt:"Round representation"})}}]),t}(o.a.Component),ct=function(e){var t=e.firstName;return e.middleName&&(t=t+" "+e.middleName),t=t+" "+e.lastName},st=function(e,t){return e.position>t.position?1:e.position<t.position?-1:void 0},lt=function(e,t){return e.timeStamp<t.timeStamp?1:-1},ut=function(e,t){return e.timeStamp>t.timeStamp?1:-1},dt=a(49),mt=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.getNotification=function(e){var t,n,r=a.props,i=r.database,c=r.account;switch(e.type){case"user":t="user/".concat(i.User.byId[e.typeId].slug);var s=Object.values(i.UserDetail.byId).find(function(t){return e.typeId===t.userId}),l=s&&s.image?"".concat(oe,"/user/").concat(1e7+parseInt(e.typeId,10),"/profile/").concat(s.image):dt;n=o.a.createElement("div",{className:"pc-noti-img"},o.a.createElement(it,{imgUrl:l}));break;case"board":t="class-work/".concat(i.User.byId[c.user.id].slug,"/").concat(e.boardId),n=o.a.createElement("div",{className:"pc-noti-icon"},o.a.createElement(X.a,{icon:"application",iconSize:40}));break;default:t=""}return o.a.createElement(K.a,{to:"/".concat(t),className:"pc-noti-wrapper",key:e.id},n,o.a.createElement("div",{className:"pc-noti-body"},o.a.createElement("p",{className:"pc-noti-desc"},e.body),o.a.createElement("p",{className:"pc-ago-date"},pe()(e.timeStamp).fromNow())))},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.database,n=t.account.user?Object.values(a.Notification.byId).sort(lt):[];return o.a.createElement("div",{className:"notification-list"},0===n.length&&o.a.createElement("div",{className:"pc-no-notis"},o.a.createElement("p",null,"You do not have any notifications at the moment.")),n.map(function(t){return e.getNotification(t)}))}}]),t}(o.a.Component),pt=Object(p.b)(function(e){return e})(mt),ft=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onPlay=function(){a.props.incoming&&clearInterval(a.interval)},a.playSound=function(){try{a.soundRef.current.play()}catch(e){}},a.state={},a.soundRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.props.incoming&&(this.interval=setInterval(this.playSound,1500))}},{key:"componentWillUnmount",value:function(){this.props.incoming&&clearInterval(this.interval)}},{key:"render",value:function(){var e=this.props,t=e.url,a=e.noLoop;return o.a.createElement("audio",{ref:this.soundRef,onPlay:this.onPlay,autoPlay:!0,loop:!a},o.a.createElement("source",{type:"audio/mpeg",src:t}))}}]),t}(o.a.Component),vt=a(112),bt=a.n(vt),gt=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={drawerOpen:!1},a.onDrawerToggle=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state.drawerOpen,n=a.props,r=n.apis,o=n.account,i=n.notiNo,c=n.lastNotifId,s=n.addDatabaseSchema,a.setState({drawerOpen:!t}),!(i>0)){e.next=14;break}return e.prev=4,e.next=7,r.addNotificationReadStatus({notifId:c,userId:o.user.id,status:1,timeStamp:Date.now()});case 7:l=e.sent,s("NotificationReadStatus",{id:l,notifId:c,userId:o.user.id,status:1,timeStamp:Date.now()}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),console.error("error in mark noti read",e.t0);case 14:case"end":return e.stop()}},e,null,[[4,11]])})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.drawerOpen,t=this.props,a=t.apis,n=t.account,r=t.notiNo,i=t.notiSound;return o.a.createElement(K.a,{to:"#",onClick:this.onDrawerToggle},o.a.createElement("div",{className:"navbar-item"},o.a.createElement(X.a,{icon:"notifications",iconSize:X.a.SIZE_LARGE}),r>0&&o.a.createElement("div",null,i&&o.a.createElement(ft,{url:bt.a,noLoop:!0}),o.a.createElement(ot,{number:r,size:20})),o.a.createElement(de.a,{isOpen:e,onClose:this.onDrawerToggle,size:de.a.SIZE_SMALL,title:"Notifications",transitionDuration:200,hasBackdrop:!1},o.a.createElement(pt,{account:n,apis:a}))))}}]),t}(o.a.Component),ht=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.showMessage=function(){(0,a.props.updateWebRtc)("showCommunication",1)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.unreadMessage,a=e.msgSound;return o.a.createElement(K.a,{to:"#",onClick:this.showMessage},o.a.createElement("div",{className:"navbar-item"},o.a.createElement(X.a,{icon:"chat",iconSize:X.a.SIZE_LARGE}),0!==t&&o.a.createElement("div",null,o.a.createElement(ot,{number:t,size:25}),a&&o.a.createElement(ft,{url:bt.a,noLoop:!0}))))}}]),t}(o.a.Component),yt=function(e,t){var a=t.database,n=[];return Object.values(a.NotificationReadStatus.byId).forEach(function(t){t.notifId===e&&n.push(t)}),n},Ct=function(e){var t=R.getState(),a=t.database,n=t.account;if(a.Notification.allIds.length>0){var r,o=Object.values(a.Notification.byId).map(function(t){return Object(y.a)({},t,{seenStatus:yt(t.id,e)})}),i=o.slice().reverse(),c=i.findIndex(function(e){return e.seenStatus.find(function(e){return e.userId===n.user.id})});return r=-1===c?o.length:c,{lastNotifId:i[0].id,unSeenNo:r}}return{unSeenNo:0}},wt=function(e){try{e.logout()}catch(t){console.error("Logout faild",t)}},Et=function(e){var t=e.account,a=e.activeNav,n=e.apis;return o.a.createElement("div",{className:"pc-drop-menu"},o.a.createElement(K.a,{to:"/",className:"properClass"===a?"pc-drop-menu-link active":"pc-drop-menu-link"},"Home"),o.a.createElement(K.a,{to:"/archive",className:"archive"===a?"pc-drop-menu-link active":"pc-drop-menu-link"},"Archive"),o.a.createElement(K.a,{to:"/search",className:"search"===a?"pc-drop-menu-link active":"pc-drop-menu-link"},"Find Mentor"),t.sessionId?o.a.createElement(K.a,{to:"#",onClick:wt.bind(void 0,n),className:"pc-drop-menu-link"},"Logout"):o.a.createElement(K.a,{to:"/login",className:"pc-drop-menu-link"},"Login"))},St=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.open,a=e.smallScreenToggle,n=e.account,r=e.pcLogo,i=e.navigate,c=e.apis;return o.a.createElement(de.a,{className:"pc-dropdown-drawer",usePortal:!0,isOpen:t,onClose:a,size:"60%",position:"left",autoFocus:!1,lazy:!0,title:o.a.createElement("img",{alt:"Proper Class Logo",style:{objectFit:"contain",width:"100%"},src:r})},o.a.createElement(Et,{account:n,activeNav:i.mainNav.name,apis:c}))}}]),t}(o.a.Component),Ot=Object(p.b)(function(e){return e},Object(y.a)({},n))(St),kt=function(e){var t=e.props,a=t.change,n=t.updateWebRtc,r=t.database,o=t.apis,i=t.account,c=t.addDatabaseSchema,s=t.fromLive,l=t.showChatHistory,u=e.type,d=e.user,m=e.lastMessageId,p=e.boardDetails,f=e.unSeenNo,v=d?d.user.id:e.boardDetails.id;(n("chatHistory",e),s||a("history"),s&&l(!0),"user"===e.type)&&n("connectionId",Object.values(r.UserConnection.byId).find(function(e){return e.userId===v||e.mId===v}).id);n("peerType",u),n("showCommunication",v),f>0&&("user"===u&&(o.addUserMessageSeenStatus({userId:i.user.id,umId:m,timeStamp:Date.now(),status:!0,broadCastId:"UserConnection-".concat(i.user.id),broadCastUserList:[{userId:d.user.id}]}),c("UserMessageSeenStatus",{id:Date.now(),userId:i.user.id,umId:m,timeStamp:Date.now(),status:!0})),"board"===u&&(o.addBoardMessageSeenStatus({userId:i.user.id,bmId:m,timeStamp:Date.now(),status:!0,broadCastId:"Board-".concat(p.id)}),c("BoardMessageSeenStatus",{id:Date.now(),userId:i.user.id,bmId:m,timeStamp:Date.now(),status:!0})))},It=function(e,t,a){var n=a.database,r=[];return"board"===t&&Object.values(n.BoardMessageSeenStatus.byId).forEach(function(t){t.bmId===e&&r.push(t)}),"user"===t&&Object.values(n.UserMessageSeenStatus.byId).forEach(function(t){t.umId===e&&r.push(t)}),r},jt=function(e){var t=e.database,a={},n={};Object.values(t.UserMessage.byId).forEach(function(e){a=a[e.connectionId]?Object(y.a)({},a,Object(h.a)({},e.connectionId,[].concat(Object(g.a)(a[e.connectionId]),[e]))):Object(y.a)({},a,Object(h.a)({},e.connectionId,[e]))}),Object.values(t.BoardMessage.byId).forEach(function(e){n=n[e.boardId]?Object(y.a)({},n,Object(h.a)({},e.boardId,[].concat(Object(g.a)(n[e.boardId]),[e]))):Object(y.a)({},n,Object(h.a)({},e.boardId,[e]))});var r=Object.values(a).map(function(t){return Object(y.a)({},function(e,t){var a,n=t.database,r=t.account,o=e.map(function(e){return Object(y.a)({},e,{seenStatus:It(e.id,"user",t)})}),i=o.reverse(),c=i.findIndex(function(e){return e.seenStatus.find(function(e){return e.userId===r.user.id})});if(-1===c)a=i.filter(function(e){return e.fuserId!==r.user.id}).length;else{for(var s=0,l=0;l<c;l+=1)i[l].fuserId!==r.user.id&&(s+=1);a=s}var u,d,m,p=o[0],f=o.find(function(e){return e.fuserId!==r.user.id}),v=f?f.id:o[0].id;return p.fuserId!==r.user.id?(u=Object.values(n.User.byId).find(function(e){return e.id===p.fuserId}),d=Object.values(n.UserDetail.byId).find(function(e){return e.userId===p.fuserId}),m=Object.values(n.UserConnection.byId).find(function(e){return e.userId===u.id||e.mId===u.id})):(u=Object.values(n.User.byId).find(function(e){return e.id===p.tuserId}),d=Object.values(n.UserDetail.byId).find(function(e){return e.userId===p.tuserId}),m=Object.values(n.UserConnection.byId).find(function(e){return e.userId===u.id||e.mId===u.id})),{connectionId:m?m.id:null,type:"user",user:{user:u,userDetails:d},unSeenNo:a,timeStamp:o[0].timeStamp,lastMessage:o[0],lastMessageId:v}}(t,e),{message:t.sort(ut)})}),o=Object.values(n).map(function(t){return Object(y.a)({},function(e,t){var a,n=t.database,r=t.account,o=e[0].boardId,i=n.Board.byId[o],c=e.map(function(e){return Object(y.a)({},e,{seenStatus:It(e.id,"board",t)})}),s=c.reverse(),l=s.findIndex(function(e){return e.seenStatus.find(function(e){return e.userId===r.user.id})});if(-1===l)a=s.filter(function(e){return e.userId!==r.user.id}).length;else{for(var u=0,d=0;d<l;d+=1)s[d].userId===r.user.id||s[d].type||(u+=1);a=u}var m=c.find(function(e){return e.userId!==r.user.id}),p=m?m.id:c[0].id,f=c.find(function(e){return!e.type||!(!e.type||e.userId!==r.user.id)||void 0});return{connectionId:o,type:"board",boardDetails:i,unSeenNo:a,timeStamp:c[0].timeStamp,lastMessage:f,lastMessageId:p}}(t,e),{message:t.sort(ut)})});return[].concat(Object(g.a)(r),Object(g.a)(o)).sort(lt).sort(lt)},xt=a(49),Nt=function(e){var t=e.content,a=e.profilePic,n=e.navigate;return o.a.createElement(K.a,{to:"#",className:"profileIcon"===n.mainNav.name?"active":null},o.a.createElement(at.a,{content:t,minimal:!0,position:ge.a.BOTTOM},o.a.createElement("div",{className:"navbar-item pc-dashboard-icon"},o.a.createElement("div",{className:"pc-dot"}),o.a.createElement("div",{className:"pc-dashboard"},"dashboard"),o.a.createElement("div",{className:"profile-icon"},o.a.createElement(it,{imgUrl:a||xt})))))},Dt=function(e,t,a){return function(){var t=Object(W.a)(L.a.mark(function t(n){var r,o,i,c,s;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.updateWebRtc,o=e.account,i=R.getState(),c=i.webRtc,s=Object.values(c.peerConnections),t.next=5,r("chatHistory",c.localCallHistory.chatHistory);case 5:if(c.localCallHistory.stream&&c.localCallHistory.stream.active&&c.localCallHistory.stream.getTracks().forEach(function(e){return e.stop()}),!c.showCommunication){t.next=36;break}if(c.mediaRecording&&(c.mediaRecording.stopRecording(),r("mediaRecording",null)),0!==s.length){t.next=15;break}if(c.localCallHistory.callEnd){t.next=13;break}return t.next=12,r("localCallHistory",Object(y.a)({},c.localCallHistory,{callEnd:!0}));case 12:n&&"board"!==c.localCallHistory.chatHistory.type||a.callClose({callCloseDetail:{uid:o.user.id,broadCastId:"user"===c.localCallHistory.chatHistory.type?o.user.id:c.localCallHistory.chatHistory.connectionId,broadCastType:"user"===c.localCallHistory.chatHistory.type?"UserConnection":"Board",callType:c.localCallHistory.callType||"Misscall",callDuration:0,type:c.localCallHistory.chatHistory.type,connectionId:c.localCallHistory.chatHistory.connectionId,callEndReply:n},userList:[{userId:"user"===c.localCallHistory.chatHistory.type?c.localCallHistory.chatHistory.user.user.id:c.localCallHistory.chatHistory.connectionId}]});case 13:t.next=20;break;case 15:if(c.localCallHistory.callEnd){t.next=20;break}return t.next=18,r("localCallHistory",Object(y.a)({},c.localCallHistory,{callEnd:!0}));case 18:s.forEach(function(){var e=Object(W.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{t.pc.pc.close()}catch(a){console.error("errror in call close handler",a)}case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),n&&"board"!==c.localCallHistory.chatHistory.type||a.callClose({callCloseDetail:{uid:o.user.id,broadCastId:"user"===c.localCallHistory.chatHistory.type?o.user.id:c.localCallHistory.chatHistory.connectionId,broadCastType:"user"===c.localCallHistory.chatHistory.type?"UserConnection":"Board",callType:c.localCallHistory.callType||"Misscall",callDuration:c.localCallHistory.startTime?Date.now()-c.localCallHistory.startTime:0,type:c.localCallHistory.chatHistory.type,connectionId:c.localCallHistory.chatHistory.connectionId,callEndReply:n},userList:[{userId:"user"===c.localCallHistory.chatHistory.type?c.localCallHistory.chatHistory.user.user.id:c.localCallHistory.chatHistory.connectionId}]});case 20:r("communicationContainer","history"),r("outGoingCallType",null),r("showOutgoingCall",!1),r("peerConnections",{}),r("pendingOffers",{}),r("remoteStream",{}),r("currentOffer",null),r("iceCandidates",{}),r("liveIncomingCall",!1),r("isLive",!1),r("localCallHistory",{callEnd:!0}),r("mainStreamId",null),r("streams",{}),r("connectedUsers",{}),t.next=37;break;case 36:r("showIncommingCall",!1);case 37:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},At=a(140),Tt=function(e,t,a,n){return o.a.createElement(Q.a,null,o.a.createElement(_.a,{icon:"dashboard",active:!0,intent:Z.a.PRIMARY,text:"Goto Dashboard",onClick:e,disabled:!n.user}),o.a.createElement(_.a,{disabled:a||!n.user,icon:"log-out",intent:Z.a.DANGER,text:"Logout",onClick:t}))},Rt=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={apis:{},redirectDashboard:!1,smallScreen:!1,loading:!1,unreadMessage:0,unreadNotis:0,lastNotifId:null,msgSound:!1,notiSound:!1},a.getUnreadNotifs=function(e){var t=e.database,n=e.account,r=a.state,o=r.unreadMessage,i=r.unreadNotis;if(n.user){var c=jt({database:t,account:n}).reduce(function(e,t){return e+=t.unSeenNo},0),s=Ct(a.props);a.setState({unreadMessage:c,unreadNotis:s.unSeenNo,lastNotifId:s.lastNotifId,msgSound:o<c,notiSound:i<s.unSeenNo})}},a.logoutAction=Object(W.a)(L.a.mark(function e(){var t,n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props.webRtc,n=a.state.apis,a.setState({loading:!0}),e.prev=3,!t.isLive){e.next=7;break}return e.next=7,Dt(a.props,null,n)();case 7:n.logout(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),a.setState({loading:!1});case 13:case"end":return e.stop()}},e,null,[[3,10]])})),a.onClickHandler=function(){a.setState({redirectDashboard:!0})},a.toggleSmallScreen=function(){var e=a.state.smallScreen;a.setState({smallScreen:!e})},a.getMetaTags=function(){var e=a.state,t=e.unreadMessage,n=e.unreadNotis,r=t+n>9?"9+":n+t;return o.a.createElement(ee.a,null,0===r?o.a.createElement("title",null,"Proper Class"):o.a.createElement("title",null,"(".concat(r,") Proper Class")))},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue.scope("Mentee");case 2:t=e.sent,this.props.account.user&&this.getUnreadNotifs(this.props),this.setState({apis:t});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillReceiveProps",value:function(e){e.account.user&&this.getUnreadNotifs(e)}},{key:"render",value:function(){var e,t=this.props,a=t.account,n=t.database,r=t.navigate,i=t.className,c=t.updateWebRtc;if(a.user){var s=Object.values(n.UserDetail.byId).find(function(e){return e.userId===a.user.id});e=s&&s.image?"".concat(oe,"/user/").concat(1e7+parseInt(s.userId,10),"/profile/").concat(s.image):null}var l=this.state,u=l.apis,d=l.unreadNotis,m=l.lastNotifId,p=l.redirectDashboard,f=l.unreadMessage,v=l.loading,b=l.smallScreen,g=l.msgSound,h=l.notiSound;return o.a.createElement("div",{className:"navbar ".concat(i)},this.getMetaTags(),p&&o.a.createElement(U.a,{exact:!0,push:!0,to:"/dashboard/".concat(a.user.slug)}),o.a.createElement("div",{className:"navbar-left"},o.a.createElement(K.a,{to:"/",className:"properClass"===r.mainNav.name?"active":null},o.a.createElement("div",{className:"navbar-item",style:{padding:"0px 5px"}},o.a.createElement("img",{width:200,alt:"Proper Class Logo",src:At}))),o.a.createElement(K.a,{to:"/archive",className:"archive"===r.mainNav.name?"active":null},o.a.createElement("div",{className:"navbar-item"},o.a.createElement("span",null,"Archive"))),o.a.createElement(K.a,{to:"/search",className:"search"===r.mainNav.name?"active":null},o.a.createElement("div",{className:"navbar-item"},o.a.createElement("span",null,"Find Mentor")))),o.a.createElement("div",{className:"navbar-more-container"},o.a.createElement(X.a,{icon:"menu",className:"more-icon",onClick:this.toggleSmallScreen}),o.a.createElement(Ot,{smallScreenToggle:this.toggleSmallScreen,open:b,account:a,apis:u,pcLogo:At})),o.a.createElement("div",{className:"navbar-right"},a.sessionId&&o.a.createElement(ht,{account:a,unreadMessage:f,database:n,updateWebRtc:c,msgSound:g}),a.sessionId&&o.a.createElement(gt,Object.assign({notiSound:h,notiNo:d,lastNotifId:m},this.props,{apis:u})),a.sessionId?o.a.createElement(Nt,{navigate:r,profilePic:e,content:Tt(this.onClickHandler,this.logoutAction,v,a)}):o.a.createElement(K.a,{to:"/login",className:"login"===r.mainNav.name?"active":null},o.a.createElement("div",{className:"navbar-item"},o.a.createElement("span",null,"Login")))))}}]),t}(r.Component);Rt.defaultProps={className:""};var Pt=Object(p.b)(function(e){return e},Object(y.a)({},n))(Rt),Mt=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"footer"},o.a.createElement("div",{className:"pc-logo"},o.a.createElement("span",null,"Proper Class")),o.a.createElement("div",{className:"left-right-container"},o.a.createElement("div",{className:"footer-left"},o.a.createElement("div",{className:"foot-left-one"},o.a.createElement("div",{className:"one-content"},o.a.createElement(K.a,{to:"/about",className:"pc-foot-link"},o.a.createElement("span",null,"About Us")),o.a.createElement(K.a,{to:"/career",className:"pc-foot-link"},o.a.createElement("span",null,"Careers")),o.a.createElement(K.a,{to:"/support",className:"pc-foot-link"},o.a.createElement("span",null,"Support")))),o.a.createElement("div",{className:"foot-left-one"},o.a.createElement("div",{className:"one-content"},o.a.createElement(K.a,{to:"/business",className:"pc-foot-link"},o.a.createElement("span",null,"Business Enquiry")),o.a.createElement(K.a,{to:"/services",className:"pc-foot-link"},o.a.createElement("span",null,"Software Services")),o.a.createElement(K.a,{to:"/privacy-policy",className:"pc-foot-link"},o.a.createElement("span",null,"Privacy Policy"))))),o.a.createElement("div",{className:"footer-right"},o.a.createElement("div",{className:"right-content"},o.a.createElement(K.a,{to:"/terms-and-conditions",className:"pc-foot-link"},o.a.createElement("span",null,"Terms and Conditions")),o.a.createElement(K.a,{to:"/report",className:"pc-foot-link"},o.a.createElement("span",null,"Report"))))),o.a.createElement("div",{className:"pc-cr-container"},o.a.createElement("p",null,"\xa9 2015 - 2019 Proper Class Inc.")))}}]),t}(o.a.Component),Ht=function(e){var t=e.sendMessage,a=e.connectMentor,n=e.type,r=e.loading;switch(n){case"connected":return o.a.createElement("div",{className:"con-option"},o.a.createElement(ve.b,{text:"Connected",large:!0,fill:!0,intent:"primary"}),o.a.createElement(ve.b,{text:"Message",large:!0,fill:!0,onClick:t}));case"pending":return o.a.createElement(ve.b,{text:"Pending",large:!0,fill:!0,icon:"follower"});case"incoming":return o.a.createElement(ve.b,{text:"Accept",loading:r,disabled:r,large:!0,fill:!0,onClick:function(){return a("accept")},intent:"success",icon:"following"});default:return o.a.createElement(ve.b,{onClick:function(){return a("request")},text:"Connect",large:!0,loading:r,disabled:r,fill:!0,intent:"primary",icon:"new-person"})}},Ut=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={type:"",loading:!1},a.sendMessage=function(){var e=a.props,t=e.updateWebRtc,n=e.details,r=e.database,o=e.account,i=Object.values(r.UserConnection.byId).find(function(e){return e.mId===n.id||e.userId===n.id});t("showCommunication",n.id),t("connectionId",i.id),t("peerType","user"),t("communicationContainer","history"),t("chatHistory",{type:"user",user:{user:i.userId===o.user.id?r.User.byId[i.mId]:r.User.byId[i.userId]},connectionId:i.id})},a.connectMentor=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d,m,p,f;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.props,r=n.apis,o=n.account,i=n.details,c=n.database,s=n.addDatabaseSchema,l=n.updateDatabaseSchema,u=o.user.id,d=i.id,m=null,c.UserConnection.allIds.map(function(e){var t=c.UserConnection.byId[e];u!==t.userId&&u!==t.mId||d!==t.userId&&d!==t.mId||(m=t)}),e.t0=t,e.next="request"===e.t0?8:"accept"===e.t0?22:34;break;case 8:return p={userId:o.user.id,mId:i.id,timeStamp:Date.now(),status:"pending"},a.setState({loading:!0}),e.prev=10,e.next=13,r.connectUser(p);case 13:f=e.sent,s("UserConnection",Object(y.a)({id:f},p)),a.setState({type:"pending",loading:!1}),e.next=21;break;case 18:e.prev=18,e.t1=e.catch(10),console.log("Error =>",e.t1);case 21:return e.abrupt("break",34);case 22:return a.setState({loading:!0}),e.prev=23,e.next=26,r.updateUserConnection([{status:"connected",mId:m.mId,userId:m.userId},{id:m.id}]);case 26:l("UserConnection",{id:m.id,status:"connected"}),a.setState({type:"connected",loading:!1}),e.next=33;break;case 30:e.prev=30,e.t2=e.catch(23),console.log("Error =>",e.t2);case 33:return e.abrupt("break",34);case 34:case"end":return e.stop()}},e,null,[[10,18],[23,30]])}));return function(t){return e.apply(this,arguments)}}(),a.checkConnection=function(e){var t=e.database,n=e.details,r=e.account.user.id,o=n.id,i="";t.UserConnection.allIds.map(function(e){var a=t.UserConnection.byId[e];if((r===a.userId||r===a.mId)&&(o===a.userId||o===a.mId)){if("connected"===a.status)return void(i="connected");i=r===a.userId?"pending":"incoming"}}),a.setState({type:i})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.checkConnection(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.checkConnection(e)}},{key:"render",value:function(){var e=this.state,t=e.type,a=e.loading;return o.a.createElement("div",{className:"con"},o.a.createElement(Ht,{loading:a,sendMessage:this.sendMessage,connectMentor:this.connectMentor,type:t}))}}]),t}(o.a.Component),Bt=a(332),Lt=function(e){var t=e.data;return o.a.createElement("a",{href:t.link?t.link:"#",style:{color:"black",textDecoration:"none"},rel:"noopener noreferrer",target:"_blank"},o.a.createElement(Bt.a,{elevation:2,interactive:!0,style:{marginRight:10,marginBottom:10,display:"flex",flexDirection:"row",padding:"2px",position:"relative"}},t.attachment&&o.a.createElement("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"}},o.a.createElement("img",{height:50,alt:"portal identity",src:"".concat(oe,"/user/").concat(1e7+parseInt(t.userId,10),"/profile/").concat(t.attachment)})),o.a.createElement("div",{style:{padding:"3px"}},o.a.createElement("span",null,o.a.createElement("strong",null,t.title)),o.a.createElement("br",null),o.a.createElement("span",null,t.description),o.a.createElement("br",null))))},Wt=function(){return o.a.createElement("div",null)},Vt=a(77),zt=a(142),Ft=a(143),qt=a(144),Gt=function(e){function t(e){var a;return Object(s.a)(this,t),(0,(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).props.updateNav)({schema:"mainNav",data:{name:""}}),a.state={apis:{},loading:!0,data:{}},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a,n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.match,n=t.account,r={},e.prev=2,!n.user){e.next=7;break}return e.next=6,ue.scope("Mentee");case 6:r=e.sent;case 7:return e.next=9,Y.a.get("".concat(oe,"/web/get-user?userId=").concat(a.params.userId));case 9:o=e.sent,this.setState({data:o.data,apis:r,loading:!1}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),console.log("Error",e.t0);case 16:case"end":return e.stop()}},e,this,[[2,13]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillReceiveProps",value:function(){var e=Object(W.a)(L.a.mark(function e(t){var a,n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.props.match,t.match.params.userId===a.params.userId){e.next=13;break}return this.setState({loading:!0}),e.prev=3,e.next=6,Y.a.get("".concat(oe,"/web/get-user?userId=").concat(t.match.params.userId));case 6:n=e.sent,this.setState({data:n.data,loading:!1}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("Error",e.t0);case 13:case"end":return e.stop()}},e,this,[[3,10]])}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.account,a=e.database,n=e.updateWebRtc,r=e.addDatabaseSchema,i=e.updateDatabaseSchema,c=this.state,s=c.loading,l=c.data,u=c.apis;if(s)return o.a.createElement(Fe,null);var d=l.userDetail,m=l.user,p=l.userEducation,f=l.userWorkExperience,v=l.userPortal,b=l.userDetail.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(l.user.id,10),"/profile/").concat(l.userDetail.coverImage):qt,g=l.userDetail.coverEdit&&"".concat(oe,"/user/").concat(1e7+parseInt(l.user.id,10),"/profile/").concat(l.userDetail.coverEdit);return o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"public-profile"},o.a.createElement("div",{className:"cover-pic"},g?o.a.createElement("img",{alt:"cover profile of the user",src:g}):o.a.createElement("img",{alt:"cover profile of the user",src:b})),o.a.createElement("div",{className:"profilePic"},o.a.createElement(it,{imgUrl:d.image?"".concat(oe,"/user/").concat(1e7+parseInt(m.id,10),"/profile/").concat(d.image):Vt})),o.a.createElement("div",{className:"top-details"},o.a.createElement("div",{className:"desc"},o.a.createElement("span",{className:"name"},ct(m)),o.a.createElement("br",null),o.a.createElement(X.a,{icon:"locate"}),o.a.createElement("span",{className:"country"}," ",d.address?d.address:"---")),t.user&&o.a.createElement("div",{className:"connect-btns"},t.user.id!==m.id&&o.a.createElement(Ut,{apis:u,updateWebRtc:n,addDatabaseSchema:r,updateDatabaseSchema:i,database:a,details:m,moreDetails:d,account:t}))),o.a.createElement("div",{className:"bio"},o.a.createElement("div",null,d.bio?o.a.createElement("p",null,d.bio):o.a.createElement("p",{style:{color:"#696969"}},"No bio added")),o.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",padding:"5px"}},v.map(function(e){return o.a.createElement(Lt,{key:e.id,data:e})}))),o.a.createElement("div",{className:"adv-body"},o.a.createElement("div",{className:"left-body"},o.a.createElement("div",{className:"education"},o.a.createElement("p",{className:"p-top"},o.a.createElement("span",null,"Education")),o.a.createElement("div",{className:"p-edu-list"},0!==p.length?o.a.createElement("div",{className:"p-edu-list"},p.map(function(e){return o.a.createElement("div",{className:"p-edu-list-i"},o.a.createElement("img",{src:zt,alt:"school icon"}),o.a.createElement("p",null,o.a.createElement("span",{className:"p-name-i"},e.degree),o.a.createElement("br",null),o.a.createElement("span",null,e.address),o.a.createElement("br",null),o.a.createElement("span",{className:"p-timeline"},"".concat(e.startTime," - ").concat(e.endTime)),o.a.createElement("br",null)))})):o.a.createElement("div",null,o.a.createElement("span",{style:{color:"#696969"}},"No School Added")))),o.a.createElement("div",{className:"experience"},o.a.createElement("p",{className:"p-top"},o.a.createElement("span",null,"Experience")),o.a.createElement("div",{className:"p-exp-list"},0!==f.length?o.a.createElement("div",{className:"p-edu-list"},f.map(function(e){return o.a.createElement("div",{className:"p-exp-list-i"},o.a.createElement("img",{src:Ft,alt:"school icon"}),o.a.createElement("p",null,o.a.createElement("span",{className:"p-title-i"},e.title),o.a.createElement("br",null),o.a.createElement("span",{className:"p-company-i"},e.company),o.a.createElement("br",null),o.a.createElement("span",{className:"p-timeline"},"".concat(e.startTime," - ").concat(e.endTime)),o.a.createElement("br",null),o.a.createElement("span",null,e.summary)))})):o.a.createElement("div",null,o.a.createElement("span",{style:{color:"#696969"}},"No experience added")))),o.a.createElement("div",{className:"skills"},o.a.createElement("p",{className:"p-top"},o.a.createElement("span",null,"Skills")),o.a.createElement("div",{className:"skills-container"},0===l.userSkill.length?"No Skills Added":JSON.parse(l.userSkill[0].skill).map(function(e,t){return o.a.createElement("span",{key:t},e)})))),o.a.createElement("div",{className:"right-body"},o.a.createElement(Wt,null)))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),Jt=Object(p.b)(function(e){return e},Object(y.a)({},n))(Gt),Yt=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={search:"",gotKey:!1},a.searchChange=function(e){a.setState({search:e.target.value})},a.submitSearch=function(e){e.preventDefault(),(0,a.props.updateNav)({schema:"search",data:{key:a.state.search}}),a.setState({gotKey:!0})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.search,a=e.gotKey,n=this.props.account;return o.a.createElement("div",{className:"search-box-container"},a&&o.a.createElement(U.a,{push:!0,to:"/search"}),o.a.createElement("div",{className:"search-form"},o.a.createElement("form",null,o.a.createElement("input",{value:t,onChange:this.searchChange,placeholder:"Keyword ..."}),o.a.createElement("button",{type:"submit",onClick:this.submitSearch},"Search"))),o.a.createElement("div",{className:"pc-jumbo"},o.a.createElement("span",{className:"pc-jumbo-text"},"Start Connecting"),n.user?o.a.createElement("button",{type:"button",onClick:this.submitSearch},"Find Mentor"):o.a.createElement(K.a,{to:"/login"},o.a.createElement("button",{type:"button"},"Login"))))}}]),t}(o.a.Component),Kt=Object(p.b)(function(e){return e},Object(y.a)({},n))(Yt),Qt=a(114),_t=a.n(Qt),Zt=[{id:"country",fieldtype:"select",options:[{label:"---",value:""}],val:""},{id:"key",fieldtype:"input",placeholder:"Ex, CEO, Professor"},{id:"industry",fieldtype:"select",options:[{label:"---",value:""},{label:"Engineering",value:"engineering"},{label:"Accounting",value:"accounting"},{label:"Medical",value:"medical"},{label:"Management",value:"management"},{label:"Information Technology",value:"informationTechnology"},{label:"Astronomy",value:"astronomy"}],val:""},{id:"apply",text:"Apply",fieldtype:"button",type:"submit"}],Xt=function(e){function t(e){var a;Object(s.a)(this,t);var n=(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).props.searchKey,r=_t()().getData().map(function(e){return{label:e.label,value:e.label}});return a.state={schema:Zt.map(function(e){return"key"===e.id?Object(y.a)({},e,{val:n}):"country"===e.id?(e.options=[].concat(Object(g.a)(e.options),Object(g.a)(r)),e):e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.schema,t=this.props.filterSearch;return o.a.createElement("div",{className:"filter-toolbar"},o.a.createElement("div",{className:"left set"},o.a.createElement("span",{className:"filter-label"},"Filters")),o.a.createElement("div",{className:"center set"},o.a.createElement(Je,{data:e,callback:t})),o.a.createElement("div",{className:"right set"}))}}]),t}(o.a.Component),$t=a(42),ea=a(49),ta=function(e){var t=e.item,a=t.user,n=t.userDetail,r=n.image?"".concat(oe,"/user/").concat(1e7+parseInt(a.id,10),"/profile/").concat(n.image):ea;return o.a.createElement("div",{className:"i-result"},o.a.createElement("div",{className:"img-con"},o.a.createElement(it,{imgUrl:r})),o.a.createElement("div",{className:"desc-con"},o.a.createElement("p",{className:"name"},o.a.createElement(K.a,{to:"/user/".concat(a.slug,"/")},ct(a))),o.a.createElement("div",{className:"location"},o.a.createElement("div",null,o.a.createElement($t.h,null)),o.a.createElement("div",{className:"country"},n.country?n.country:"---"))))},aa=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.data;return o.a.createElement("div",{className:"result-list"},o.a.createElement("p",{className:"label"},"Showing"," ",e.length," ","results"),e.map(function(e,t){return o.a.createElement(ta,{key:t,item:e})}))}}]),t}(o.a.Component),na=a(78),ra=function(e){var t=e.obj,a=t.blog.content.replace(/<[^>]+>/g,"").replace(/&nbsp;/g," ").substring(0,300),n=t.userDetails.find(function(e){return e.user.id===t.blog.userId}),r=t.blog.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(t.blog.userId,10),"/blog/").concat(t.blog.coverImage):na;return o.a.createElement("div",{className:"ar-left-i"},o.a.createElement("div",{className:"ar-i-img"},o.a.createElement("img",{alt:"test here",src:r})),o.a.createElement("div",{className:"ar-i-detail"},o.a.createElement(K.a,{to:"/blog/".concat(n.user.slug,"/").concat(t.blog.slug),className:"ar-i-title"},t.blog.title),o.a.createElement("p",null,o.a.createElement("span",null,"Author: "),o.a.createElement(K.a,{to:"/user/".concat(n.user.slug,"/")}," ".concat(n.user.firstName," ").concat(n.user.middleName?"".concat(n.user.middleName," "):"").concat(n.user.lastName)),o.a.createElement("br",null),o.a.createElement("small",{className:"pc-date"},new Date(t.blog.timeStamp).toDateString())),o.a.createElement("p",{className:"pc-blog-desc"},"".concat(a," ...")),o.a.createElement("div",{className:"ar-i-counts"},o.a.createElement("p",{className:"label"},o.a.createElement("span",{className:"count"},t.blogComment.length),"Comments"),o.a.createElement("p",{className:"label"},o.a.createElement("span",{className:"count"},t.blogLike.length),"Likes"))))},oa=a(78),ia=a(49),ca=function(e){var t=e.obj,a=t.userDetail.image?"".concat(oe,"/user/").concat(1e7+parseInt(t.user.id,10),"/profile/").concat(t.userDetail.image):ia;return o.a.createElement("div",{className:"popular-user"},o.a.createElement("div",{className:"user-image"},o.a.createElement(it,{imgUrl:a})),o.a.createElement("div",{className:"user-detail"},o.a.createElement("div",{className:"name"},o.a.createElement(K.a,{to:"/user/".concat(t.user.slug,"/")}," ".concat(t.user.firstName," ").concat(t.user.middleName?"".concat(t.user.middleName," "):"").concat(t.user.lastName))),o.a.createElement("div",{style:{opacity:.8,marginTop:3}},o.a.createElement($t.h,null)," ",o.a.createElement("span",{style:{textTransform:"capitalize",fontSize:14,verticalAlign:"text-bottom"}}," ",t.userDetail.country||"---"))))},sa=function(e){var t=e.obj,a=t.blog.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(t.blog.userId,10),"/blog/").concat(t.blog.coverImage):oa,n=t.userDetails.find(function(e){return e.user.id===t.blog.userId});return o.a.createElement("div",{className:"popular-blog"},o.a.createElement("div",{className:"ar-i-img",style:{background:"url(".concat(a,")")}}),o.a.createElement("div",{className:"ar-i-detail"},o.a.createElement(K.a,{to:"/blog/".concat(n.user.slug,"/").concat(t.blog.slug),className:"blog-title"},t.blog.title),o.a.createElement("div",{className:"blog-author"},"Author:"," ",o.a.createElement(K.a,{to:"/user/".concat(n.user.slug,"/")}," ".concat(n.user.firstName," ").concat(n.user.middleName?"".concat(n.user.middleName," "):"").concat(n.user.lastName)),o.a.createElement("div",null,o.a.createElement("small",{className:"pc-date"},new Date(t.blog.timeStamp).toDateString())))))},la=function(e){var t=e.data,a=t.blogs.map(function(e,t){return o.a.createElement(sa,{obj:e,key:t})}),n=t.users.map(function(e,t){return o.a.createElement(ca,{obj:e,key:t})});return o.a.createElement("div",{className:"popular-on-pc"},a,o.a.createElement("div",{className:"users-head"},"Popular Mentors"),n)},ua=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0,data:{}},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a,n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.updateNav,a=k("pc-session"),t({schema:"mainNav",data:{name:"archive"}}),e.prev=3,e.next=6,Y.a.get("".concat(oe,"/web/get-archive?userId=").concat(a||""));case 6:n=e.sent,this.setState({data:n.data,loading:!1}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),console.log("Eror: ",e.t0);case 13:case"end":return e.stop()}},e,this,[[3,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.data;return t?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"archive"},o.a.createElement("div",{className:"ar-top"},o.a.createElement("span",null,"BASED ON YOUR READING HISTORY")),o.a.createElement("div",{className:"ar-content"},o.a.createElement("div",{className:"ar-left"},a.basedOnHistory.blogs.map(function(e,t){return o.a.createElement(ra,{key:t,obj:e})})),o.a.createElement("div",{className:"ar-right"},o.a.createElement("p",{className:"ar-right-top"},"Popular on PC"),o.a.createElement(la,{data:a.popularOnPc})))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),da=Object(p.b)(function(e){return e},Object(y.a)({},n))(ua),ma=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.data;return o.a.createElement("div",{className:"result-list blogs"},o.a.createElement("p",{className:"label"},"Popular Blogs"),e.map(function(e){return o.a.createElement(ra,{obj:e,key:e.blog.id})}))}}]),t}(o.a.Component),pa=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getSearchResult=function(){var e=Object(W.a)(L.a.mark(function e(t){var n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.a.get("".concat(oe,"/web/do-search?key=").concat(t.key,"&country=").concat(t.country,"&industry=").concat(t.industry));case 3:n=e.sent,a.setState({data:n.data,loading:!1}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("Error",e.t0);case 10:case"end":return e.stop()}},e,null,[[0,7]])}));return function(t){return e.apply(this,arguments)}}(),a.fireScroll=function(){var e=a.state.changeStyle;window.scrollY>65&&!e&&a.setState({changeStyle:!0}),window.scrollY<65&&e&&a.setState({changeStyle:!1})},a.filterSearch=function(e){return(0,a.props.updateNav)({schema:"search",data:e}),a.getSearchResult(e),{response:200}},a.state={loading:!0,data:{},changeStyle:!1},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){window.addEventListener("scroll",this.fireScroll,{passive:!0});var e=this.props,t=e.navigate;(0,e.updateNav)({schema:"mainNav",data:{name:"search"}}),this.getSearchResult(t.search)}},{key:"render",value:function(){var e=this.props.navigate,t=this.state,a=t.loading,n=t.data,r=t.changeStyle;return a?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,{className:r?"":"pcm-nav"}),o.a.createElement("div",{className:"search-result"},o.a.createElement(Xt,{searchKey:e.search.key,filterSearch:this.filterSearch}),o.a.createElement(aa,{data:n.users}),o.a.createElement(ma,{data:n.blogs})),o.a.createElement(Mt,null))}}]),t}(o.a.Component),fa=Object(p.b)(function(e){return e},Object(y.a)({},n))(pa),va=a(253),ba=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={data:null},a.searchChange=function(e,t){a.setState(Object(h.a)({},e,t))},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.data;this.setState({data:e.map(function(e){return"".concat(oe,"/images/slider/").concat(e)})})}},{key:"componentWillReceiveProps",value:function(e){this.props.data!==e.data&&this.setState({data:e.data.map(function(e){return"".concat(oe,"/images/slider/").concat(e)})})}},{key:"render",value:function(){var e=this.state.data;return e?o.a.createElement("div",{className:"slider-container"},o.a.createElement(va.Carousel,{interval:5e3,showIndicators:!1,showThumbs:!1,stopOnHover:!1,dynamicHeight:!0,showStatus:!1,infiniteLoop:!0,autoPlay:!0},e.map(function(e,t){return o.a.createElement("div",{key:t,style:{backgroundImage:"url(".concat(e,")")},className:"slider-img-con"})})),o.a.createElement(Kt,null)):o.a.createElement("div",null)}}]),t}(r.Component),ga=a(63),ha=a(267),ya=a(268),Ca=a(269),wa=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.account;return o.a.createElement("div",{className:"banner-container"},o.a.createElement("div",{className:"banner-head"},o.a.createElement("p",null,"How it works")),o.a.createElement("div",{className:"banners"},o.a.createElement("div",{className:"banner"},o.a.createElement("div",{className:"banner-image"},o.a.createElement("img",{src:ha,alt:"banner here"})),o.a.createElement("div",{className:"banner-content"},o.a.createElement("div",{className:"banner-title"},o.a.createElement("p",null,"Connect with the Mentors")),o.a.createElement("div",{className:"banner-description"},o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement(K.a,{to:e.user?"#":"/register"},o.a.createElement(ga.b,{color:"#1d4354",size:22}))," ","Sign up to create your profile and own a dashboard."),o.a.createElement("p",null,o.a.createElement(ga.e,{color:"#1d4354",size:22})," ","Find mentors using the search feature as your interest."),o.a.createElement("p",null,o.a.createElement(ga.d,{color:"#1d4354",size:22})," ","Send Connection request to the mentors."))))),o.a.createElement("div",{className:"banner middle"},o.a.createElement("div",{className:"banner-content"},o.a.createElement("div",{className:"banner-title"},o.a.createElement("p",null,"Manage your profile and start project")),o.a.createElement("div",{className:"banner-description"},o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement(ga.f,{color:"#1d4354",size:22})," ","Update your profile, fill out your education and experience"),o.a.createElement("p",null,o.a.createElement(ga.a,{color:"#1d4354",size:22})," ","Create classrooms and organize the projects with tasks"),o.a.createElement("p",null,o.a.createElement($t.b,{color:"#1d4354",size:22})," ","Create content, write blogs and use drawing board as well.")))),o.a.createElement("div",{className:"banner-image"},o.a.createElement("img",{src:ya,alt:"banner here"}))),o.a.createElement("div",{className:"banner"},o.a.createElement("div",{className:"banner-image"},o.a.createElement("img",{src:Ca,alt:"banner here"})),o.a.createElement("div",{className:"banner-content"},o.a.createElement("div",{className:"banner-title"},o.a.createElement("p",null,"Mentorship")),o.a.createElement("div",{className:"banner-description"},o.a.createElement("div",null,o.a.createElement("p",null,o.a.createElement($t.d,{color:"#1d4354",size:22})," ","Strengthen mentor-mentee relationship"),o.a.createElement("p",null,o.a.createElement($t.a,{color:"#1d4354",size:22})," ","Track your progress, communicate, generate report"),o.a.createElement("p",null,o.a.createElement($t.i,{color:"#1d4354",size:22})," ","Read, learn and contribute")))))))}}]),t}(r.Component),Ea=Object(p.b)(function(e){return{account:e.account}},Object(y.a)({},n))(wa),Sa=a(77),Oa=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={portrait:!1},a.checkPortrait=function(){var e=a.props.candidate,t=e.user,n=e.userDetail,r=n.image?"".concat(oe,"/user/").concat(1e7+parseInt(t.id,10),"/profile/").concat(n.image):Sa,o=new Image;o.onload=function(){o.height>o.width&&a.setState({portrait:!0})},o.src=r},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.checkPortrait()}},{key:"render",value:function(){var e=this.props.candidate,t=e.user,a=e.userDetail,n=this.state.portrait,r=a.image?"".concat(oe,"/user/").concat(1e7+parseInt(t.id,10),"/profile/").concat(a.image):Sa;return o.a.createElement("div",{className:"popular"},o.a.createElement("div",{className:"popularImage"},o.a.createElement("img",{className:n?"portrait":"landscape",src:r,alt:"candidate ".concat(a.id)})),o.a.createElement("div",{className:"popularDesc"},o.a.createElement(K.a,{to:"user/".concat(t.slug),className:"popularName"},ct(t)),o.a.createElement("p",{className:"popularExpertize"},e.expertize)))}}]),t}(o.a.Component),ka=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.data;return o.a.createElement("div",{className:"popularContainer"},o.a.createElement("div",{className:"popularHeader"},o.a.createElement("p",null,"Featured Mentors at Proper Class")),o.a.createElement("div",{className:"popularCover"},e.map(function(e){return o.a.createElement(Oa,{key:e.user.id,candidate:e})})))}}]),t}(r.Component),Ia=function(e){var t=e.post;return o.a.createElement(Bt.a,{className:"post-box"},o.a.createElement("div",{className:"post-header"},o.a.createElement("p",null,t.title)),o.a.createElement("div",{className:"desc-image"},o.a.createElement("div",{className:"post-desc"},o.a.createElement("p",null,t.description)),o.a.createElement("div",{className:"post-image"},o.a.createElement("img",{src:t.image,alt:t.id}))))},ja=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={posts:[]},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.posts;return o.a.createElement("div",{className:"post-container"},o.a.createElement("div",{className:"posts"},e.map(function(e){return o.a.createElement(Ia,{key:e.id,post:e})})))}}]),t}(r.Component),xa=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={data:{},loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return R.dispatch(V({schema:"mainNav",data:{name:"properClass"}})),e.prev=1,e.next=4,Y.a.get("".concat(oe,"/web/get-index"));case 4:t=e.sent,this.setState({data:t.data,loading:!1}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("Eror: ",e.t0);case 11:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.data;return e.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement(ba,{data:t.sliderImages}),o.a.createElement(Ea,null),o.a.createElement(ja,null),o.a.createElement(ka,{data:t.indexUsers}),o.a.createElement(Mt,null))}}]),t}(r.Component),Na=[{id:"email",fieldtype:"input",name:"Email",required:!0,placeholder:"Eg, alex@gmail.com"},{id:"password",fieldtype:"input",hidden:!0,required:!0,name:"Password",placeholder:"Eg, Xyz@123peQ",icon:{side:"right",name:"eye-open"}},{id:"submit",fieldtype:"button",type:"submit",text:"Submit",fill:"fill",intent:"primary",large:"large"}],Da=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.loginHandler;return o.a.createElement(Le,{data:Na,callback:e})}}]),t}(r.Component),Aa=a(254),Ta=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.googleLogin,a=e.loading;return o.a.createElement(Aa.GoogleLogin,{clientId:"326098273643-s03gfvahj2tvlkb3fvr487o5nep2fp0f.apps.googleusercontent.com",buttonText:"Sign in with google",onSuccess:t,onFailure:t,disabled:a,disabledStyle:{cursor:"not-allowed",opacity:.7},cookiePolicy:"single_host_origin",className:"google-default"})}}]),t}(o.a.Component),Ra=function(){var e=Object(W.a)(L.a.mark(function e(t){var a,n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.a.post("".concat(oe,"/auth/login"),t);case 3:if(a=e.sent,n=a.data,200!==a.status||!n.token){e.next=8;break}return I("pc-session",(r=n).token),R.dispatch({type:"VERIFIED",payload:r.token}),ue.reconnect(ie()),e.abrupt("return",{response:200,data:a.data});case 8:if(201!==a.status){e.next=10;break}return e.abrupt("return",{error:a.data});case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",{error:e.t0.message});case 15:case"end":return e.stop()}var r},e,null,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),Pa=function(){var e=Object(W.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.a.get("".concat(oe,"/auth/forgot?email=").concat(t.email));case 3:if(200!==e.sent.status){e.next=6;break}return e.abrupt("return",{response:200});case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{error:"No result found"});case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),Ma=function(){var e=Object(W.a)(L.a.mark(function e(t){var a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.a.post("".concat(oe,"/auth/user-registration"),{firstName:t.firstName,middleName:t.middleName,lastName:t.lastName,email:t.email,password:t.password});case 3:if(200!==(a=e.sent).status){e.next=6;break}return e.abrupt("return",{response:200});case 6:if(201!==a.status){e.next=8;break}return e.abrupt("return",{error:a.data});case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(0),console.log("error in resgistration",e.t0.response.body),e.abrupt("return",{error:e.t0.message});case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t){return e.apply(this,arguments)}}(),Ha=function(){var e=Object(W.a)(L.a.mark(function e(t){var a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.a.get("".concat(oe,"/auth/reset?password=").concat(t.newPassword,"&token=").concat(t.token));case 3:if(200!==(a=e.sent).status){e.next=6;break}return e.abrupt("return",{response:200});case 6:return e.abrupt("return",{error:a.data.error});case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",{error:e.t0.message});case 12:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t){return e.apply(this,arguments)}}(),Ua=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={redirect:!1,slug:"",loading:!1},a.loginHandler=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props.updateNav,e.next=3,Ra(t);case 3:return 200===(r=e.sent).response&&(n({schema:"popNotification",data:{active:!0,message:"Login successful. Welcome to Dashboard.",intent:"success"}}),a.setState({redirect:!0,slug:r.data.slug})),e.abrupt("return",r);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.googleLogin=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props.updateNav,a.setState({loading:!0}),e.prev=2,e.next=5,Ra({loginType:"google",record:t});case 5:return 200===(r=e.sent).response&&(n({schema:"popNotification",data:{active:!0,message:"Login successful. Welcome to Dashboard.",intent:"success"}}),a.setState({redirect:!0,slug:r.data.slug})),e.abrupt("return",r);case 10:e.prev=10,e.t0=e.catch(2),a.setState({loading:!1}),n({schema:"popNotification",data:{active:!0,message:"Could not login with google",intent:"danger"}});case 14:case"end":return e.stop()}},e,null,[[2,10]])}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.account,t=this.state,a=t.redirect,n=t.slug,r=t.loading;return o.a.createElement("div",{className:"o-log-or-reg"},o.a.createElement("div",{className:"log-or-reg"},o.a.createElement("div",{className:"reg-box-header"},o.a.createElement("p",null,"Login to Proper Class"),o.a.createElement(K.a,{to:"/register"},o.a.createElement("u",null,"or create an account"))),a||e.user?o.a.createElement(U.a,{push:!0,to:"/dashboard/".concat(n||e.user.slug)}):o.a.createElement(Da,{loginHandler:this.loginHandler}),o.a.createElement("div",{className:"auth-with-others"},o.a.createElement(Ta,{loading:r,googleLogin:this.googleLogin})),o.a.createElement("div",{className:"auth-footer"},o.a.createElement("p",null,o.a.createElement("br",null),o.a.createElement(K.a,{to:"/forgot-password"},o.a.createElement("u",null,"Forgot your password?"))))))}}]),t}(r.Component),Ba=Object(p.b)(function(e){return e},Object(y.a)({},n))(Ua),La=new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*])(?=.{8,})"),Wa=new RegExp("^(((?=.*[a-z])(?=.*[A-Z]))|((?=.*[a-z])(?=.*[0-9]))|((?=.*[A-Z])(?=.*[0-9])))(?=.{6,})"),Va=function(e){return La.test(e)?"strong":Wa.test(e)?"medium":"weak"},za=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,Fa=function(e){return!!za.test(e)},qa=[{id:"firstName",fieldtype:"input",name:"First Name",placeholder:"",required:!0},{id:"middleName",fieldtype:"input",name:"Middle Name",placeholder:""},{id:"lastName",fieldtype:"input",name:"Last Name",placeholder:"",required:!0},{id:"email",fieldtype:"input",name:"Email",placeholder:"Eg, alex@gmail.com",required:!0},{id:"password",fieldtype:"input",hidden:!0,name:"Password",placeholder:"Eg, Xyz@123peQ",icon:{side:"right",name:"eye-open"},required:!0},{id:"confirmPassword",fieldtype:"input",hidden:!0,name:"Confirm Password",placeholder:"Eg, ........",icon:{side:"right",name:"eye-open"},required:!0},{id:"submit",fieldtype:"button",type:"submit",text:"Submit",fill:"fill",intent:"primary",large:"large"}],Ga=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.handleRegistration;return o.a.createElement(Le,{data:qa,callback:e})}}]),t}(r.Component),Ja=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={redirect:!1},a.handleRegistration=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props.updateNav,Fa(t.email)){e.next=3;break}return e.abrupt("return",{error:"Please enter a valid email"});case 3:if("weak"!==Va(t.password)){e.next=5;break}return e.abrupt("return",{error:"Please enter a stronger password"});case 5:if(t.password===t.confirmPassword){e.next=7;break}return e.abrupt("return",{error:"Passwords don't match"});case 7:return e.next=9,Ma(t);case 9:return 200===(r=e.sent).response&&(n({schema:"popNotification",data:{active:!0,message:"Registration successful. Please verify your email and login.",intent:"success"}}),a.setState({redirect:!0})),e.abrupt("return",r);case 12:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.redirect;return o.a.createElement("div",{className:"o-log-or-reg"},e&&o.a.createElement(U.a,{to:"/login"}),o.a.createElement("div",{className:"log-or-reg"},o.a.createElement("div",{className:"reg-box-header"},o.a.createElement("p",null," Create a Proper Class Account "),o.a.createElement(K.a,{to:"/login"},o.a.createElement("u",null,"or login to your account"))),o.a.createElement(Ga,{handleRegistration:this.handleRegistration})))}}]),t}(r.Component),Ya=Object(p.b)(function(e){return e},Object(y.a)({},n))(Ja),Ka=a(333),Qa=function(e){var t=e.name,a=e.active,n=e.match,r=e.toggleMenu,i=e.url;return o.a.createElement(K.a,{to:i?"".concat(n.url,"/").concat(i):n.url,onClick:r,className:a?"sideNavElement active":"sideNavElement"},o.a.createElement("span",null,"\xa0\xa0",t))};Qa.defaultProps={active:!1,url:null};var _a=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={open:!1},a.toggleMenu=function(){var e=a.state.open;a.setState({open:!e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state.open,a=this.props,n=a.navigate,r=a.match;return o.a.createElement("div",{className:"pc-small-screen-sidenav"},o.a.createElement("div",null,o.a.createElement(ve.b,{onClick:this.toggleMenu,className:"nav-button",text:n.sideNav.name,fill:!0,large:!0,rightIcon:t?"chevron-up":"chevron-down",alignText:"left"})),o.a.createElement(Ka.a,{isOpen:t,keepChildrenMounted:!0},o.a.createElement("div",{className:"pc-collapse-menu"},[{name:"Profile",url:null},{name:"Classes",url:"classes"},{name:"Connections",url:"connection"},{name:"Drawing Board",url:"drawing-board"},{name:"Blog",url:"blog"},{name:"Settings",url:"settings"}].map(function(t){return o.a.createElement(Qa,{toggleMenu:e.toggleMenu,match:r,url:t.url,name:t.name,key:t.name,iconName:t.iconName,active:n.sideNav.name===t.name})}))))}}]),t}(o.a.Component),Za=Object(p.b)(function(e){return e})(_a),Xa=a(68),$a=function(e){var t=e.iconName,a=e.name,n=e.active,r=e.match,i=e.url;return o.a.createElement(K.a,{to:i?"".concat(r.url,"/").concat(i):r.url,className:n?"sideNavElement active":"sideNavElement"},o.a.createElement(X.a,{icon:Xa.a[t],iconSize:"15",color:"rgba(78, 185, 255, 1)",style:{verticalAlign:"baseline"}}),o.a.createElement("span",null,"\xa0\xa0",a))};$a.defaultProps={active:!1};var en=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:"profileIcon"}})}},{key:"render",value:function(){var e=this.props,t=e.match,a=e.navigate;return o.a.createElement("div",{className:"sideNav"},[{iconName:"PERSON",name:"Profile",url:""},{iconName:"PROJECTS",name:"Classes",url:"classes"},{iconName:"PEOPLE",name:"Connections",url:"connection"},{iconName:"DRAW",name:"Drawing Board",url:"drawing-board"},{iconName:"PARAGRAPH",name:"Blog",url:"blog"},{iconName:"COG",name:"Settings",url:"settings"}].map(function(e){return o.a.createElement($a,{match:t,url:e.url,name:e.name,key:e.name,iconName:e.iconName,active:a.sideNav.name===e.name})}))}}]),t}(r.Component),tn=Object(p.b)(function(e){return{navigate:e.navigate}},Object(y.a)({},n))(en),an=[{id:"bio",fieldtype:"textarea",name:"Bio",placeholder:"Tell world about you...",required:!0},{id:"submit",fieldtype:"button",type:"submit",text:"Submit",fill:"fill",intent:"primary",large:"large"}],nn=[{id:"degree",fieldtype:"input",name:"Name of the degree",placeholder:"Ex, Bachelors in IT",required:!0},{id:"address",fieldtype:"input",name:"Address",required:!0,placeholder:"Address of your institute"},{id:"startTime",fieldtype:"date",name:"Start Date"},{id:"endTime",fieldtype:"date",name:"End Date"},{id:"submit",fieldtype:"button",text:"Submit",type:"submit",fill:"fill",intent:"primary",large:"large"}],rn=[{id:"title",fieldtype:"input",name:"Title",required:!0,placeholder:"Ex, Software Developer"},{id:"company",fieldtype:"input",name:"Organization",required:!0,placeholder:"Ex, Tesla"},{id:"startTime",fieldtype:"date",name:"Start Date"},{id:"endTime",fieldtype:"date",name:"End Date"},{id:"summary",fieldtype:"textarea",name:"Summary",placeholder:"Write here about what your role was..."},{id:"submit",fieldtype:"button",text:"Submit",type:"submit",fill:"fill",intent:"primary",large:"large"}],on=[{id:"title",fieldtype:"input",name:"Title",placeholder:"Your product name",required:!0},{id:"attachment",fieldtype:"image",name:"Attachment"},{id:"description",fieldtype:"textarea",name:"Description",placeholder:"Tell about your product"},{id:"link",fieldtype:"input",name:"Link",placeholder:"https://www.google.com"},{id:"submit",fieldtype:"button",text:"Submit",type:"submit",fill:"fill",intent:"primary",large:"large"}],cn=a(142),sn=function(e){var t=e.data,a=e.editPopover;return o.a.createElement("div",{className:"p-edu-list-i"},o.a.createElement("img",{src:cn,alt:"school icon"}),o.a.createElement("p",null,o.a.createElement("span",{className:"p-name-i"},t.degree),o.a.createElement("br",null),o.a.createElement("span",null,t.address),o.a.createElement("br",null),o.a.createElement("span",{className:"p-timeline"},"".concat(t.startTime," - ").concat(t.endTime))),o.a.createElement("p",null,o.a.createElement(X.a,{style:{cursor:"pointer"},icon:"edit",onClick:function(){return a(t)}})))},ln=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={educationEditPopover:!1,editObj:null},a.editPopover=function(e){nn.map(function(t){switch(t.id){case"degree":return t.val=e.degree,t;case"address":return t.val=e.address,t;case"startTime":return t.val=new Date(pe()(e.startTime,"DD/MM/YYYY").valueOf()),t;case"endTime":return t.val=new Date(pe()(e.endTime,"DD/MM/YYYY").valueOf()),t;default:return t}}),a.togglePopover(e)},a.addEducation=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state.editObj,r=a.props,o=r.apis,i=r.account,c=r.addDatabaseSchema,s=r.updateDatabaseSchema,l=Object(y.a)({},t,{startTime:t.startTime.toLocaleString("en-IN").split(",")[0],endTime:t.endTime.toLocaleString("en-IN").split(",")[0],userId:i.user.id}),!n){e.next=8;break}return e.next=6,o.updateUserEducation([Object(y.a)({},l),{id:n.id}]);case 6:return s("UserEducation",Object(y.a)({},l,{id:n.id})),e.abrupt("return",{response:200,message:"Successfully Edited!"});case 8:return e.next=10,o.addUserEducation(l);case 10:return u=e.sent,c("UserEducation",Object(y.a)({},l,{id:u})),e.abrupt("return",{response:200,message:"Successfully Added!"});case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.togglePopover=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.state.educationEditPopover;a.setState({editObj:e&&e.id?e:null,educationEditPopover:!t})},a.onDelete=Object(W.a)(L.a.mark(function e(){var t,n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.editObj,n=a.props,r=n.apis,o=n.deleteDatabaseSchema,e.next=4,r.deleteUserEducation({id:t.id});case 4:o("UserEducation",{id:t.id}),a.togglePopover(t);case 6:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.educationEditPopover,n=t.editObj,r=this.props,i=r.database,c=r.account,s=[];return Object.values(i.UserEducation.byId).map(function(e){c.user.id===e.userId&&s.push(e)}),o.a.createElement("div",{className:"education"},o.a.createElement(tt,{del:n,onDelete:this.onDelete,isOpen:a,structure:nn,callback:this.addEducation,onClose:function(){return e.togglePopover()}}),o.a.createElement("p",{className:"p-top"},o.a.createElement("span",null,"Education"),o.a.createElement(X.a,{icon:"plus",onClick:function(){return e.editPopover({startTime:"02/02/2018",endTime:"02/02/2018"})},style:{cursor:"pointer"}})),0!==s.length?o.a.createElement("div",{className:"p-edu-list"},s.map(function(t){return o.a.createElement(sn,{editPopover:e.editPopover,data:t,key:t.id})})):o.a.createElement("div",null,o.a.createElement("span",{style:{color:"#696969"}},"No School Added")))}}]),t}(o.a.Component),un=a(143),dn=function(e){var t=e.data,a=e.editPopover;return o.a.createElement("div",{className:"p-exp-list-i"},o.a.createElement("img",{src:un,alt:"school icon"}),o.a.createElement("p",null,o.a.createElement("span",{className:"p-title-i"},t.title),o.a.createElement("br",null),o.a.createElement("span",{className:"p-company-i"},t.company),o.a.createElement("br",null),o.a.createElement("span",{className:"p-timeline"},"".concat(t.startTime," - ").concat(t.endTime)),o.a.createElement("br",null),o.a.createElement("span",null,t.summary)),o.a.createElement("p",null,o.a.createElement(X.a,{style:{cursor:"pointer"},icon:"edit",onClick:function(){return a(t)}})))},mn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={experienceEditPopover:!1,editObj:null},a.editPopover=function(e){rn.map(function(t){switch(t.id){case"title":return t.val=e.title,t;case"company":return t.val=e.company,t;case"summary":return t.val=e.summary,t;case"startTime":return t.val=new Date(pe()(e.startTime,"DD/MM/YYYY").valueOf()),t;case"endTime":return t.val=new Date(pe()(e.endTime,"DD/MM/YYYY").valueOf()),t;default:return t}}),a.togglePopover(e)},a.addExperience=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.apis,o=n.account,i=n.addDatabaseSchema,c=n.updateDatabaseSchema,s=a.state.editObj,l=Object(y.a)({},t,{startTime:t.startTime.toLocaleString("en-IN").split(",")[0],endTime:t.endTime.toLocaleString("en-IN").split(",")[0],userId:o.user.id}),!s){e.next=8;break}return e.next=6,r.updateUserWorkExperience([Object(y.a)({},l),{id:s.id}]);case 6:return c("UserWorkExperience",Object(y.a)({},l,{id:s.id})),e.abrupt("return",{response:200,message:"Successfully Edited!"});case 8:return e.next=10,r.addUserWorkExperience(l);case 10:return u=e.sent,i("UserWorkExperience",Object(y.a)({},l,{id:u})),e.abrupt("return",{response:200,message:"Successfully Added!"});case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.togglePopover=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=a.state.experienceEditPopover;a.setState({editObj:e&&e.id?e:null,experienceEditPopover:!t})},a.onDelete=Object(W.a)(L.a.mark(function e(){var t,n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.editObj,n=a.props,r=n.apis,o=n.deleteDatabaseSchema,e.next=4,r.deleteUserWorkExperience({id:t.id});case 4:o("UserWorkExperience",{id:t.id}),a.togglePopover(t);case 6:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.experienceEditPopover,n=t.editObj,r=this.props,i=r.database,c=r.account,s=[];return Object.values(i.UserWorkExperience.byId).map(function(e){c.user.id===e.userId&&s.push(e)}),o.a.createElement("div",{className:"experience"},o.a.createElement(tt,{del:n,onDelete:this.onDelete,isOpen:a,structure:rn,callback:this.addExperience,onClose:function(){return e.togglePopover()}}),o.a.createElement("p",{className:"p-top"},o.a.createElement("span",null,"Experience"),o.a.createElement(X.a,{icon:"plus",onClick:function(){return e.editPopover({startTime:"02/02/2018",endTime:"02/02/2018"})},style:{cursor:"pointer"}})),o.a.createElement("div",{className:"p-exp-list"},0!==s.length?o.a.createElement("div",{className:"p-edu-list"},s.map(function(t){return o.a.createElement(dn,{data:t,editPopover:e.editPopover,key:t.id})})):o.a.createElement("div",null,o.a.createElement("span",{style:{color:"#696969"}},"No Experience Added"))))}}]),t}(o.a.Component),pn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={portal:!1},a.addPortal=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d,m,p;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.apis,o=n.account,i=n.database,c=n.addDatabaseSchema,s=n.updateDatabaseSchema,l=a.state.portal,u=i.UserPortal.byId[l],e.prev=3,!t.attachment.size){e.next=11;break}return(m=new FormData).append("data",JSON.stringify({token:o.sessionId,fileType:"image",content:"profile"})),m.append("file",t.attachment),e.next=10,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:m});case 10:d=e.sent;case 11:if(d&&200!==d.status){e.next=23;break}if("number"!==typeof l){e.next=17;break}return e.next=15,r.updateUserPortal([Object(y.a)({},t,{attachment:d?d.data:u.attachment,userId:o.user.id}),{id:l}]);case 15:return s("UserPortal",Object(y.a)({},t,{attachment:d?d.data:u.attachment,userId:o.user.id,id:l})),e.abrupt("return",{response:200,message:"Successfully updated"});case 17:return e.next=19,r.addUserPortal(Object(y.a)({},t,{attachment:d?d.data:"",userId:o.user.id}));case 19:return p=e.sent,c("UserPortal",Object(y.a)({},t,{attachment:d?d.data:"",userId:o.user.id,id:p})),a.setState({portal:p}),e.abrupt("return",{response:200,message:"Successfully added"});case 23:return e.abrupt("return",{response:400,error:d.data});case 26:return e.prev=26,e.t0=e.catch(3),e.abrupt("return",{response:400,error:"Something went wrong"});case 29:case"end":return e.stop()}},e,null,[[3,26]])}));return function(t){return e.apply(this,arguments)}}(),a.togglePortal=function(){var e=a.state.portal;on[0].val="",on[1].val=null,on[2].val="",on[3].val="",a.setState({portal:!e})},a.deletePortal=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.portal,n=a.props,r=n.apis,o=n.deleteDatabaseSchema,i=n.onClose,e.prev=2,e.next=5,r.deleteUserPortal({id:t});case 5:o("UserPortal",{id:t}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Some Error",e.t0);case 11:i();case 12:case"end":return e.stop()}},e,null,[[2,8]])})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.database,a=e.account;Object.values(t.UserDetail.byId).map(function(e){a.user.id===e.userId&&(an[0].val=e.bio)})}},{key:"componentWillReceiveProps",value:function(e){var t=this.state.portal,a=e.database,n=e.portalOpen;if(e.portalOpen!==t){if(e.portalOpen){var r=a.UserPortal.byId[n];on[0].val=r.title,on[1].val={name:r.attachment},on[2].val=r.description,on[3].val=r.link}this.setState({portal:n})}}},{key:"render",value:function(){var e=this.props,t=e.isOpen,a=e.onClose,n=e.callback,r=this.state.portal;return o.a.createElement(fe.a,{isOpen:t,onClose:a},o.a.createElement("div",{className:"popover-form bio"},o.a.createElement("div",{className:"top"},r?"Fill Portal Details":"Fill Bio Details"),r?o.a.createElement("div",null,o.a.createElement(Le,{data:on,callback:this.addPortal})):o.a.createElement(Le,{data:an,callback:n})),o.a.createElement("div",{style:{width:"100%",padding:"0px 5px"}},r?o.a.createElement(ve.b,{large:!0,text:"Cancle",fill:!0,onClick:this.togglePortal}):o.a.createElement(ve.b,{large:!0,text:"Add your portals",fill:!0,onClick:this.togglePortal})),o.a.createElement("div",{style:{width:"100%",padding:"2px 5px"}},"number"===typeof r&&o.a.createElement(ve.b,{onClick:this.deletePortal,minimal:!0,large:!0,text:"Delete",fill:!0,intent:"danger"})))}}]),t}(o.a.Component);pn.defaultProps={portalOpen:null};var fn=pn,vn=function(e){var t=e.data,a=e.account,n=e.onClick;return o.a.createElement(Bt.a,{elevation:2,interactive:!0,onClick:function(){return n(t.id)},style:{marginRight:10,marginBottom:10,display:"flex",flexDirection:"row",padding:"2px",position:"relative"}},t.attachment&&o.a.createElement("div",{style:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"}},o.a.createElement("img",{height:50,alt:"portal identity",src:"".concat(oe,"/user/").concat(1e7+parseInt(a.user.id,10),"/profile/").concat(t.attachment)})),o.a.createElement("div",{style:{padding:"3px"}},o.a.createElement("span",null,o.a.createElement("strong",null,t.title)),o.a.createElement("br",null),o.a.createElement("span",null,t.description),o.a.createElement("br",null)))},bn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={bioEditPopover:!1,portalOpen:null},a.editBio=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.account,i=n.updateDatabaseSchema,c=n.addDatabaseSchema,s=n.database,e.next=3,r.updateUserDetails(Object(y.a)({userId:o.user.id},t));case 3:return l=e.sent,(u=Object.values(s.UserDetail.byId).find(function(e){return e.userId===o.user.id}))?i("UserDetail",Object(y.a)({id:u.id},t)):c("UserDetail",Object(y.a)({id:l},t)),e.abrupt("return",{response:200,message:l});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.togglePopover=function(){var e=a.state.bioEditPopover;a.setState({bioEditPopover:!e,portalOpen:null})},a.togglePortal=function(e){a.setState({portalOpen:e,bioEditPopover:!0})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.bioEditPopover,n=t.portalOpen,r=this.props,i=r.database,c=r.account,s=r.apis,l=r.deleteDatabaseSchema,u=r.updateDatabaseSchema,d=r.addDatabaseSchema,m=Object.values(i.UserDetail.byId).find(function(e){return c.user.id===e.userId}),p=Object.values(i.UserPortal.byId).filter(function(e){return e.userId===c.user.id});return o.a.createElement("div",{className:"bio"},o.a.createElement("p",{className:"bio-content"},"About"),o.a.createElement("div",{className:"bio-info"},m?o.a.createElement("p",null,m.bio):o.a.createElement("p",{style:{color:"#696969"}},"No bio added"),o.a.createElement("p",{className:"edit",style:{cursor:"pointer"}},o.a.createElement(X.a,{icon:"edit",onClick:this.togglePopover}))),o.a.createElement("div",{style:{display:"flex",flexWrap:"wrap",padding:"5px"}},p.map(function(t){return o.a.createElement(vn,{onClick:e.togglePortal,account:c,key:t.id,data:t})})),o.a.createElement(fn,{deleteDatabaseSchema:l,updateDatabaseSchema:u,addDatabaseSchema:d,portalOpen:n,database:i,account:c,apis:s,isOpen:a,structure:an,callback:this.editBio,onClose:function(){return e.togglePopover()}}))}}]),t}(o.a.Component),gn=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onChange=function(e){(0,a.props.onChange)(e.target.files[0])},a.onClick=function(){a.fileInputRef.current.click()},a.changeStyle=function(e){e.target.style.cursor="pointer"},a.state={},a.fileInputRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{onClick:this.onClick,onKeyDown:this.onClick,role:"button",onMouseOver:this.changeStyle,onFocus:this.changeStyle,className:"image-upload-icon"},o.a.createElement(X.a,{icon:Xa.a.PLUS,intent:Z.a.PRIMARY,iconSize:20,color:"white"}),o.a.createElement("input",{ref:this.fileInputRef,type:"file",style:{display:"none"},onChange:this.onChange}))}}]),t}(o.a.Component),hn=a(341),yn=a(149),Cn=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).centerBackgroundImage=function(e,t){var n=t.width,r=t.height;if(e.left>e.getScaledWidth()/2||e.top>(e.getScaledHeight()/2||e.left<e.getScaledWidth()/2+n-e.getScaledWidth())||e.top<e.getScaledHeight()/2+r-e.getScaledHeight())return e.scaleX+=.01,e.scaleY+=.01,a.centerBackgroundImage(e,t);e.scaleX+=.2,e.scaleY+=.2,t.renderAll(),a.setState({minScale:e.scaleX-.2,zoomValue:e.scaleX})},a.onZoom=function(e){var t=a.state.canvas;t._objects[0].scaleX=e,t._objects[0].scaleY=e,t.renderAll(),a.setState({canvas:t,zoomValue:e})},a.saveImage=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l,u,d,m,p,f,v,b,g;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=a.state.canvas,n=a.props,r=n.clickEditCover,o=n.account,i=n.userDetail,c=n.apis,s=n.updateDatabaseSchema,l=t.toDataURL({format:"jpeg",quality:1}),u=l.split(","),d=u[0].match(/:(.*?);/)[1],m=window.atob(u[1]),p=m.length,f=new Uint8Array(p);p;)f[p-=1]=m.charCodeAt(p);return v=new File([f],"cover-edit.jpeg",{type:d}),e.prev=10,(b=new FormData).append("data",JSON.stringify({token:o.sessionId,fileType:"image",content:"profile"})),b.append("file",v),e.next=16,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:b});case 16:if(200!==(g=e.sent).status){e.next=21;break}return e.next=20,c.updateUserDetails({userId:o.user.id,coverEdit:g.data});case 20:s("UserDetail",{id:i.id,coverEdit:g.data});case 21:r("reposition"),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(10),alert("Sorry your task could not be performed.");case 27:case"end":return e.stop()}},e,null,[[10,24]])}));var n=a.props,r=n.userDetail,o=n.account;return a.state={minScale:1,canvas:{},zoomValue:0,imageUrl:"".concat(oe,"/user/").concat(1e7+parseInt(o.user.id,10),"/profile/").concat(r.coverImage)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.state.imageUrl,a=new yn.fabric.Canvas("mainCanvas",{selection:!1,backgroundColor:"white"});yn.fabric.Image.fromURL(t,function(t){t.set("originX","center").set("originY","center").set("cacheKey","Background"),a.add(t),a.renderAll(),e.centerBackgroundImage(t,a)},{hasBorders:!1,crossOrigin:"Anonymous",top:a.height/2,left:a.width/2,hasControls:!1}),this.setState({canvas:a})}},{key:"render",value:function(){var e=this.state,t=e.minScale,a=e.zoomValue;return o.a.createElement("div",{className:"cover-pic-edit-mode"},o.a.createElement("canvas",{id:"mainCanvas",height:400,width:1200}),o.a.createElement("div",{className:"edit-cover"},o.a.createElement("div",{role:"menu",tabIndex:"0",onKeyDown:function(){return!1},onClick:this.saveImage},o.a.createElement("span",{style:{padding:"3px",border:"1px solid #137cbd"}},"Save "))),o.a.createElement("div",{className:"pc-zoom-slider"},o.a.createElement(hn.a,{id:"pcZoom",labelRenderer:!1,onChange:this.onZoom,max:t+3,min:t,stepSize:.1,value:a})))}}]),t}(o.a.Component),wn=(a(277),a(144)),En=function(e,t){return o.a.createElement(Q.a,null,o.a.createElement(_.a,{text:"Upload New",onClick:function(){return e("upload")}}),o.a.createElement(Q.a.Divider,null),o.a.createElement(_.a,{disabled:!t.coverImage,text:"Reposition",onClick:function(){return e("reposition")}}))},Sn=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).clickEditCover=function(){var e=Object(W.a)(L.a.mark(function e(t){var n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state.drag,"reposition"!==t){e.next=4;break}return a.setState({drag:!n}),e.abrupt("return");case 4:a.fileInputRef.current.click();case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.coverChange=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.account,o=n.apis,i=n.userDetail,c=n.updateDatabaseSchema,s=n.addDatabaseSchema,(l=new FormData).append("data",JSON.stringify({token:r.sessionId,fileType:"image",content:"profile"})),l.append("file",t.target.files[0]),e.prev=4,e.next=7,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:l});case 7:if(200!==(u=e.sent).status){e.next=13;break}return e.next=11,o.updateUserDetails({userId:r.user.id,coverImage:u.data,coverEdit:null});case 11:d=e.sent,i.id?c("UserDetail",{id:i.id,coverImage:u.data,coverEdit:null}):s("UserDetail",{id:d,type:"mentee",coverImage:u.data,coverEdit:null});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),console.log(e.t0);case 18:case"end":return e.stop()}},e,null,[[4,15]])}));return function(t){return e.apply(this,arguments)}}(),a.state={drag:!1},a.fileInputRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.userDetail,a=e.account,n=e.updateDatabaseSchema,r=e.apis,i=this.state.drag,c=t.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(a.user.id,10),"/profile/").concat(t.coverImage):wn,s=t.coverEdit&&"".concat(oe,"/user/").concat(1e7+parseInt(a.user.id,10),"/profile/").concat(t.coverEdit);return i?o.a.createElement(Cn,{clickEditCover:this.clickEditCover,apis:r,updateDatabaseSchema:n,userDetail:t,account:a}):o.a.createElement("div",{className:"cover-pic"},s?o.a.createElement("img",{alt:"cover profile of the user",src:s}):o.a.createElement("img",{alt:"cover profile of the user",src:c}),o.a.createElement("div",{className:"edit-cover"},o.a.createElement(at.a,{content:En(this.clickEditCover,t)},o.a.createElement("div",null,o.a.createElement("span",null,"Edit "),o.a.createElement(X.a,{icon:"edit",color:"white",className:"edit-icon"}),o.a.createElement("input",{ref:this.fileInputRef,type:"file",style:{display:"none"},onChange:this.coverChange})))))}}]),t}(o.a.Component),On=a(77),kn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.uploadImage=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.account,o=n.apis,i=n.userDetail,c=n.updateDatabaseSchema,s=n.addDatabaseSchema,(l=new FormData).append("data",JSON.stringify({token:r.sessionId,fileType:"image",content:"profile",type:"profilePic"})),l.append("file",t),e.prev=4,e.next=7,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:l});case 7:if(200!==(u=e.sent).status){e.next=13;break}return e.next=11,o.updateUserDetails({userId:r.user.id});case 11:d=e.sent,i.id?c("UserDetail",{id:i.id,image:u.data}):s("UserDetail",{id:d,type:"mentee",image:u.data});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),console.log(e.t0);case 18:case"end":return e.stop()}},e,null,[[4,15]])}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.userDetail,a=e.account,n=t.image?"".concat(oe,"/user/").concat(1e7+parseInt(a.user.id,10),"/profile/").concat(t.image):On;return o.a.createElement("div",{className:"profilePic"},o.a.createElement(it,{imgUrl:n}),o.a.createElement(gn,{onChange:this.uploadImage}))}}]),t}(o.a.Component),In=function(e){var t=e.data,a=e.value,n=e.onChange,r=e.callback;return o.a.createElement("div",{style:{padding:"10px 10px 0 10px"}},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",fontSize:18,fontWeight:600,paddingBottom:10}},o.a.createElement("span",null,"Add Skills")),o.a.createElement(ke,{data:t,onChange:n,value:a}),o.a.createElement(ve.b,{onClick:r,fill:!0,intent:"primary",large:!0,text:"Add Skills"}))},jn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={openPopover:!1,value:[]},a.setSkills=function(){var e=a.props,t=e.skills,n=e.account,r=[];Object.values(t.byId).map(function(e){e.userId===n.user.id&&(r=JSON.parse(e.skill))}),a.setState({value:r})},a.togglePopover=function(){var e=a.state.openPopover;a.setState({openPopover:!e})},a.onChageSkill=function(e,t){a.setState({value:t})},a.submitSkills=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props,n=t.apis,r=t.account,o=t.skills,i=t.updateDatabaseSchema,c=t.addDatabaseSchema,s=a.state.value,Object.values(o.byId).map(function(e){e.userId===r.user.id&&(l=e)}),e.prev=3,l){e.next=10;break}return e.next=7,n.addUserSkill({userId:r.user.id,skill:JSON.stringify(s)});case 7:c("UserSkill",{id:Date.now(),userId:r.user.id,skill:JSON.stringify(s)}),e.next=13;break;case 10:return e.next=12,n.updateUserSkill([{userId:r.user.id,skill:JSON.stringify(s)},{id:l.id}]);case 12:i("UserSkill",{id:l.id,skill:JSON.stringify(s)});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),console.log("Error- ",e.t0);case 18:a.togglePopover();case 19:case"end":return e.stop()}},e,null,[[3,15]])})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.setSkills()}},{key:"componentDidUpdate",value:function(e){this.props.skills.allIds!==e.skills.allIds&&this.setSkills()}},{key:"render",value:function(){var e,t=this.state,a=t.openPopover,n=t.value,r=this.props,i=r.skills,c=r.account;Object.values(i.byId).map(function(t){t.userId===c.user.id&&(e=JSON.parse(t.skill))});return o.a.createElement("div",{className:"skills"},o.a.createElement(fe.a,{onClose:this.togglePopover,isOpen:a},o.a.createElement(In,{onChange:this.onChageSkill,value:n,data:{id:"skills",name:"Skills",placeholder:"Type and press enter"},callback:this.submitSkills})),o.a.createElement("p",{className:"p-top"},o.a.createElement("span",null,"Skills"),o.a.createElement(X.a,{icon:"plus",style:{cursor:"pointer"},onClick:this.togglePopover})),e?o.a.createElement("div",{className:"skills-container"},e.map(function(e,t){return o.a.createElement("span",{key:t},e)})):o.a.createElement("div",{style:{color:"#696969"}},"No skills added"))}}]),t}(o.a.Component),xn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={apis:{}},a.togglePopovers=function(e){var t=a.state.skillsEditPopover;"skills"===e&&a.setState({skillsEditPopover:!t})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.updateNav,e.next=3,ue.scope("Mentee");case 3:a=e.sent,this.setState({apis:a}),t({schema:"sideNav",data:{name:"Profile"}});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.account,a=e.database,n=e.deleteDatabaseSchema,r=e.updateDatabaseSchema,i=e.addDatabaseSchema,c=this.state.apis;if(!t.user)return o.a.createElement("div",null);var s=a.User.byId[t.user.id],l={};return Object.values(a.UserDetail.byId).map(function(e){s&&s.id===e.userId&&(l=e)}),o.a.createElement("div",{className:"profile bro-right"},o.a.createElement(Sn,{account:t,userDetail:l,apis:c,updateDatabaseSchema:r,addDatabaseSchema:i}),o.a.createElement(kn,{account:t,apis:c,userDetail:l,updateDatabaseSchema:r,addDatabaseSchema:i}),o.a.createElement("div",{className:"top-details"},o.a.createElement("span",{className:"name"},ct(s)),o.a.createElement("br",null),o.a.createElement(X.a,{icon:"locate"}),o.a.createElement("span",{className:"country"}," ",l.address?l.address:"---")),o.a.createElement(bn,{account:t,apis:c,database:a,updateDatabaseSchema:r,addDatabaseSchema:i,deleteDatabaseSchema:n}),o.a.createElement(ln,{apis:c,database:a,account:t,updateDatabaseSchema:r,addDatabaseSchema:i,deleteDatabaseSchema:n}),o.a.createElement(mn,{apis:c,database:a,account:t,updateDatabaseSchema:r,addDatabaseSchema:i,deleteDatabaseSchema:n}),o.a.createElement(jn,{account:t,apis:c,skills:a.UserSkill,updateDatabaseSchema:r,addDatabaseSchema:i}))}}]),t}(r.Component),Nn=Object(p.b)(function(e){return e},Object(y.a)({},n))(xn),Dn=[{id:"firstName",fieldtype:"input",name:"First Name",placeholder:"",required:!0},{id:"middleName",fieldtype:"input",name:"Middle Name",placeholder:""},{id:"lastName",fieldtype:"input",name:"Last Name",placeholder:"",required:!0},{id:"submit",fieldtype:"button",text:"Submit",type:"submit",fill:"fill",intent:"primary",large:"large"}],An=[{id:"address",fieldtype:"input",name:"Address",placeholder:"",required:!0},{id:"submit",fieldtype:"button",text:"Submit",type:"submit",fill:"fill",intent:"primary",large:"large"}],Tn=[{id:"country",fieldtype:"select",options:[{label:"---",value:""}],name:"Country",placeholder:"",required:!0},{id:"submit",fieldtype:"button",text:"Submit",type:"submit",fill:"fill",intent:"primary",large:"large"}],Rn=[{id:"gender",fieldtype:"select",name:"Gender",required:!0,options:[{label:"---",value:""},{label:"Male",value:"male"},{label:"Female",value:"female"},{label:"Others",value:"others"}]},{id:"submit",fieldtype:"button",type:"submit",text:"Submit",fill:"fill",intent:"primary",large:"large"}],Pn=function(e){var t=e.data,a=e.value,n=e.onChange,r=e.callback;return o.a.createElement("div",{style:{padding:"10px 10px 0 10px"}},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",fontSize:18,fontWeight:600,paddingBottom:10}},o.a.createElement("span",null,"Add Skills")),o.a.createElement(ke,{data:t,onChange:n,value:a}),o.a.createElement(ve.b,{onClick:r,fill:!0,intent:"primary",large:!0,text:"Add Skills"}))},Mn=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).togglePopover=function(){var e=a.state.open;a.setState({open:!e})},a.onChangeInterest=function(e,t){a.setState({value:t})},a.editInterest=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state.value,n=a.props,r=n.apis,o=n.userDetail,i=n.updateDatabaseSchema,e.next=4,r.updateUserDetails({field:JSON.stringify(t),userId:o.userId});case 4:return i("UserDetail",{id:o.id,field:JSON.stringify(t)}),e.abrupt("return",{response:200,message:"Changed successfully"});case 6:case"end":return e.stop()}},e)}));var n=a.props.userDetail;return a.state={open:!1,value:n.field?JSON.parse(n.field):[]},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=t.open,n=t.value,r=this.props.userDetail;return o.a.createElement("div",{className:"basic"},o.a.createElement("div",{className:"label"},"Carrier Interests"),o.a.createElement(fe.a,{onClose:this.togglePopover,isOpen:a},o.a.createElement(Pn,{onChange:this.onChangeInterest,value:n,data:{id:"interest",name:"Carrier Interests",placeholder:"Type and press enter"},callback:this.editInterest})),o.a.createElement("div",{className:"value"},r.field&&0!==JSON.parse(r.field).length?o.a.createElement("ul",null,JSON.parse(r.field).map(function(e,t){return o.a.createElement("li",{key:t},e)})):o.a.createElement("ul",null,"---"),o.a.createElement(X.a,{icon:"edit",color:"rgba(167, 182, 194, 1)",className:"edit-icon",onClick:function(){return e.togglePopover("career")}})))}}]),t}(o.a.Component),Hn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={namePopover:!1,genderPopover:!1,addressPopover:!1,countryPopover:!1},a.editCountry=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.account,e.prev=1,e.next=4,r.updateUserDetails(Object(y.a)({},t,{userId:o.user.id}));case 4:return e.abrupt("return",{response:200,message:"Changed successfully"});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{response:400,error:"Internal server error"});case 10:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),a.editName=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.account,e.next=3,r.updateUser([Object(y.a)({},t),{id:o.user.id}]);case 3:return e.abrupt("return",{response:200,message:"Changed successfully"});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.editAddress=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.account,e.prev=1,e.next=4,r.updateUserDetails(Object(y.a)({},t,{userId:o.user.id}));case 4:return e.abrupt("return",{response:200,message:"Changed successfully"});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{response:400,error:"Internal server error"});case 10:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),a.editGender=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.account,e.prev=1,e.next=4,r.updateUserDetails(Object(y.a)({},t,{userId:o.user.id}));case 4:return e.abrupt("return",{response:200,message:"Changed successfully"});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{response:400,error:"Internal server error"});case 10:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),a.togglePopover=function(e){var t=a.state,n=t.namePopover,r=t.genderPopover,o=t.addressPopover,i=t.countryPopover,c=a.props,s=c.account,l=c.database,u=Object.values(l.User.byId).find(function(e){return e.id===s.user.id});switch(e){case"name":Dn.map(function(e){"firstName"===e.id&&(e.val=u.firstName),"lastName"===e.id&&(e.val=u.lastName),"middleName"===e.id&&(e.val=u.middleName)}),a.setState({namePopover:!n});break;case"gender":Rn.map(function(e){if("gender"===e.id){var t="";Object.values(l.UserDetail.byId).map(function(e){e.userId===s.user.id&&(t=e.gender)}),e.val=t}}),a.setState({genderPopover:!r});break;case"country":Tn.map(function(e){if("country"===e.id){var t=_t()().getData().map(function(e){return{label:e.label,value:e.label}}),a=Object.values(l.UserDetail.byId).find(function(e){return e.userId===s.user.id});return a&&(e.val=a.country),e.options=[].concat(Object(g.a)(e.options),Object(g.a)(t)),e}}),a.setState({countryPopover:!i});break;case"address":An.map(function(e){if("address"===e.id){var t="";Object.values(l.UserDetail.byId).map(function(e){e.userId===s.user.id&&(t=e.address)}),e.val=t}}),a.setState({addressPopover:!o})}},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.account,n=t.database,r=t.updateDatabaseSchema,i=t.apis,c=this.state,s=c.namePopover,l=c.addressPopover,u=c.genderPopover,d=c.countryPopover,m="---",p="---",f="---",v={};Object.values(n.UserDetail.byId).map(function(e){e.userId===a.user.id&&(m=e.gender?e.gender:"---",p=e.address?e.address:"---",v=e,f=e.country?e.country:"---")});var b=Object.values(n.User.byId).find(function(e){return e.id===a.user.id});return o.a.createElement("div",{className:"container-settings"},o.a.createElement(tt,{isOpen:s,structure:Dn,callback:this.editName,onClose:function(){return e.togglePopover("name")}}),o.a.createElement(tt,{isOpen:l,structure:An,callback:this.editAddress,onClose:function(){return e.togglePopover("address")}}),o.a.createElement(tt,{isOpen:u,structure:Rn,callback:this.editGender,onClose:function(){return e.togglePopover("gender")}}),o.a.createElement(tt,{isOpen:d,structure:Tn,callback:this.editCountry,onClose:function(){return e.togglePopover("country")}}),o.a.createElement("div",{className:"basic"},o.a.createElement("div",{className:"label"},"Full Name"),o.a.createElement("div",{className:"value"},a.user&&o.a.createElement("span",null,b.middleName?"".concat(b.firstName," ").concat(b.middleName," ").concat(b.lastName):"".concat(b.firstName," ").concat(b.lastName)),o.a.createElement(X.a,{icon:"edit",color:"rgba(167, 182, 194, 1)",className:"edit-icon",onClick:function(){return e.togglePopover("name")}}))),o.a.createElement("div",{className:"basic"},o.a.createElement("div",{className:"label"},"Gender"),o.a.createElement("div",{className:"value"},o.a.createElement("span",{style:{textTransform:"capitalize"}},m),o.a.createElement(X.a,{icon:"edit",color:"rgba(167, 182, 194, 1)",className:"edit-icon",onClick:function(){return e.togglePopover("gender")}}))),o.a.createElement("div",{className:"basic"},o.a.createElement("div",{className:"label"},"Country"),o.a.createElement("div",{className:"value"},o.a.createElement("span",{style:{textTransform:"capitalize"}},f),o.a.createElement(X.a,{icon:"edit",color:"rgba(167, 182, 194, 1)",className:"edit-icon",onClick:function(){return e.togglePopover("country")}}))),o.a.createElement("div",{className:"basic"},o.a.createElement("div",{className:"label"},"Address"),o.a.createElement("div",{className:"value"},o.a.createElement("span",null,p),o.a.createElement(X.a,{icon:"edit",color:"rgba(167, 182, 194, 1)",className:"edit-icon",onClick:function(){return e.togglePopover("address")}}))),o.a.createElement(Mn,{updateDatabaseSchema:r,userDetail:v,apis:i}))}}]),t}(o.a.Component),Un=Object(p.b)(function(e){return e},Object(y.a)({},n))(Hn),Bn=a(279),Ln=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={mentor:!1},a.switchUser=Object(W.a)(L.a.mark(function e(){var t,n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.apis,r=t.account,o=a.state.mentor,e.prev=2,e.next=5,n.updateUserDetails({userId:r.user.id,type:o?"mentee":"mentor"});case 5:a.setState({mentor:!o}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log(e.t0);case 11:case"end":return e.stop()}},e,null,[[2,8]])})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.account,n=t.database;Object.values(n.UserDetail.byId).map(function(t){a.user.id===t.userId&&"mentor"===t.type&&e.setState({mentor:!0})})}},{key:"render",value:function(){var e=this.state.mentor;return o.a.createElement("div",{className:"container-settings"},o.a.createElement("div",{className:"switch-adv-con"},e?o.a.createElement("p",null,"You are a Mentor",o.a.createElement("br",null),"Help people learn with your knowledge base.",o.a.createElement("br",null),"Be a part to educate the world."):o.a.createElement("p",null,"Change your profile to Mentor",o.a.createElement("br",null),"and help people learn with your knowledge base.",o.a.createElement("br",null),"Be a part to educate the world."),o.a.createElement(Bn.b,{onChange:this.switchUser,className:"switch-button",checked:e,large:!0,innerLabel:"Mentor"})))}}]),t}(o.a.Component),Wn=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={activeTab:"basic",apis:{}},a.handleClick=function(e){a.setState({activeTab:e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.updateNav,e.next=3,ue.scope("Mentee");case 3:a=e.sent,this.setState({apis:a}),t({schema:"sideNav",data:{name:"Settings"}});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.activeTab,n=t.apis,r=this.props,i=r.database,c=r.account;return o.a.createElement("div",{className:"settings bro-right"},o.a.createElement("div",{className:"setting-types"},o.a.createElement("div",{onClick:function(){return e.handleClick("basic")},tabIndex:0,onKeyDown:function(){return e.handleClick("basic")},role:"menuitem",className:"basic"===a?"active i-setting":"i-setting"},"General"),o.a.createElement("div",{onClick:function(){return e.handleClick("advanced")},tabIndex:0,onKeyDown:function(){return e.handleClick("advanced")},role:"menuitem",className:"advanced"===a?"active i-setting":"i-setting"},"Advanced")),"basic"===a&&o.a.createElement(Un,{apis:n,account:c,database:i}),"advanced"===a&&o.a.createElement(Ln,{apis:n,database:i,account:c}))}}]),t}(r.Component),Vn=Object(p.b)(function(e){return e},Object(y.a)({},n))(Wn),zn=a(201),Fn=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onClassChange=function(e){var t=a.props.database,n=[];Object.values(t.BoardColumnCard.byId).map(function(a){Object.values(t.BoardColumn.byId).map(function(t){t.boardId===parseInt(e.target.value,10)&&t.id===a.boardColumnId&&n.push(a)})}),a.setState({classVal:e.target.value,taskOptions:n.map(function(e){return{label:e.name.substring(0,50),value:e.id}}),taskVal:n[0]&&n[0].id})},a.onTaskChange=function(e){a.setState({taskVal:e.target.value})},a.submitForm=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.callback,n=a.state,r=n.taskVal,o=n.classVal,a.setState({loading:!0}),e.next=5,t({task:r,class:o});case 5:200===(i=e.sent).response?a.setState({loading:!1,message:i.message}):a.setState({loading:!1,error:i.error});case 7:case"end":return e.stop()}},e)}));var n=a.props.database,r=Object.values(n.Board.byId).filter(function(e){return"private"===e.type}),o=Object.values(n.BoardColumnCard.byId).filter(function(e){return!e.deleteStatus&&Object.values(n.BoardColumn.byId).find(function(t){return t.boardId===r[0].id&&t.id===e.boardColumnId})});return a.state={error:null,message:null,loading:!1,classVal:r[0].id,classeOptions:r.map(function(e){return{label:e.name.substring(0,50),value:e.id}}),taskOptions:o.map(function(e){return{label:e.name.substring(0,50),value:e.id}}),taskVal:o[0]&&o[0].id},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.classeOptions,a=e.taskOptions,n=e.taskVal,r=e.classVal,i=e.error,c=e.loading,s=e.message;return o.a.createElement("div",{style:{padding:"10px"}},o.a.createElement("div",{style:{padding:"5px"}},o.a.createElement("span",{style:{fontSize:"18px",fontWeight:"bold"}},"Choose a Target Card")),o.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},o.a.createElement("div",{style:{padding:"10px"}},o.a.createElement("p",{style:{fontSize:"16px"}},"Class"),o.a.createElement(Ie.a,{options:t,onChange:this.onClassChange,value:r})),o.a.createElement("div",{style:{padding:"10px",marginBottom:"10px"}},o.a.createElement("p",{style:{fontSize:"16px"}},"Task"),o.a.createElement(Ie.a,{options:a,onChange:this.onTaskChange,value:n})),o.a.createElement("div",{className:"btn-group"},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",alignItems:"center"}},c&&o.a.createElement(zn.a,{intent:"primary",size:40}),i&&o.a.createElement(he.c,{style:{fontSize:16,color:"red"}},i),s&&o.a.createElement(he.c,{style:{fontSize:16,color:"green"}},s)),o.a.createElement(ve.b,{text:"Submit",onClick:this.submitForm,intent:"primary",large:!0,fill:!0}))))}}]),t}(o.a.Component),qn=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).uploadImage=function(){a.fileInputRef.current.click()},a.saveImage=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d,m,p,f,v,b,g,h;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a.props,r=n.canvas,o=n.account,i=n.addDatabaseSchema,c=n.apis,s=r.toDataURL({format:"jpeg",quality:1}),l=s.split(","),u=l[0].match(/:(.*?);/)[1],d=window.atob(l[1]),m=d.length,p=new Uint8Array(m);m;)p[m-=1]=d.charCodeAt(m);return f=new File([p],"canvas-shot.jpeg",{type:u}),e.prev=9,(v=new FormData).append("data",JSON.stringify({token:o.sessionId,fileType:"image",content:"board"})),v.append("file",f),e.next=15,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:v});case 15:if(200!==(b=e.sent).status){e.next=22;break}return g={userId:o.user.id,timeStamp:Date.now(),name:"Canvas Print",boardColumnCardId:parseInt(t.task,10),url:b.data},e.next=20,c.addBoardColumnCardAttachment(Object(y.a)({},g,{broadCastId:"Board-".concat(t.class)}));case 20:h=e.sent,i("BoardColumnCardAttachment",Object(y.a)({},g,{id:h}));case 22:return e.abrupt("return",{response:200,message:"Uploaded"});case 25:return e.prev=25,e.t0=e.catch(9),e.abrupt("return",{response:400,error:"Network issues"});case 28:case"end":return e.stop()}},e,null,[[9,25]])}));return function(t){return e.apply(this,arguments)}}(),a.state={},a.fileInputRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.draw,a=e.drawActive,n=e.clear,r=e.addText,i=e.anyObjectActive,c=e.onDelete,s=e.color,l=e.colorChange,u=e.fileUpload,d=e.database;return o.a.createElement("div",{className:"draw-tools"},o.a.createElement("div",{className:"tool-label"},o.a.createElement("span",null,"Tools")),o.a.createElement("div",{className:"tool-container"},o.a.createElement(ve.b,{intent:"default",onClick:this.uploadImage,icon:"media",className:"i-tool"}),o.a.createElement("input",{ref:this.fileInputRef,type:"file",style:{display:"none"},onChange:u}),o.a.createElement(ve.b,{intent:"default",onClick:r,icon:"new-text-box",className:"i-tool"}),o.a.createElement(ve.b,{icon:"draw",onClick:t,className:"i-tool",intent:!0===a?"primary":"default"}),o.a.createElement(Ie.a,{className:"i-tool",value:s,options:[{label:"Black",value:"black"},{label:"Red",value:"red"},{label:"Blue",value:"blue"}],onChange:l}),o.a.createElement(ve.b,{className:"i-tool",text:"clear",onClick:n}),o.a.createElement(ve.b,{disabled:!i,onClick:c,intent:"danger",icon:"trash",className:"i-tool"})),o.a.createElement("div",{className:"save-wrapper"},o.a.createElement(at.a,{content:o.a.createElement(Fn,{callback:this.saveImage,database:d})},o.a.createElement(ve.b,{text:"save",large:!0,intent:"success"}))))}}]),t}(o.a.Component),Gn=a(149),Jn=a(140),Yn=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).drawPath=function(e,t){var n=a.state.color;e.beginPath(),e.moveTo(a.previousPoint.x,a.previousPoint.y),e.lineTo(t.pointer.x,t.pointer.y),e.strokeStyle=n,e.lineWidth=1,e.stroke(),e.closePath(),a.previousPoint=t.pointer},a.onMouseMove=function(e){var t=a.state,n=t.canvas,r=t.draw,o=t.mouseDown;r&&o&&a.drawPath(n.lowerCanvasEl.getContext("2d"),e)},a.addInitialAnimation=function(){var e=a.state.canvas;Gn.fabric.Image.fromURL(Jn,function(t){var a=t.set({cacheKey:"logo",left:875,top:0,scaleX:.2,scaleY:.2,selectable:!1,opacity:.6});e.add(a)})},a.draw=function(){var e=a.state,t=e.canvas,n=e.draw;t.isDrawingMode=!n,a.setState({canvas:t,draw:!n})},a.colorChange=function(e){var t=a.state.canvas;t.freeDrawingBrush.color=e.target.value,a.setState({canvas:t,color:e.target.value})},a.clearCanvas=function(){var e=a.state.canvas;e.clear(),e.backgroundColor="white",a.addInitialAnimation(),a.setState({canvas:e})},a.onMouseUp=function(){a.setState({mouseDown:!1})},a.onMouseDown=function(e){var t=a.state,n=t.canvas,r=t.anyObjectActive;t.draw?(a.setState({mouseDown:!0}),a.previousPoint=e.pointer):!r&&n.getActiveObject()?a.setState({anyObjectActive:!0}):n.getActiveObject()||a.setState({anyObjectActive:!1})},a.deleteObject=function(){var e=a.state.canvas;e.remove(e.getActiveObject()),e.requestRenderAll(),a.setState({canvas:e,anyObjectActive:!1})},a.addText=function(){var e=a.state,t=e.canvas,n=e.color,r=new Gn.fabric.IText("Enter Text",{left:50,top:50,fontSize:18,cacheKey:"text",fill:n});t.add(r).setActiveObject(r),t.isDrawingMode=!1,a.setState({draw:!1,canvas:t,anyObjectActive:!0})},a.fileUpload=function(e){var t=a.state.canvas,n=e.target.files[0];e.target.value="";var r=new FileReader;r.onloadend=function(){var e=new Image;e.onload=function(){var n=1;n=e.height>e.width?t.height/2/e.height:t.width/2/e.width;var r=new Gn.fabric.Image(e,{top:t.height/2,left:t.width/2,scaleX:n,scaleY:n,originX:"center",originY:"center",cacheKey:"image"});t.add(r),t.requestRenderAll(),a.setState({canvas:t})},e.src=r.result},n&&r.readAsDataURL(n)},a.state={apis:{},canvas:{},anyObjectActive:!1,color:"black",draw:!1,mouseDown:!1},a.previousPoint={x:0,y:0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a,n,r=this;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.updateNav,e.next=3,ue.scope("Mentee");case 3:a=e.sent,(n=new Gn.fabric.Canvas("mainCanvas",{preserveObjectStacking:!0,selection:!1,backgroundColor:"white"})).freeDrawingBrush.width=2,n.on("mouse:down",function(e){r.onMouseDown(e)}),n.on("mouse:move",function(e){r.onMouseMove(e)}),n.on("mouse:up",function(e){r.onMouseUp(e)}),this.setState({apis:a,canvas:n}),t({schema:"sideNav",data:{name:"Drawing Board"}}),this.addInitialAnimation();case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUpdate",value:function(e){var t=this.state.canvas;if(e.webRtc.localCallHistory&&"whiteBoard"===e.webRtc.localCallHistory.mediaType){var a=t.getObjects().find(function(e){return"logo"===e.cacheKey&&e});t.remove(a),this.addInitialAnimation(),t.requestRenderAll()}}},{key:"render",value:function(){var e=this.state,t=e.draw,a=e.anyObjectActive,n=e.color,r=e.canvas,i=e.apis,c=this.props,s=c.database,l=c.account,u=c.addDatabaseSchema;return o.a.createElement("div",{className:"drawing-board bro-right"},o.a.createElement("div",{className:"draw-title"},o.a.createElement("span",null,"White Board")),o.a.createElement(qn,{draw:this.draw,drawActive:t,apis:i,colorChange:this.colorChange,clear:this.clearCanvas,anyObjectActive:a,onDelete:this.deleteObject,addText:this.addText,color:n,account:l,database:s,fileUpload:this.fileUpload,canvas:r,addDatabaseSchema:u}),o.a.createElement("div",{className:"draw-canvas"},o.a.createElement("canvas",{id:"mainCanvas",height:700,width:1e3})))}}]),t}(r.Component),Kn=Object(p.b)(function(e){return e},Object(y.a)({},n))(Yn),Qn=a(49),_n=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!1},a.getImage=function(e,t){var a=e&&e.image?"".concat(oe,"/user/").concat(1e7+parseInt(e.userId,10),"/profile/").concat(e.image):Qn;return o.a.createElement("div",{className:"img-con"},o.a.createElement(it,{imgUrl:a}),t.activeStatus&&o.a.createElement("span",{className:"green-dot"}))},a.sendMessage=function(){var e=a.props,t=e.updateWebRtc,n=e.id,r=e.database,o=e.account,i=e.connection;t("showCommunication",n),t("peerType","user"),t("communicationContainer","history"),t("connectionId",i.id),t("chatHistory",{type:"user",user:{user:i.userId===o.user.id?r.User.byId[i.mId]:r.User.byId[i.userId]},connectionId:i.id})},a.deleteRequest=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.id,r=t.apis,o=t.deleteDatabaseSchema,i=t.connection,a.setState({loading:!0}),e.next=4,r.deleteUserConnection({id:n});case 4:o("UserConnection",{id:i.id}),a.setState({loading:!1});case 6:case"end":return e.stop()}},e)})),a.acceptRequest=Object(W.a)(L.a.mark(function e(){var t,n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.apis,r=t.updateDatabaseSchema,o=t.connection,a.setState({loading:!0}),e.next=4,n.updateUserConnection([{status:"connected",mId:o.mId,userId:o.userId},{id:o.id}]);case 4:r("UserConnection",{id:o.id,status:"connected"}),a.setState({loading:!1});case 6:case"end":return e.stop()}},e)})),a.getConfigButtons=function(){var e=a.props,t=e.account,n=e.connection,r=a.state.loading;return t.user.id===n.userId&&"pending"===n.status?o.a.createElement("div",{className:"con-buttons"},o.a.createElement(ve.b,{text:"Requested",icon:"follower",onClick:a.deleteRequest})):"pending"===n.status?o.a.createElement("div",{className:"con-buttons"},o.a.createElement(ve.b,{text:"Decline",icon:"delete",intent:"danger",loading:r,disabled:r,onClick:a.deleteRequest}),o.a.createElement(ve.b,{loading:r,disabled:r,text:"Accept",icon:"following",className:"pc-accept",intent:"success",onClick:a.acceptRequest})):o.a.createElement("div",{className:"con-buttons"},o.a.createElement(ve.b,{text:"Message",icon:"chat",onClick:a.sendMessage}))},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.database,n=a.User.byId[t],r=Object.values(a.UserDetail.byId).find(function(e){return t===e.userId});return o.a.createElement("div",{className:"i-result"},this.getImage(r,n),o.a.createElement("div",{className:"desc-con"},o.a.createElement("p",{className:"name"},o.a.createElement(K.a,{to:"/user/".concat(n.slug,"/")},ct(n))),o.a.createElement("p",{className:"location"},r&&r.address?r.address:"---"),o.a.createElement("div",{className:"con-config"},this.getConfigButtons())))}}]),t}(o.a.Component),Zn=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getConnections=function(){var e=a.props,t=e.database,n=e.account.user.id,r=[];return Object.values(t.UserConnection.byId).map(function(e){r.push(e.userId===n?{userId:e.mId,connection:e}:{userId:e.userId,connection:e})}),r},(0,a.props.updateNav)({schema:"sideNav",data:{name:"Connections"}}),a.state={apis:{}},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue.scope("Mentee");case 2:t=e.sent,this.setState({apis:t});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=e.database,a=e.account,n=e.updateWebRtc,r=e.updateDatabaseSchema,i=e.deleteDatabaseSchema,c=this.state.apis;if(!a.user)return o.a.createElement("div",{className:"bro-right",style:{position:"relative"}},o.a.createElement(Fe,null));var s=this.getConnections();return o.a.createElement("div",{className:"connection bro-right"},o.a.createElement("div",{className:"header"},o.a.createElement("div",null,o.a.createElement("span",{className:"title"},"Connections "),o.a.createElement("small",null,"Mange your connections"))),o.a.createElement("div",{className:"con-list"},0===s.length&&o.a.createElement("div",{className:"pc-no-cons"},o.a.createElement("p",null,"You do not have any connections at the moment.")),s.map(function(e){return o.a.createElement(_n,{updateWebRtc:n,deleteDatabaseSchema:i,updateDatabaseSchema:r,apis:c,key:e.userId,id:e.userId,connection:e.connection,account:a,database:t})})))}}]),t}(o.a.Component),Xn=Object(p.b)(function(e){return e},Object(y.a)({},n))(Zn),$n=[{id:"name",fieldtype:"input",required:!0,name:"Name",placeholder:""},{id:"submit",fieldtype:"button",type:"submit",text:"Submit",fill:"fill",intent:"success",large:"large"}],er=a(55),tr=function(e){var t=e.user,a=e.obj;return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement("div",{className:"template-icon"},o.a.createElement(er.d,{size:30})),o.a.createElement(K.a,{to:"/class-template/".concat(t.slug,"/").concat(a.id),className:"content-link"},o.a.createElement("div",{className:"class-repr"},o.a.createElement("span",null,a.name)),o.a.createElement("div",{className:"class-detail"},o.a.createElement("span",{className:"name"},"Proper Class"),o.a.createElement("span",{className:"date"},(new Date).toDateString()))))},ar=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).getTemplates=function(){var e=a.props.data,t=e.classes.map(function(t){var a=e.users[t.userId];return o.a.createElement(tr,{key:"template-".concat(t.id),user:a,obj:t})});return 0===t.length?o.a.createElement("p",{className:"no-template"},"Templates coming soon!"):t},a.state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"pc-class-template-container"},o.a.createElement("div",{className:"header"},o.a.createElement("span",{className:"title"},"Templates "),o.a.createElement("small",null,"Start with a template")),o.a.createElement("div",{className:"content-list"},this.getTemplates()))}}]),t}(o.a.Component),nr=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={createBool:!1,deleteClass:{id:0,name:"",deletePopOverBool:!1},updateClass:{id:0,updateClassBool:!1},api:{}},a.createNewClass=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,r=a.props,o=r.account,i=r.addDatabaseSchema,c=a.state.api,n.userId=o.user.id,n.timeStamp=Date.now(),e.prev=5,e.next=8,c.addBoard(n);case 8:s=e.sent,i("Board",Object(y.a)({},n,{type:"private",id:s.boardId})),i("BoardMember",{id:s.boardMemberId,boardId:s.boardId,tuserId:o.user.id,fuserId:o.user.id,joinStatus:1,timeStamp:Date.now(),userType:"creator"}),e.next=16;break;case 13:return e.prev=13,e.t0=e.catch(5),e.abrupt("return",{response:404});case 16:return a.newClass(),e.abrupt("return",{response:200});case 18:case"end":return e.stop()}},e,null,[[5,13]])}));return function(t){return e.apply(this,arguments)}}(),a.newClass=function(){var e=a.state.createBool;$n.map(function(e){"name"===e.id&&(e.val="")}),a.setState({createBool:!e})},a.onMore=function(){var e=Object(W.a)(L.a.mark(function e(t,n){var r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=a.state,o=r.deleteClass,i=r.updateClass,c=a.props.database,"delete"===t&&a.setState({deleteClass:{id:n,name:c.Board.byId[n].name,deletePopOverBool:!o.deletePopOverBool}}),"edit"===t&&($n.map(function(e){"name"===e.id&&(e.val=c.Board.byId[n].name)}),a.setState({updateClass:{id:n,updateClassBool:!i.updateClassBool}}));case 4:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.deleteClass=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,r=n.deleteClass,o=n.api,i=a.props.deleteDatabaseSchema,"confirm"!==t){e.next=6;break}return e.next=5,o.deleteBoard({id:r.id,broadCastId:"Board-".concat(r.id)});case 5:i("Board",{id:r.id});case 6:a.setState({deleteClass:{id:0,name:"",deletePopOverBool:!r.deletePopOverBool}});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.updateClass=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state,r=n.updateClass,o=n.api,i=a.props.updateDatabaseSchema,e.next=4,o.updateBoard([Object(y.a)({},t,{broadCastId:"Board-".concat(r.id)}),{id:r.id}]);case 4:return i("Board",Object(y.a)({id:r.id},t)),a.setState({updateClass:{id:0,updateClassBool:!1}}),e.abrupt("return",{response:200});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.cancleUpdate=function(){var e=a.state.updateClass;a.setState({updateClass:{id:0,updateClassBool:!e.updateClassBool}})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.updateNav,e.next=3,ue.scope("Mentee");case 3:a=e.sent,this.setState({api:a}),t({schema:"sideNav",data:{name:"Classes"}});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,a=t.account,n=t.database,r=this.state,i=r.createBool,c=r.deleteClass,s=r.updateClass;return o.a.createElement("div",{className:"classes bro-right"},o.a.createElement(We,{isOpen:c.deletePopOverBool,action:this.deleteClass,name:c.name}),o.a.createElement("div",{className:"header"},o.a.createElement("span",{className:"title"},"Classrooms "),o.a.createElement("small",null,"Your classrooms")),o.a.createElement("div",{className:"content-list"},Object.values(n.Board.byId).filter(function(e){return"private"===e.type}).map(function(t,r){var i=n.User.byId[t.userId],c=t.name.length>30?t.name.substring(0,29):t.name;return o.a.createElement("div",{style:{position:"relative"},key:r},o.a.createElement(rt,{onMore:e.onMore,id:t.id}),o.a.createElement(K.a,{to:"/class-work/".concat(a.user.slug,"/").concat(t.id),className:"content-link"},o.a.createElement("div",{className:"class-repr"},o.a.createElement("span",null,c)),o.a.createElement("div",{className:"class-detail"},o.a.createElement("span",{className:"name"},ct(i)),o.a.createElement("span",{className:"date"},new Date(t.timeStamp).toDateString()))))}),o.a.createElement("div",{className:"content-link add-new"},o.a.createElement(ve.b,{intent:"primary",icon:"plus",onClick:this.newClass,text:"Add New"}))),o.a.createElement(ar,{data:{classes:Object.values(n.Board.byId).filter(function(e){return"template"===e.type}),users:n.User.byId}}),o.a.createElement(tt,{isOpen:i,onClose:this.newClass,callback:this.createNewClass,structure:$n}),o.a.createElement(tt,{isOpen:s.updateClassBool,onClose:this.cancleUpdate,callback:this.updateClass,structure:$n}))}}]),t}(r.Component),rr=Object(p.b)(function(e){return e},Object(y.a)({},n))(nr),or=function(){var e=Object(W.a)(L.a.mark(function e(t,a){var n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a.title.replace(/\s/g,"").length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t(a);case 5:return n=e.sent,e.abrupt("return",n);case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0);case 12:case"end":return e.stop()}},e,null,[[2,9]])}));return function(t,a){return e.apply(this,arguments)}}(),ir=function(){var e=Object(W.a)(L.a.mark(function e(t,a){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==a[0].title.replace(/\s/g,"").length){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,t(a);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:case"end":return e.stop()}},e,null,[[2,7]])}));return function(t,a){return e.apply(this,arguments)}}(),cr=function(e){var t=e.imgName,a=e.callback;return o.a.createElement("div",{style:{padding:"5px"}},o.a.createElement(Me.a,{text:t,onInputChange:a,large:!0}))},sr=function(e){var t=e.bold,a=e.italic,n=e.underline,r=e.imageSource,i=e.publish,c=e.onClick,s=e.onPublish,l=e.saveBlog,u=e.saveLoading,d=e.uploadImg,m=e.blogId;return o.a.createElement("div",{className:"toolbar"},o.a.createElement("div",{className:"left"},m&&o.a.createElement(Bn.b,{innerLabel:"Draft",innerLabelChecked:"Public",alignIndicator:"right",large:!0,checked:"publish"===i,className:"switch",onChange:s})),o.a.createElement("div",{className:"center"},o.a.createElement(Ie.a,{options:[{label:"Normal",value:"p"},{value:"h1",label:"Heading 1"},{value:"h2",label:"Heading 2"},{value:"h3",label:"Heading 3"},{label:"Code",value:"pre"}],onChange:function(e){return c("formatBlock",e.target.value)}}),o.a.createElement(ve.b,{type:"button",icon:"bold",intent:t?"primary":null,onClick:function(){return c("bold","")}}),o.a.createElement(ve.b,{type:"button",icon:"italic",intent:a?"primary":null,onClick:function(){return c("italic","")}}),o.a.createElement(ve.b,{type:"button",icon:"underline",intent:n?"primary":null,onClick:function(){return c("underline","")}}),o.a.createElement(ve.b,{type:"button",icon:"align-left",onClick:function(){return c("justifyLeft","")}}),o.a.createElement(ve.b,{type:"button",icon:"align-center",onClick:function(){return c("justifyCenter","")}}),o.a.createElement(ve.b,{type:"button",icon:"align-right",onClick:function(){return c("justifyRight","")}}),o.a.createElement(at.a,{content:o.a.createElement(cr,{imgName:r,callback:d})},o.a.createElement(ve.b,{type:"button",icon:"media"}))),o.a.createElement("div",{className:"right"},o.a.createElement(ve.b,{type:"button",disabled:u,loading:u,intent:"success",text:"save",onClick:l})))};sr.defaultProps={blogId:null};var lr=sr,ur=a(78),dr=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onChange=function(e){(0,a.props.coverChange)(e.target.files[0])},a.onClick=function(){a.fileInputRef.current.click()},a.state={},a.fileInputRef=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.coverImage;return o.a.createElement("div",{className:"img-upload-container"},o.a.createElement("div",{className:"blog-cover-img"},o.a.createElement("img",{alt:"default blog icon",src:e||ur})),o.a.createElement("div",{className:"img-upload",onClick:this.onClick,role:"button"},o.a.createElement(er.e,{size:30,color:"#1d4354"}),o.a.createElement("span",{style:{marginLeft:10,display:"inline-grid",fontSize:18,color:"#1d4354",alignItems:"center"}},"Add Cover Image"),o.a.createElement("input",{ref:this.fileInputRef,type:"file",style:{display:"none"},onChange:this.onChange})))}}]),t}(o.a.Component),mr=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={bold:!1,italic:!1,underline:!1,publish:"draft",saveLoading:!1,apis:{},title:"",description:"",blogId:null,imageSource:"Choose a picture...",coverImage:{actualFile:null,url:null,serverImageName:null}},a.observeMutation=function(e){for(var t=[],n=0;n<e.length;n+=1)for(var r=e[n].removedNodes,o=e[n].addedNodes,i=0;i<r.length;i+=1){if(o.length>i&&o[n].src===r[i].src)return;if("img"===r[i].localName){var c=r[i].src.split("/");t.push(c[c.length-1])}}0!==t.length&&a.deleteFileHandler(t)},a.onChangeDesc=function(e){a.setState({description:e.target.innerHTML})},a.onChangeTitle=function(e){a.setState({title:e.target.value})},a.onEditorFocus=function(){var e,t=!1,n=!1,r=!1;if(window.getSelection){if(!(e=window.getSelection()).focusNode)return;var o=e.focusNode.parentElement;if(e.rangeCount)for(;"div"!==o.localName;){switch(o.localName){case"u":r=!0;break;case"b":t=!0;break;case"i":n=!0;break;default:return}o=o.parentElement}}a.setState({bold:t,italic:n,underline:r})},a.onClick=function(e,t){document.execCommand(e,!1,t),document.getElementById("editor").focus()},a.toggleButtons=function(e){var t=a.state,n=t.bold,r=t.italic,o=t.underline,i=t.h2;switch(e){case"bold":n=!n;break;case"italic":r=!r;break;case"underline":o=!o;break;case"h2":i=!i;break;default:return}a.setState({bold:n,italic:r,underline:o,h2:i})},a.contentChange=function(e){if((!0===e.ctrlKey||!0===e.metaKey)&&83===e.keyCode)return e.preventDefault(),void a.saveBlog();if(46===e.keyCode&&8===e.keyCode){var t=e.target.innerText;"\n"!==t&&""!==t||(e.target.innerHTML="")}},a.onkeyUp=function(e){a.contentChange(e),a.onEditorFocus()},a.createMarkup=function(e){return{__html:e}},a.saveBlog=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l,u,d,m,p,f,v,b,g;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,n=t.apis,r=t.title,o=t.description,i=t.blogId,c=t.publish,s=t.coverImage,l=null,a.setState({saveLoading:!0}),u=a.props,d=u.account,m=u.history,p=u.addDatabaseSchema,f=u.updateDatabaseSchema,!s.actualFile){e.next=18;break}return(v=new FormData).append("data",JSON.stringify({token:d.sessionId,fileType:"image",content:"blog"})),v.append("file",s.actualFile),e.prev=8,e.next=11,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:v});case 11:200===(b=e.sent).status&&(l=b.data,a.setState({coverImage:Object(y.a)({},s,{actualFile:null,serverImageName:l})})),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(8),console.log("Error",e.t0);case 18:if(i){e.next=26;break}return e.next=21,or(n.addBlog,{userId:d.user.id,timeStamp:Date.now(),saveStatus:c,title:r,coverImage:l,content:o});case 21:return g=e.sent,p("Blog",{id:g,userId:d.user.id,timeStamp:Date.now(),saveStatus:c,coverImage:l,title:r,content:o}),m.push("/edit-blog/".concat(d.user.slug,"/").concat(g)),a.setState({saveLoading:!1,blogId:g,publish:"draft"}),e.abrupt("return");case 26:return e.next=28,ir(n.updateBlog,[{title:r,content:o,saveStatus:c,coverImage:s.url||l?l||s.serverImageName:null},{id:i}]);case 28:f("Blog",{id:i,saveStatus:c,title:r,content:o,coverImage:s.url||l?l||s.serverImageName:null}),a.setState({saveLoading:!1});case 30:case"end":return e.stop()}},e,null,[[8,15]])})),a.publish=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,r=n.blogId,o=n.apis,i=n.title,c=n.description,a.setState({saveLoading:!0}),s=a.props.updateDatabaseSchema,l=t.target.checked?"publish":"draft",""===r){e.next=9;break}return a.setState({publish:l}),e.next=8,ir(o.updateBlog,[{title:i,content:c,saveStatus:l},{id:r}]);case 8:s("Blog",{id:r,saveStatus:l,title:i,content:c});case 9:a.setState({saveLoading:!1});case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.uploadImg=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props.account,a.setState({imageSource:t.target.files[0].name}),e.prev=2,(r=new FormData).append("data",JSON.stringify({token:n.sessionId,fileType:"image",content:"blog"})),r.append("file",t.target.files[0]),e.next=8,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:r});case 8:200===(o=e.sent).status?(document.getElementById("editor").focus(),document.execCommand("insertImage",!1,"".concat(oe,"/user/").concat(1e7+parseInt(n.user.id,10),"/blog/").concat(o.data)),a.saveBlog()):alert("Please try with different image"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),alert("Please try with different image");case 15:case"end":return e.stop()}},e,null,[[2,12]])}));return function(t){return e.apply(this,arguments)}}(),a.deleteFileHandler=function(){var e=Object(W.a)(L.a.mark(function e(t){var n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props.account,e.prev=1,e.next=4,Y.a.post("".concat(oe,"/web/delete-file"),{token:n.sessionId,content:"blog",fileName:t});case 4:a.saveBlog(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.log("Internal Error",e.t0);case 10:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),a.coverChange=function(e){a.setState({coverImage:{url:URL.createObjectURL(e),actualFile:e}})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a,n,r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.match,n=t.database,e.next=3,ue.scope("Mentor");case 3:r=e.sent,this.setState({apis:r}),o={attributes:!0,childList:!0,subtree:!0},i=document.getElementById("editor"),new MutationObserver(this.observeMutation).observe(i,o),a.params.blogId&&n.Blog.allIds.length>0&&(c=n.Blog.byId[parseInt(a.params.blogId,10)],document.getElementById("editor").innerHTML=c.content,this.setState({blogId:c.id,publish:c.saveStatus,title:c.title,coverImage:{actualFile:null,serverImageName:c.coverImage,url:c.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(c.userId,10),"/blog/").concat(c.coverImage):null},description:c.content}));case 10:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUpdate",value:function(e){var t=this.props,a=t.database,n=t.match;if(n.params.blogId&&e.database.Blog.byId!==a.Blog.byId){var r=e.database.Blog.byId[parseInt(n.params.blogId,10)];document.getElementById("editor").innerHTML=e.database.Blog.byId[parseInt(n.params.blogId,10)].content,this.setState({blogId:r.id,coverImage:{actualFile:null,serverImageName:r.coverImage,url:r.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(r.userId,10),"/blog/").concat(r.coverImage):null},publish:r.saveStatus,title:r.title,description:r.content})}}},{key:"render",value:function(){var e=this.state,t=e.bold,a=e.italic,n=e.underline,r=e.imageSource,i=e.publish,c=e.title,s=e.saveLoading,l=e.coverImage,u=e.blogId,d=this.props.account;return o.a.createElement("div",null,!d.sessionId&&o.a.createElement(U.a,{to:"/"}),o.a.createElement(Pt,{className:"pcm-nav"}),o.a.createElement("div",{className:"create-blog"},o.a.createElement(lr,{saveLoading:s,onClick:this.onClick,onPublish:this.publish,uploadImg:this.uploadImg,saveBlog:this.saveBlog,bold:t,blogId:u,italic:a,underline:n,imageSource:r,publish:i}),o.a.createElement(dr,{coverImage:l.url,coverChange:this.coverChange}),o.a.createElement("div",{className:"title"},o.a.createElement(Te.a,{fill:!0,placeholder:"Header...*",maxLength:"150",rows:"1",onChange:this.onChangeTitle,value:c,intent:0===c.replace(/\s/g,"").length?"danger":"none",style:{resize:"none",overflowX:"hidden",overflowWrap:"break-word",maxHeight:"97px"}})),o.a.createElement("div",{className:"editor-container"},o.a.createElement("div",{id:"editor",role:"textbox",tabIndex:0,contentEditable:!0,datatext:"Start Writing ...",style:{content:"attr(placeholder)"},onKeyUp:this.onkeyUp,onKeyDown:this.contentChange,onFocus:this.onEditorFocus,onClick:this.onEditorFocus,onInput:this.onChangeDesc}))))}}]),t}(r.Component),pr=Object(p.b)(function(e){return{account:e.account,database:e.database}},Object(y.a)({},n))(mr),fr=a(78),vr=function(e){var t=e.onMore,a=e.users,n=e.obj,r=n.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(n.userId,10),"/blog/").concat(n.coverImage):fr;return o.a.createElement("div",{className:"blog-container"},o.a.createElement("div",{className:"img-container"},o.a.createElement(rt,{onMore:t,id:n.id}),o.a.createElement("img",{alt:"test",src:r})),o.a.createElement("div",{className:"detail-container"},o.a.createElement("div",{className:"blog-author"},o.a.createElement(K.a,{to:"/user/".concat(a.byId[n.userId].slug)},a.byId[n.userId].middleName?"".concat(a.byId[n.userId].firstName," ").concat(a.byId[n.userId].middleName," ").concat(a.byId[n.userId].lastName):"".concat(a.byId[n.userId].firstName," ").concat(a.byId[n.userId].lastName))),o.a.createElement("div",{className:"blog-title"},o.a.createElement("p",{className:"title"},n.title),o.a.createElement("p",{style:{textAlign:"right",width:"100%"}},o.a.createElement("span",{className:"pc-date"},new Date(n.timeStamp).toDateString())))))},br=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={createBlog:!1,editBlog:!1,deletePopOverIsOpen:!1,blogId:null,apis:{}},a.deleteBlog=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state,r=n.apis,o=n.blogId,i=a.props.deleteDatabaseSchema,"confirm"!==t){e.next=8;break}return e.next=5,r.deleteBlog({id:o});case 5:return a.setState({deletePopOverIsOpen:!1,blogId:""}),i("Blog",{id:o}),e.abrupt("return");case 8:a.setState({deletePopOverIsOpen:!1});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onMore=function(e,t){"delete"===e?a.setState({deletePopOverIsOpen:!0,blogId:t}):"edit"===e&&a.setState({editBlog:!0,blogId:t})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.updateNav,e.next=3,ue.scope("Mentor");case 3:a=e.sent,this.setState({apis:a}),t({schema:"sideNav",data:{name:"Blog"}});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.createBlog,n=t.deletePopOverIsOpen,r=t.blogId,i=t.editBlog,c=this.props.account,s=this.props.database;return o.a.createElement("div",{className:"blogs bro-right"},a&&o.a.createElement(U.a,{push:!0,to:"/create-blog/".concat(c.user.slug)}),r&&i&&o.a.createElement(U.a,{push:!0,to:"/edit-blog/".concat(c.user.slug,"/").concat(r)}),o.a.createElement(We,{isOpen:n,action:this.deleteBlog,name:r?s.Blog.byId[r].title:""}),o.a.createElement("div",{className:"header"},o.a.createElement("div",null,o.a.createElement("span",{className:"title"},"Blogs "),o.a.createElement("small",null,"Manage your blogs here")),o.a.createElement("div",null,o.a.createElement(ve.b,{className:"create-btn",text:"Create Blog",intent:"success",onClick:function(){return e.setState({createBlog:!a})}}))),o.a.createElement("div",{className:"blog-list"},0===s.Blog.allIds.length&&o.a.createElement("div",{className:"pc-no-blogs"},o.a.createElement("p",null,"You have not created any blogs at the moment.")),Object.values(s.Blog.byId).filter(function(e){return e.userId===c.user.id}).map(function(t,a){return o.a.createElement(vr,{onMore:e.onMore,users:s.User,obj:t,key:a})})))}}]),t}(r.Component),gr=Object(p.b)(function(e){return e},Object(y.a)({},n))(br),hr=a(49),yr=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).editComment=function(){a.setState({editComment:!0})},a.commentChange=function(e){a.setState({commentText:e.target.value})},a.togglePopover=function(){var e=a.state.deletePopover;a.setState({deletePopover:!e})};var n=a.props.comment;return a.state={deletePopover:!1,commentText:n.comment,editComment:!1},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.comment,n=t.user,r=t.account,i=t.saveComment,c=t.replyComment,s=t.deleteComment,l=this.state,u=l.editComment,d=l.commentText,m=n.userDetail&&n.userDetail.image?"".concat(oe,"/user/").concat(1e7+parseInt(n.user.id,10),"/profile/").concat(n.userDetail.image):hr;return o.a.createElement("div",{className:"i-response"},o.a.createElement("div",{className:"pc-profile-icon"},o.a.createElement(it,{imgUrl:m})),o.a.createElement("div",{className:"comment-content"},o.a.createElement("div",{style:{fontSize:16}},n.user.middleName?o.a.createElement(K.a,{to:"/user/".concat(n.user.slug,"/"),key:"user-".concat(n.user.id)},"".concat(n.user.firstName," ").concat(n.user.middleName," ").concat(n.user.lastName," ")):o.a.createElement(K.a,{to:"/user/".concat(n.user.slug,"/"),key:"user-".concat(n.user.id)},"".concat(n.user.firstName," ").concat(n.user.lastName," ")),o.a.createElement("span",{style:{opacity:.8,fontSize:10}},new Date(a.timeStamp).toDateString())),o.a.createElement("div",{className:"com-desc"},u?o.a.createElement("div",{className:"pc-comment-edit"},o.a.createElement(Te.a,{fill:!0,small:!0,style:{fontSize:16,padding:"2px"},placeholder:"Put your comments.",value:d,onChange:this.commentChange}),o.a.createElement(ve.b,{icon:"tick",style:{margin:"0px 5px"},onClick:function(){e.setState({editComment:!1}),i(d,a)},intent:"success"}),o.a.createElement(ve.b,{icon:"cross",onClick:function(){return e.setState({editComment:!1})}})):o.a.createElement("p",null,a.comment)),r.user&&!u&&o.a.createElement("div",{className:"com-config"},r.user.id===a.userId?o.a.createElement("div",null,o.a.createElement("small",{className:"primary",role:"menu",tabIndex:"0",onKeyDown:function(){return!1},onClick:function(){return e.editComment(a)}},o.a.createElement("u",null,"Edit")),o.a.createElement("small",{className:"danger",role:"menu",tabIndex:"0",onKeyDown:function(){return!1},onClick:function(){return s(a)}},o.a.createElement("u",null,"Delete"))):o.a.createElement("small",{className:"primary",role:"menu",tabIndex:"0",onKeyDown:function(){return!1},onClick:function(){return c(a)}},o.a.createElement("u",null,"Reply")))))}}]),t}(o.a.Component),Cr=a(49),wr=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={comment:"",liked:null,allComments:[],allLikes:[],deletePopover:!1,commentToDelete:{}},a.setComment=function(e){a.setState({comment:e.target.value})},a.submitComment=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state,n=t.comment,r=t.allComments,o=a.props,i=o.apis,c=o.blogId,s=o.account,e.prev=2,l={userId:s.user.id,comment:n,timeStamp:Date.now(),blogId:c,broadCastId:"Blog-".concat(c)},e.next=6,i.addBlogComment(l);case 6:u=e.sent,a.setState({allComments:[].concat(Object(g.a)(r),[Object(y.a)({},l,{id:u})]),comment:""}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log("Error",e.t0);case 13:case"end":return e.stop()}},e,null,[[2,10]])})),a.saveEditedComment=function(){var e=Object(W.a)(L.a.mark(function e(t,n){var r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.props,o=r.apis,i=r.blogId,c=a.state.allComments,e.prev=2,s={comment:t,broadCastId:"Blog-".concat(i)},e.next=6,o.updateBlogComment([s,{id:n.id}]);case 6:l=c.filter(function(e){return e.id!==n.id}),a.setState({allComments:[].concat(Object(g.a)(l),[Object(y.a)({},n,{comment:t})]),comment:""}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log("Error",e.t0);case 13:case"end":return e.stop()}},e,null,[[2,10]])}));return function(t,a){return e.apply(this,arguments)}}(),a.replyComment=function(e){var t=a.props.users.find(function(t){return t.user.id===e.userId});a.setState({comment:"@".concat(t.user.firstName)})},a.toggleDelete=function(e){var t=a.state.deletePopover;a.setState({deletePopover:!t,commentToDelete:e})},a.deleteComment=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.apis,o=n.blogId,i=a.state,c=i.commentToDelete,s=i.allComments,"confirm"!==t){e.next=8;break}return e.next=5,r.deleteBlogComment({id:c.id,broadCastId:"Blog-".concat(o)});case 5:return l=s.filter(function(e){return e.id!==c.id}),a.setState({deletePopover:!1,commentToDelete:{},allComments:l}),e.abrupt("return");case 8:a.setState({deletePopover:!1,commentToDelete:{}});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.likeBlog=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,n=t.liked,r=t.allLikes,o=a.props,i=o.apis,c=o.account,s=o.blogId,!n){e.next=8;break}return e.next=5,i.deleteBlogLike({id:n,broadCastId:"Blog-".concat(s)});case 5:a.setState({allLikes:r.filter(function(e){return e.id!==n}),liked:null}),e.next=13;break;case 8:return l={blogId:s,userId:c.user.id,timeStamp:Date.now(),likeType:"like"},e.next=11,i.addBlogLike(Object(y.a)({},l,{broadCastId:"Blog-".concat(s)}));case 11:u=e.sent,a.setState({liked:u,allLikes:[].concat(Object(g.a)(r),[Object(y.a)({},l,{id:u})])});case 13:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props,a=t.likes,n=t.account,r=t.comments;this.setState({allComments:r,allLikes:a}),n.user&&a.filter(function(t){t.userId===n.user.id&&e.setState({liked:t.id})})}},{key:"componentWillReceiveProps",value:function(e){var t=this,a=this.props,n=a.account,r=a.likes;n.user!==e.account.user&&r.filter(function(a){a.userId===e.account.user.id&&t.setState({liked:a.id})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.comment,n=t.liked,r=t.allComments,i=t.allLikes,c=t.deletePopover,s=this.props,l=s.users,u=(s.imgUrl,s.account),d=u.user&&u.user.userDetails.image?"".concat(oe,"/user/").concat(1e7+parseInt(u.user.id,10),"/profile/").concat(u.user.userDetails.image):Cr;return o.a.createElement("div",{className:"response"},o.a.createElement("div",{className:"left"}),o.a.createElement("div",{className:"comment-section"},o.a.createElement("div",null,u.user&&o.a.createElement(ve.b,{intent:n?"primary":"none",text:n?"Liked":"Like",icon:"thumbs-up",onClick:this.likeBlog}),o.a.createElement("span",null," ".concat(i.length," Likes"))),u.user&&o.a.createElement("div",{className:"top-label"},o.a.createElement("h1",null,"Comment here")),u.user&&o.a.createElement("div",{className:"comment-area"},o.a.createElement("div",{className:"profile-icon"},o.a.createElement(it,{imgUrl:d})),o.a.createElement(Te.a,{placeholder:"Write your thoughts on this...",onChange:this.setComment,value:a}),o.a.createElement(ve.b,{intent:"primary",fill:!0,onClick:this.submitComment},o.a.createElement($t.j,{size:30}))),o.a.createElement("div",{className:"responses"},o.a.createElement("div",{className:"res-label"},o.a.createElement("h3",null,"Responses")),r.sort(lt).map(function(t){var a=l.find(function(e){return e.user.id===t.userId});return o.a.createElement(yr,{deleteComment:e.toggleDelete,replyComment:e.replyComment,saveComment:e.saveEditedComment,user:a,account:u,comment:t,key:t.id})}),o.a.createElement(We,{isOpen:c,name:"Comment",action:this.deleteComment}))),o.a.createElement("div",{className:"right"}))}}]),t}(o.a.Component),Er=function(e){var t=e.blog,a=t.blog.coverImage?"".concat(oe,"/user/").concat(1e7+parseInt(t.blog.userId,10),"/blog/").concat(t.blog.coverImage):null;return o.a.createElement("div",{className:"pc-blog-cover-image"},a&&o.a.createElement("img",{alt:"blog cover",src:a}))},Sr=a(49),Or=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={blogId:null,apis:{},data:{},loading:!0},a.createMarkup=function(e){return{__html:e}},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props,a=t.account,n=t.match,e.prev=1,r={},!a.user){e.next=8;break}return e.next=6,ue.scope("Mentee");case 6:r=e.sent,o=a.user.id;case 8:return e.next=10,Y.a.get("".concat(oe,"/web/get-blog?blogId=").concat(n.params.blogSlug,"&userId=").concat(n.params.userSlug,"&uid=").concat(o));case 10:i=e.sent,this.setState({data:i.data,apis:r,blogId:i.data.blog.id,loading:!1}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(1),console.log("Error",e.t0);case 17:case"end":return e.stop()}},e,this,[[1,14]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(W.a)(L.a.mark(function e(t){var a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.account.user===t.account.user){e.next=12;break}return e.prev=2,e.next=5,ue.scope("Mentee");case 5:a=e.sent,this.setState({apis:a}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.log("Error",e.t0);case 12:case"end":return e.stop()}},e,this,[[2,9]])}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.blogId,a=e.apis,n=e.data;if(e.loading)return o.a.createElement(Fe,null);var r=this.props.account,i=n.userDetails.find(function(e){return e.user.id===n.blog.userId}),c=i.userDetail&&i.userDetail.image?"".concat(oe,"/user/").concat(1e7+parseInt(i.user.id,10),"/profile/").concat(i.userDetail.image):Sr,s=n.userDetails;return o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"public-blog"},o.a.createElement("div",{className:"public-blog-title"},o.a.createElement("p",null,n.blog.title),o.a.createElement("div",{className:"author-user"},o.a.createElement("div",{className:"auth-con"},o.a.createElement("div",{className:"profile-icon"},o.a.createElement(it,{imgUrl:c})),o.a.createElement("div",{className:"author-detail"},o.a.createElement(K.a,{key:i.user.id,to:"/user/".concat(i.user.slug)},"".concat(i.user.firstName," ").concat(i.user.middleName?"".concat(i.user.middleName," "):"").concat(i.user.lastName)),o.a.createElement("span",null,new Date(n.blog.timeStamp).toDateString()))),o.a.createElement($e,{url:window.location.href}))),o.a.createElement(Er,{blog:n}),o.a.createElement("div",{className:"public-blog-content"},o.a.createElement("div",{id:"blogContent",dangerouslySetInnerHTML:this.createMarkup(n.blog.content)})),o.a.createElement(wr,{imgUrl:c,account:r,apis:a,users:s,comments:n.blogComment,likes:n.blogLike,blogId:t})),o.a.createElement(Mt,null))}}]),t}(o.a.Component),kr=Object(p.b)(function(e){return e})(Or),Ir=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.account,a=e.match;return t.sessionId?t.user?t.user.slug!==a.params.id?o.a.createElement(U.a,{to:"/"}):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"broWrapper"},o.a.createElement(Za,{match:a}),o.a.createElement(tn,{match:a}),o.a.createElement("div",{className:"fake-side-nav"}),o.a.createElement(M.a,null,o.a.createElement(H.a,{exact:!0,path:"".concat(a.path),component:Nn}),o.a.createElement(H.a,{exact:!0,path:"".concat(a.path,"/classes"),component:rr}),o.a.createElement(H.a,{exact:!0,path:"".concat(a.path,"/blog"),component:gr}),o.a.createElement(H.a,{exact:!0,path:"".concat(a.path,"/settings"),component:Vn}),o.a.createElement(H.a,{exact:!0,path:"".concat(a.path,"/drawing-board"),component:Kn}),o.a.createElement(H.a,{exact:!0,path:"".concat(a.path,"/connection"),component:Xn}),o.a.createElement(U.a,{to:"/error"})))):o.a.createElement(Fe,null):o.a.createElement(U.a,{to:"/"})}}]),t}(r.Component),jr=Object(p.b)(function(e,t){return Object(y.a)({},e,t)})(Ir),xr=a(338),Nr=a(81),Dr=a(62),Ar=a(342),Tr=a(343),Rr=a(119),Pr={COLUMN:"column",TASK:"task"},Mr=a(202),Hr=a(72),Ur=a(65),Br=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onClick=function(){var e=a.props;(0,e.onClick)(e.task.id)};var n=a.props,r=n.tags,o=n.task,i=n.comments,c=n.attachments,l=Object.values(r.byId).filter(function(e){return o.id===e.boardColumnCardId&&!e.deleteStatus});return a.state={allTags:l,comments:Object.values(i.byId).filter(function(e){return o.id===e.boardColumnCardId&&!e.deleteStatus}).length,attachments:Object.values(c.byId).filter(function(e){return o.id===e.boardColumnCardId&&!e.deleteStatus}).length},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.tags,n=t.task;if(a.allIds!==e.tags.allIds){var r=Object.values(a.byId).filter(function(e){return n.id===e.boardColumnCardId&&!e.deleteStatus});this.setState({allTags:r})}}},{key:"render",value:function(){var e=this.props.task,t=this.state,a=t.allTags,n=t.attachments,r=t.comments;return o.a.createElement("div",{id:"id_task_".concat(e.id),className:"task-container",onClick:this.onClick,role:"menuitem",tabIndex:0},o.a.createElement("div",{className:"pc-task-flag"},o.a.createElement("div",{className:"pc-tag-view"},a.map(function(e,t){return o.a.createElement(Mr.a,{className:"pc-tag",key:t,intent:e.tag})})),o.a.createElement("div",{className:"pc-deadline-view"},e.Deadline&&o.a.createElement("p",{className:e.Deadline<new Date?"expire":"no-expire"},pe()(e.Deadline).format("YYYY-MM-DD")))),o.a.createElement("p",{className:"pc-task-name"},e.name),o.a.createElement("div",{className:"task-footer"},r>0&&o.a.createElement("div",{className:"pc-item"},o.a.createElement(Hr.a,{size:"0.9em",className:"pc-icon"}),o.a.createElement("span",{className:"pc-count"},r)),n>0&&o.a.createElement("div",{className:"pc-item"},o.a.createElement(Ur.c,{size:"1em",className:"pc-icon"}),o.a.createElement("span",{className:"pc-count"},n))))}}]),t}(r.Component),Lr=Object(p.b)(function(e){var t=e.database;return{tags:t.BoardColumnCardTag,comments:t.BoardColumnCardComment,attachments:t.BoardColumnCardAttachment}})(Br),Wr=a(255),Vr=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={popOpen:!1},a.handlePopOverForm=function(){var e=a.state.popOpen;e||$n.map(function(e){"name"===e.id&&(e.val="")}),a.setState({popOpen:!e})},a.addNewTask=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d,m;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.columnId,o=n.account,i=n.boardId,c=n.database,s=n.addDatabaseSchema,l=n.api,u=Object.values(c.BoardColumnCard.byId).filter(function(e){return!e.deleteStatus&&e.boardColumnId===r}).sort(st),d=u.length>0?u[u.length-1].position+16384:16384,e.next=5,l.addBoardColumnCard({userId:o.user.id,timeStamp:Date.now(),name:t.name,position:d,boardColumnId:r,broadCastId:"Board-".concat(i)});case 5:if(!(m=e.sent)){e.next=10;break}return s("BoardColumnCard",{id:m,userId:o.user.id,timeStamp:Date.now(),name:t.name,position:d,boardColumnId:r}),a.handlePopOverForm(),e.abrupt("return",{response:200});case 10:return e.abrupt("return",{response:404});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.popOpen;return o.a.createElement("div",null,o.a.createElement(tt,{isOpen:e,onClose:this.handlePopOverForm,callback:this.addNewTask,structure:$n}),o.a.createElement("div",{className:"column-footer",role:"button",tabIndex:0,onKeyDown:this.handlePopOverForm,onClick:this.handlePopOverForm},o.a.createElement(Wr.a,null),"New Task"))}}]),t}(r.Component),zr=Object(p.b)(function(e){return e},Object(y.a)({},n))(Vr),Fr=function(e){var t=Object(r.useRef)(null),a=e.children,n=e.setDraggingContent,i=e.dragStartEnd,c=e.task,s=e.index,l=e.draggableId,u=e.moveTask,d=Object(Ar.a)({accept:Pr.TASK,hover:function(e,a){if(t.current||!a.isOver({shallow:!0})){var n=e.index,r=s;if(n!==r||c.boardColumnId!==e.dropableId){var o=t.current.getBoundingClientRect(),i=o.top+(o.bottom-o.top)/2,l=a.getClientOffset();return c.boardColumnId!==e.dropableId?i>l.y?(u({index:n,dropableId:e.dropableId},{index:r,dropableId:c.boardColumnId},e.draggableId),e.dropableId=c.boardColumnId,void(e.index=r)):i<l.y?(u({index:n,dropableId:e.dropableId},{index:r+1,dropableId:c.boardColumnId},e.draggableId),e.dropableId=c.boardColumnId,void(e.index=r+1)):void(n===r&&(i>l.y?(u({index:n,dropableId:e.dropableId},{index:r,dropableId:c.boardColumnId},e.draggableId),e.dropableId=c.boardColumnId,e.index=r):(u({index:n,dropableId:e.dropableId},{index:r+1,dropableId:c.boardColumnId},e.draggableId),e.dropableId=c.boardColumnId,e.index=r+1))):n>r&&i>l.y?(u({index:n,dropableId:e.dropableId},{index:r,dropableId:c.boardColumnId},e.draggableId),e.dropableId=c.boardColumnId,void(e.index=r)):void(n<r&&i<l.y&&(u({index:n,dropableId:e.dropableId},{index:r,dropableId:c.boardColumnId},e.draggableId),e.dropableId=c.boardColumnId,e.index=r))}}}}),m=Object(Dr.a)(d,2)[1],p=Object(Tr.a)({item:{type:Pr.TASK,id:c.id,draggableId:l,dropableId:c.boardColumnId,index:s},collect:function(e){return{isDragging:e.isDragging()}},isDragging:function(e){return c.id===e.getItem().id},begin:function(e){var t={type:Pr.TASK,id:c.id,draggableId:l,dropableId:c.boardColumnId,index:s};n("start",t),i("start",t,e.getInitialSourceClientOffset(),e.getInitialClientOffset())},end:function(e,t){n("end",e),i("end",e)}}),f=Object(Dr.a)(p,3),v=f[0].isDragging,b=f[1],g=f[2];return Object(r.useEffect)(function(){g(Object(Rr.a)(),{captureDraggingState:!1})},[]),b(m(t)),o.a.createElement("div",{style:{opacity:v?.2:1},ref:t},o.a.cloneElement(a))},qr=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={columnDeletePopOver:!1,id:"",columnEditPopOver:!1},a.onMore=function(){var e=Object(W.a)(L.a.mark(function e(t,n){var r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=a.props.column,"delete"===t&&a.setState({id:n,columnDeletePopOver:!0}),"edit"===t&&($n.map(function(e){"name"===e.id&&(e.val=r.name)}),a.setState({id:n,columnEditPopOver:!0}));case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.deleteColumn=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.api,o=n.deleteDatabaseSchema,i=n.boardId,c=a.state.id,"confirm"!==t){e.next=6;break}return e.next=5,r.deleteBoardColumn({id:c,boardId:i,broadCastId:"Board-".concat(i)});case 5:o("BoardColumn",{id:c});case 6:a.setState({id:"",columnDeletePopOver:!1});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.updateColumnName=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.api,o=n.updateDatabaseSchema,i=n.boardId,c=a.state.id,e.next=4,r.updateBoardColumn([Object(y.a)({},t,{boardId:i,broadCastId:"Board-".concat(i)}),{id:c}]);case 4:return o("BoardColumn",Object(y.a)({id:c},t)),a.setState({id:"",columnEditPopOver:!1}),e.abrupt("return",{response:200});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.closeUpdatePopOver=function(){var e=a.state.columnEditPopOver;a.setState({columnEditPopOver:!e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.column,a=e.columnId,n=e.onTaskClick,r=e.boardId,i=e.moveTask,c=e.handle,s=e.dragStartEnd,l=e.setDraggingContent,u=e.reference,d=e.api,m=this.state,p=m.columnDeletePopOver,f=m.columnEditPopOver;return o.a.createElement("div",{className:"column-inner-container",ref:u},o.a.createElement(tt,{onClose:this.closeUpdatePopOver,callback:this.updateColumnName,isOpen:f,structure:$n}),o.a.createElement(We,{isOpen:p,action:this.deleteColumn,name:t.name}),o.a.createElement("div",{className:"column-title",ref:c},o.a.createElement("div",{className:"text"},t.name),o.a.createElement(rt,{id:a,onMore:this.onMore})),o.a.createElement("div",{className:"task-list"},t.tasks.filter(function(e){return!e.deleteStatus}).map(function(e,t){var a=e;return o.a.createElement(Fr,{dragStartEnd:s,setDraggingContent:l,moveTask:i,index:t,task:a,key:"task".concat(a.id),draggableId:"task".concat(a.id)},o.a.createElement(Lr,{task:a,index:t,onClick:n}))})),o.a.createElement(zr,{api:d,columnId:t.id,boardId:r}))}}]),t}(r.Component),Gr=function(e){var t=Object(r.useRef)(null),a=e.api,n=e.startScroll,i=e.boardId,c=e.xCoor,s=e.dragStartEnd,l=e.setDraggingContent,u=e.addDatabaseSchema,d=e.updateDatabaseSchema,m=e.deleteDatabaseSchema,p=e.onTaskClick,f=e.column,v=e.moveTask,b=e.index,g=e.draggableId,h=e.moveColumns,y=Object(Ar.a)({accept:[Pr.COLUMN,Pr.TASK],hover:function(e,a){if(t.current)if(n(a.getClientOffset()),e.type===Pr.TASK&&a.isOver({shallow:!0}))a.getItem().dropableId!==f.id&&0===f.tasks.filter(function(e){return!e.deleteStatus}).length&&(v({index:e.index,dropableId:e.dropableId},{index:0,dropableId:f.id},e.draggableId),e.dropableId=f.id,e.index=0);else if(e.type===Pr.COLUMN){var r=e.index,o=b;if(r===o)return;var i=t.current.getBoundingClientRect(),s=i.left+(i.right-i.left)/2,l=a.getClientOffset();if(r>o&&s>l.x-c.left)return h(r,o,e.draggableId),void(e.index=o);r<o&&s<l.x+c.right&&(h(r,o,e.draggableId),e.index=o)}}}),C=Object(Dr.a)(y,2)[1],w=Object(Tr.a)({item:{type:Pr.COLUMN,id:f.id,draggableId:g,index:b},collect:function(e){return{isDragging:e.isDragging()}},begin:function(e){var t={type:Pr.COLUMN,id:f.id,draggableId:g,index:b};l("start",t),s("start",t,e.getInitialSourceClientOffset(),e.getInitialClientOffset())},end:function(e,t){l("end",e),s("end",e)}}),E=Object(Dr.a)(w,3),S=E[0],O=(S.coor,S.isDragging),k=E[1],I=E[2];return Object(r.useEffect)(function(){I(Object(Rr.a)(),{captureDraggingState:!1})},[]),C(t),o.a.createElement("div",{className:"column-container",id:"id_column_".concat(f.id),style:{opacity:O?.1:1}},o.a.createElement(qr,{reference:t,handle:k,column:f,columnId:f.id,index:b,dragStartEnd:s,setDraggingContent:l,api:a,moveTask:v,boardId:i,addDatabaseSchema:u,updateDatabaseSchema:d,deleteDatabaseSchema:m,onTaskClick:p}))},Jr=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={popOpen:!1},a.handlePopOverForm=function(){var e=a.state.popOpen;$n.map(function(e){"name"===e.id&&(e.val="")}),a.setState({popOpen:!e})},a.addNewColumn=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.classId,o=n.account,i=n.database,c=n.addDatabaseSchema,s=n.api,l=Object.values(i.BoardColumn.byId).filter(function(e){return!e.deleteStatus&&e.boardId===r}).sort(st),u=l.length>0?l[l.length-1].position+16384:16384,e.next=5,s.addBoardColumn({userId:o.user.id,timeStamp:Date.now(),name:t.name,position:u,boardId:r,broadCastId:"Board-".concat(r)});case 5:if(!(d=e.sent)){e.next=10;break}return c("BoardColumn",{id:d,userId:o.user.id,timeStamp:Date.now(),name:t.name,position:u,boardId:r}),a.handlePopOverForm(),e.abrupt("return",{response:200});case 10:return e.abrupt("return",{response:404});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.popOpen;return o.a.createElement("div",{className:"add-new-column"},o.a.createElement(tt,{isOpen:e,onClose:this.handlePopOverForm,callback:this.addNewColumn,structure:$n}),o.a.createElement("div",{role:"button",tabIndex:0,onKeyDown:this.handlePopOverForm,className:"title",onClick:this.handlePopOverForm},o.a.createElement($t.f,null),o.a.createElement("span",null,"New Column")))}}]),t}(r.Component);Jr.defaultProps={classId:""};var Yr=Object(p.b)(function(e){return e},Object(y.a)({},n))(Jr),Kr=function(e){var t=e.comment,a=/(\s@\w+\s)|(^@\w+\s)|(^@\w+$)|(\s@\w+$)/,n=t.split(a);return o.a.createElement("div",null,n.map(function(e,t){return e&&e.match(a)?o.a.createElement("span",{key:t,style:{fontWeight:"bold",color:"rgba(19, 124, 189, 1)"}},e):e}))},Qr=a(49),_r=function(e){var t=e.activity,a=e.userList,n=e.userDetailList,r=e.color,i=e.columns,c=a.byId[t.userId],s=Object.values(n.byId).find(function(e){return e.userId===c.id}),l=s&&s.image?"".concat(oe,"/user/").concat(1e7+parseInt(c.id,10),"/profile/").concat(s.image):Qr,u=c.middleName?"".concat(c.firstName," ").concat(c.middleName," ").concat(c.lastName):"".concat(c.firstName," ").concat(c.lastName);switch(t.message){case"createCard":return o.a.createElement("div",{className:"pc-task-activity",style:{backgroundColor:r}},o.a.createElement("div",{className:"img-con"},o.a.createElement(it,{imgUrl:l})),o.a.createElement("div",{className:"activity-detail"},o.a.createElement("div",null,o.a.createElement("span",{className:"activity-user"},u)," ","created this card"),o.a.createElement("div",null,o.a.createElement("small",{style:{opacity:.8}},new Date(t.timeStamp).toDateString()))));case"outsideColumn":var d=i.byId[t.tColId],m=i.byId[t.fColId];return o.a.createElement("div",{className:"pc-task-activity",style:{backgroundColor:r}},o.a.createElement("div",{className:"img-con"},o.a.createElement(it,{imgUrl:l})),o.a.createElement("div",{className:"activity-detail"},o.a.createElement("div",null,o.a.createElement("span",{className:"activity-user"},u)," ","moved this card from"," ",o.a.createElement("span",{className:"activity-col"},m.name)," ","to"," ",o.a.createElement("span",{className:"activity-col"},d.name)," "),o.a.createElement("div",null,o.a.createElement("small",{style:{opacity:.8}},new Date(t.timeStamp).toDateString()))));default:return o.a.createElement("div",null)}},Zr=a(49),Xr=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={deletePopover:!1,editCommentId:null,comment:"",activeComment:{}},a.editComment=function(e){a.setState({editCommentId:e.id,comment:e.comment})},a.commentChange=function(e){a.setState({comment:e.target.value})},a.saveComment=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state,n=t.editCommentId,r=t.comment,o=a.props,i=o.apis,c=o.updateDatabaseSchema,e.next=4,i.updateBoardColumnCardComment([{comment:r},{id:n}]);case 4:c("BoardColumnCardComment",{comment:r,id:n}),a.setState({editCommentId:null});case 6:case"end":return e.stop()}},e)})),a.replyComment=function(e){var t=a.props,n=t.commentReply,r=t.userList,o="Anonymous";Object.values(r.byId).map(function(t){t.id===e.userId&&(o=t.firstName)}),n("@".concat(o," "))},a.togglePopover=function(e){a.setState({deletePopover:!0,activeComment:e})},a.deleteComment=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.apis,o=n.boardId,i=n.deleteDatabaseSchema,c=a.state.activeComment,"confirm"!==t){e.next=6;break}return e.next=5,r.deleteBoardColumnCardComment({id:c.id,cardId:c.boardColumnCardId,broadCastId:"Board-".concat(o)});case 5:i("BoardColumnCardComment",{id:c.id});case 6:a.setState({deletePopover:!1,activeComment:{}});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.getCommentUser=function(e){var t=a.props,n=t.userList,r=t.userDetailList;return{user:Object.values(n.byId).find(function(t){return t.id===e.userId}),userDetail:Object.values(r.byId).find(function(t){return t.userId===e.userId})}},a.getHistory=function(e,t){var n=a.props,r=n.account,i=n.userList,c=n.userDetailList,s=n.columns,l=a.state,u=l.editCommentId,d=l.comment;if(e.message)return o.a.createElement(_r,{color:t,userList:i,userDetailList:c,columns:s,key:"activity".concat(e.id),activity:e});var m=a.getCommentUser(e),p=m.user.middleName?"".concat(m.user.firstName," ").concat(m.user.middleName," ").concat(m.user.lastName):"".concat(m.user.firstName," ").concat(m.user.lastName),f=m.userDetail&&m.userDetail.image?"".concat(oe,"/user/").concat(1e7+parseInt(m.user.id,10),"/profile/").concat(m.userDetail.image):Zr;return o.a.createElement("div",{className:"s-comment",style:{backgroundColor:t},key:e.id},o.a.createElement("div",{className:"img-con"},o.a.createElement(it,{imgUrl:f})),o.a.createElement("div",{className:"com-con"},o.a.createElement("div",{className:"com-auth"},o.a.createElement("span",{style:{fontSize:"16px",fontWeight:"bold"}},p),o.a.createElement("small",{style:{opacity:.8}}," ",new Date(e.timeStamp).toDateString())),o.a.createElement("div",{className:"com-desc"},u!==e.id?o.a.createElement(Kr,{comment:e.comment}):o.a.createElement("div",{className:"pc-comment-edit"},o.a.createElement(Te.a,{fill:!0,small:!0,style:{fontSize:16,padding:"2px"},placeholder:"Put your comments.",value:d,onChange:function(e){return a.commentChange(e)}}),o.a.createElement(ve.b,{icon:"tick",style:{margin:"0px 5px"},onClick:a.saveComment,intent:"success"}),o.a.createElement(ve.b,{icon:"cross",onClick:function(){return a.setState({editCommentId:null})}}))),u!==e.id&&o.a.createElement("div",{className:"com-config"},r.user.id===e.userId?o.a.createElement("div",null,o.a.createElement("small",{className:"primary",role:"menu",tabIndex:"0",onKeyDown:function(){return!1},onClick:function(){return a.editComment(e)}},o.a.createElement("u",null,"Edit")),o.a.createElement("small",{className:"danger",role:"menu",tabIndex:"0",onKeyDown:function(){return!1},onClick:function(){return a.togglePopover(e)}},o.a.createElement("u",null,"Delete"))):o.a.createElement("small",{className:"primary",role:"menu",tabIndex:"0",onKeyDown:function(){return!1},onClick:function(){return a.replyComment(e)}},o.a.createElement("u",null,"Reply")))))},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.comments,a=this.state.deletePopover;return o.a.createElement("div",{className:"comments"},o.a.createElement(We,{isOpen:a,name:"Comment",action:this.deleteComment}),o.a.createElement("h3",null,"History"),t.sort(lt).map(function(t,a){return e.getHistory(t,a%2===0?"#f9f9f9":"#fff")}))}}]),t}(o.a.Component),$r=[{id:"name",fieldtype:"input",name:"Name",required:!0,placeholder:"Title"},{id:"attachment",fieldtype:"image",name:"Attachment"},{id:"submit",fieldtype:"button",text:"Upload",fill:"fill",intent:"success",large:"large"}],eo=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.uploadAttachment=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l,u,d,m;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.attachment){e.next=2;break}return e.abrupt("return",{response:400,error:"Choose a file"});case 2:return n=a.props,r=n.account,o=n.apis,i=n.addDatabaseSchema,c=n.boardId,s=n.task,e.prev=3,(l=new FormData).append("data",JSON.stringify({token:r.sessionId,fileType:t.attachment.type.split("/")[0],content:"board"})),l.append("file",t.attachment),e.next=9,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:l});case 9:if(200!==(u=e.sent).status){e.next=16;break}return d={userId:r.user.id,timeStamp:Date.now(),name:t.name,boardColumnCardId:s.id,url:u.data},e.next=14,o.addBoardColumnCardAttachment(Object(y.a)({},d,{broadCastId:"Board-".concat(c)}));case 14:m=e.sent,i("BoardColumnCardAttachment",Object(y.a)({},d,{id:m}));case 16:return e.abrupt("return",{response:200,message:"Uploaded"});case 19:return e.prev=19,e.t0=e.catch(3),e.abrupt("return",{response:400,error:"Network issues"});case 22:case"end":return e.stop()}},e,null,[[3,19]])}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{style:{padding:"5px",minWidth:"300px"}},o.a.createElement(Le,{callback:this.uploadAttachment,data:$r}))}}]),t}(o.a.Component),to=function(e){var t=e.obj,a=e.user,n=e.getName,r=e.deleteAttachment,i=n(t.userId),c="".concat(oe,"/user/").concat(1e7+parseInt(t.userId,10),"/board/").concat(t.url);return o.a.createElement("li",null,o.a.createElement("div",{className:"file-type"},o.a.createElement("span",null,t.url.split(".")[1]),o.a.createElement(X.a,{iconSize:11,style:{cursor:"pointer"},icon:"cross",className:"pc-attach-delete",onClick:function(){return r(t.id,t.url)}})),o.a.createElement("div",{className:"file-detail"},o.a.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:c,className:"attach-title"},t.name),o.a.createElement("div",null,o.a.createElement("span",{className:"date"},pe()(t.timeStamp).format("DD-MM-YYYY"))," - ",o.a.createElement(K.a,{to:"/user/".concat(a.slug)},i))))},ao=function(e){var t=e.attachments,a=e.Users,n=e.getName,r=e.deleteAttachment;return o.a.createElement("div",{className:"attach-container"},0!==t.length&&o.a.createElement("div",{className:"attach-head"},"Attachments"),o.a.createElement("div",{className:"attach-list"},o.a.createElement("ul",null,t.map(function(e){return o.a.createElement(to,{user:a.byId[e.userId],getName:n,deleteAttachment:r,obj:e,key:e.id})}))))},no=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onClassChange=function(e){var t=a.props.database,n=[];Object.values(t.BoardColumn.byId).map(function(t){t.boardId===parseInt(e.target.value,10)&&n.push(t)}),a.setState({classVal:e.target.value,colOptions:n.map(function(e){return{label:e.name.substring(0,50),value:e.id}}),colVal:n[0]&&n[0].id})},a.onTaskChange=function(e){a.setState({colVal:e.target.value})},a.submitForm=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.callback,n=a.state,r=n.colVal,o=n.classVal,a.setState({loading:!0}),e.next=5,t({column:r,class:o});case 5:200===(i=e.sent).response?a.setState({loading:!1,message:i.message}):a.setState({loading:!1,error:i.error});case 7:case"end":return e.stop()}},e)}));var n=a.props.database,r=Object.values(n.Board.byId),o=[];return Object.values(n.BoardColumn.byId).map(function(e){e.boardId===r[0].id&&o.push(e)}),a.state={error:null,message:null,loading:!1,classVal:r[0].id,classeOptions:r.map(function(e){return{label:e.name.substring(0,50),value:e.id}}),colOptions:o.map(function(e){return{label:e.name.substring(0,50),value:e.id}}),colVal:o[0]&&o[0].id},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state,t=e.classeOptions,a=e.colOptions,n=e.colVal,r=e.classVal,i=e.error,c=e.loading,s=e.message;return o.a.createElement("div",{style:{padding:"10px"}},o.a.createElement("div",{style:{padding:"5px"}},o.a.createElement("span",{style:{fontSize:"18px",fontWeight:"bold"}},"Choose a Target Column")),o.a.createElement("div",{style:{display:"flex",flexDirection:"column"}},o.a.createElement("div",{style:{padding:"10px"}},o.a.createElement("p",{style:{fontSize:"16px"}},"Class"),o.a.createElement(Ie.a,{options:t,onChange:this.onClassChange,value:r})),o.a.createElement("div",{style:{padding:"10px",marginBottom:"10px"}},o.a.createElement("p",{style:{fontSize:"16px"}},"Column"),o.a.createElement(Ie.a,{options:a,onChange:this.onTaskChange,value:n})),o.a.createElement("div",{className:"btn-group"},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",flexWrap:"wrap",alignItems:"center"}},c&&o.a.createElement(zn.a,{intent:"primary",size:40}),i&&o.a.createElement(he.c,{style:{fontSize:16,color:"red"}},i),s&&o.a.createElement(he.c,{style:{fontSize:16,color:"green"}},s)),o.a.createElement(ve.b,{text:"Submit",onClick:this.submitForm,intent:"primary",large:!0,fill:!0}))))}}]),t}(o.a.Component),ro=function(e){var t=e.tags,a=e.addTag;return o.a.createElement("div",{style:{padding:"5px",minWidth:"250px"}},o.a.createElement("div",{style:{padding:"5px",textAlign:"center",fontSize:"15px",fontWeight:"bold"}},o.a.createElement("span",null,"Select Tags")),o.a.createElement("div",null,["primary","warning","success","danger"].map(function(e,n){var r=!1;return t.map(function(t){t.tag===e&&(r=!0)}),o.a.createElement(Mr.a,{key:n,onClick:function(){return a(e,r)},fill:!0,large:!0,intent:e,interactive:!0,style:{margin:"5px 0px"},icon:r?"tick":null})})))},oo=function(e){var t=e.callback;return o.a.createElement("div",{style:{padding:"5px",minWidth:"300px"}},o.a.createElement(Le,{callback:t,data:[{id:"deadline",fieldtype:"date",name:"Deadline"},{id:"submit",fieldtype:"button",type:"submit",text:"ADD",fill:"fill",intent:"success",large:"large"}]}))},io=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={deleteCardPopover:!1},a.uploadDeadLine=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.task,i=n.updateDatabaseSchema,c=n.boardId,s=new Date(t.deadline).getTime(),e.next=4,r.updateBoardColumnCard([{Deadline:s,broadCastId:"Board-".concat(c)},{id:o.id}]);case 4:return i("BoardColumnCard",{id:o.id,Deadline:s}),e.abrupt("return",{response:200,message:"Deadline added"});case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.copyCard=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.account,i=n.description,c=n.attachments,s=n.task,l=n.tags,e.prev=1,e.next=4,r.copyBoardColumnCard({card:Object(y.a)({},s,{userId:o.user.id,timeStamp:Date.now()}),description:Object(y.a)({},i,{userId:o.user.id,timeStamp:Date.now()}),attachments:c.map(function(e){return Object(y.a)({},e,{userId:o.user.id,timeStamp:Date.now()})}),tags:l.map(function(e){return Object(y.a)({},e,{userId:o.user.id})}),boardId:t.class,columnId:t.column});case 4:return e.abrupt("return",{response:200,message:"Copied!"});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{response:400,error:"Could not copy"});case 10:case"end":return e.stop()}},e,null,[[1,7]])}));return function(t){return e.apply(this,arguments)}}(),a.addTag=function(){var e=Object(W.a)(L.a.mark(function e(t,n){var r,o,i,c,s,l,u,d,m,p;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.props,o=r.task,i=r.apis,c=r.tags,s=r.addDatabaseSchema,l=r.deleteDatabaseSchema,u=r.account,d=r.boardId,!n){e.next=7;break}return c.map(function(e){e.tag===t&&(m=e)}),e.next=5,i.deleteBoardColumnCardTag({broadCastId:"Board-".concat(d),id:m.id,cardId:o.id});case 5:return l("BoardColumnCardTag",{id:m.id}),e.abrupt("return");case 7:return e.next=9,i.addBoardColumnCardTag({broadCastId:"Board-".concat(d),userId:u.user.id,boardColumnCardId:o.id,tag:t});case 9:p=e.sent,s("BoardColumnCardTag",{id:p,userId:u.user.id,tag:t,boardColumnCardId:o.id});case 11:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.deleteCard=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.apis,o=n.deleteDatabaseSchema,i=n.boardId,c=n.task,s=n.onClose,"confirm"!==t){e.next=9;break}return a.toggleDeleteCard(),e.next=5,r.deleteBoardColumnCard({id:c.id,broadCastId:"Board-".concat(i)});case 5:o("BoardColumnCard",{id:c.id}),s(),e.next=10;break;case 9:a.toggleDeleteCard();case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.toggleDeleteCard=function(){var e=a.state.deleteCardPopover;a.setState({deleteCardPopover:!e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.deleteCardPopover,t=this.props,a=t.task,n=t.tags,r=t.addDatabaseSchema,i=t.apis,c=t.account,s=t.boardId,l=t.database;return o.a.createElement("div",{className:"right"},o.a.createElement("div",{className:"rt-in"},o.a.createElement("div",{className:"tool-header"},"Tools"),o.a.createElement("div",{className:"rt-tools"},o.a.createElement(at.a,{content:o.a.createElement(ro,{addTag:this.addTag,tags:n}),position:"left-top"},o.a.createElement(ve.b,{alignText:"left",icon:"tag",text:"Tag"})),o.a.createElement(at.a,{content:o.a.createElement(oo,{callback:this.uploadDeadLine}),position:"left-top"},o.a.createElement(ve.b,{alignText:"left",icon:"outdated",text:"Deadline"})),o.a.createElement(at.a,{content:o.a.createElement(eo,{boardId:s,account:c,task:a,apis:i,addDatabaseSchema:r}),position:"left-top"},o.a.createElement(ve.b,{alignText:"left",icon:"paperclip",text:"Attachment"}))),o.a.createElement("div",{className:"tool-header"},"Actions"),o.a.createElement("div",{className:"rt-actions"},o.a.createElement(at.a,{content:o.a.createElement(no,{callback:this.copyCard,database:l})},o.a.createElement(ve.b,{alignText:"left",icon:"move",text:"Copy"})),o.a.createElement(ve.b,{alignText:"left",icon:"trash",text:"delete",onClick:this.toggleDeleteCard}),o.a.createElement(We,{isOpen:e,action:this.deleteCard,name:a.name}))))}}]),t}(o.a.Component),co=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.commentChange=function(e){(0,a.props.writeComment)(e.target.value)},a.saveComment=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.props,n=t.apis,r=t.writeComment,o=t.task,i=t.account,c=t.boardId,s=t.addDatabaseSchema,0!==(l=t.comment).replace(/\s/g,"").length){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,n.addBoardColumnCardComment({boardColumnCardId:o.id,comment:l,timeStamp:Date.now(),userId:i.user.id,broadCastId:"Board-".concat(c)});case 5:u=e.sent,s("BoardColumnCardComment",{id:u,boardColumnCardId:o.id,comment:l,timeStamp:Date.now(),userId:i.user.id}),r("");case 8:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.comment;return o.a.createElement("div",{className:"comment-container"},o.a.createElement(Te.a,{fill:!0,placeholder:"Comment...",value:t,onChange:function(t){return e.commentChange(t)}}),o.a.createElement(ve.b,{text:"submit",intent:"primary",onClick:this.saveComment}))}}]),t}(o.a.Component),so=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={editHead:!1,editDesc:!1,loading:!0,task:{},comments:[],description:{},attachments:[],tags:[],title:"",desc:"",comment:"",activities:[]},a.onClose=function(){var e=a.props;(0,e.onClose)(e.taskId),a.setState({editHead:!1,loading:!0,editDesc:!1})},a.toggleElemTitle=function(){var e=a.state.editHead;a.setState({editHead:!e})},a.titleChange=function(e){a.setState({title:e.target.value})},a.saveTitle=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.apis,r=t.boardId,o=t.updateDatabaseSchema,i=a.state,c=i.task,s=i.title,e.next=4,n.updateBoardColumnCard([{name:s,broadCastId:"Board-".concat(r)},{id:c.id}]);case 4:o("BoardColumnCard",{id:c.id,name:s}),a.toggleElemTitle();case 6:case"end":return e.stop()}},e)})),a.toggleElemDesc=function(){var e=a.state.editDesc;a.setState({editDesc:!e})},a.descChange=function(e){a.setState({desc:e.target.value})},a.saveDesc=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.apis,r=t.account,o=t.boardId,i=t.addDatabaseSchema,c=a.state,s=c.task,l=c.desc,e.next=4,n.addBoardColumnCardDescription({boardColumnCardId:s.id,title:l,timeStamp:Date.now(),userId:r.user.id,broadCastId:"Board-".concat(o)});case 4:u=e.sent,i("BoardColumnCardDescription",{boardColumnCardId:s.id,title:l,timeStamp:Date.now(),userId:r.user.id,id:u}),a.toggleElemDesc();case 7:case"end":return e.stop()}},e)})),a.getName=function(e){var t=a.props.userList.byId[e];return t.middleName?"".concat(t.firstName," ").concat(t.middleName," ").concat(t.lastName):"".concat(t.firstName," ").concat(t.lastName)},a.deleteAttachment=function(){var e=Object(W.a)(L.a.mark(function e(t,n){var r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.state.task,o=a.props,i=o.apis,c=o.deleteDatabaseSchema,s=o.account,l=o.boardId,e.prev=2,e.next=5,Y.a.post("".concat(oe,"/web/delete-file"),{token:s.sessionId,content:"board",fileName:n});case 5:return e.next=7,i.deleteBoardColumnCardAttachment({id:t,broadCastId:"Board-".concat(l),cardId:r.id});case 7:c("BoardColumnCardAttachment",{id:t}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),console.log("Error");case 13:case"end":return e.stop()}},e,null,[[2,10]])}));return function(t,a){return e.apply(this,arguments)}}(),a.writeComment=function(e){a.setState({comment:e})},a.getCardActivity=Object(W.a)(L.a.mark(function e(){var t,n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.apis,n=a.state.task,e.next=4,t.getCardActivity({cardId:n.id});case 4:r=e.sent,a.setState({loading:!1,activities:r.cardActivities.filter(function(e){return"createCard"===e.message||"outsideColumn"===e.message})});case 6:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.taskId,a=e.database,n=Object.values(a.BoardColumnCard.byId).find(function(e){return e.id===t});if(n){var r=Object.values(a.BoardColumnCardComment.byId).filter(function(e){return t===e.boardColumnCardId&&!e.deleteStatus}).sort(lt),o=Object.values(a.BoardColumnCardAttachment.byId).filter(function(e){return t===e.boardColumnCardId&&!e.deleteStatus}).sort(lt),i=Object.values(a.BoardColumnCardDescription.byId).filter(function(e){return t===e.boardColumnCardId}).sort(lt)[0],c=Object.values(a.BoardColumnCardTag.byId).filter(function(e){return t===e.boardColumnCardId&&!e.deleteStatus}),s=i?i.title:"";this.setState({comments:r,attachments:o,tags:c,description:i,title:n.name,desc:s,task:n})}else this.setState({loading:!0})}},{key:"render",value:function(){var e=this,t=this.state,a=t.editHead,n=t.editDesc,r=t.task,i=t.comments,c=t.attachments,s=t.title,l=t.description,u=t.desc,d=t.tags,m=t.comment,p=t.activities,f=t.loading,v=this.props,b=v.userList,h=v.apis,y=v.boardId,C=v.onClose,w=v.deleteDatabaseSchema,E=v.updateDatabaseSchema,S=v.addDatabaseSchema,O=v.account,k=v.isOpen,I=v.database;return o.a.createElement(fe.a,{isOpen:k,onClose:this.onClose,onOpening:this.getCardActivity,className:"overlay-container",style:{width:"800px"}},f?o.a.createElement(Fe,null):o.a.createElement("div",{className:"task-detail-overlay"},o.a.createElement("div",{className:"overlay-title"},o.a.createElement("div",{className:"head"},a?o.a.createElement(Te.a,{value:s,onChange:function(t){return e.titleChange(t)}}):o.a.createElement("span",{className:"title"},r.name),a?o.a.createElement("div",{className:"buttons-group"},o.a.createElement(ve.b,{icon:"tick",intent:"success",onClick:this.saveTitle}),o.a.createElement(ve.b,{icon:"cross",onClick:this.toggleElemTitle})):o.a.createElement("div",{className:"buttons-group"},o.a.createElement(X.a,{className:"edit-title",icon:"edit",onClick:this.toggleElemTitle}))),o.a.createElement(ve.b,{icon:"cross",className:"task-close",minimal:!0,onClick:this.onClose})),o.a.createElement("div",{className:"overlay-body"},o.a.createElement("div",{className:"left"},o.a.createElement("div",{className:"pc-tags-and-deadline"},o.a.createElement("div",{className:"pc-tag-view"},d.map(function(e){return o.a.createElement(Mr.a,{className:"tag",key:e.id,large:!0,intent:e.tag})})),o.a.createElement("div",{className:"pc-deadline-view"},r.Deadline?o.a.createElement("p",{className:r.Deadline<new Date?"expire":"no-expire"},"Deadline: ".concat(pe()(r.Deadline).format("YYYY-MM-DD"))):" ")),o.a.createElement("div",{className:"overlay-description"},o.a.createElement("div",{className:"desc-head"},o.a.createElement("span",null,"Description"),n?o.a.createElement("span",{className:"buttons-group"},o.a.createElement(ve.b,{icon:"tick",onClick:this.saveDesc,intent:"success",small:!0,className:"edit-button"}),o.a.createElement(ve.b,{icon:"cross",onClick:this.toggleElemDesc,small:!0,className:"edit-button"})):o.a.createElement(X.a,{icon:"edit",onClick:this.toggleElemDesc,className:"edit-button"})),o.a.createElement("div",{className:"desc"},n?o.a.createElement(Te.a,{value:u,onChange:this.descChange}):o.a.createElement("span",null,l&&l.title))),o.a.createElement(ao,{attachments:c,getName:this.getName,Users:I.User,deleteAttachment:this.deleteAttachment}),o.a.createElement(co,{apis:h,addDatabaseSchema:S,account:O,boardId:y,task:r,writeComment:this.writeComment,comment:m}),o.a.createElement(Xr,{comments:[].concat(Object(g.a)(i),Object(g.a)(p)),account:O,apis:h,userList:b,userDetailList:I.UserDetail,columns:I.BoardColumn,commentReply:this.writeComment,boardId:y,deleteDatabaseSchema:w,updateDatabaseSchema:E})),o.a.createElement(io,{tags:d,onClose:C,boardId:y,task:r,apis:h,account:O,database:I,description:l,attachments:c,deleteDatabaseSchema:w,updateDatabaseSchema:E,addDatabaseSchema:S}))))}}]),t}(r.Component);so.defaultProps={taskId:null};var lo=Object(p.b)(function(e){var t=e.database,a=e.account;return{userList:t.User,account:a,database:t}})(so),uo=a(336),mo=a(280),po=function(e){var t=e.detail;return o.a.createElement("div",{style:{padding:"10px 5px 5px 5px"}},o.a.createElement("div",{style:{padding:"2px"}},o.a.createElement(K.a,{to:"/user/".concat(t.slug)},t.middleName?"".concat(t.firstName," ").concat(t.middleName," ").concat(t.lastName):"".concat(t.firstName," ").concat(t.lastName))))},fo=function(e){var t=e.userList,a=e.extUser,n=e.boardMembers,r=e.boardId,i=e.apis,c=e.account;return o.a.createElement("div",{className:"all-users"},o.a.createElement("div",{className:"header"},"Members"),o.a.createElement("div",{className:"user-con"},Object.values(n.byId).filter(function(e){return e.boardId===r}).filter(function(e){return!e.deleteStatus&&e.tuserId!==c.user.id}).map(function(e){return o.a.createElement("div",{className:"user",key:"user-".concat(e.id)},o.a.createElement(K.a,{to:"/user/".concat(t.byId[e.tuserId].slug)},ct(t.byId[e.tuserId])),t.byId[e.tuserId].activeStatus&&o.a.createElement("span",{className:"active"}),a&&"mentor"===a.type&&o.a.createElement("div",{className:"remover"},o.a.createElement($t.c,{onClick:function(){return function(e,t){try{t.deleteBoardMember({boardId:e.boardId,userId:e.tuserId,id:e.id})}catch(a){console.error("Error in delete class member",a)}}(e,i)}})))})))},vo=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.getSmallList=function(){var e=a.props,t=e.boardId,n=e.boardMembers,r=e.userList;return Object.values(n.byId).filter(function(e){return e.boardId===t}).slice(0,4).filter(function(e){return!e.deleteStatus}).map(function(e,t){return o.a.createElement(at.a,{position:"bottom",content:o.a.createElement(po,{detail:r.byId[e.tuserId]}),key:t},o.a.createElement("div",{className:"i-user"},r.byId[e.tuserId].firstName[0],r.byId[e.tuserId].lastName[0],r.byId[e.tuserId].activeStatus&&o.a.createElement("span",{className:"green-dot"})))})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.userList,a=e.boardMembers,n=e.boardId,r=e.extUser,i=e.apis,c=e.account;return o.a.createElement("div",{className:"each-item user-list"},this.getSmallList(),o.a.createElement(at.a,{position:"right-top",content:o.a.createElement(fo,{userList:t,boardMembers:a,boardId:n,apis:i,account:c,extUser:r})},o.a.createElement("div",{className:"i-user"},o.a.createElement(ga.c,{size:18}))))}}]),t}(o.a.Component),bo=[{id:"user",fieldtype:"select",options:[{label:"---",value:""}],required:!0,name:"Add new member"},{id:"submit",fieldtype:"button",text:"Send Request",fill:"fill",intent:"success",large:"large"}],go=function(e){var t=e.callback;return o.a.createElement("div",{style:{padding:"5px",minWidth:"300px"}},o.a.createElement(Le,{data:bo,callback:t}))},ho=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.addUserToBoardHandler=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.apis,o=n.boardId,i=n.account,c={userId:t.user,joinStatus:!0,userType:"normal",fuserId:i.user.id,boardId:o,timeStamp:Date.now()},e.prev=2,e.next=5,r.addBoardMember(c);case 5:if(200!==(s=e.sent).status){e.next=8;break}return e.abrupt("return",{response:200,message:"Congratulations! You have added a new user"});case 8:return e.abrupt("return",{response:201,error:s.message});case 11:return e.prev=11,e.t0=e.catch(2),e.abrupt("return",{response:400,error:"Network Error"});case 14:case"end":return e.stop()}},e,null,[[2,11]])}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.connections,a=e.users,n=e.account.user.id;bo.map(function(e){return"user"===e.id&&(e.options=[{label:"---",value:""}].concat(Object(g.a)(t.map(function(e){return{label:ct(a[n===e.mId?e.userId:e.mId]),value:n===e.mId?e.userId:e.mId}})))),e})}},{key:"render",value:function(){return o.a.createElement(at.a,{content:o.a.createElement(go,{callback:this.addUserToBoardHandler})},o.a.createElement("div",{className:"add-user-btn"},o.a.createElement(Hr.c,{size:20})))}}]),t}(o.a.Component),yo=function(e,t){for(var a=e.toDataURL({format:"jpeg",quality:1}).split(","),n=a[0].match(/:(.*?);/)[1],r=window.atob(a[1]),o=r.length,i=new Uint8Array(o);o;)i[o-=1]=r.charCodeAt(o);return new File([i],t,{type:n})},Co=function(){var e=Object(W.a)(L.a.mark(function e(t,a){var n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(n=new FormData).append("data",JSON.stringify({token:a.sessionId,fileType:"image",content:"report"})),n.append("file",t),e.next=6,Y()({config:{headers:{"Content-Type":"multipart/form-data"}},method:"post",url:"".concat(oe,"/web/upload-file"),data:n});case 6:if(200!==(r=e.sent).status){e.next=9;break}return e.abrupt("return",r.data);case 9:return e.abrupt("return",!1);case 12:return e.prev=12,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,null,[[0,12]])}));return function(t,a){return e.apply(this,arguments)}}(),wo=function(){var e=Object(W.a)(L.a.mark(function e(t){var a,n,r,o,i,c,s,l,u,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=t.account,n=t.apis,r=t.boardDetail,o=t.tableData,i=["BoarActivityBarChart.jpeg","BoardActivityLineChart.jpeg","CommunicationActivityBarChart.jpeg","CommunicationActivityLineChart.jpeg"],c=["board-activity-bar-chart","board-activity-line-chart","communication-activity-bar-chart","communication-activity-line-chart"].map(function(e){return document.getElementById(e)}),console.log("canvas elements",c),s=c.filter(function(e){return e}).map(function(e,t){return yo(e,i[t])}),l=s.map(function(e){return Co(e,a)}),e.next=10,Promise.all(l);case 10:return u=e.sent,console.log("posted image res",u),e.next=14,n.generateReport({allImages:u,boardDetail:r,tableData:o});case 14:return d=e.sent,e.abrupt("return",{images:u,pdf:d});case 18:e.prev=18,e.t0=e.catch(0),console.log("Error in capturing canvas",e.t0);case 21:case"end":return e.stop()}},e,null,[[0,18]])}));return function(t){return e.apply(this,arguments)}}(),Eo=a(335),So=a(120),Oo=a.n(So),ko=["#e6194b","#3cb44b","#ffe119","#4363d8","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#fabebe","#008080","#e6beff","#9a6324","#fffac8","#800000","#aaffc3","#808000","#ffd8b1","#000075","#808080","#000000"],Io=function(e,t,a,n,r,o,i){return new Oo.a(i,{type:"horizontalBar",data:{labels:e,datasets:[{label:t,data:a,backgroundColor:e.map(function(e,t){return ko[t]}),borderColor:e.map(function(e,t){return ko[t]}),borderWidth:1}]},options:{responsive:!0,title:{display:!0,text:n},scales:{yAxes:[{display:!0,scaleLabel:{display:!0,labelString:r},ticks:{beginAtZero:!0}}],xAxes:[{display:!0,scaleLabel:{display:!0,labelString:o},ticks:{beginAtZero:!0}}]}}})},jo=function(e,t,a){var n=e.map(function(e){return e.firstName});return Io(n,"Class Activities",t,"Class Activities Bar Chart","User List","No of Class Activities",a)},xo=a(121),No=a(53),Do=a(334),Ao=a(348),To=a(309),Ro=a(124),Po=function(e,t){return e.map(function(e){return e.filter(function(e){return e.userId===t})}).map(function(e){return e.length})},Mo=function(e,t){if(console.log("allFormater value",e),e.length>0){var a=e[0].timeStamp,n=[],r=[],o=0;e.forEach(function(e){t(new Date(a),new Date(e.timeStamp))?r.push(Object(y.a)({},e,{sameValue:o})):(o+=1,r.push(Object(y.a)({},e,{sameValue:o})),a=e.timeStamp)});for(var i=function(e){n.push(r.filter(function(t){return t.sameValue===e}))},c=0;c<=o;c+=1)i(c);return n}return e},Ho=function(e,t){for(var a=[],n=t(new Date(Date.now()),new Date(e[0].timeStamp)),r=1;r<=n+1;r+=1)a.push(r);return a},Uo=function(e,t,a,n,r){var o,i;switch(r){case"Week":o=Mo(n,Ro.a),i=Ho(n,Do.a);break;case"Month":o=Mo(n,xo.a),i=Ho(n,Ao.a);break;default:o=Mo(n,No.a),i=Ho(n,To.a)}var c=e.map(function(e,t){return{label:e.firstName,backgroundColor:ko[t],borderColor:ko[t],data:Po(o,e.id),fill:!1}});return Bo(i,"Communication Activities","Communication Activities","No of Days",c,a)},Bo=function(e,t,a,n,r,o){return new Oo.a(o,{type:"line",data:{labels:e,datasets:r},options:{responsive:!0,title:{display:!0,text:t},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{yAxes:[{display:!0,scaleLabel:{display:!0,labelString:a},ticks:{beginAtZero:!0}}],xAxes:[{display:!0,scaleLabel:{display:!0,labelString:n},ticks:{beginAtZero:!0}}]}}})},Lo=function(e,t){for(var a=[],n=t(new Date(Date.now()),new Date(e[0].timeStamp)),r=1;r<=n+1;r+=1)a.push(r);return a},Wo=function(e,t,a,n,r){var o,i;switch(r){case"Week":o=Mo(n,Ro.a),i=Lo(n,Do.a);break;case"Month":o=Mo(n,xo.a),i=Lo(n,Ao.a);break;default:o=Mo(n,No.a),i=Lo(n,To.a)}var c=e.map(function(e,t){return{label:e.firstName,backgroundColor:ko[t],borderColor:ko[t],data:Po(o,e.id),fill:!1}});return Bo(i,"Class Activities Chart","Activities","No Of Days",c,a)},Vo=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={timelineValue:"Day",myBarChart:null,myLineChart:null},a.drawChart=function(e){var t=document.getElementById("board-activity-bar-chart"),n=document.getElementById("board-activity-line-chart"),r=a.props,o=r.boardActivities,i=r.userList,c=r.users,s=[];i.forEach(function(e){var t=o.filter(function(t){return t.userId===e.tuserId});s.push(t)});var l=i.map(function(e){return Object.values(c.byId).find(function(t){return t.id===e.tuserId})}),u=s.map(function(e){return e.length}),d=jo(l,u,t),m=Wo(l,s,n,o,e);a.setState({myLineChart:m,myBarChart:d})},a.timelineChange=function(e){var t=a.state,n=t.myBarChart,r=t.myLineChart;a.setState({timelineValue:e.target.value}),n&&(n.destroy(),r.destroy()),a.drawChart(e.target.value)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.timelineValue;this.drawChart(e)}},{key:"render",value:function(){var e=this.state.timelineValue;return o.a.createElement("div",{className:"pc-canvases"},o.a.createElement("div",{className:"pc-canvas-con"},o.a.createElement("canvas",{id:"board-activity-bar-chart",width:400,height:400})),o.a.createElement("div",{className:"pc-graph-timeline"},o.a.createElement("h3",null,"Select a timeline: "),o.a.createElement(Eo.a,{className:"pc-report-radio-group",inline:!0,onChange:this.timelineChange,selectedValue:e},o.a.createElement(Bn.a,{label:"Day",value:"Day"}),o.a.createElement(Bn.a,{label:"Week",value:"Week"}),o.a.createElement(Bn.a,{label:"Month",value:"Month"}))),o.a.createElement("div",{className:"pc-canvas-con"},o.a.createElement("canvas",{id:"board-activity-line-chart",width:400,height:400})))}}]),t}(o.a.Component),zo=function(e,t,a){var n=e.map(function(e){return e.firstName});return Io(n,"Communication Activities",t,"Communication Activities Bar Chart","User List","No Of Hours",a)},Fo=function(e){return(e.reduce(function(e,t){return t.type&&(e+=t.duration),e},0)/36e5).toFixed(2)},qo=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={timelineValue:"Day",myBarChart:null,myLineChart:null},a.drawChart=function(e){var t=document.getElementById("communication-activity-bar-chart"),n=document.getElementById("communication-activity-line-chart"),r=a.props,o=r.boardCommunicationActivities,i=r.userList,c=r.users,s=[];i.forEach(function(e){var t=o.filter(function(t){return t.userId===e.tuserId});s.push(t)});var l=i.map(function(e){return Object.values(c.byId).find(function(t){return t.id===e.tuserId})}),u=s.map(function(e){return Fo(e)}),d=zo(l,u,t),m=Uo(l,s,n,o,e);a.setState({myLineChart:m,myBarChart:d})},a.timelineChange=function(e){var t=a.state,n=t.myLineChart,r=t.myBarChart;a.setState({timelineValue:e.target.value}),n&&(n.destroy(),r.destroy()),a.drawChart(e.target.value)},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this.state.timelineValue;this.drawChart(e)}},{key:"render",value:function(){var e=this.state.timelineValue;return o.a.createElement("div",{className:"pc-canvases"},o.a.createElement("div",{className:"pc-canvas-con"},o.a.createElement("canvas",{id:"communication-activity-bar-chart",width:400,height:400})),o.a.createElement("div",{className:"pc-graph-timeline"},o.a.createElement("h3",null,"Select a timeline: "),o.a.createElement(Eo.a,{className:"pc-report-radio-group",inline:!0,onChange:this.timelineChange,selectedValue:e},o.a.createElement(Bn.a,{label:"Day",value:"Day"}),o.a.createElement(Bn.a,{label:"Week",value:"Week"}),o.a.createElement(Bn.a,{label:"Month",value:"Month"}))),o.a.createElement("div",{className:"pc-canvas-con"},o.a.createElement("canvas",{id:"communication-activity-line-chart",width:400,height:400})))}}]),t}(o.a.Component),Go=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props.boardCommunicationActivities;return o.a.createElement("div",{className:"pc-report-charts"},o.a.createElement(Vo,this.props),e.length>0?o.a.createElement(qo,this.props):null)}}]),t}(o.a.Component),Jo=function(e,t){return t.map(function(t,a){return o.a.createElement("tr",{key:a,style:{background:t.rowColor?t.rowColor:a%2===0?"white":"#f5f5f5"}},function(e,t){return e.map(function(e,a){return o.a.createElement("td",{key:a,style:{textAlign:"center",padding:8}},t[e])})}(e,t))})},Yo=function(e){return o.a.createElement("div",{style:{width:"100%",overflowX:"auto"}},o.a.createElement("table",{className:"pc-table"},o.a.createElement("tbody",null,o.a.createElement("tr",null,Object.values(e.headers).map(function(e,t){return o.a.createElement("th",{key:t},e)})),Jo(Object.keys(e.headers),e.data))))},Ko=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).fetchReport=Object(W.a)(L.a.mark(function e(){var t,n,r,o;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.boardId,r=t.apis,e.next=3,r.getBoardActivity({boardId:n});case 3:(o=e.sent)?a.setState({boardActivities:o.boardActivities,boardCommunicationActivities:o.boardCommunicationActivities}):a.setState({error:"Faild to fetch report data."});case 5:case"end":return e.stop()}},e)})),a.generatePdfHandler=function(){var e=Object(W.a)(L.a.mark(function e(t,n){var r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.props.account,a.setState({loading:!0}),o=document.getElementById("report-chart"),e.next=5,wo(Object(y.a)({},a.props,{canvas:o,boardDetail:t,tableData:n}));case 5:(i=e.sent).images.map(function(){var e=Object(W.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Y.a.post("".concat(oe,"/web/delete-file"),{token:r.sessionId,content:"report",fileName:t});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log("Internal Error",e.t0);case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(t){return e.apply(this,arguments)}}()),a.setState({loading:!1,pdfUrl:"".concat(oe,"/user/").concat(1e7+parseInt(r.user.id,10),"/report/").concat(i.pdf)});case 8:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.state={boardActivities:null,pdfUrl:null,loading:!1,boardCommunicationActivities:null,error:null},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.isOpen,n=t.onClose,r=t.boardId,i=t.boards,c=t.users,s=t.boardMembers,l=this.state,u=l.boardActivities,d=l.error,m=l.boardCommunicationActivities,p=l.loading,f=l.pdfUrl,v=i.byId[r].name,b=Object.values(s.byId).filter(function(e){return e.boardId===r&&!e.deleteStatus}),g=b.map(function(e){return Object.values(c.byId).find(function(t){return t.id===e.tuserId})}),h=u?g.map(function(e){return function(e,t,a){var n=e.firstName,r=t.filter(function(t){return t.userId===e.id}).filter(function(e){return"createCard"===e.message}).length,o=t.filter(function(t){return t.userId===e.id}).filter(function(e){return"outsideColumn"===e.message}).length;return{userName:n,noOfCreateCard:r,noOfComment:t.filter(function(t){return t.userId===e.id}).filter(function(e){return"createComment"===e.message}).length,noOfHours:(a.filter(function(t){return t.userId===e.id}).reduce(function(e,t){return t.type&&(e+=t.duration),e},0)/36e5).toFixed(2),noOfMessage:a.filter(function(t){return t.userId===e.id}).length,noOfMoveCard:o}}(e,u,m)}):[];return o.a.createElement(fe.a,{onOpening:this.fetchReport,isOpen:a,title:v,icon:"chart",onClose:n,className:"pc-report-overlay"},u&&!d?o.a.createElement("div",{className:"pc-report-content"},o.a.createElement(Go,Object.assign({boardId:r},this.props,{boardActivities:u,boardCommunicationActivities:m,userList:b})),o.a.createElement("div",{className:"pc-report-table-con"},o.a.createElement("div",{className:"table-title"},o.a.createElement("h3",null,"Tabulated Data")),o.a.createElement(Yo,{headers:{userName:"Users",noOfCreateCard:"No of Tasks created",noOfMoveCard:"No of Tasks moved",noOfComment:"No of Comments",noOfHours:"Call Time(hr)",noOfMessage:"Total Messages sent"},data:h})),o.a.createElement("div",{className:"pc-pdf-gen-btn-con"},f&&o.a.createElement("div",{className:"pdf-link"},o.a.createElement("a",{href:f,rel:"noopener noreferrer",target:"_blank"},"Download Pdf")),o.a.createElement(ve.b,{loading:p,text:"Generate PDF",intent:"success",onClick:function(){return e.generatePdfHandler(i.byId[r],h)}}))):o.a.createElement(zn.a,{intent:"success"}))}}]),t}(o.a.Component),Qo=Ko;Ko.defaultProps={isOpen:null};var _o=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={showReport:null},a.toggleAddUser=function(){var e=a.state.addUser;a.setState({addUser:!e})},a.onChat=function(){var e=a.props,t=e.updateWebRtc,n=e.boardId;t("showCommunication",n),t("peerType","board"),t("communicationContainer","history"),t("chatHistory",{type:"board",user:{user:null},connectionId:n})},a.generateReportHandler=function(){a.setState({showReport:window.location.pathname})},a.reportCloseHandler=function(){a.setState({showReport:null})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.boards,a=e.boardId,n=e.users,r=e.boardMembers,i=e.account,c=e.apis,s=e.database,l=e.UserDetail,u=Object.values(l.byId).find(function(e){return e.userId===i.user.id}),d=Object.values(t.byId).find(function(e){return e.id===a}),m=this.state.showReport,p=Object.values(r.byId).find(function(e){return e.boardId===a&&e.fuserId===e.tuserId});return o.a.createElement("div",{className:"tool-bar"},o.a.createElement(Qo,Object.assign({isOpen:m,onClose:this.reportCloseHandler,boardId:a},this.props,{boards:t,apis:c,users:n})),o.a.createElement("div",{className:"toolbar-container"},o.a.createElement("div",{className:"left-tools"},o.a.createElement("div",{className:"class-name each-item"},d.name),o.a.createElement(uo.a,null),o.a.createElement(vo,{extUser:u,userList:n,boardId:a,boardMembers:r,apis:c,account:i})),o.a.createElement("div",{className:"right-tools"},o.a.createElement(be.a,{content:o.a.createElement("span",{style:{color:"#1d4354"}},"Chat")},o.a.createElement(ve.b,{minimal:!0,icon:"chat",onClick:this.onChat})),u&&("mentor"===u.type||u.userId===p.fuserId)&&o.a.createElement(be.a,{content:o.a.createElement("span",{style:{color:"#1d4354"}},"Add user to this class")},o.a.createElement(ho,{apis:c,users:s.User.byId,connections:Object.values(s.UserConnection.byId),account:i,boardId:a})),u&&"mentor"===u.type&&o.a.createElement(be.a,{content:o.a.createElement("span",{style:{color:"#1d4354"}},"Generate Report")},o.a.createElement(ve.b,{minimal:!0,onClick:this.generateReportHandler},o.a.createElement(mo.a,{size:20}))))))}}]),t}(o.a.Component),Zo=Object(p.b)(function(e){var t=e.database,a=e.account;return{boards:t.Board,UserDetail:t.UserDetail,users:t.User,boardMembers:t.BoardMember,account:a,database:t}},Object(y.a)({},n))(_o),Xo=function(e,t,a,n){var r=Number(t.split("column")[1]),o=e,i=e.find(function(e){return e.id===r});return 0===a.index?i.position=e[0].position/2:a.index===e.length-1?i.position=e[a.index].position+16384:(n.index>a.index&&(i.position=(e[a.index-1].position+e[a.index].position)/2),n.index<a.index&&(i.position=(e[a.index].position+e[a.index+1].position)/2)),o.splice(n.index,1),o.splice(a.index,0,i),{newColumns:o,column:i}},$o=function(e,t,a,n){var r,o=e.dropableId,i=a,c={},s=[];a.map(function(e,t){e.id===o&&(c=e,s=e.tasks,r=t)});var l=s.find(function(e){return e.id===n});return 0===t.index?l.position=s[0].position/2:t.index===s.length-1?l.position=s[t.index].position+16384:(e.index>t.index&&(l.position=(s[t.index-1].position+s[t.index].position)/2),e.index<t.index&&(l.position=(s[t.index].position+s[t.index+1].position)/2)),s.splice(e.index,1),s.splice(t.index,0,l),c.tasks=s,i.splice(r,1),i.splice(r,0,c),{newColumns:i,newTask:l}},ei=function(e,t,a,n,r){var o,i,c=a,s=e.dropableId,l={},u={};c.map(function(e,t){e.id===s&&(l=e,o=t),e.id===n&&(u=e,i=t)});var d=l.tasks,m=u.tasks,p=d.find(function(e){return e.id===r});return d.splice(e.index,1),0===t.index?0!==m.length?p.position=m[0].position/2:p.position=16384:t.index===m.length?p.position=m[t.index-1].position+16384:p.position=(m[t.index-1].position+m[t.index].position)/2,p.boardColumnId=n,m.splice(t.index,0,p),u.tasks=m,l.tasks=d,c.splice(o,1),c.splice(o,0,l),c.splice(i,1),c.splice(i,0,u),{newColumns:c,newTask:p}},ti=function(e){var t=e.children,a=Object(Ar.a)({accept:Pr.COLUMN,drop:function(){},collect:function(e){return{isOver:e.isOver()}}}),n=Object(Dr.a)(a,2),r=(n[0].isOver,n[1]);return o.a.createElement("div",{className:"columns",id:"allColumnWrapper",ref:r},t)},ai=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).loadData=function(e){var t=e.tasks,n=e.columns,r=e.account,o=e.classId;if(r.user){var i=Object.values(n.byId).filter(function(e){return e.boardId===o&&!e.deleteStatus}).map(function(e){var a=Object(y.a)({},e),n=Object.values(t.byId).filter(function(t){return!t.deleteStatus&&t.boardColumnId===e.id}).sort(st);return a.tasks=n,a}).sort(st);a.setState({columns:i})}},a.dragStartEnd=function(){var e=Object(W.a)(L.a.mark(function e(t,n,r,o){var i,c,s,l,u,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("start"!==t){e.next=3;break}return a.setState({draggingInitialItem:n,xCoor:{left:o.x-r.x,right:300-(o.x-r.x)}}),e.abrupt("return");case 3:if(a.stopScroll(),i=a.state,c=i.draggingInitialItem,s=i.api,l=i.columns,u=i.classId,n.type!==Pr.COLUMN){e.next=17;break}if(n.index===c.index){e.next=15;break}return e.prev=7,e.next=10,s.updateBoardColumn([{position:l.find(function(e){return e.id===n.id}).position,timeStamp:Date.now(),broadCastId:"Board-".concat(u)},{id:n.id}]);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.log("error in movement");case 15:return a.setState({draggingInitialItem:{},xCoor:{}}),e.abrupt("return");case 17:if(n.type!==Pr.TASK){e.next=30;break}if(n.dropableId!==c.dropableId||n.index!==c.index){e.next=21;break}return a.setState({draggingInitialItem:{},xCoor:{}}),e.abrupt("return");case 21:return d=l.find(function(e){return e.id===n.dropableId}),e.prev=22,e.next=25,s.updateBoardColumnCard([{todo:n.dropableId===c.dropableId?"withinColumn":"outsideColumn",fColId:c.dropableId,tColId:n.dropableId,position:d.tasks.find(function(e){return e.id===n.id}).position,timeStamp:Date.now(),boardColumnId:n.dropableId,broadCastId:"Board-".concat(u)},{id:n.id}]);case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(22),console.log("task movement server-error");case 30:a.setState({draggingInitialItem:{},xCoor:{}});case 31:case"end":return e.stop()}},e,null,[[7,12],[22,27]])}));return function(t,a,n,r){return e.apply(this,arguments)}}(),a.moveColumns=function(e,t,n){var r=a.state.columns,o=Xo(r,n,{index:t},{index:e});a.setState({columns:o.newColumns})},a.moveTask=function(e,t,n){var r=a.state.columns;if(e.dropableId!==t.dropableId){var o=t.dropableId,i=Number(n.split("task")[1]),c=ei(e,t,r.filter(function(e){return!e.deleteStatus}),o,i);a.setState({columns:c.newColumns})}else{var s=Number(n.split("task")[1]),l=$o(e,t,r,s);a.setState({columns:l.newColumns})}},a.toggleTaskOverlay=function(e){var t=a.state.taskOverlayIsOpen;a.setState({taskIdInOverlay:e,taskOverlayIsOpen:!t})},a.scrollRight=function(){a.setState({scrolling:!0}),a.scrollInterval=setInterval(function(){document.getElementById("allColumnWrapper").scrollLeft+=10},10)},a.scrollLeft=function(){a.setState({scrolling:!0}),a.scrollInterval=setInterval(function(){document.getElementById("allColumnWrapper").scrollLeft-=10},10)},a.stopScroll=function(){a.setState({scrolling:!1}),clearInterval(a.scrollInterval)},a.startScroll=function(e){a.state.scrolling?e.x+75<window.innerWidth&&e.x>75&&a.stopScroll():e.x+75>window.innerWidth?a.scrollRight():e.x<75&&a.scrollLeft()};var n=a.props,r=n.classId,o=n.apis;return a.state={api:o,classId:r,draggingInitialItem:{},xCoor:{},scrolling:!1,columns:[],taskOverlayIsOpen:!1,taskIdInOverlay:null},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.loadData(this.props)}},{key:"componentWillReceiveProps",value:function(e){this.loadData(e)}},{key:"render",value:function(){var e=this,t=this.state,a=t.classId,n=t.columns,r=t.api,i=t.taskIdInOverlay,c=t.taskOverlayIsOpen,s=t.xCoor,l=this.props,u=l.addDatabaseSchema,d=l.account,m=l.updateDatabaseSchema,p=l.deleteDatabaseSchema,f=l.classMembers,v=l.userSlug,b=l.setDraggingContent;return d.sessionId?d.user?d.user.slug!==v?o.a.createElement(U.a,{to:"/"}):Object.values(f.byId).find(function(e){return e.boardId===a&&!e.deleteStatus&&d.user.id===e.tuserId})?o.a.createElement("div",{className:"class-wrapper"},o.a.createElement(ti,null,n.filter(function(e){return!e.deleteStatus&&e.boardId===a}).map(function(t,n){return o.a.createElement(Gr,{startScroll:e.startScroll,xCoor:s,dragStartEnd:e.dragStartEnd,setDraggingContent:b,moveTask:e.moveTask,moveColumns:e.moveColumns,index:n,draggableId:"column".concat(t.id),column:t,key:"column".concat(t.id),columnId:t.id,api:r,boardId:a,addDatabaseSchema:u,updateDatabaseSchema:m,deleteDatabaseSchema:p,onTaskClick:e.toggleTaskOverlay})}),o.a.createElement(Yr,{api:r,classId:a})),o.a.createElement(lo,{apis:r,isOpen:c,taskId:i,onClose:this.toggleTaskOverlay,boardId:a,addDatabaseSchema:u,updateDatabaseSchema:m,deleteDatabaseSchema:p})):o.a.createElement(U.a,{to:"/".concat(v,"/classes")}):o.a.createElement(Fe,null):o.a.createElement(U.a,{to:"/"})}}]),t}(r.Component),ni=Object(p.b)(function(e){var t=e.database;return{account:e.account,classMembers:t.BoardMember,columns:t.BoardColumn,tasks:t.BoardColumnCard,boardUsers:t.User,tags:t.BoardColumnCardTag}},Object(y.a)({},n))(ai),ri=a(337),oi={position:"fixed",pointerEvents:"none",zIndex:100,left:0,top:0,width:"100%",height:"100%"};function ii(e,t){if(!t)return{display:"none"};var a=t.x,n=t.y;if(e.type===Pr.COLUMN){var r="translate(".concat(a,"px, ").concat(n-8,"px)");return{transform:r,WebkitTransform:r}}var o="translate(".concat(a,"px, ").concat(n,"px)");return{transform:o,WebkitTransform:o}}var ci=function(e){var t=e.draggingContent,a=Object(ri.a)(function(e){return{item:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()}}),n=a.item,r=a.isDragging,i=a.currentOffset;return r&&t?o.a.createElement("div",{style:oi},o.a.createElement("div",{style:ii(n,i)},o.a.createElement("div",{style:{boxShadow:n.type===Pr.TASK?"0px 0px 5px 0px rgba(0,0,0,0.75)":null},className:n.type===Pr.TASK?"task-container":"column-container",dangerouslySetInnerHTML:{__html:t.innerHTML}}))):null};ci.defaultProps={draggingContent:null};var si=ci,li=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0,apis:{},draggingContent:null},a.setDraggingContent=function(e,t){"end"!==e?a.setState({draggingContent:document.getElementById(t.type===Pr.TASK?"id_task_".concat(t.id):"id_column_".concat(t.id))}):a.setState({draggingContent:null})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;ue.scope("Mentee").then(function(t){e.setState({apis:t,loading:!1})})}},{key:"render",value:function(){var e=this.props.match,t=this.state,a=t.apis,n=t.draggingContent;return t.loading?o.a.createElement(Fe,null):o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(Pt,{className:"pcm-nav"}),o.a.createElement(Zo,{boardId:Number(e.params.classId,10),apis:a}),o.a.createElement(xr.a,{backend:Nr.a},o.a.createElement(si,{draggingContent:n}),o.a.createElement(ni,{setDraggingContent:this.setDraggingContent,apis:a,userSlug:e.params.userSlug,classId:Number(e.params.classId,10)})))}}]),t}(o.a.Component),ui=[{id:"email",fieldtype:"input",name:"Email",placeholder:"Eg, alex@gmail.com",required:!0},{id:"submit",fieldtype:"button",type:"submit",text:"Submit",fill:"fill",intent:"primary",large:"large"}],di=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.forgotPassword=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Fa(t.email)){e.next=2;break}return e.abrupt("return",{error:"Please enter a valid email"});case 2:return n=a.props.updateNav,e.next=5,Pa(t);case 5:return 200===(r=e.sent).response&&n({schema:"popNotification",data:{active:!0,message:"Click the link in the email and recover your password.",intent:"success"}}),e.abrupt("return",r);case 8:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement(Le,{data:ui,callback:this.forgotPassword})}}]),t}(r.Component),mi=Object(p.b)(function(e){return e},Object(y.a)({},n))(di),pi=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"o-log-or-reg"},o.a.createElement("div",{className:"log-or-reg"},o.a.createElement("div",{className:"reg-box-header"},o.a.createElement("p",null,"Recover your password"),o.a.createElement(K.a,{to:"/login"},o.a.createElement("u",null,"or login to your account"))),o.a.createElement(mi,null)))}}]),t}(r.Component),fi=[{id:"newPassword",fieldtype:"input",hidden:!0,name:"New Password",placeholder:"Eg, Xyz@123peQ",required:!0,icon:{side:"right",name:"eye-open"}},{id:"confirmPassword",fieldtype:"input",required:!0,hidden:!0,name:"Confirm Password",placeholder:"Eg, Xyz@123peQ",icon:{side:"right",name:"eye-open"}},{id:"submit",type:"submit",fieldtype:"button",text:"Submit",fill:"fill",intent:"primary",large:"large"}],vi=[{id:"oldPassword",fieldtype:"input",hidden:!0,name:"Old Password",placeholder:"Eg, ........",icon:{side:"right",name:"eye-open"}},{id:"newPassword",fieldtype:"input",hidden:!0,name:"New Password",placeholder:"Eg, ........",icon:{side:"right",name:"eye-open"}},{id:"confirmPassword",fieldtype:"input",hidden:!0,name:"Confirm Password",placeholder:"Eg, ........",icon:{side:"right",name:"eye-open"}},{id:"submit",fieldtype:"button",type:"submit",text:"Submit",fill:"fill",intent:"primary",large:"large"}],bi=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={redirect:!1},a.handleChange=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props,r=n.updateNav,o=n.token,t.newPassword===t.confirmPassword){e.next=3;break}return e.abrupt("return",{error:"Passwords did not match"});case 3:if("weak"!==Va(t.newPassword)){e.next=5;break}return e.abrupt("return",{error:"Please enter a stronger password"});case 5:return e.next=7,Ha(Object(y.a)({},t,{token:o}));case 7:return 200===(i=e.sent).response&&(r({schema:"popNotification",data:{active:!0,message:"Your password is changed. Please login.",intent:"success"}}),a.setState({redirect:!0})),e.abrupt("return",i);case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){if(this.state.redirect)return o.a.createElement(U.a,{to:"/login"});var e=this.props.pForm;return o.a.createElement(Le,{data:e,callback:this.handleChange})}}]),t}(r.Component),gi=Object(p.b)(function(e){return e},Object(y.a)({},n))(bi),hi=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.type,a=e.match;return o.a.createElement("div",{className:"o-log-or-reg"},o.a.createElement("div",{className:"log-or-reg"},o.a.createElement("div",{className:"reg-box-header"},o.a.createElement("p",null," Reset your password "),o.a.createElement(K.a,{to:"/login"},o.a.createElement("u",null,"or Login"))),o.a.createElement(gi,{token:a.params.token,pForm:"change"===t?vi:fi})))}}]),t}(r.Component),yi=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={emailVerified:!1,loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a,n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.match,n=t.updateNav,e.prev=1,e.next=4,Y.a.get("".concat(oe,"/auth/email-verification?token=").concat(a.params.token));case 4:200===e.sent.status&&(n({schema:"popNotification",data:{active:!0,message:"Email is verified. Please login.",intent:"success"}}),this.setState({emailVerified:!0,loading:!1})),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),n({schema:"popNotification",data:{active:!0,message:"Could not verify your email.",intent:"danger"}}),this.setState({emailVerified:!1,loading:!1});case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.emailVerified;return e.loading?o.a.createElement(Fe,null):t?o.a.createElement(U.a,{to:"/login"}):o.a.createElement(U.a,{to:"/registration"})}}]),t}(o.a.Component),Ci=Object(p.b)(function(e){return e},Object(y.a)({},n))(yi),wi=function(e,t,a){var n=a.database,r=[];return"board"===t&&Object.values(n.BoardMessageSeenStatus.byId).forEach(function(t){t.bmId===e&&r.push(t)}),"user"===t&&Object.values(n.UserMessageSeenStatus.byId).forEach(function(t){t.umId===e&&r.push(t)}),r},Ei=function(e,t,a){var n,r=a.account,o=e.slice().reverse(),i=o.findIndex(function(e){return e.seenStatus.find(function(e){return e.userId===r.user.id})});if(-1===i)n=o.filter(function(e){return e.fuserId!==r.user.id}).length;else{for(var c=0,s=0;s<i;s+=1)o[s]["user"===t?"fuserId":"userId"]!==r.user.id&&(c+=1);n=c}var l=o.find(function(e){return e["user"===t?"fuserId":"userId"]!==r.user.id});return{lastMessageId:l?l.id:o[0].id,unSeenNo:n}},Si=a(122),Oi=a.n(Si),ki=function(e,t,a){var n=[];return n="user"===a?t:Oi.a.uniq(t.map(function(e){return[e.tuserId,e.fuserId]}).reduce(function(e,t){return Array.isArray(t)?t.forEach(function(t){return e.push(t)}):e.push(t),e},[])),e.slice().reverse().map(function(e){var t=[];return n.length>0&&e.seenStatus.forEach(function(e){n.find(function(t){return t===e.userId})&&(n=n.filter(function(t){return t!==e.userId}),t.push(e))}),Object(y.a)({},e,{seenStatus:t})})},Ii=function(e){var t=e.webRtc;if(t.chatHistory)return"user"===t.chatHistory.type?function(e){var t=e.database,a=e.webRtc,n=[],r=[],o=[],i=null,c=null,s=null,l=null;return(n=Object.values(t.UserMessage.byId).filter(function(e){return e.connectionId===a.chatHistory.connectionId})).length>0&&(s=new Date(n[0].timeStamp),n.forEach(function(t,a,n){Object(No.a)(s,new Date(t.timeStamp))&&0!==a||(r.push(Object(y.a)({},t,{showImage:!1,type:"date",seenStatus:wi(t.id,"user",e)})),s=t.timeStamp),t.tuserId===c?0!==a?n[a-1].type?r.push(Object(y.a)({},t,{showImage:!0,seenStatus:wi(t.id,"user",e)})):Object(No.a)(l,new Date(t.timeStamp))?r.push(Object(y.a)({},t,{showImage:!1,seenStatus:wi(t.id,"user",e)})):(r.push(Object(y.a)({},t,{showImage:!0,seenStatus:wi(t.id,"user",e)})),l=t.timeStamp):r.push(Object(y.a)({},t,{showImage:!1,seenStatus:wi(t.id,"user",e)})):(c=t.tuserId,r.push(Object(y.a)({},t,{showImage:!0,seenStatus:wi(t.id,"user",e)})))}),o=ki(r,[a.chatHistory.user.user.id],"user"),i=Ei(r,"user",e)),Object(y.a)({messages:o},i)}(e):function(e){var t=e.database,a=e.webRtc,n=[],r=[],o=[],i=null,c=null,s=null,l=null;return(n=Object.values(t.BoardMessage.byId).filter(function(e){return e.boardId===a.chatHistory.connectionId})).length>0&&(n.forEach(function(t,a,n){Object(No.a)(s,new Date(t.timeStamp))&&0!==a||(r.push(Object(y.a)({},t,{showImage:!1,type:"date",seenStatus:wi(t.id,"board",e)})),s=t.timeStamp),t.userId===c?0!==a?n[a-1].type?r.push(Object(y.a)({},t,{showImage:!0,seenStatus:wi(t.id,"board",e)})):Object(No.a)(l,new Date(t.timeStamp))?r.push(Object(y.a)({},t,{showImage:!1,seenStatus:wi(t.id,"board",e)})):(r.push(Object(y.a)({},t,{showImage:!0,seenStatus:wi(t.id,"board",e)})),l=t.timeStamp):r.push(Object(y.a)({},t,{showImage:!1,seenStatus:wi(t.id,"board",e)})):t.userId!==c?(c=t.userId,r.push(Object(y.a)({},t,{showImage:!0,seenStatus:wi(t.id,"board",e)}))):(console.log("Test"),r.push(Object(y.a)({},t,{showImage:!1,seenStatus:wi(t.id,"board",e)})))}),o=ki(r,Object.values(t.BoardMember.byId).filter(function(e){return e.boardId===a.chatHistory.connectionId})),i=Ei(r,"board",e)),Object(y.a)({messages:o},i)}(e)},ji=function(e,t){var a=t.webRtc,n=t.account,r=t.database;if("user"===a.chatHistory.type){if(e.fuserId===n.user.id)return{isOwn:!0,user:n.user};var o=Object.values(r.User.byId).find(function(t){return t.id===e.fuserId}),i=Object.values(r.UserDetail.byId).find(function(t){return t.userId===e.fuserId});return{isOwn:!1,user:Object(y.a)({},o,{userDetails:i})}}if(e.userId===n.user.id)return{isOwn:!0,user:n.user};var c=Object.values(r.User.byId).find(function(t){return t.id===e.userId}),s=Object.values(r.UserDetail.byId).find(function(t){return t.userId===e.userId});return{isOwn:!1,user:Object(y.a)({},c,{userDetails:s})}},xi=a(56),Ni=a.n(xi),Di=function(e){var t=Math.floor(parseInt(e,10)/6e4),a=Math.floor((parseInt(e,10)-60*t*1e3)/1e3);return"(".concat(t," : ").concat(a,")  ")},Ai=function(e,t,a,n,r,i){return o.a.createElement("div",{key:i,style:{width:"95%",display:"flex",justifyContent:r?"flex-start":"center",alignItems:"center",margin:r?0:10}},o.a.createElement("span",{style:{padding:5,border:r?null:"1px solid ".concat(a),borderRadius:10,fontSize:r?14:10,background:r?null:a,color:r?"#757575":"white"}},o.a.createElement(X.a,{icon:t,iconSize:r?13:10,style:{marginRight:5}}),"".concat(e," ").concat(n.duration?Di(n.duration):""),r?null:o.a.createElement(Ni.a,{format:"h:mm:a",style:{marginLeft:10}},n.timeStamp)))},Ti=function(e,t,a,n,r){if("board"===a){if(e.userId===t.user.id&&!e.duration||e.type&&n&&!e.duration)return Ai("Missed Call","arrow-bottom-left","#f17d77",e,n,r);if(e.userId===t.user.id&&e.duration||e.type&&n&&!e.duration)return Ai("Incoming Call","arrow-bottom-left","#A6A9A9",e,n,r)}return e.fuserId!==t.user.id||e.duration?e.tuserId!==t.user.id||e.duration?e.fuserId===t.user.id?Ai("Incoming Call","arrow-bottom-left","#A6A9A9",e,n,r):e.tuserId===t.user.id?Ai("Outgoing Call","arrow-top-right","#A6A9A9",e,n,r):void 0:Ai("Outgoing Call","arrow-top-right","#A6A9A9",e,n,r):Ai("Missed Call","arrow-bottom-left","#f17d77",e,n,r)},Ri=function(e,t,a,n,r,i){return o.a.createElement("div",{key:i,style:{width:"95%",display:"flex",justifyContent:r?"flex-start":"center",alignItems:"center",margin:r?0:10}},o.a.createElement("span",{style:{padding:5,border:r?null:"1px solid ".concat(a),borderRadius:10,fontSize:r?14:10,background:r?null:a,color:r?"#757575":"white"}},o.a.createElement(X.a,{icon:t,iconSize:r?13:10,style:{marginRight:5}}),"".concat(e," ").concat(n.duration?Di(n.duration):""),r?null:o.a.createElement(Ni.a,{format:"h:mm:a",style:{marginLeft:10}},n.timeStamp)))},Pi=function(e,t,a,n,r){return"board"===a&&e.userId===t.user.id?Ri("Outgoing Call","arrow-top-right","#A6A9A9",e,n,r):e.tuserId!==t.user.id||e.duration?e.tuserId===t.user.id?Ri("Incoming Call","arrow-bottom-left","#A6A9A9",e,n,r):e.fuserId===t.user.id?Ri("Outgoing Call","arrow-top-right","#A6A9A9",e,n,r):void 0:Ri("Missed Call","arrow-bottom-left","#f17d77",e,n,r)},Mi=a(49),Hi=function(e){var t=e.clo,a=e.idx,n="user"===t.type;return o.a.createElement("div",{key:a,style:{cursor:"pointer",padding:"5px 10px 5px 5px",background:t.mouseHoverId===a?"#d6f4fe":"white"},onClick:function(){return t.onClick(t)},onMouseOver:function(){return t.onMouseHover(a)}},o.a.createElement("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},o.a.createElement("div",{style:{display:"flex",position:"relative"}},n?o.a.createElement("div",{className:"profile-icon"},o.a.createElement(it,{imgUrl:t.user.userDetails&&t.user.userDetails.image?"".concat(oe,"/user/").concat(1e7+parseInt(t.user.user.id,10),"/profile/").concat(t.user.userDetails.image):Mi})):o.a.createElement("div",{className:"class-icon"},o.a.createElement(X.a,{icon:"application",iconSize:40})),n&&t.user.user.activeStatus&&o.a.createElement("div",{className:"green-dot"}),o.a.createElement("div",{style:{display:"flex",flexDirection:"column",marginLeft:10}},o.a.createElement("div",{style:{fontWeight:"bold"}},o.a.createElement("span",{style:{padding:3}},n?t.user.user.firstName:t.boardDetails.name),!n&&t.boardDetails.activeStatus&&o.a.createElement("span",{style:{background:"green",padding:3,fontSize:10,marginLeft:5,fontWeight:"lighter",borderRadius:5,color:"white"}},"Live")),o.a.createElement("span",{className:"last-text"},t.lastMessage.type?"Incoming"===t.lastMessage.type?Ti(t.lastMessage,R.getState().account,t.type,!0):Pi(t.lastMessage,R.getState().account,t.type,!0):t.lastMessage.message))),o.a.createElement("div",{style:{position:"relative",display:"flex",justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end"}},o.a.createElement("span",{style:{fontSize:12,color:"#757575"}},pe()(t.timeStamp).fromNow()),t.unSeenNo>0&&o.a.createElement("div",{style:{marginTop:5,position:"relative",backgroundColor:"green",height:20,width:20,borderRadius:"50%",justifyContent:"center",display:"flex",color:"white",alignItems:"center"}},o.a.createElement("span",{style:{fontSize:10,fontWeight:"bold"}},t.unSeenNo)))))},Ui=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={mouseHoverId:null,chatList:[]},a.onMouseHover=function(e){a.setState({mouseHoverId:e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=jt(this.props);this.setState({chatList:e})}},{key:"componentWillReceiveProps",value:function(e){var t=jt(e);this.setState({chatList:t})}},{key:"render",value:function(){var e=this,t=this.props.style,a=this.state,n=a.mouseHoverId,r=a.chatList;return o.a.createElement("div",{style:t,className:"chat-list"},0===r.length&&o.a.createElement("div",{className:"no-msg"},"You do not have any conversations"),r.map(function(t,a){return o.a.createElement(Hi,{key:a,clo:Object(y.a)({},t,{onClick:kt,onMouseHover:e.onMouseHover,mouseHoverId:n,props:e.props}),idx:a})}))}}]),t}(o.a.Component),Bi=(function(){var e=Object(W.a)(L.a.mark(function e(t){var a,n,r,o,i,c,s,l,u,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=document.getElementById("mainCanvas"),n=null,e.prev=2,navigator.getWebcam=navigator.getUserMedia||navigator.webKitGetUserMedia||navigator.moxGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.t0=t,e.next="audio"===e.t0?7:"video"===e.t0?17:"screenshare"===e.t0?27:"whiteBoard"===e.t0?37:"mute"===e.t0?47:48;break;case 7:if(!navigator.mediaDevices.getUserMedia){e.next=13;break}return e.next=10,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 10:n=e.sent,e.next=16;break;case 13:return e.next=15,navigator.getWebcam({audio:!0,video:!1});case 15:n=e.sent;case 16:return e.abrupt("return",n);case 17:if(!navigator.mediaDevices.getUserMedia){e.next=23;break}return e.next=20,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 20:n=e.sent,e.next=26;break;case 23:return e.next=25,navigator.getWebcam({audio:!0,video:!0});case 25:n=e.sent;case 26:return e.abrupt("return",n);case 27:return e.next=29,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 29:return r=e.sent,e.next=32,navigator.mediaDevices.getDisplayMedia({video:!0});case 32:return o=e.sent,i=r.getTracks(),c=o.getTracks(),n=new MediaStream([].concat(Object(g.a)(i),Object(g.a)(c))),e.abrupt("return",n);case 37:return e.next=39,a.captureStream(10);case 39:return s=e.sent,e.next=42,navigator.mediaDevices.getUserMedia({audio:!0,video:!1});case 42:return l=e.sent,u=l.getTracks(),d=s.getTracks(),n=new MediaStream([].concat(Object(g.a)(u),Object(g.a)(d))),e.abrupt("return",n);case 47:return e.abrupt("return",null);case 48:return e.abrupt("return",n);case 49:e.next=54;break;case 51:e.prev=51,e.t1=e.catch(2),console.error("Media Selector error",e.t1);case 54:case"end":return e.stop()}},e,null,[[2,51]])}))}(),function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=t.updateWebRtc,o=n.connectionId,i=n.isLive,c=R.getState(),(s=c.webRtc).mainStreamId&&!i){e.next=7;break}return e.next=7,r("mainStreamId",n.uid);case 7:return e.next=9,r("connectionId",o);case 9:return e.next=11,r("connectedUsers",Object(y.a)({},s.connectedUsers,Object(h.a)({},n.uid,{streams:[],type:n.callType})));case 11:return e.next=13,r("streams",Object(y.a)({},s.streams,Object(h.a)({},n.uid,Object(y.a)({},s.streams[n.uid],{callEnd:!1,stream:[],callType:"Incoming"}))));case 13:return e.next=15,r("localCallHistory",Object(y.a)({},s.localCallHistory,{callType:s.localCallHistory.callType||"Incoming",callEnd:!1}));case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Offer initialization Error",e.t0);case 20:case"end":return e.stop()}},e,null,[[0,17]])}));return function(t,a,n){return e.apply(this,arguments)}}());function Li(e,t,a,n,r,o,i){return Wi.apply(this,arguments)}function Wi(){return(Wi=Object(W.a)(L.a.mark(function e(t,a,n,r,o,i,c){var s,l,u,d,m,p,f,v,b;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=a,l={iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:["turn:properclass.com:3478?transport=tcp"],username:"properclass",credential:"proper199201"}]},e.prev=2,(u=new RTCPeerConnection(l)).addEventListener("icecandidate",function(e){return t(e,s)}),u.addEventListener("iceconnectionstatechange",function(e){return r(e,u,s)}),u.addEventListener("track",function(e){return n(e,s)}),u.onicecandidateerror=function(e){return console.error("Error on onIceCandidate",e)},u.onicegatheringstatechange=function(e){return c(s,e.target.iceGatheringState)},d=function(e){u.setLocalDescription(e)},m=function(e){u.addIceCandidate(new RTCIceCandidate(JSON.parse(e)))},p=function(e){u.setRemoteDescription(e)},f=function(){var e=Object(W.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i(t,s),t.getTracks().forEach(function(e){return u.addTrack(e,t)}),u.createOffer(function(e){d(e),o(e,s)},function(e){console.error("error in create offer",e)},{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}});case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),v=function(){var e=Object(W.a)(L.a.mark(function e(t,a){var n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a&&(a.getTracks().forEach(function(e){return u.addTrack(e,a)}),i(a,s)),p(t),e.next=5,u.createAnswer();case 5:return n=e.sent,d(n),e.abrupt("return",n);case 10:e.prev=10,e.t0=e.catch(0),console.error("Error in Create Answer",s,t);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t,a){return e.apply(this,arguments)}}(),b=function(e){u.addIceCandidate(new RTCIceCandidate(JSON.parse(e)))},e.abrupt("return",{pc:u,createOffer:f,createAnswer:v,addIceCandidate:b,setRemoteDescription:p,addCandidate:m});case 18:e.prev=18,e.t0=e.catch(2),console.error("Error in Creating turn server",e.t0);case 21:case"end":return e.stop()}},e,null,[[2,18]])}))).apply(this,arguments)}var Vi=function(e,t){return function(){var t=Object(W.a)(L.a.mark(function t(a,n){var r,o,i,c;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=e.updateWebRtc,o=R.getState(),i=o.webRtc;try{a.candidate&&(c=i.iceCandidates[n],r("iceCandidates",c?Object(y.a)({},i.iceCandidates,Object(h.a)({},n,Object(y.a)({},i.iceCandidates[n],{candidates:i.iceCandidates[n].candidates?[].concat(Object(g.a)(i.iceCandidates[n].candidates),[a]):[a]}))):Object(y.a)({},i.iceCandidates,Object(h.a)({},n,Object(y.a)({},i.iceCandidates[n],{candidates:[a]})))))}catch(s){console.error("Error in add local iCe candidate",s)}case 3:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()},zi=function(e,t){return Fi.apply(this,arguments)};function Fi(){return(Fi=Object(W.a)(L.a.mark(function e(t,a){var n,r,i,c,s,l,u,d,m;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("video-mentor"),r=n.captureStream?n.captureStream():n.mozCaptureStream(),c=[],s=function(e){e.data&&e.data.size>0&&c.push(e.data)},l={mimeType:'video/webm;codecs="vp8,opus"'},MediaRecorder.isTypeSupported(l.mimeType)||(l={mimeType:'video/webm;codecs="vp8, opus"'},MediaRecorder.isTypeSupported(l.mimeType)||(l={mimeType:"video/webm"},MediaRecorder.isTypeSupported(l.mimeType)||(l={mimeType:""})));try{(i=new MediaRecorder(r,l)).ondataavailable=s,i.start(10)}catch(t){}return i.onstop=function(e){},i.onpause=function(e){},i.onresume=function(e){},u=function(e){(0,a.updateWebRtc)("recordedBlobs",R.getState().webRtc.recordedBlobs.filter(function(t){return Object.keys(t)[0]!==e}))},d=function(){var e=a.updateWebRtc,t=R.getState(),n=t.webRtc,i=t.database,s=new Blob(c,{type:"video/webm"}),l=window.URL.createObjectURL(s),d="".concat((new Date).getDate(),"-").concat((new Date).getMonth()+1,"-").concat((new Date).getFullYear());e("recordedBlobs",[].concat(Object(g.a)(R.getState().webRtc.recordedBlobs),[Object(h.a)({},r.id,o.a.createElement("a",{id:r.id,href:l,className:"recorded-item",download:"".concat("user"===n.localCallHistory.chatHistory.type?i.User.byId[n.showCommunication].firstName:i.Board.byId[n.showCommunication].name,"-").concat(d,".webm")},o.a.createElement("div",{onClick:function(){return u(r.id)}},"".concat("user"===n.localCallHistory.chatHistory.type?i.User.byId[n.showCommunication].firstName:i.Board.byId[n.showCommunication].name,"-").concat(d))))]))},m=function(){i.stop(),d()},e.abrupt("return",{stopRecording:m,mediaRecorder:i,stream:r});case 14:case"end":return e.stop()}},e)}))).apply(this,arguments)}var qi=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.getState(),o=r.webRtc,i=t.updateWebRtc,!o.mediaRecording||n.id===o.mediaRecording.stream.id){e.next=9;break}return o.mediaRecording.stopRecording(),e.next=6,zi(1,t);case 6:return c=e.sent,e.next=9,i("mediaRecording",c);case 9:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),Gi=function(e){return function(){var t=Object(W.a)(L.a.mark(function t(a,n){var r,o,i;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.updateWebRtc,o=R.getState(),i=o.webRtc,t.next=4,r("connectedUsers",Object(y.a)({},i.connectedUsers,Object(h.a)({},n,Object(y.a)({},i.connectedUsers[n],{streams:i.connectedUsers[n]?[].concat(Object(g.a)(i.connectedUsers[n].streams),[a]):[a]}))));case 4:return t.next=6,r("streams",Object(y.a)({},i.streams,Object(h.a)({},n,Object(y.a)({},i.streams[n],{startTimeStamp:i.streams[n].startTimeStamp||Date.now(),endTimeStamp:null,stream:i.streams[n]?[].concat(Object(g.a)(i.streams[n].stream),[a]):[a]}))));case 6:return t.next=8,r("localCallHistory",Object(y.a)({},i.localCallHistory,{startTime:i.localCallHistory.startTime||Date.now()}));case 8:return t.next=10,r("lastStreamId",n);case 10:return t.next=12,qi(e,n,a);case 12:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()},Ji=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r){var o,i,c,s,l;return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:try{o=R.getState(),i=o.account,c=o.webRtc,(0,e.updateWebRtc)("streams",Object(y.a)({},c.streams,Object(h.a)({},r,Object(y.a)({},c.streams[r],{callEnd:!1,stream:[]})))),s="user"===c.localCallHistory.chatHistory.type?"UserConnection":"Board",l="user"===c.localCallHistory.chatHistory.type?i.user.id:c.localCallHistory.chatHistory.connectionId,t.apis.createOffer({offerDetail:{isLive:c.isCallUpgraded,offer:n,uid:i.user.id,broadCastId:l,broadCastType:s,connectionId:c.localCallHistory.chatHistory.connectionId,callType:c.localCallHistory.mediaType},userList:[{userId:r}]})}catch(u){console.error("Error in offerHandler",r)}case 1:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}()},Yi=function(e){return function(t,a){var n=e.updateWebRtc;R.getState().webRtc.streams?n("streams",Object(y.a)({},R.getState().webRtc.streams,Object(h.a)({},a,{stream:[]}))):n("streams",Object(h.a)({},a,{stream:[]}))}},Ki=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r){var o,i,c,s,l,u,d,m;return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,o=R.getState(),i=o.account,c=o.webRtc,s=e.updateWebRtc,"complete"!==r){a.next=20;break}return l=c.iceCandidates[n],a.next=8,s("iceCandidates",Object(y.a)({},c.iceCandidates,Object(h.a)({},n,Object(y.a)({},c.iceCandidates[n],{isGatherComplete:!0}))));case 8:if(!l||l.sendStatus||!l.doSend){a.next=18;break}return u=l.candidates.map(function(e){return JSON.stringify(e.candidate)}),d="user"===c.localCallHistory.chatHistory.type?"UserConnection":"Board",m="user"===c.localCallHistory.chatHistory.type?i.user.id:c.showCommunication,t.apis.addIceCandidate({iceCandidateDetail:{iceCandidate:u,uid:i.user.id,broadCastId:m,broadCastType:d},userList:[{userId:n}]}),a.next=16,s("iceCandidates",Object(y.a)({},c.iceCandidates,Object(h.a)({},n,Object(y.a)({},c.iceCandidates[n],{sendStatus:!0}))));case 16:a.next=20;break;case 18:return a.next=20,s("iceCandidates",Object(y.a)({},c.iceCandidates,Object(h.a)({},n,Object(y.a)({},c.iceCandidates[n],{isGatherComplete:!0,sendStatus:!1}))));case 20:a.next=25;break;case 22:a.prev=22,a.t0=a.catch(0),console.error("Error in offerHandler",n);case 25:case"end":return a.stop()}},a,null,[[0,22]])}));return function(e,t){return a.apply(this,arguments)}}()},Qi=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.webRtc,o=a.updateWebRtc,i=a.account,c=a.database,s=r.peerConnections[t].pc,e.next=4,s.pc.close();case 4:return delete r.peerConnections[t],e.next=7,Li(Vi(a),t,Gi(a),Zi(a,n),Ji(a,n),Yi(a),Ki(a,n));case 7:return l=e.sent,e.next=10,l.createOffer(r.connectedUsers[i.user.id].streams[0]);case 10:return e.next=12,o("peerConnections",Object(y.a)({},r.peerConnections,Object(h.a)({},t,{pc:l,user:c.User.byId[t]})));case 12:delete r.iceCandidates[t];case 13:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),_i=function(e){if(e.isLive&&"board"===e.localCallHistory.chatHistory.type)return Object.values(e.connectedUsers).find(function(e){return"connected"===e.iceCandidateStatus});return!1},Zi=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r,o){var i,c,s,l,u,d,m,p,f,v;return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:i=e.updateWebRtc,c=t.apis,s=R.getState(),l=s.webRtc,u=s.account,d=s.database;try{m=l.localCallHistory.chatHistory.connectionId,p=u.user.id,f=o,v=r.iceConnectionState,c.onPcStatusChange({boardId:m,userId:p,pcId:f,status:v})}catch(n){console.error("Faild to update onPcStatusChange",n)}return a.next=6,i("connectedUsers",Object(y.a)({},l.connectedUsers,Object(h.a)({},o,Object(y.a)({},l.connectedUsers[o],{iceCandidateStatus:r.iceConnectionState}))));case 6:return a.next=8,i("peerConnections",Object(y.a)({},l.peerConnections,Object(h.a)({},o,Object(y.a)({},l.peerConnections[o],{iceCandidateStatus:r.iceConnectionState}))));case 8:"failed"===r.iceConnectionState&&(_i(R.getState().webRtc)?Qi(o,{webRtc:l,account:u,updateWebRtc:i,database:d},{apis:c}):console.log("CLOSE CALL"));case 9:case"end":return a.stop()}},a)}));return function(e,t,n){return a.apply(this,arguments)}}()},Xi=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r,o,i){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("communicationContainer","list");case 2:return e.next=4,t("showCommunication",a);case 4:return e.next=6,t("localCallHistory",Object(y.a)({},o.localCallHistory,{chatHistory:{connectionId:i,type:r,user:{user:n.User.byId[a]},broadCastId:a}}));case 6:t("showIncommingCall",!0);case 7:case"end":return e.stop()}},e)}));return function(t,a,n,r,o,i){return e.apply(this,arguments)}}(),$i=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l,u,d,m,p,f,v,b,g,C;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.uid,o=n.offer,i=t.updateWebRtc,c=t.database,s=R.getState(),l=s.webRtc,u=s.account,d=a.apis,e.prev=4,m=l.peerConnections[n.uid],p=null,f=!1,!m){e.next=31;break}if(v=l.peerConnections[n.uid],b=v.pc,"connected"!==v.iceCandidateStatus){e.next=17;break}return e.next=13,b.createAnswer(o,null);case 13:p=e.sent,f=!0,e.next=29;break;case 17:return e.next=19,b.pc.close();case 19:return delete l.peerConnections[r],e.next=22,Li(Vi(t),r,Gi(t),Zi(t,a),Ji(t,a),Yi(t),Ki(t,a));case 22:return g=e.sent,e.next=25,g.createAnswer(o,l.connectedUsers[u.user.id].streams[0]);case 25:return p=e.sent,e.next=28,i("peerConnections",Object(y.a)({},l.peerConnections,Object(h.a)({},r,{pc:g,user:c.User.byId[r]})));case 28:delete l.iceCandidates[r];case 29:e.next=38;break;case 31:return e.next=33,Li(Vi(t),r,Gi(t),Zi(t,a),Ji(t,a),Yi(t),Ki(t,a));case 33:return C=e.sent,e.next=36,C.createAnswer(o,l.streams[u.user.id].stream[0]);case 36:p=e.sent,i("peerConnections",Object(y.a)({},l.peerConnections,Object(h.a)({},r,{pc:C,user:c.User.byId[r]})));case 38:d.createAnswer({answerDetail:{answer:p,uid:u.user.id,broadCastId:"user"===l.localCallHistory.chatHistory.type?u.user.id:l.showCommunication,broadCastType:"user"===l.localCallHistory.chatHistory.type?"UserConnection":"Board",callType:l.localCallHistory.mediaType,isConnected:f},userList:[{userId:r}]}),e.next=44;break;case 41:e.prev=41,e.t0=e.catch(4),console.error("erro in onlive offer handler",e.t0);case 44:case"end":return e.stop()}},e,null,[[4,41]])}));return function(t,a,n){return e.apply(this,arguments)}}(),ec=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l,u,d,m,p;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.getState(),o=r.database,i=t.updateWebRtc,c=n.broadCastId,s=n.broadCastType,l=n.connectionId,u=n.uid,d="UserConnection"===s?"user":"board",m=R.getState(),p=m.webRtc,i("currentOffer",n),i("pendingOffers",Object(y.a)({},p.pendingOffers,Object(h.a)({},u,n))),p.isLive){e.next=12;break}return e.next=10,Xi(i,c,o,d,p,l);case 10:e.next=14;break;case 12:return e.next=14,$i(t,a,n);case 14:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),tc=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l,u,d,m;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.updateWebRtc,o=n.broadCastId,i=n.broadCastType,c=n.connectionId,s=n.uid,l="UserConnection"===i?"user":"board",u=R.getState(),d=u.webRtc,m=u.database,e.next=7,r("localCallHistory",Object(y.a)({},d.localCallHistory,{chatHistory:{connectionId:c,type:l,user:{user:m.User.byId[o]},broadCastId:o}}));case 7:return e.next=9,r("chatHistory",{connectionId:c,type:l,user:{user:m.User.byId[o]},broadCastId:o});case 9:return e.next=11,r("showCommunication",o);case 11:r("showIncommingCall",!0),r("currentOffer",n),r("pendingOffers",Object(y.a)({},d.pendingOffers,Object(h.a)({},s,n))),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),console.error("Offer On open Communication Open error",e.t0);case 19:case"end":return e.stop()}},e,null,[[0,16]])}));return function(t,a,n){return e.apply(this,arguments)}}(),ac=function(e,t,a){var n=e.updateWebRtc;setTimeout(Object(W.a)(L.a.mark(function a(){var r,o;return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:r=R.getState(),(o=r.webRtc).isLive||o.localCallHistory.callEnd||(Dt(e,t,t.apis)(),n("showIncommingCall",!1),n("communicationContainer","history"));case 2:case"end":return a.stop()}},a)})),a||6e4)},nc=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bi(t,a,n);case 2:if(!r.showCommunication){e.next=7;break}return e.next=5,ec(t,a,n);case 5:e.next=9;break;case 7:return e.next=9,tc(t,a,n);case 9:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),rc=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r,o){var i,c,s,l,u,d;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=a.account,c=r.uid,s=r.broadCastId,l=r.broadCastType,u=r.connectionId,d=n.apis;try{d.callStatusChange({callStatusDetails:{broadCastType:l,broadCastId:s,uid:i.user.id,connectionId:u,type:"busy"},userList:[{userId:c}]})}catch(t){console.error("Call Stautus change error when live",t)}case 4:case"end":return e.stop()}},e)}));return function(t,a,n,r,o){return e.apply(this,arguments)}}(),oc=(function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l,u,d,m,p;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.getState(),o=r.webRtc,i=n.uid,c=n.connectionId,s=n.broadCastType,l=n.broadCastId,u="Board"===s?"board":"user",d=t.account,m=t.updateWebRtc,p=a.apis,!o.showIncommingCall&&!o.isConnecting){e.next=16;break}if(o.localCallHistory.chatHistory.connectionId!==l){e.next=13;break}return e.next=9,m("pendingOffers",Object(y.a)({},o.pendingOffers,Object(h.a)({},i,n)));case 9:return e.next=11,m("connectedUsers",Object(y.a)({},o.connectedUsers,Object(h.a)({},n.uid,{streams:[],type:n.callType})));case 11:return e.next=13,m("streams",Object(y.a)({},o.streams,Object(h.a)({},n.uid,Object(y.a)({},o.streams[n.uid],{callEnd:!1,stream:[],callType:"Incoming"}))));case 13:rc("Call is busy",t,a,n,o),e.next=41;break;case 16:if(o.isLive||(ac(t,a),p.callStatusChange({callStatusDetails:{broadCastType:s,broadCastId:l,uid:d.user.id,connectionId:c,type:"ringing"},userList:[{userId:i}]})),"board"!==u){e.next=29;break}if(!o.isLive){e.next=27;break}if(o.localCallHistory.chatHistory.connectionId!==l){e.next=24;break}return e.next=22,nc(t,a,n,o);case 22:e.next=25;break;case 24:rc("Call is busy",t,a,n,o);case 25:e.next=29;break;case 27:return e.next=29,nc(t,a,n,o);case 29:if("user"!==u){e.next=41;break}if(!o.isLive){e.next=39;break}if(o.localCallHistory.chatHistory.connectionId!==c||"board"===o.localCallHistory.chatHistory.type){e.next=36;break}return e.next=34,nc(t,a,n,o);case 34:e.next=37;break;case 36:rc("Call is busy",t,a,n,o);case 37:e.next=41;break;case 39:return e.next=41,nc(t,a,n,o);case 41:case"end":return e.stop()}},e)}))}(),function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l,u,d,m,p,f;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=a.apis,o=t.updateWebRtc,i=R.getState(),c=i.webRtc,s=i.account,i.database,l=n.uid,u=n.answer,n.boardId,d=n.callType,m=c.peerConnections[l].pc,p=c.iceCandidates[l],!u){e.next=25;break}if(m.setRemoteDescription(u),!p.isGatherComplete){e.next=16;break}return f=p.candidates.map(function(e){return JSON.stringify(e.candidate)}),r.addIceCandidate({iceCandidateDetail:{iceCandidate:f,uid:s.user.id,broadCastId:"user"===c.localCallHistory.chatHistory.type?s.user.id:c.showCommunication,broadCastType:"user"===c.localCallHistory.chatHistory.type?"UserConnection":"Board"},userList:[{userId:l}]}),e.next=14,o("iceCandidates",Object(y.a)({},c.iceCandidates,Object(h.a)({},l,Object(y.a)({},c.iceCandidates[l],{sendStatus:!0,doSend:!1}))));case 14:e.next=18;break;case 16:return e.next=18,o("iceCandidates",Object(y.a)({},c.iceCandidates,Object(h.a)({},l,Object(y.a)({},c.iceCandidates[l],{sendStatus:!1,doSend:!0}))));case 18:if(n.isConnected){e.next=21;break}return e.next=21,o("connectedUsers",Object(y.a)({},c.connectedUsers,Object(h.a)({},l,{streams:[],type:d})));case 21:return e.next=23,o("isLive",!0);case 23:return e.next=25,o("isConnecting",!1);case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(0),console.error("Error on onAnswer",n.uid,e.t0);case 30:case"end":return e.stop()}},e,null,[[0,27]])}))}(),function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.updateWebRtc,e.next=3,Dt(t,a,a.apis)(n);case 3:r("showIncommingCall",!1),r("communicationContainer","history");case 5:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}());(function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r){var o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=R.getState(),i=o.webRtc,c=n.uid,s=n.broadCastId,n.broadCastType,l=n.type,u=n.connectionId,"user"===l&&(i.isLive||i.peerConnections[c]||i.showIncommingCall)&&l===i.localCallHistory.chatHistory.type&&i.localCallHistory.chatHistory.connectionId===u&&(r(!0),oc(t,a,n)),"board"===l&&(i.isLive||i.showIncommingCall||i.showOutgoingCall)&&i.localCallHistory.chatHistory.connectionId===s&&(r(!0),oc(t,a,n));case 4:case"end":return e.stop()}},e)}))})(),function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l,u,d,m,p,f;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=a.database,o=a.updateWebRtc,i=a.account,c=R.getState(),s=c.webRtc,l=null,"user"===s.localCallHistory.chatHistory.type?l=[s.localCallHistory.chatHistory.user.user]:(u=Object.values(r.BoardMember.byId).filter(function(e){return e.boardId===t}),d=u.map(function(e){return r.User.byId[e.tuserId]}),l=d.filter(function(e){return e.id!==i.user.id}).filter(function(e){return e.activeStatus})),m=l.map(function(e){return Li(Vi(a),e.id,Gi(a),Zi(a,n),Ji(a,n),Yi(a),Ki(a,n))}),e.next=8,Promise.all(m);case 8:return p=e.sent,f=l.reduce(function(e,t,a){return e[t.id]={pc:p[a],user:t,iceCandidateStatus:"Connecting..."},e},{}),o("peerConnections",f),e.abrupt("return",l);case 14:e.prev=14,e.t0=e.catch(0),console.error("Error in creating pc",e.t0);case 17:case"end":return e.stop()}},e,null,[[0,14]])}))}();function ic(e){return cc.apply(this,arguments)}function cc(){return(cc=Object(W.a)(L.a.mark(function e(t){var a,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.account,n=t.apis,r=t.webRtc,o=t.message,e.prev=1,e.next=4,n.addUserMessage({tuserId:r.chatHistory.user.user.id,fuserId:a.user.id,timeStamp:Date.now(),message:o,url:null,readStatus:0,connectionId:r.chatHistory.connectionId,broadCastId:"UserConnection-".concat(a.user.id),broadCastUserList:[{userId:r.chatHistory.user.user.id}]});case 4:return i=e.sent,e.abrupt("return",i);case 8:return e.prev=8,e.t0=e.catch(1),console.error("Error in sending message",e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function sc(e){return lc.apply(this,arguments)}function lc(){return(lc=Object(W.a)(L.a.mark(function e(t){var a,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.account,n=t.apis,r=t.webRtc,o=t.message,e.prev=1,e.next=4,n.addBoardMessage({boardId:r.chatHistory.connectionId,message:o,userId:a.user.id,timeStamp:Date.now(),url:null,remarks:null,broadCastId:"Board-".concat(r.chatHistory.connectionId),readStatus:0});case 4:return i=e.sent,e.abrupt("return",i);case 8:return e.prev=8,e.t0=e.catch(1),console.error("Error in sending board message",e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}var uc=function(e,t,a,n,r){var o=e.webRtc,i=e.addDatabaseSchema,c=e.message,s=e.account,l=e.deleteDatabaseSchema;"board"===o.chatHistory.type?"add"===a?i("BoardMessage",{id:t,boardId:o.chatHistory.connectionId,message:c,userId:s.user.id,timeStamp:Date.now(),url:null,remarks:null,readStatus:0,status:"loading"}):(l("BoardMessage",{id:n}),i("BoardMessage",{id:t,boardId:o.chatHistory.connectionId,message:c,userId:s.user.id,timeStamp:Date.now(),url:null,remarks:null,readStatus:0,status:r})):"add"===a?i("UserMessage",{id:t,tuserId:o.chatHistory.user.user.id,fuserId:s.user.id,timeStamp:Date.now(),connectionId:o.chatHistory.connectionId,message:c,url:null,readStatus:0,status:"loading"}):(l("UserMessage",{id:n}),i("UserMessage",{id:t,tuserId:o.chatHistory.user.user.id,fuserId:s.user.id,timeStamp:Date.now(),connectionId:o.chatHistory.connectionId,message:c,url:null,readStatus:0,status:r}))};function dc(e){return mc.apply(this,arguments)}function mc(){return(mc=Object(W.a)(L.a.mark(function e(t){var a,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.resend,n=t.deleteDatabaseSchema,a&&n("UserMessage",{id:a}),r=Date.now(),"board"!==t.webRtc.chatHistory.type){e.next=12;break}return uc(t,r,"add"),e.next=8,sc(t);case 8:(o=e.sent)?uc(t,o,"deleteAdd",r):uc(t,o,"deleteAdd",r,"error"),e.next=17;break;case 12:return uc(t,r,"add"),e.next=15,ic(t);case 15:(i=e.sent)?uc(t,i,"deleteAdd",r):uc(t,i,"deleteAdd",r,"error");case 17:case"end":return e.stop()}},e)}))).apply(this,arguments)}var pc=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={message:""},a.onMessageType=function(e){a.setState({message:e.target.value})},a.handleKeyPress=function(){var e=Object(W.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"Enter"===t.key&&(t.preventDefault(),a.sendMessage());case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.sendMessage=Object(W.a)(L.a.mark(function e(){var t;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=a.state.message).replace(/\s/g,"").length){e.next=3;break}return e.abrupt("return");case 3:return a.setState({message:""}),e.prev=4,e.next=7,dc(Object(y.a)({},a.props,{message:t}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),console.log("Error");case 12:case"end":return e.stop()}},e,null,[[4,9]])})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.message;return o.a.createElement("div",{className:"chat-box",style:{marginTop:10}},o.a.createElement(Te.a,{rows:2,placeholder:"Message...",onChange:this.onMessageType,value:e,onKeyPress:this.handleKeyPress}),o.a.createElement(ve.b,{style:{background:"#154155",color:"white",width:"10%"},rightIcon:o.a.createElement(X.a,{icon:"direction-right",color:"white",iconSize:25}),onClick:this.sendMessage}))}}]),t}(o.a.Component);pc.defaultProps={peerId:0};var fc=pc,vc=a(49),bc=function(e){var t=e.own,a=e.obj,n=e.props,r=e.type;return o.a.createElement("div",{className:t.isOwn?"i-chat right":"i-chat left",key:a.id,style:{marginTop:a.showImage&&15}},a.showImage&&!t.isOwn&&o.a.createElement("div",{className:"img-wrap"},o.a.createElement(it,{imgUrl:t.user.userDetails&&t.user.userDetails.image?"".concat(oe,"/user/").concat(1e7+parseInt(t.user.id,10),"/profile/").concat(t.user.userDetails.image):vc})),o.a.createElement("div",{className:"text-contain".concat(a.showImage||t.isOwn?"":" spaced")},a.showImage&&!t.isOwn&&o.a.createElement("span",{style:{fontSize:10,color:"#757575",marginLeft:5}},t.user.firstName),o.a.createElement("div",{className:"text",style:{background:t.isOwn?"error"===a.status?"#ff7470":"#A9DBEF":"white",border:"".concat(t.isOwn?"error"===a.status?"1px solid red":"1px solid #A9DBEF":"1px solid white"),padding:2,paddingBottom:0,margin:0,marginRight:5,marginLeft:a.showImage||t.isOwn?3:r?3:45,marginBottom:!a.showImage&&0}},a.message,o.a.createElement("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"flex-end"}},o.a.createElement(Ni.a,{style:{color:"#757575"},format:"h:mm:a"},a.timeStamp))),o.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",margin:0}},"loading"===a.status&&o.a.createElement(zn.a,{size:"15",intent:"primary"}),"error"===a.status&&o.a.createElement(X.a,{icon:"repeat",iconSize:"15",style:{cursor:"pointer"},onClick:function(){return dc(Object(y.a)({},n,{message:a.message,resend:a.id}))}}),o.a.createElement("div",{style:{marginTop:2,display:"flex",width:"100%"}},function(e,t){var a=e.database,n=e.account,r=Oi.a.uniq(t.filter(function(e){return e.userId!==n.user.id}).map(function(e){return e.userId})),i=[];return r.forEach(function(e){var t=Object.values(a.UserDetail.byId).find(function(t){return t.userId===e});i.push(o.a.createElement("div",{className:"seen-user"},o.a.createElement(it,{imgUrl:t&&t.image?"".concat(oe,"/user/").concat(1e7+parseInt(t.userId,10),"/profile/").concat(t.image):vc})))}),i}(n,a.seenStatus)))))},gc=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).scrollToBottom=function(){a.scrollToEnd.current.scrollIntoView({behavior:"auto"})},a.goBack=function(){(0,a.props.change)("list")},a.toCallScreen=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=a.props,r=n._callHandler,o=n.apis,i=n.change,c=n.updateWebRtc,s=n.webRtc,l=n.account,n.database,e.next=4,c("isCallUpgraded",!1);case 4:return e.next=6,c("isConnecting",!0);case 6:return e.next=8,c("connectedUsers",Object(y.a)({},s.connectedUsers,Object(h.a)({},l.user.id,{streams:[],type:t})));case 8:return e.next=10,c("localCallHistory",{chatHistory:s.chatHistory,stream:null,mediaType:t,callType:"Outgoing",callEnd:!1});case 10:ac(a.props,{apis:o},62e3),r(o,null,t),i("connecting"),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("Error in calling",e.t0);case 18:case"end":return e.stop()}},e,null,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),a.containerHandler=function(e,t,n,r){var i=a.props.webRtc;switch(e.type){case"date":return o.a.createElement("div",{key:r,style:{width:"95%",display:"flex",justifyContent:"center",alignItems:"center",margin:10}},o.a.createElement(Ni.a,{style:{color:"#757575",padding:5,border:"1px solid #757575",borderRadius:10,fontSize:10},format:"YYYY MMM DD"},e.timeStamp));case"Incoming":return Ti(e,t,i.chatHistory.type,r);case"Outgoing":return Pi(e,t,i.chatHistory.type,r);default:return e.message?o.a.createElement(bc,{key:e.id,own:ji(e,a.props),obj:e,props:a.props,type:n}):null}},a.isShowCallerButton=function(){var e=R.getState(),t=e.webRtc,a=e.database,n=t.janus,r=!1,o=!1,i=!1;if(n){n.oneToOneCall,n.conferenceCall;"board"===t.chatHistory.type?(r=!a.Board.byId[t.chatHistory.connectionId].activeStatus,o=!a.Board.byId[t.chatHistory.connectionId].activeStatus,i=a.Board.byId[t.chatHistory.connectionId].activeStatus):(r=n.oneToOneCall,o=n.oneToOneCall)}return{showVideo:o,showAudio:r,showJoin:i}},a.state={messages:[],lastMessageId:null,unSeenNo:null},a.scrollToEnd=o.a.createRef(),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Ii(this.props);this.setState(Object(y.a)({},e)),this.scrollToBottom()}},{key:"componentWillReceiveProps",value:function(e){var t=Ii(e);this.setState(Object(y.a)({},t))}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props,a=t.style,n=t.webRtc,r=t.database,i=t.account,c=t.fromLive,s=n.chatHistory.user,l=this.state.messages,u=this.isShowCallerButton(),d=u.showAudio,m=u.showVideo,p=u.showJoin;return n.showCommunication?o.a.createElement("div",{style:Object(y.a)({},a,{background:"#DDE1E2"}),className:"chat-history",onClick:function(){return function(e,t){var a=e.apis,n=e.webRtc,r=e.account,o=e.addDatabaseSchema,i=t.unSeenNo,c=t.lastMessageId;i>0&&("user"===n.chatHistory.type&&(a.addUserMessageSeenStatus({userId:r.user.id,umId:c,timeStamp:Date.now(),status:!0,broadCastId:"UserConnection-".concat(r.user.id),broadCastUserList:[{userId:n.chatHistory.user.user.id}]}),o("UserMessageSeenStatus",{id:Date.now(),userId:r.user.id,umId:c,timeStamp:Date.now(),status:!0})),"board"===n.chatHistory.type&&(a.addBoardMessageSeenStatus({userId:r.user.id,bmId:c,timeStamp:Date.now(),status:!0,broadCastId:"Board-".concat(n.chatHistory.connectionId)}),o("BoardMessageSeenStatus",{id:Date.now(),userId:r.user.id,bmId:c,timeStamp:Date.now(),status:!0})))}(e.props,e.state)}},!c&&o.a.createElement("div",{className:"top",style:{background:"white"}},o.a.createElement("div",null,o.a.createElement(ve.b,{className:"arrow-btn",minimal:!0,intent:"default",icon:"double-chevron-left",onClick:this.goBack})),o.a.createElement("div",{className:"op-name"},"user"===n.chatHistory.type?ct(s.user):r.Board.byId[n.chatHistory.connectionId].name,"user"===n.chatHistory.type&&s.user.activeStatus&&o.a.createElement("div",{className:"green-dot"})),o.a.createElement("div",{className:"call-control"},d&&o.a.createElement(ve.b,{icon:"phone",intent:"success",onClick:function(){return e.toCallScreen("audio")}}),m&&o.a.createElement(ve.b,{icon:"mobile-video",intent:"success",onClick:function(){return e.toCallScreen("video")}}),p&&o.a.createElement(ve.b,{intent:"success",onClick:function(){return e.toCallScreen("audio")},text:"Join"}))),o.a.createElement("div",{className:"chats",id:"pcChats"},l.sort(ut).map(function(t,a,n){return e.containerHandler(t,i,0!==a&&n[a-1].type)}),o.a.createElement("div",{className:"i-chat left",ref:this.scrollToEnd})),o.a.createElement(fc,this.props)):o.a.createElement("div",null)}}]),t}(o.a.Component),hc=a(281),yc=a.n(hc),Cc=a(150),wc=function(e){var t=e.isUser,a=e.database,n=e.webRtc,r=t?Object.values(a.UserDetail.byId).find(function(e){return e.userId===n.localCallHistory.chatHistory.user.user.id}):null;return t&&r&&r.image?o.a.createElement("div",{className:"img-container"},o.a.createElement(it,{imgUrl:"".concat(oe,"/user/").concat(1e7+parseInt(r.userId,10),"/profile/").concat(r.image)})):t?o.a.createElement("div",{className:"img-container"},o.a.createElement(it,{imgUrl:Cc})):o.a.createElement("div",{className:"icon-container"},o.a.createElement(X.a,{icon:"application",iconSize:130,style:{color:"#757575"}}))},Ec=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={autoClose:null,callStatus:"connecting..."},a.callReject=Object(W.a)(L.a.mark(function e(){var t,n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props,n=t.closeHandler,r=t.change,e.next=3,n("callReject");case 3:r("history");case 4:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(){var e=Object(W.a)(L.a.mark(function e(t){var a,n,r,o,i=this;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=this.props.webRtc,n=this.state.autoClose,a!==t.webRtc&&("user"===t.webRtc.localCallHistory.chatHistory.type&&(r=t.webRtc.connectedUsers[a.localCallHistory.chatHistory.user.user.id]||{},this.setState({callStatus:r.status}),"busy"!==r.status&&"declined"!==r.status||(this.setState({callStatus:r.status}),n||(o=setTimeout(this.callReject,2e3),this.setState({autoClose:o})))),"board"===t.webRtc.chatHistory.type&&Object.values(t.webRtc.connectedUsers).forEach(function(e){"ringing"===e.status&&i.setState({callStatus:"ringing"})}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.callStatus,t=this.props,a=t.webRtc,n=t.database,r="user"===a.localCallHistory.chatHistory.type;return o.a.createElement("div",{className:"outgoing-call-screen"},o.a.createElement(ft,{url:yc.a}),o.a.createElement("div",{className:"person-icon-container"},o.a.createElement("div",{className:"person-name-status"},o.a.createElement("span",{className:"name"},"user"===a.chatHistory.type?"".concat(n.User.byId[a.localCallHistory.chatHistory.user.user.id].firstName," ").concat(n.User.byId[a.localCallHistory.chatHistory.user.user.id].lastName):n.Board.byId[a.showCommunication].name),o.a.createElement("span",{className:"status",style:{textTransform:"capitalize",color:"Declined"===e?"red":"white"}},e," ","...")),o.a.createElement(wc,{isUser:r,webRtc:a,database:n}),o.a.createElement("div",{className:"controllers"},"declined"===e||"disconnected"===e||"busy"===e?o.a.createElement(ve.b,{large:!0,intent:"danger"},o.a.createElement($t.e,{size:20})):o.a.createElement(ve.b,{onClick:this.callReject,large:!0,intent:"danger"},o.a.createElement(Hr.b,{size:20})))))}}]),t}(o.a.Component),Sc=function(e){var t=e.onClose,a=e.onClickItem;return o.a.createElement("div",{className:"sc-chat-list"},o.a.createElement("div",{className:"sc-cl-header"},o.a.createElement("div",null),o.a.createElement("div",{className:"sc-cl-title"},"Chats"),o.a.createElement("div",{className:"icon-con"},o.a.createElement(X.a,{className:"arrow-btn",onClick:t,icon:"double-chevron-left"}))),o.a.createElement("div",{className:"sc-cl-content"},o.a.createElement(Ui,Object.assign({},e,{fromLive:!0,showChatHistory:a}))),o.a.createElement("div",{className:"sc-cl-footer"}))},Oc=function(e){var t=e.onClose,a=e.webRtc,n=e.database,r=a.chatHistory.user;return o.a.createElement("div",{className:"sc-chat-history"},o.a.createElement("div",{className:"sc-ch-header"},o.a.createElement("div",{className:"icon-con"},o.a.createElement(X.a,{className:"arrow-btn",onClick:function(){return t(null)},icon:"double-chevron-right"})),o.a.createElement("div",{className:"sc-ch-title"},"user"===a.chatHistory.type?"".concat(r.user.firstName," ").concat(r.user.lastName):n.Board.byId[a.chatHistory.connectionId].name),o.a.createElement("div",null)),o.a.createElement("div",{className:"sc-ch-content"},o.a.createElement(gc,Object.assign({},e,{fromLive:!0}))),o.a.createElement("div",{className:"sc-ch-footer"}))},kc=a(282),Ic=a.n(kc),jc=function(){var e=Object(W.a)(L.a.mark(function e(t,a){var n,r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a._callHandler,r=a.apis,o=a.updateWebRtc,i=a.webRtc,c=a.account,s=a.updateDatabaseSchema,l=i.localCallHistory.mediaType,e.next=4,o("isCallUpgraded",!0);case 4:if(!i.localCallHistory.stream){e.next=10;break}return e.next=7,o("connectedUsers",Object(y.a)({},i.connectedUsers,Object(h.a)({},c.user.id,Object(y.a)({},i.connectedUsers[c.user.id],{type:t}))));case 7:"board"===i.localCallHistory.chatHistory.type&&s("Board",{id:i.localCallHistory.chatHistory.connectionId,activeStatus:c.user.id}),o("localCallHistory","mute"===t||"unmute"===t?Object(y.a)({},i.localCallHistory,{callEnd:!1,mute:"mute"===t}):Object(y.a)({},i.localCallHistory,{mediaType:t,callEnd:!1})),n(r,null,t,l);case 10:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),xc=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).recordingHandler=Object(W.a)(L.a.mark(function e(){var t,n,r,o,i;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state.startRecording,n=a.props,r=n.updateWebRtc,o=n.webRtc,t){e.next=10;break}return e.next=5,zi(1,a.props);case 5:i=e.sent,r("mediaRecording",i),a.setState({startRecording:!0}),e.next=13;break;case 10:o.mediaRecording.stopRecording(),r("mediaRecording",null),a.setState({startRecording:!1});case 13:case"end":return e.stop()}},e)})),a.callReject=function(e){var t=a.props,n=t.closeHandler,r=t.change;(0,t.remoteCallEndMinimizer)(),n(e),r("history")},a.callUpGradeController=function(){var e=Object(W.a)(L.a.mark(function e(t){var n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.props.webRtc,n.localCallHistory.mediaType!==t){e.next=6;break}jc("audio",a.props),e.next=13;break;case 6:if("whiteBoard"!==t){e.next=12;break}return e.next=9,a.setState({showWhiteBoard:!0});case 9:jc(t,a.props),e.next=13;break;case 12:jc(t,a.props);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.muteToggle=function(){},a.state={showWhiteBoard:!1,startRecording:!1},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.webRtc,a=e.database;if(t.isLive){var n=t.localCallHistory.chatHistory,r=n.type,o=n.connectionId;if("board"===r)Object.values(a.Board.byId).find(function(e){return e.id===parseInt(o,10)}).activeStatus||this.callReject("autoClose")}}},{key:"render",value:function(){var e=this,t=this.props,a=t.webRtc,n=t.account,r=this.state,i=r.showWhiteBoard,c=r.startRecording;return o.a.createElement("div",{className:"controllers"},o.a.createElement(Ic.a,null),i&&o.a.createElement(U.a,{to:"/".concat(n.user.slug,"/drawing-board")}),o.a.createElement(ve.b,{"data-tip":"Call End",className:"pc-control-btn bg-red",onClick:this.callReject},o.a.createElement(er.c,{size:20})),o.a.createElement(ve.b,{"data-tip":"Video",className:"video"===a.localCallHistory.mediaType?"pc-control-btn active":"pc-control-btn",onClick:function(){return e.callUpGradeController("video")}},o.a.createElement(er.f,{size:20})),o.a.createElement(ve.b,{"data-tip":"ScreenShare",className:"screenshare"===a.localCallHistory.mediaType?"pc-control-btn active":"pc-control-btn",onClick:function(){return e.callUpGradeController("screenshare")}},o.a.createElement(er.a,{size:20})),o.a.createElement(ve.b,{"data-tip":"Recording",onClick:function(){return e.recordingHandler()},className:c?"pc-control-btn active record":"pc-control-btn"},o.a.createElement(Ur.d,{size:20})),o.a.createElement(ve.b,{"data-tip":"Mute",className:a.localCallHistory.mute?"pc-control-btn active":"pc-control-btn",onClick:function(){return e.callUpGradeController(a.localCallHistory.mute?"unmute":"mute")}},o.a.createElement(er.b,{size:20})))}}]),t}(o.a.Component),Nc=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,a=t.database,n=t.webRtc,r="user"===n.localCallHistory.chatHistory.type?n.localCallHistory.chatHistory.user.user.id:a.Board.byId[n.localCallHistory.chatHistory.connectionId].activeStatus,o="user"===n.localCallHistory.chatHistory.type?n.localCallHistory.chatHistory.user.user.id:e.database.Board.byId[n.localCallHistory.chatHistory.connectionId].activeStatus;return JSON.stringify(n.connectedUsers[o])!==JSON.stringify(e.webRtc.connectedUsers[o])||r!==o}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.webRtc,a=e.database,n=e.account,r=document.getElementById("video-mentor"),o="user"===t.localCallHistory.chatHistory.type?t.localCallHistory.chatHistory.user.user.id:a.Board.byId[t.localCallHistory.chatHistory.connectionId].activeStatus,i=t.connectedUsers[o];r&&i&&i.streams.forEach(function(e){e&&(e.streams&&(r.srcObject=e.streams[0]),parseInt(o,10)===n.user.id&&(r.srcObject=e),r.srcObject=e)})}},{key:"render",value:function(){var e=this.props,t=e.database,a=e.webRtc,n=e.account,r="board"===a.localCallHistory.chatHistory.type&&t.Board.byId[a.localCallHistory.chatHistory.connectionId].activeStatus===n.user.id;return o.a.createElement("div",{className:"pc-main-screen"},o.a.createElement("video",{id:"video-mentor",playsInline:!0,controlsList:"noremoteplayback",autoPlay:!0,muted:r,className:"pc-main-video"}))}}]),t}(o.a.Component),Dc=function(e){var t=e.pc,a=e.database,n=e.mute,r=e.userId,i=e.status,c=e.account,s=Object.values(a.UserDetail.byId).find(function(e){return e.userId===r}),l=a.User.byId[r];return o.a.createElement("div",{className:"pc-each-screen"},o.a.createElement("video",{muted:n,id:"video-".concat(l.id),playsInline:!0,poster:s?"".concat(oe,"/user/").concat(1e7+parseInt(r,10),"/profile/").concat(s.image):null,autoPlay:!0}),o.a.createElement("div",{className:"pc-info"},o.a.createElement("div",{className:"pc-short-name"},o.a.createElement("span",null,l.id===c.user.id?"You":"".concat(l.firstName[0]).concat(l.lastName[0]))),o.a.createElement("div",{className:"pc-ice"},t?o.a.createElement("span",{className:"pc-ice-status"},i):null)))},Ac=function(e){var t=e.account,a=e.database,n=R.getState().webRtc,r=n.localCallHistory.chatHistory,i=r.type,c=r.connectionId,s="user"===i?n.mainStreamId:a.Board.byId[c].activeStatus,l=Object.keys(n.connectedUsers).filter(function(e){return parseInt(e,10)!==t.user.id}).filter(function(e){return"disconnected"!==n.connectedUsers[e].iceCandidateStatus}).filter(function(e){return parseInt(e,10)!==parseInt(s,10)}).filter(function(e){return n.connectedUsers[e].streams.length>0}).map(function(e){return o.a.createElement(Dc,{account:t,status:n.connectedUsers[e].iceCandidateStatus,userId:parseInt(e,10),pc:n.peerConnections[parseInt(e,10)],database:a,mute:s===parseInt(e,10)})});return"user"===n.localCallHistory.chatHistory.type?[o.a.createElement(Dc,{account:t,userId:t.user.id,pc:t,mute:!0,key:t.user.id,database:a})]:[].concat(Object(g.a)(l),[o.a.createElement(Dc,{userId:t.user.id,mute:!0,account:t,pc:t,key:t.user.id,database:a})])},Tc=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"shouldComponentUpdate",value:function(e){var t=this.props.webRtc;return JSON.stringify(e.webRtc.connectedUsers)!==JSON.stringify(t.connectedUsers)}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.webRtc,a=(e.account,Object.keys(t.connectedUsers)),n=a.map(function(e){return document.getElementById("video-".concat(e))});n&&n.forEach(function(e,n){e&&t.connectedUsers[a[n]].streams.forEach(function(t){t&&(e.srcObject=t)})})}},{key:"render",value:function(){return o.a.createElement("div",{className:"pc-user-screens"},o.a.createElement(Ac,this.props))}}]),t}(o.a.Component),Rc=a(77),Pc=function(e){var t=e.webRtc,a=e.database,n=e.minimize,r=!1,i="",c="user"===t.localCallHistory.chatHistory.type?t.localCallHistory.chatHistory.user.user.id:a.Board.byId[t.localCallHistory.chatHistory.connectionId].activeStatus;if("user"===t.localCallHistory.chatHistory.type){var s=Object.values(a.UserDetail.byId).find(function(e){return e.userId===t.localCallHistory.chatHistory.user.user.id});i=s&&s.image?"".concat(oe,"/user/").concat(1e7+parseInt(s.userId,10),"/profile/").concat(s.image):Rc,t.connectedUsers[c]&&"audio"===t.connectedUsers[c].type&&(r=!0)}else t.connectedUsers[c]&&"audio"===a.Board.byId[t.localCallHistory.chatHistory.connectionId].mediaType&&(r=!0);return r?o.a.createElement("div",{className:"img-main-screen",style:{display:n?"none":"flex"}},o.a.createElement("div",{className:"user"===t.localCallHistory.chatHistory.type?"user":"board"},"user"===t.localCallHistory.chatHistory.type?o.a.createElement(it,{imgUrl:i}):o.a.createElement(X.a,{icon:"application",iconSize:130,style:{color:"#757575"}}))):o.a.createElement("div",null)},Mc=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleClickChatBox=function(e,t){var n=a.props,r=n.updateWebRtc,o=n.webRtc;t&&(r("connectionId",o.localCallHistory.chatHistory.connectionId),r("chatHistory",o.localCallHistory.chatHistory)),a.setState({showChatBox:e,showChatList:!1})},a.handleClickChatList=function(){var e=a.state.showChatList;a.setState({showChatList:!e})},a.callReject=function(){var e=a.props,t=e.closeHandler,n=e.change;t(),n("history")},a.state={showChatList:!1,showChatBox:null,unMessageCount:null},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.webRtc,t=jt(this.props).find(function(t){return t.connectionId===e.localCallHistory.chatHistory.connectionId});this.setState({unMessageCount:t})}},{key:"componentDidMount",value:function(){var e=this.props,t=e.webRtc,a=e.database,n=e.account;if("board"===t.localCallHistory.chatHistory.type&&t.localCallHistory.chatHistory&&a.Board.byId[t.localCallHistory.chatHistory.connectionId].activeStatus===n.user.id)document.getElementById("video-mentor")}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.webRtc,a=jt(e).find(function(e){return e.connectionId===t.localCallHistory.chatHistory.connectionId});this.setState({unMessageCount:a})}},{key:"render",value:function(){var e=this,t=this.props,a=t.style,n=t.webRtc,r=t.isMaximum,i=t.database,c=t.toggleMaximize,s=t.minimize,l=n.localCallHistory.chatHistory,u=l.user,d=l.type,m=this.state,p=m.showChatBox,f=m.showChatList,v=m.unMessageCount;return o.a.createElement("div",{className:"call-screen",style:a},f&&o.a.createElement(Sc,Object.assign({onClose:this.handleClickChatList,onClickItem:this.handleClickChatBox},this.props)),p&&o.a.createElement(Oc,Object.assign({onClose:this.handleClickChatBox},this.props)),o.a.createElement("div",{className:"top"},o.a.createElement(ve.b,{minimal:!0,className:"arrow-btn",intent:"default",icon:"menu",onClick:this.handleClickChatList}),o.a.createElement("div",{className:"op-name"},"user"===d?"".concat(u.user.firstName," ").concat(u.user.lastName):i.Board.byId[n.localCallHistory.chatHistory.connectionId].name),o.a.createElement(ve.b,{className:"arrow-btn",minimal:!0,onClick:function(){return e.handleClickChatBox(n.showCommunication,!0)}},o.a.createElement("div",{style:{position:"relative"}},o.a.createElement($t.g,{size:18}),v?0!==v.unSeenNo&&o.a.createElement(ot,{number:v.unSeenNo,size:10,top:-5}):null))),o.a.createElement("div",{className:"video-container"},o.a.createElement("div",{className:"pc-maxmin-btn"},o.a.createElement(ve.b,{onClick:c,className:"pc-control-btn"},r?o.a.createElement(Ur.b,{size:25}):o.a.createElement(Ur.a,{size:25}))),o.a.createElement(Pc,this.props),o.a.createElement(Tc,this.props),o.a.createElement(Nc,this.props)),!s&&o.a.createElement(xc,Object.assign({toggleMaximize:c},this.props)),o.a.createElement("div",{className:"pc-record-container"},n.recordedBlobs.map(function(e){return Object.values(e)[0]})))}}]),t}(o.a.Component),Hc=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return this.props.webRtc.isLive?o.a.createElement(Mc,this.props):o.a.createElement(Ec,this.props)}}]),t}(o.a.Component),Uc=a(283),Bc=a.n(Uc),Lc=a(150),Wc=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a.callAccept=function(){var e=Object(W.a)(L.a.mark(function e(t){var n,r,o,i,c,s;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,r=n.answerHandler,o=n.apis,i=n.updateWebRtc,c=n.webRtc,s=n.account,e.next=3,i("connectedUsers",Object(y.a)({},c.connectedUsers,Object(h.a)({},s.user.id,{streams:[]})));case 3:return e.next=5,i("isCallUpgraded",!1);case 5:return e.next=7,i("isLive",!0);case 7:return e.next=9,i("localCallHistory",Object(y.a)({},c.localCallHistory,{stream:null,mediaType:t,callType:"Incoming"}));case 9:return e.next=11,r(o,null,t);case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.callReject=Object(W.a)(L.a.mark(function e(){var t,n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.props,n=t.change,r=t.updateWebRtc,(0,t.closeHandler)(),r("showIncommingCall",!1),n("history");case 4:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.style,n=t.webRtc,r=t.database,i="user"===n.localCallHistory.chatHistory.type;return o.a.createElement("div",{style:a,className:"incoming-call-screen"},n.showIncommingCall&&o.a.createElement(ft,{incoming:!0,url:Bc.a}),o.a.createElement("div",{className:"person-icon-container",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"}},o.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignSelf:"center",flexDirection:"column"}},o.a.createElement("div",{style:{width:"100%",display:"flex",alignSelf:"center",justifyContent:"center",margin:5}},o.a.createElement("span",{style:{fontSize:20,fontWeight:"bold",color:"white"}},"user"===n.localCallHistory.chatHistory.type?"".concat(r.User.byId[n.showCommunication].firstName," ").concat(r.User.byId[n.showCommunication].lastName):r.Board.byId[n.showCommunication].name)),o.a.createElement("div",{className:"img-container"},(i?r.UserDetail.byId[n.localCallHistory.chatHistory.broadCastId]&&r.UserDetail.byId[n.localCallHistory.chatHistory.broadCastId].image:[r.Board.byId[n.localCallHistory.chatHistory.broadCastId]].image)?o.a.createElement(it,{imgUrl:"".concat(oe,"/user/").concat(1e7+parseInt(n.localCallHistory.chatHistory.broadCastId,10),"/profile/").concat(Object.values(r.UserDetail.byId).find(function(e){return e.userId===n.localCallHistory.chatHistory.broadCastId}).image)}):o.a.createElement(it,{imgUrl:Lc})),o.a.createElement("div",{style:{width:"100%",display:"flex",justifyContent:"center",margin:5}},o.a.createElement("span",{style:{fontSize:15,fontWeight:"bold",color:"#757575"}},n.currentOffer?"Incoming ".concat(n.currentOffer.callType," call..."):null)),o.a.createElement("div",{className:"controllers"},o.a.createElement(ve.b,{icon:"phone",onClick:function(){return e.callAccept("audio")},large:!0,intent:"success"}),o.a.createElement(ve.b,{icon:"mobile-video",onClick:function(){return e.callAccept("video")},large:!0,intent:"success"}),o.a.createElement(ve.b,{icon:"cross",onClick:this.callReject,large:!0,intent:"danger"})))))}}]),t}(o.a.Component),Vc=a(57),zc=a(20),Fc=a.n(zc),qc=function(e,t,a,n){var r=R.getState(),o=r.webRtc,i=r.account,c=r.database,s=(Object.values(c.Board.byId).map(function(e){return e.id}),i.user.id);try{if(e&&t&&a&&("oneToOneCall"===t&&(e.send({message:{request:"register",username:"".concat(s)}}),a("janus",Object(y.a)({},o.janus,Object(h.a)({},t,e)))),"conferenceCall"===t)){if(n){var l=o.localCallHistory.chatHistory.connectionId,u=c.Board.byId[l].joinToken,d={request:"join",room:l,ptype:"publisher",display:"".concat(s),pin:u};e.send({message:d})}a("janus",Object(y.a)({},o.janus,Object(h.a)({},t,e)))}}catch(m){console.error("Registration Faild!",m)}},Gc={oneToOneCall:"janus.plugin.videocall",conferenceCall:"janus.plugin.videoroom"};function Jc(e,t,a,n,r,o,i,c,s,l,u){e.attach({plugin:Gc[t],success:function(e){Fc.a.log("Puligin attachment Success",t),qc(e,t,c,u)},error:function(e){Fc.a.error("Faild to attach plugin",e),n(e)},consentDialog:function(e){Fc.a.log("consetDialog",e)},mediaState:function(e,t){Fc.a.log("Janus  ".concat(t?"started":"stopped",' receiving our " + ').concat(e))},webrtcState:function(e){Fc.a.log("Janus says our WebRTC PeerConnection is ".concat(e?"up":"down","  now"))},onmessage:function(e,n){Fc.a.log(t,"Message",e,n),a(e,n)},ondataopen:function(e){Fc.a.log("The DataChannel is available!",e),l(e)},ondata:function(e){Fc.a.debug("We got data from the DataChannel! ",e),s(e)},onlocalstream:function(e){Fc.a.log("onLocal Stream",e),r(e)},onremotestream:function(e){Fc.a.log("OnRemote Stream",e),o(e)},oncleanup:function(){Fc.a.log("onCleanup called")},detached:function(){}})}var Yc=function(e){return function(t){var a=R.getState().webRtc,n=(a.janus,e.updateWebRtc);a.isLive&&(n("chatHistory",a.localCallHistory.chatHistory),a.localCallHistory.stream&&a.localCallHistory.stream.active&&a.localCallHistory.stream.getTracks().forEach(function(e){return e.stop()}));n("communicationContainer","history"),n("outGoingCallType",null),n("showOutgoingCall",!1),n("peerConnections",{}),n("pendingOffers",{}),n("remoteStream",{}),n("currentOffer",null),n("iceCandidates",{}),n("liveIncomingCall",!1),n("isLive",!1),n("localCallHistory",{callEnd:!0}),n("mainStreamId",null),n("streams",{}),n("connectedUsers",{}),n("isConnecting",!1),n("showIncommingCall",!1)}},Kc=function(e){console.error(e)},Qc=function(e){return function(t){var a=R.getState(),n=a.webRtc,r=a.account,o=e.updateWebRtc;o("localCallHistory",Object(y.a)({},n.localCallHistory,{stream:t,callEnd:!1})),o("connectedUsers",Object(y.a)({},n.connectedUsers,Object(h.a)({},r.user.id,{streams:[t]})))}},_c=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.getState(),o=r.webRtc,i=t.updateWebRtc,!o.mediaRecording||n.id===o.mediaRecording.stream.id){e.next=9;break}return o.mediaRecording.stopRecording(),e.next=6,zi(1,t);case 6:return c=e.sent,e.next=9,i("mediaRecording",c);case 9:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),Zc=function(e){return function(){var t=Object(W.a)(L.a.mark(function t(a,n){var r,o,i,c;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.updateWebRtc,o=R.getState(),i=o.webRtc,c=i.localCallHistory.chatHistory.user.user.id,t.next=5,r("connectedUsers",Object(y.a)({},i.connectedUsers,Object(h.a)({},c,Object(y.a)({},i.connectedUsers[c],{streams:i.connectedUsers[c]?[].concat(Object(g.a)(i.connectedUsers[c].streams),[a]):[a]}))));case 5:return t.next=7,r("localCallHistory",Object(y.a)({},i.localCallHistory,{startTime:i.localCallHistory.startTime||Date.now()}));case 7:return t.next=9,r("lastStreamId",c);case 9:return t.next=11,_c(e,c,a);case 11:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()},Xc=function(e){return function(t){var a=e.updateWebRtc,n=R.getState(),r=n.webRtc,o=n.account,i=JSON.parse(t);i.callType&&(r.connectedUsers[i.uid].type!==i.callType&&(a("connectedUsers",Object(y.a)({},r.connectedUsers,Object(h.a)({},i.uid,Object(y.a)({},r.connectedUsers[i.uid],{type:i.callType})))),r.janus.oneToOneCall.data({text:JSON.stringify({callType:r.localCallHistory.mediaType,uid:o.user.id})})))}},$c=function(e,t){var a=R.getState(),n=a.webRtc,r=a.database,o=a.account,i=n.apis,c=n.janus;if(c.oneToOneCall.hangup(),"callReject"!==t){var s,l=n.localCallHistory.chatHistory.user.user.id,u=Object.values(r.UserConnection.byId).find(function(e){return e.mId===o.user.id&&e.userId===l});s=u?u.id:Object.values(r.UserConnection.byId).find(function(e){return e.userId===o.user.id&&e.mId===l}).id,i.sfuCallStatusChange({callStatusDetails:{broadCastType:"UserConnection",broadCastId:l,uid:o.user.id,callType:n.localCallHistory.callType||"Misscall",callDuration:n.localCallHistory.startTime?Date.now()-n.localCallHistory.startTime:0,connectionId:s,type:"declined"},userList:[{userId:l}]})}else c.oneToOneCall.detach({success:function(){!function(e){var t=e.updateWebRtc;Jc(R.getState().webRtc.janus.janus,"oneToOneCall",cs(e),Kc,Qc(e),Zc(e),Yc(e),t,Xc(e),function(e){},!0)}(e)},error:function(e){console.error("one to one detachement error",e)}})},es=function(e){var t=R.getState(),a=t.webRtc,n=t.account,r=a.janus,o=a.apis,i=a.localCallHistory,c=e.updateWebRtc,s=i.chatHistory.connectionId;a.isLive&&(Object.values(a.janus.remoteFeeds).forEach(function(e){e.detach({success:function(e){}})}),r.conferenceCall.detach({success:function(e){c("janus",Object(y.a)({},a.janus,{conferenceCall:void 0}))},error:function(e){console.log("Detach error",e)}}),o.sfuCallStatusChange({callStatusDetails:{broadCastType:"Board",broadCastId:s,uid:n.user.id,callType:a.localCallHistory.callType||"Misscall",callDuration:a.localCallHistory.startTime?Date.now()-a.localCallHistory.startTime:0,connectionId:s,type:"declined"},userList:[{userId:n.user.id}]}))},ts=function(e){return function(){var t=Object(W.a)(L.a.mark(function t(a){var n,r,o;return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=R.getState(),r=n.webRtc,(o=e.updateWebRtc)("chatHistory",r.localCallHistory.chatHistory),r.localCallHistory.stream&&r.localCallHistory.stream.active&&r.localCallHistory.stream.getTracks().forEach(function(e){return e.stop()}),"user"===r.localCallHistory.chatHistory.type?$c(e,a):es(e),o("communicationContainer","history"),o("outGoingCallType",null),o("showOutgoingCall",!1),o("peerConnections",{}),o("pendingOffers",{}),o("remoteStream",{}),o("currentOffer",null),o("iceCandidates",{}),o("liveIncomingCall",!1),o("isLive",!1),o("localCallHistory",{callEnd:!0}),o("mainStreamId",null),o("streams",{}),o("connectedUsers",{}),o("isConnecting",!1);case 20:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},as=function(e,t,a){var n=e.updateWebRtc;setTimeout(Object(W.a)(L.a.mark(function a(){var r,o,i;return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:r=R.getState(),o=r.webRtc,i=o.apis,o.isLive||o.localCallHistory.callEnd||(ts(e,t,i)(),n("showIncommingCall",!1),n("communicationContainer","history"));case 3:case"end":return a.stop()}},a)})),a||6e4)},ns=function(e,t){var a=e.updateWebRtc;R.getState().webRtc;a("isLive",!0),a("showIncommingCall",!1),a("communicationContainer","connecting")},rs=function(e,t){switch(e){case"audio":return{audio:!0,videoSend:!1,videoRecv:!0,replaceAudio:!0,data:!0,removeVideo:!0};case"video":return{audio:!0,video:!0,replaceVideo:!0,replaceAudio:!0,data:!0};case"screenshare":return{audio:!0,video:"screen",replaceVideo:!0,replaceAudio:!0,data:!0};default:return{audio:!0,videoSend:!1,videoRecv:!0,replaceAudio:!0,data:!0}}},os=function(e,t){var a,n=R.getState(),r=n.webRtc,o=n.database,i=e.display,c=e.id,s=(e.audio,e.video),l=r.localCallHistory,u=r.janus,d=l.chatHistory.connectionId,m=t.updateWebRtc,p=o.Board.byId[d].joinToken;Fc.a.log("Remote Handler called",e,u),u.janus.attach({plugin:"janus.plugin.videoroom",success:function(e){a=e;var t={request:"join",room:d,ptype:"subscriber",feed:c,pin:p};"safari"!==Fc.a.webRTCAdapter.browserDetails.browser||"vp9"!==s&&("vp8"!==s||Fc.a.safariVp8)||(s&&(s=s.toUpperCase()),Fc.a.error("Publisher is using ",s,", but Safari doesnt support it: disabling video"),t.offer_video=!1),a.videoCodec=s,a.send({message:t}),m("janus",Object(y.a)({},r.janus,{remoteFeeds:Object(y.a)({},r.janus.remoteFeeds,Object(h.a)({},c,a))})),m("connectedUsers",Object(y.a)({},R.getState().webRtc.connectedUsers,Object(h.a)({},i,Object(y.a)({},r.connectedUsers[i],{streams:[],publisherId:c,uid:i}))))},error:function(e){Fc.a.error("  -- Error attaching plugin...",e)},onmessage:function(e,t){Fc.a.log(" ::: Got a message (subscriber) :::",e);var n=e.videoroom;Fc.a.log("Event: ",n),e.error?Fc.a.log("".concat(i,") Error"),e.error):n&&(Fc.a.log(i,"Remote Feed Event",e),"attached"===n&&Fc.a.log("".concat(i,") Plugin attached"))),t&&(Fc.a.log(i,"Handling SDP as well in subscriber feed...",t),a.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){Fc.a.log(i,"Got SDP! in feed answer",e);var t={request:"start",room:d};a.send({message:t,jsep:e})},error:function(e){Fc.a.error("WebRTC error:",e)}}))},webrtcState:function(e){Fc.a.log("Janus says this WebRTC PeerConnection",i,"is",e?"up":"down"," now")},onlocalstream:function(e){},onremotestream:function(e){Fc.a.log(i,"Remote stream");var t=R.getState().webRtc;m("connectedUsers",Object(y.a)({},t.connectedUsers,Object(h.a)({},i,Object(y.a)({},t.connectedUsers[i],{streams:t.connectedUsers[i]?[].concat(Object(g.a)(t.connectedUsers[i].streams),[e]):[e]})))),m("localCallHistory",Object(y.a)({},t.localCallHistory,{startTime:t.localCallHistory.startTime||Date.now()}))},oncleanup:function(){Fc.a.log(" ::: Got a cleanup notification (remote feed ",c,") :::")}})},is=function(e,t){var a=t.updateWebRtc,n=e.videoroom,r=R.getState(),o=r.webRtc,i=(r.database,o.janus),c=o.localCallHistory,s=i.conferenceCall;if("joined"===n){s.createOffer({media:rs(c.mediaType),success:function(e){s.send({message:{request:"configure",audio:!0,video:!0},jsep:e})},error:function(e){console.error("error on publishing own feed",e)}}),a("janus",Object(y.a)({},o.janus,{joinStatus:!0}));var l=e.publishers;l&&l.length>0&&c.chatHistory&&(ns(t),l.forEach(function(e){return os(e,t)}))}else if("event"===n){var u=e.publishers,d=(e.configured,e.unpublished);u&&u.length>0&&c.chatHistory&&(ns(t),u.forEach(function(e){return os(e,t)})),d&&function(e,t){try{var a=R.getState().webRtc,n=e.updateWebRtc,r=a.apis,o=a.localCallHistory.chatHistory.connectionId,i=Object.keys(a.connectedUsers),c=Object.values(a.connectedUsers),s=c.findIndex(function(e){return e.publisherId===t}),l=[].concat(Object(g.a)(i.slice(0,s)),Object(g.a)(i.slice(s+1))),u=[].concat(Object(g.a)(c.slice(0,s)),Object(g.a)(c.slice(s+1)));n("connectedUsers",l.reduce(function(e,t,a){return e[t]=u[a],e},{})),u.length<2&&(ts(e)(),r&&r.closeSfuCall({id:o,activeStatus:null}))}catch(d){console.error("Problem in sfuclose call",d)}}(t,d)}},cs=function(e,t){return function(a,n){var r=R.getState().webRtc,o=r.localCallHistory,i=e.updateWebRtc,c=r.janus;Fc.a.log(" ::: Got a message onMessageHandler :::",a);var s=a.result;if(null!==s&&void 0!==s){if(void 0!==s.list&&null!==s.list){var l=s.list;Fc.a.debug("Got a list of registered peers:",l)}else if(void 0!==s.event&&null!==s.event){var u=s.event;if("registered"===u){var d=s.username;Fc.a.log("Successfully registered as ",d)}else if("calling"===u){Fc.a.log("Waiting for the peer to answer...");var m=o.chatHistory.user.user.id;i("connectedUsers",Object(y.a)({},r.connectedUsers,Object(h.a)({},m,Object(y.a)({},r.connectedUsers[m],{streams:[],status:"ringing"}))))}else"incomingcall"===u?(Fc.a.log("Incoming call from",s.username),function(e,t,a,n){var r,o=e.updateWebRtc,i=R.getState(),c=i.webRtc,s=i.database,l=i.account,u=c.apis,d=a.result,m=parseInt(d.username,10),p=Object.values(s.UserConnection.byId).find(function(e){return e.mId===l.user.id&&e.userId===m});r=p?p.id:Object.values(s.UserConnection.byId).find(function(e){return e.userId===l.user.id&&e.mId===m}).id;var f=parseInt(d.username,10);c.isLive?u.sfuCallStatusChange({callStatusDetails:{broadCastType:"UserConnection",broadCastId:f,uid:l.user.id,connectionId:r,type:"busy"},userList:[{userId:r}]}):(o("janus",Object(y.a)({},c.janus,{jsep:n})),o("chatHistory",{connectionId:r,type:"user",user:{user:s.User.byId[f]},broadCastId:f}),o("showCommunication",parseInt(d.username,10)),o("localCallHistory",Object(y.a)({},c.localCallHistory,{chatHistory:{connectionId:r,type:"user",user:{user:s.User.byId[parseInt(d.username,10)]},broadCastId:f},callType:c.localCallHistory.callType||"Incoming"})),o("showIncommingCall",!0),as(e,t))}(e,t,a,n)):"accepted"===u?(ns(e),n&&c.oneToOneCall.handleRemoteJsep({jsep:n})):"update"===u?(Fc.a.log("Update the current peer"),n&&("answer"===n.type?c.oneToOneCall.handleRemoteJsep({jsep:n}):c.oneToOneCall.createAnswer({jsep:n,media:rs(o.mediaType),success:function(e){c.oneToOneCall.send({message:{request:"set"},jsep:e})},error:function(e){Fc.a.error("WebRTC error:",e)}}))):"hangup"===u&&function(e,t,a){var n=R.getState().webRtc,r=(a.videocall,a.result),o=e.updateWebRtc,i=r.reason;r.username;if("User busy"===i){var c=n.localCallHistory.chatHistory.user.user.id;o("connectedUsers",Object(y.a)({},n.connectedUsers,Object(h.a)({},c,Object(y.a)({},n.connectedUsers[c],{status:"busy"}))))}"Remote WebRTC hangup"===i&&Yc(e)("remoteHangup")}(e,0,a)}}else if(n&&"answer"===n.type){var p=R.getState().webRtc,f=p.localCallHistory.chatHistory.type,v=p.janus;Fc.a.log("Answer Arrived",n,f,v),"user"===f&&v.oneToOneCall.handleRemoteJsep(n),"board"===f&&v.conferenceCall.handleRemoteJsep({jsep:n})}a.videoroom&&is(a,e)}},ss=function(e,t){var a=e.updateWebRtc;!function(e,t,a,n,r,o,i,c){var s,l,u,d=R.getState().webRtc;Fc.a.init({debug:!1,dependencies:Fc.a.useDefaultDependencies({adapter:Vc.a}),callback:function(){Fc.a.log("Janus API support ok")}});var m=new Fc.a({server:"wss://properclass.com:8989/janus",apisecret:"properclassdotcom@654123",iceServers:[{urls:"turn:properclass.com:3478?transport=tcp",username:"properclass",credential:"proper199201"}],success:function(){Fc.a.log("Janus is ready for attachment"),s=!0,o("janus",Object(y.a)({},d.janus,{janus:m})),Jc(m,"oneToOneCall",e,t,a,n,0,o,i,c),Jc(m,"conferenceCall",e,t,a,n,0,o,i,c)},error:function(e){Fc.a.error("Janus Server Error",e),l=e},destroyed:function(){u=!0,Fc.a.error("Janus destroyed")}})}(cs(e,t),Kc,Qc(e),Zc(e),Yc(e),a,Xc(e),function(e){})},ls=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.updateWebRtc,n.boardId,o=n.userId,i=R.getState(),c=i.webRtc,e.next=6,r("connectedUsers",Object(y.a)({},c.connectedUsers,Object(h.a)({},o,{streams:[]})));case 6:return e.next=8,r("localCallHistory",Object(y.a)({},c.localCallHistory,{callType:c.localCallHistory.callType||"Incoming"}));case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Offer initialization Error",e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t,a,n){return e.apply(this,arguments)}}(),us=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r,o){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("communicationContainer","list");case 2:return e.next=4,t("showCommunication",r);case 4:return e.next=6,t("localCallHistory",Object(y.a)({},a.localCallHistory,{chatHistory:{connectionId:r,type:"board",user:{user:n.User.byId[o]}}}));case 6:t("showIncommingCall",!0);case 7:case"end":return e.stop()}},e)}));return function(t,a,n,r,o){return e.apply(this,arguments)}}(),ds=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case 1:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),ms=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l,u;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.getState(),o=r.database,i=t.updateWebRtc,c=n.userId,s=n.boardId,l=R.getState(),(u=l.webRtc).isLive){e.next=9;break}return e.next=7,us(i,u,o,s,c);case 7:e.next=11;break;case 9:return e.next=11,ds(t,a,n);case 11:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),ps=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.updateWebRtc,o=n.boardId,i=n.userId,c=R.getState(),s=c.webRtc,l=c.database,e.next=6,r("localCallHistory",Object(y.a)({},s.localCallHistory,{chatHistory:{type:"board",connectionId:o,user:{user:l.User.byId[i]}}}));case 6:return e.next=8,r("showCommunication",o);case 8:r("showIncommingCall",!0),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("Offer On open Communication Open error",e.t0);case 14:case"end":return e.stop()}},e,null,[[0,11]])}));return function(t,a,n){return e.apply(this,arguments)}}(),fs=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ls(t,a,n);case 2:if(!r.showCommunication){e.next=7;break}return e.next=5,ms(t,a,n);case 5:e.next=9;break;case 7:return e.next=9,ps(t,a,n);case 9:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),vs=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r,o){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case 1:case"end":return e.stop()}},e)}));return function(t,a,n,r,o){return e.apply(this,arguments)}}(),bs=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,i,c,s,l;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=R.getState(),o=r.webRtc,i=r.account,c=n.boardId,s=n.userId,l=o.apis,!o.showIncommingCall&&!o.isConnecting){e.next=7;break}vs("Call is busy",t,a,n,o),e.next=20;break;case 7:if(!o.isLive){e.next=16;break}if(o.localCallHistory.chatHistory.connectionId!==c){e.next=13;break}return e.next=11,fs(t,a,n,o);case 11:e.next=14;break;case 13:vs("Call is busy",t,a,n,o);case 14:e.next=20;break;case 16:return e.next=18,fs(t,a,n,o);case 18:as(t,a),l.sfuCallStatusChange({callStatusDetails:{broadCastType:"Board",broadCastId:c,uid:i.user.id,connectionId:c,type:"ringing"},userList:[{userId:s}]});case 20:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}(),gs=function(e,t,a){var n=a.uid,r=a.type,o=e.updateWebRtc,i=R.getState().webRtc;o("connectedUsers",i.connectedUsers[n]?Object(y.a)({},i.connectedUsers,Object(h.a)({},n,Object(y.a)({},i.connectedUsers[n],{status:r,streams:i.connectedUsers[n].streams||[]}))):Object(y.a)({},i.connectedUsers,Object(h.a)({},n,{status:r,streams:[]})))},hs=function(e,t,a){ue.on("sfuInit",function(a){bs(e,t,a)}),ue.on("callStatus",function(){var t=Object(W.a)(L.a.mark(function t(a){return L.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a&&gs(e,0,a);case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),ue.on("ping",function(e){e&&function(e,t,a){var n=R.getState(),r=n.webRtc,o=n.account,i=r.apis;r.isLive&&"board"===r.localCallHistory.chatHistory.type&&a.boardId===r.localCallHistory.chatHistory.connectionId&&i.commPingPong({userId:o.user.id,boardId:a.boardId})}(0,0,e)})},ys=function(e,t){try{var a=R.getState(),n=a.webRtc,r=a.account,o=n.janus,i=n.localCallHistory.chatHistory.user.user.id;n.isCallUpgraded?"mute"===e||"unmute"===e?("mute"===e&&o.oneToOneCall.muteAudio(),"unmute"===e&&o.oneToOneCall.unmuteAudio()):o.oneToOneCall.createOffer({media:rs(e),success:function(t){o.oneToOneCall.data({text:JSON.stringify({callType:e,uid:r.user.id})}),o.oneToOneCall.send({message:{request:"set"},jsep:t})},error:function(e){console.error("Error creatign offer",e)}}):o.oneToOneCall.createOffer({media:rs(e),iceRestart:!0,success:function(t){var a={request:"call",username:"".concat(i)};o.oneToOneCall.data({text:JSON.stringify({callType:e,uid:r.user.id})}),o.oneToOneCall.send({message:a,jsep:t})},error:function(e){console.error("Error creatign offer",e)},customizeSdp:function(e){}})}catch(c){console.error("oneToOneCall Error",c)}},Cs=function(e){var t=R.getState(),a=t.database,n=t.account,r=t.webRtc,o=n.user.id,i=r.localCallHistory.chatHistory.connectionId,c=r.janus.conferenceCall,s=S()(),l=a.Board.byId[i].name,u=Object.values(a.BoardMember.byId).filter(function(e){return e.boardId===i}).length,d={request:"edit",description:l,room:i,publishers:u,new_pin:s};c.send({message:d,success:function(t){var a=t.videoroom,n=t.error,d=t.error_code,m=t.room;if(void 0!==a&&null!==a)if(m){var p={request:"join",room:m||i,ptype:"publisher",display:"".concat(o),pin:s};c.send({message:p}),e.initSfuCall({activeStatus:o,id:i,joinToken:s,mediaType:r.localCallHistory.mediaType})}else if(n&&426===d){var f={request:"create",description:l,room:i,publishers:u,new_pin:s};c.send({message:f,success:function(a){var n=t.videoroom,l=a.error,u=a.error_code,d=a.room;if(void 0!==n&&null!==n)if(d){var m={request:"join",room:d||i,ptype:"publisher",display:"".concat(o),pin:s};c.send({message:m}),e.initSfuCall({activeStatus:o,id:i,joinToken:s,mediaType:r.localCallHistory.mediaType})}else l&&u&&console.error("Eror in creating room",a)},error:function(e){console.error("Room Create Error",e)}})}},error:function(e){console.error("Room Create Error",e)}})},ws=function(e){var t=R.getState(),a=t.webRtc,n=t.account.user.id,r=a.janus,o={request:"join",room:a.localCallHistory.chatHistory.connectionId,ptype:"publisher",display:"".concat(n),pin:e};r.conferenceCall.send({message:o})},Es=function(e,t){var a=t.updateWebRtc;Jc(R.getState().webRtc.janus.janus,"conferenceCall",cs(t),Kc,Qc(t),Zc(t),Yc(t),a,Xc(t),function(e){},!0)},Ss=function(){var e=Object(W.a)(L.a.mark(function e(t,a,n,r){var o,i,c,s,l,u,d,m,p,f,v,b,g;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{o=R.getState(),i=o.webRtc,c=o.database,s=o.account,l=i.apis,u=i.janus,d=i.localCallHistory,m=i.isCallUpgraded,p=d.chatHistory.connectionId,f=c.Board.byId[p],v=f.joinToken,b=f.activeStatus,g=u.conferenceCall,l.sfuPingPong({boardId:p,userId:s.user.id}),m?"mute"===t||"unmute"===t?("mute"===t&&g.muteAudio(),"unmute"===t&&g.unmuteAudio()):(g.createOffer({media:rs(t),success:function(e){g.data({text:JSON.stringify({callType:t,uid:s.user.id})}),Fc.a.log("upgrade success",e),g.send({message:{request:"configure"},jsep:e})},error:function(e){Fc.a.error("Error creatign offer",e)}}),l.initSfuCall({activeStatus:s.user.id,id:p,isCallUpgraded:m,mediaType:d.mediaType})):g?b&&g?(Fc.a.log("Class join"),ws(v)):g&&(Fc.a.log("Class call",u),Cs(l)):(Fc.a.log("Class attach and join"),Es(0,r),b||l.initSfuCall({id:p,activeStatus:s.user.id,mediaType:d.mediaType}))}catch(a){Fc.a.error("ConferenceCall Error",a)}case 1:case"end":return e.stop()}},e)}));return function(t,a,n,r){return e.apply(this,arguments)}}(),Os=function(e,t){return function(){var a=Object(W.a)(L.a.mark(function a(n,r,o,i){var c,s,l,u;return L.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:c=R.getState(),s=c.webRtc,l=s.localCallHistory,"user"===(u=l.chatHistory.type)&&ys(o,0),"board"===u&&Ss(o,i,t,e);case 5:case"end":return a.stop()}},a)}));return function(e,t,n,r){return a.apply(this,arguments)}}()},ks=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={minimize:!1,apis:null,maximize:!1},a.remoteCallEndMinimizer=function(){a.setState({maximize:!1})},a.toggleMinMax=function(){a.state.minimize?a.setState({minimize:!1}):a.setState({minimize:!0,maximize:!1})},a.cutWindow=function(){var e=a.props,t=e.updateWebRtc,n=e.webRtc,r=a.state.apis;a.setState({maximize:!1,minimize:!1}),n.isLive&&ts(a.props,a.state,r)(),t("showCommunication",!1),t("showIncommingCall",!1)},a.switchScreen=function(){var e=Object(W.a)(L.a.mark(function e(t){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:(0,a.props.updateWebRtc)("communicationContainer",t);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.maximize=function(){var e=a.state.maximize;a.setState({maximize:!e})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=Object(W.a)(L.a.mark(function e(){var t,a;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.updateWebRtc,e.prev=1,e.next=4,ue.scope("Mentee");case 4:return a=e.sent,e.next=7,this.setState({apis:a});case 7:t("apis",a),ss(this.props,this.state),hs(this.props,this.state,this.remoteCallEndMinimizer),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error("error in fetching apis in communication");case 15:case"end":return e.stop()}},e,this,[[1,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.minimize,a=e.apis,n=e.maximize,r="75%";n&&(r="100%"),t&&(r="40px");var i,c=this.props,s=c.webRtc,l=c.updateWebRtc;return(s.showIncommingCall||s.showCommunication)&&o.a.createElement("div",{className:n?"communicate pc-com-maximum":"communicate",style:{height:r,animationName:t?"slideDown":"slideUp",animationDuration:"0.3s"}},o.a.createElement("div",{className:"header"},o.a.createElement("div",{className:"win-title",onClick:this.toggleMinMax},"Messaging"),o.a.createElement("div",{className:"control-icons"},o.a.createElement(X.a,{iconSize:20,icon:"small-cross",style:{cursor:"pointer"},onClick:this.cutWindow}))),o.a.createElement("div",{className:"content"},!s.showIncommingCall&&s.showCommunication&&"list"===s.communicationContainer&&o.a.createElement(Ui,Object.assign({change:this.switchScreen,apis:a},this.props)),!s.showIncommingCall&&"history"===s.communicationContainer&&a&&o.a.createElement(gc,Object.assign({change:this.switchScreen,_callHandler:Os(this.props,this.state),apis:a},this.props)),!s.showIncommingCall&&"connecting"===s.communicationContainer&&s.localCallHistory.chatHistory&&o.a.createElement(Hc,Object.assign({toggleMaximize:this.maximize,isMaximum:n,minimize:t,remoteCallEndMinimizer:this.remoteCallEndMinimizer,change:this.switchScreen,updateWebRtc:l,closeHandler:ts(this.props,this.state,a),_callHandler:Os(this.props,this.state),apis:a},this.props)),s.showIncommingCall&&s.localCallHistory.chatHistory&&o.a.createElement(Wc,Object.assign({change:this.switchScreen,webRtc:s,answerHandler:(i=this.props,this.state,function(){var e=Object(W.a)(L.a.mark(function e(t,a,n){var r,o,c,s,l,u,d,m;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=i.updateWebRtc,o=R.getState(),c=o.webRtc,s=o.account,l=c.apis,u=c.janus,d=c.localCallHistory,"user"===(m=d.chatHistory.type)&&u.oneToOneCall.createAnswer({jsep:u.jsep,media:rs(n),iceRestart:!0,success:function(e){Fc.a.log("Got SDP!"),Fc.a.debug(e),u.oneToOneCall.send({message:{request:"accept"},jsep:e}),u.oneToOneCall.data({text:JSON.stringify({callType:n,uid:s.user.id})})},error:function(e){Fc.a.error("WebRTC error:",e)}}),"board"===m&&Ss(n,null,{apis:l},i),r("showIncommingCall",!1),r("communicationContainer","connecting");case 9:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()),apis:a,updateWebRtc:l,closeHandler:ts(this.props,this.state,a)},this.props))))}}]),t}(o.a.Component),Is=Object(p.b)(function(e){return e},Object(y.a)({},n))(ks),js=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:"tour"}})}},{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"take-tour"},o.a.createElement("iframe",{width:"600",height:"600",src:"https://www.youtube.com/embed/tgbNymZ7vqY"})))}}]),t}(o.a.Component),xs=Object(p.b)(function(e){return e},Object(y.a)({},n))(js),Ns=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-about"},o.a.createElement("div",{className:"pc-about-header"},o.a.createElement("h1",null,"About Us"),o.a.createElement("p",null,"Revolutionizing Online Mentorship")),o.a.createElement("div",{className:"pc-about-content"},o.a.createElement("h2",null,"Our Story"),o.a.createElement("p",null,"Proper Class begins some years ago when two classmates were doing their college project during their bachelors final year. They realized the traditional way of in person Mentorship has not been effective in this era. So they came up with a plan to integrate all the tools and techniques to make online Mentorship possible and better."),o.a.createElement("h2",null,"Mentorship since history"),o.a.createElement("p",null,"Great men and women who left remarkable achievements and great inspiration had Mentors in their lives. Bruce Lee, Albert Einstein, Steven Hawkins, Alexander The Great, Aristotle, Plato, Steve Jobs and many other great leaders and protagonists had one or more Mentors in their lives.",o.a.createElement("br",null),o.a.createElement("br",null),"Mentorship is not just a tool or a concept to do good in our lives but it has been in many cultures sinces ages. Like Hindu people have gurus who mentor them throughout their lifetime in bad and good times. Mentors are respected, loved and given a higher priority."),o.a.createElement("h2",null,"A World of Opportunities"),o.a.createElement("p",null,"Proper Class gives a platform for learners and teachers. Specially to professionals who have real field knowledge, and have ability to pass that knowledge to noobies who are just aspiring. And to the people who are looking to get real field knowledge through experienced Mentors. Proper Class breaks the physical barriers and makes it possible to meet experienced mentors, get mentored and pay from a single place."),o.a.createElement("h2",null,"Our Vision"),o.a.createElement("p",null,"A world with practical education from experienced Mentors."),o.a.createElement("h2",null,"Our Mission"),o.a.createElement("p",null,"To create opportunities so people can share and access quality education."))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),Ds=Object(p.b)(function(e){return e},Object(y.a)({},n))(Ns),As=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-privacy"},o.a.createElement("div",{className:"pc-privacy-content"},o.a.createElement("h2",null,"Privacy Policy"),o.a.createElement("p",null,"We use your personal information only for providing services and improving the Site. By using the site, you agree to the collection and use of information in accordance with the following policy. Unless otherwise defined in this Privacy Policy, terms used in this privacy policy have the same meanings as in our"," ",o.a.createElement(K.a,{to:"/terms-and-conditions"},"Terms and Conditions"),"."),o.a.createElement("h3",null,"1. Information We Collect"),o.a.createElement("ul",null,o.a.createElement("li",null,"The information you actively give us when you perform certain actions in our site, such as creating an account, filling out your profile details, writing blogs, creating classrooms(Projects), and communications(audio, video, conferencing etc.)."),o.a.createElement("li",null,'While using our site you may also provide data that is not personally identifiable("non-identifying data"). This includes your expertize, timezone, language.'),o.a.createElement("li",null,"We may also collect information about your interactions with this Platform, such as requests posted, session history, pages viewed, likes and connections."),o.a.createElement("li",null,'Like many sites, we collect information that your browser sends whenever you visit our site ("Log Data"). This Log Data may include information such as your computer\'s Internet Protocol address, browser type, browser version, the pages of our site that you visit, the time and date of your visit, the time spent on those pages, and other statistics.'),o.a.createElement("li",null,"Our website also sends your browser some cookies which are stored on your computers hard drive. Cookies are very small files containing data. However you can block cookies from your browser settings. We recommend you not blocking the cookies because we use it to enhance your experience in our site."),o.a.createElement("li",null,"If you connect your Proper Class account with third parties like google, we store information provided by those third-party services such as email and profile information. This information is controlled by the third-party service or your authorization via the privacy settings at that service.")),o.a.createElement("h3",null,"2. Use of Personal Information"),o.a.createElement("ul",null,o.a.createElement("li",null,"We may use your personal credentials to send you emails, notifications or other important reminders."),o.a.createElement("li",null,"Information collected from users can also be used to analyse the trend to improve our product development."),o.a.createElement("li",null,"Collected data is used to improve, maintain, and develop our services. For example, we use the personal information to recommend mentors to mentees."),o.a.createElement("li",null,"We may use also feature profile in our most viewed pages as our testimonials and success stories."),o.a.createElement("li",null,"To investigate and prevent security issues and abuse."),o.a.createElement("li",null,"We display your public information to other people using our site, such as your experience, education etc. But we won't share your sensitive information like conversation and login credentials.")))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),Ts=Object(p.b)(function(e){return e},Object(y.a)({},n))(As),Rs=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-terms"},o.a.createElement("div",{className:"pc-terms-content"},o.a.createElement("h2",null,"Terms and Conditions"),o.a.createElement("p",null,"Terms and Conditions Coming Soon...."))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),Ps=Object(p.b)(function(e){return e},Object(y.a)({},n))(Rs),Ms=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-support"},o.a.createElement("div",{className:"pc-support-content"},o.a.createElement("h2",null,"Support"),o.a.createElement("p",null,"Please make sure you need it before you write us.",o.a.createElement("br",null),"If you are facing any problem on this site. Please write us your issue."," ",o.a.createElement(K.a,{to:"#"},"support@properclass.com")))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),Hs=Object(p.b)(function(e){return e},Object(y.a)({},n))(Ms),Us=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-career"},o.a.createElement("div",{className:"pc-career-content"},o.a.createElement("h2",null,"Careers"),o.a.createElement("p",null,"We do not have any job openings at the moment.",o.a.createElement("br",null),"But we always review what you can offer. You can write us at"," ",o.a.createElement(K.a,{to:"#"},"careers@properclass.com")))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),Bs=Object(p.b)(function(e){return e},Object(y.a)({},n))(Us),Ls=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-report"},o.a.createElement("div",{className:"pc-report-content"},o.a.createElement("h2",null,"Report"),o.a.createElement("p",null,"If you find any sort of malfunction, bug or if you find anything abusive.",o.a.createElement("br",null),"Please write us about at"," ",o.a.createElement(K.a,{to:"#"},"report@properclass.com")))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),Ws=Object(p.b)(function(e){return e},Object(y.a)({},n))(Ls),Vs=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-business"},o.a.createElement("div",{className:"pc-business-content"},o.a.createElement("h2",null,"Business Enquiry"),o.a.createElement("p",null,"Our main business is Proper Class online Mentorship platform. However we provide other tech related solutions.",o.a.createElement("br",null),"If you are willing to partner with us or want to know more about our business. Please write us at"," ",o.a.createElement(K.a,{to:"#"},"info@properclass.com")))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),zs=Object(p.b)(function(e){return e},Object(y.a)({},n))(Vs),Fs=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){(0,this.props.updateNav)({schema:"mainNav",data:{name:""}}),this.setState({loading:!1})}},{key:"render",value:function(){return this.state.loading?o.a.createElement(Fe,null):o.a.createElement("div",null,o.a.createElement(Pt,null),o.a.createElement("div",{className:"pc-services"},o.a.createElement("div",{className:"pc-services-content"},o.a.createElement("h2",null,"Our Software Services"),o.a.createElement("p",null,"Our main business is Proper Class online Mentorship platform. However we provide other tech related solutions. We have expertize on mobile app development, digital marketing, web application development, machine learning and AI.",o.a.createElement("br",null),"If you are looking for software solutions for your business, please write us at"," ",o.a.createElement(K.a,{to:"#"},"info@properclass.com")))),o.a.createElement(Mt,null))}}]),t}(o.a.Component),qs=Object(p.b)(function(e){return e},Object(y.a)({},n))(Fs),Gs=a(339),Js=a(311),Ys=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={dismiss:!1},a.onDismiss=function(){var e=a.props.onClose;a.setState({dismiss:!0}),e()},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.state.dismiss,t=this.props,a=t.message,n=t.intent;return o.a.createElement(Gs.a,{position:ge.a.TOP},!e&&o.a.createElement(Js.a,{message:a,intent:n,onDismiss:this.onDismiss,timeout:5e3}))}}]),t}(o.a.Component),Ks=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={editHead:!1,editDesc:!1,loading:!0,task:{},comments:[],description:{},attachments:[],title:"",desc:"",activities:[]},a.onClose=function(){var e=a.props;(0,e.onClose)(e.taskId)},a.writeComment=function(){},a.toggleElemTitle=function(){},a.titleChange=function(e){},a.saveTitle=Object(W.a)(L.a.mark(function e(){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),a.toggleElemDesc=function(){},a.descChange=function(e){},a.saveDesc=Object(W.a)(L.a.mark(function e(){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)})),a.getTags=function(){var e=a.props.tags,t=a.state.task;return t.id?Object.values(e.byId).filter(function(e){return e.boardColumnCardId===t.id&&!e.deleteStatus}):[]},a.getName=function(e){var t=a.props.userList.byId[e];return t.middleName?"".concat(t.firstName," ").concat(t.middleName," ").concat(t.lastName):"".concat(t.firstName," ").concat(t.lastName)},a.deleteAttachment=function(){var e=Object(W.a)(L.a.mark(function e(t,a){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.getCardActivity=Object(W.a)(L.a.mark(function e(){var t,n,r;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.apis,n=a.state.task,e.next=4,t.getCardActivity({cardId:n.id});case 4:r=e.sent,a.setState({loading:!1,activities:r.cardActivities.filter(function(e){return("createCard"===e.message||"outsideColumn"===e.message)&&e.tColId&&e.fColId})});case 6:case"end":return e.stop()}},e)})),a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=this,a=e.taskId,n=e.tasks,r=e.comments,o=e.attachments,i=e.descriptions,c=r.filter(function(e){return a===e.boardColumnCardId&&!e.deleteStatus}),s=o.filter(function(e){return a===e.boardColumnCardId&&!e.deleteStatus}),l=i.filter(function(e){return a===e.boardColumnCardId}).sort(lt)[0],u=l?l.title:"";n.map(function(e){e.id===a&&t.setState({comments:c,attachments:s,task:e,description:l,title:e.name,desc:u})})}},{key:"render",value:function(){var e=this,t=this.state,a=t.editHead,n=t.editDesc,r=t.task,i=t.comments,c=t.attachments,s=t.title,l=t.description,u=t.desc,d=t.activities,m=t.loading,p=this.props,f=p.userList,v=p.apis,b=p.boardId,h=p.deleteDatabaseSchema,y=p.updateDatabaseSchema,C=p.account,w=p.isOpen,E=p.database;return o.a.createElement(fe.a,{isOpen:w,onClose:this.onClose,onOpening:this.getCardActivity,className:"overlay-container",style:{width:"800px"}},m?o.a.createElement("div",null):o.a.createElement("div",{className:"task-detail-overlay"},o.a.createElement("div",{className:"overlay-title"},o.a.createElement("div",{className:"head"},a?o.a.createElement(Te.a,{value:s,onChange:function(t){return e.titleChange(t)}}):o.a.createElement("span",{className:"title"},r.name),a?o.a.createElement("div",{className:"buttons-group"},o.a.createElement(ve.b,{icon:"tick",intent:"success",onClick:this.saveTitle}),o.a.createElement(ve.b,{icon:"cross",onClick:this.toggleElemTitle})):o.a.createElement("div",{className:"buttons-group"},o.a.createElement(X.a,{className:"edit-title",icon:"edit",onClick:this.toggleElemTitle}))),o.a.createElement(ve.b,{icon:"cross",style:{float:"right"},minimal:!0,onClick:this.onClose})),o.a.createElement("div",{className:"overlay-body"},o.a.createElement("div",{className:"left"},o.a.createElement("div",{className:"pc-tags-and-deadline"},o.a.createElement("div",{className:"pc-tag-view"},this.getTags().map(function(e){return o.a.createElement(Mr.a,{key:e.id,large:!0,intent:e.tag,style:{margin:5}})})),o.a.createElement("div",{className:"pc-deadline-view"},r.Deadline?o.a.createElement("p",{className:r.Deadline<new Date?"expire":"no-expire"},"Deadline: ".concat(pe()(r.Deadline).format("YYYY-MM-DD"))):" ")),o.a.createElement("div",{className:"overlay-description"},o.a.createElement("div",{className:"desc-head"},o.a.createElement("u",null,"Description"),n?o.a.createElement("span",{className:"buttons-group"},o.a.createElement(ve.b,{icon:"tick",onClick:this.saveDesc,intent:"success",small:!0,className:"edit-button"}),o.a.createElement(ve.b,{icon:"cross",onClick:this.toggleElemDesc,small:!0,className:"edit-button"})):o.a.createElement(X.a,{icon:"edit",onClick:this.toggleElemDesc,className:"edit-button"})),o.a.createElement("div",{className:"desc"},n?o.a.createElement(Te.a,{value:u,onChange:this.descChange}):o.a.createElement("span",null,l&&l.title))),o.a.createElement(ao,{attachments:c,getName:this.getName,Users:E.User,deleteAttachment:this.deleteAttachment}),o.a.createElement(Xr,{comments:[].concat(Object(g.a)(i),Object(g.a)(d)),account:C,apis:v,userList:f,userDetailList:E.UserDetail,columns:E.BoardColumn,commentReply:this.writeComment,boardId:b,deleteDatabaseSchema:h,updateDatabaseSchema:y})))))}}]),t}(r.Component),Qs=Object(p.b)(function(e){var t=e.database,a=e.account;return{userList:t.User,account:a,database:t}})(Ks),_s=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onClick=function(){var e=a.props;(0,e.onClick)(e.task.id)};var n=a.props,r=n.tags,o=n.task,i=Object.values(r.byId).filter(function(e){return o.id===e.boardColumnCardId&&!e.deleteStatus});return a.state={allTags:i},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.tags,n=t.task;if(a.allIds!==e.tags.allIds){var r=Object.values(a.byId).filter(function(e){return n.id===e.boardColumnCardId&&!e.deleteStatus});this.setState({allTags:r})}}},{key:"render",value:function(){var e=this.props.task,t=this.state.allTags;return o.a.createElement("div",{className:"task-container",onClick:this.onClick,onKeyDown:this.onClick,role:"menuitem",tabIndex:0},o.a.createElement("div",{className:"pc-task-flag"},o.a.createElement("div",{className:"pc-tag-view"},t.map(function(e,t){return o.a.createElement(Mr.a,{key:t,intent:e.tag,style:{marginRight:"5px"}})})),o.a.createElement("div",{className:"pc-deadline-view"},e.Deadline&&o.a.createElement("p",{className:e.Deadline<new Date?"expire":"no-expire"},pe()(e.Deadline).format("YYYY-MM-DD")))),o.a.createElement("p",{className:"pc-task-name"},e.name))}}]),t}(r.Component),Zs=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.column,a=e.onTaskClick,n=e.tags;return o.a.createElement("div",{className:"column-container"},o.a.createElement("div",{className:"column-inner-container"},o.a.createElement("div",{className:"column-title"},o.a.createElement("span",null,t.name)),o.a.createElement("div",{className:"task-list"},t.tasks.filter(function(e){return!e.deleteStatus}).map(function(e,t){var r=e;return o.a.createElement(_s,{key:"task".concat(r.id),task:r,index:t,tags:n,onClick:a})}))))}}]),t}(r.Component),Xs=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.boards,a=e.classId,n=e.users,r=e.boardMembers,i=Object.values(t.byId).find(function(e){return e.id===a});return o.a.createElement("div",{className:"tool-bar"},o.a.createElement("div",{className:"toolbar-container"},o.a.createElement("div",{className:"left-tools"},o.a.createElement("div",{className:"class-name each-item"},i.name),o.a.createElement(uo.a,null),o.a.createElement(vo,{userList:n,boardId:a,boardMembers:r})),o.a.createElement("div",{className:"right-tools"})))}}]),t}(o.a.Component),$s=Object(p.b)(function(e){var t=e.database,a=e.account;return{boards:t.Board,UserDetail:t.UserDetail,users:t.User,boardMembers:t.BoardMember,account:a,database:t}})(Xs),el=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={loading:!0,api:{},classId:0,columns:[],tasks:[],comments:[],attachments:[],descriptions:[],taskOverlayIsOpen:!1,taskIdInOverlay:0},a.toggleTaskOverlay=function(e){var t=a.state.taskOverlayIsOpen;a.setState({taskIdInOverlay:e,taskOverlayIsOpen:!t})},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match;ue.scope("Mentee").then(function(a){e.setState({api:a,classId:parseInt(t.params.classId,10),loading:!1}),e.componentWillReceiveProps(e.props)})}},{key:"componentWillReceiveProps",value:function(e){var t=e.tasks,a=e.columns,n=e.comments,r=e.attachments,o=e.descriptions,i=e.match,c=[];Object.values(a.byId).map(function(e){if(e.boardId===Number(i.params.classId)){var a=Object(y.a)({},e),n=[];Object.values(t.byId).map(function(t){t.boardColumnId===e.id&&n.push(t)}),n.sort(st),a.tasks=n,c.push(a)}}),this.setState({tasks:Object.values(t.byId),columns:c.sort(st),comments:Object.values(n.byId).sort(lt),attachments:Object.values(r.byId),descriptions:Object.values(o.byId)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.classId,n=t.columns,r=t.tasks,i=t.api,c=t.taskIdInOverlay,s=t.taskOverlayIsOpen,l=t.comments,u=t.attachments,d=t.descriptions,m=t.loading,p=this.props,f=p.addDatabaseSchema,v=p.tags,b=p.account,g=p.updateDatabaseSchema,h=p.deleteDatabaseSchema;return b.sessionId?!b.user||m?o.a.createElement(Fe,null):o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(Pt,{className:"pcm-nav"}),o.a.createElement($s,{classId:a,apis:i}),o.a.createElement("div",{className:"class-wrapper",style:{height:window.innerHeight}},o.a.createElement("div",{className:"columns"},n.filter(function(e){return!e.deleteStatus}).map(function(t,n){if(t.boardId===a)return o.a.createElement(Zs,{key:"column".concat(t.id),column:t,columnId:t.id,index:n,api:i,tags:v,boardId:a,addDatabaseSchema:f,updateDatabaseSchema:g,deleteDatabaseSchema:h,onTaskClick:e.toggleTaskOverlay})}))),o.a.createElement(Qs,{apis:i,isOpen:s,taskId:c,tasks:r,onClose:this.toggleTaskOverlay,comments:l,attachments:u,descriptions:d,boardId:a,tags:v,addDatabaseSchema:f,updateDatabaseSchema:g,deleteDatabaseSchema:h})):o.a.createElement(U.a,{to:"/"})}}]),t}(r.Component),tl=Object(p.b)(function(e){var t=e.database;return{account:e.account,columns:t.BoardColumn,tasks:t.BoardColumnCard,comments:t.BoardColumnCardComment,descriptions:t.BoardColumnCardDescription,attachments:t.BoardColumnCardAttachment,boardUsers:t.User,tags:t.BoardColumnCardTag}},Object(y.a)({},n))(el),al=a(30),nl=a.n(al),rl=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).janusAttachment=function(){var e=a.state.janus,t=null;e.attach({plugin:"janus.plugin.echotest",success:function(e){console.log("Puligin handle",e);var a={audio:!0,video:!0};(t=e).send({message:a}),t.createOffer({media:{video:!0,audio:!0},success:function(e){t.send({message:a,jsep:e})},error:function(e){console.error("Error creatign offer",e)},customizeSdp:function(e){}})},error:function(e){console.error("Faild to attach plugin",e)},consentDialog:function(e){console.log("consetDialog",e)},onmessage:function(e,a){console.log("onmessage",e,a),void 0!==a&&null!==a&&t.handleRemoteJsep({jsep:a})},onlocalstream:function(e){console.log("onlocalStream",e),document.getElementById("left-video").srcObject=e},onremotestream:function(e){console.log("onremotestream",e),document.getElementById("right-video").srcObject=e},oncleanup:function(){console.log("onCleanup called")},detached:function(){console.log("clear the stuff after plugin detach")}})},a.state={janus:null,isJanusConnected:!1},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){var e=this;nl.a.init({debug:!0,dependencies:nl.a.useDefaultDependencies({adapter:Vc.a}),callback:function(){console.log("working fine janus")}});var t=new nl.a({server:"https://properclass.com:8089/janus",iceServers:[{urls:"turn:properclass.com:3478?transport=tcp",username:"properclass",credential:"proper199201"}],success:function(){console.log("server is conneted now go for plugin atatachment"),e.setState({isJanusConnected:!0})},error:function(e){console.error("server config error",e)},destroyed:function(){}});this.setState({janus:t})}},{key:"render",value:function(){return this.state.isJanusConnected&&this.janusAttachment(),o.a.createElement("div",null,o.a.createElement("span",null,"local"),o.a.createElement("video",{playsInline:!0,controlsList:"noremoteplayback",autoPlay:!0,id:"left-video",style:{height:300,width:300}}),o.a.createElement("span",null,"remote"),o.a.createElement("video",{playsInline:!0,controlsList:"noremoteplayback",autoPlay:!0,id:"right-video",style:{height:300,width:300}}))}}]),t}(o.a.Component),ol=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).janusAttachment=function(){a.state.janus.attach({plugin:"janus.plugin.videocall",success:function(e){console.log("Puligin handle",e),a.videoCall=e;a.videoCall.send({message:{audio:!0,video:!1}})},error:function(e){console.error("Faild to attach plugin",e)},consentDialog:function(e){console.log("consetDialog",e)},onmessage:function(e,t){console.log("onmessage",e,t),nl.a.log(" ::: Got a message :::",e);var n=e.result;if(console.log("Result",n),null!==n&&void 0!==n)if(void 0!==n.list&&null!==n.list){var r=n.list;nl.a.debug("Got a list of registered peers:"),nl.a.debug(r)}else if(void 0!==n.event&&null!==n.event){var o=n.event;if(a.setState({currentState:o}),"registered"===o){var i=n.username;nl.a.log("Successfully registered as ",i),a.videoCall.send({message:{request:"list"}})}else if("calling"===o)nl.a.log("Waiting for the peer to answer..."),a.setState({currentState:o});else if("incomingcall"===o){nl.a.log("Incoming call from",n.username);n.username;a.setState({currentState:o}),a.videoCall.createAnswer({jsep:t,media:{video:!0,audio:!0},success:function(e){nl.a.log("Got SDP!"),nl.a.debug(e);a.videoCall.send({message:{request:"accept"},jsep:e})},error:function(e){nl.a.error("WebRTC error:",e)}})}else if("accepted"===o){var c=n.username;null===c||void 0===c||nl.a.log(c," accepted the call!"),t&&a.videoCall.handleRemoteJsep({jsep:t})}else"update"===o&&t&&("answer"===t.type?a.videoCall.handleRemoteJsep({jsep:t}):a.videoCall.createAnswer({jsep:t,media:{video:!0,audio:!0},success:function(e){nl.a.debug("Got SDP!"),nl.a.debug(e);a.videoCall.send({message:{request:"set"},jsep:e})},error:function(e){nl.a.error("WebRTC error:",e)}}))}},onlocalstream:function(e){console.log("onlocalStream",e),document.getElementById("left-video").srcObject=e},onremotestream:function(e){console.log("onremotestream",e),document.getElementById("right-video").srcObject=e},oncleanup:function(){console.log("onCleanup called")},detached:function(){console.log("clear the stuff after plugin detach")}})},a.onUserRegister=function(){var e={request:"register",username:a.state.username};a.videoCall.send({message:e})},a.onInputChange=function(e,t){console.log("Inpute change",t.target.value),a.setState(Object(h.a)({},e,t.target.value))},a.onAnswerHandler=function(){},a.onCallHandler=function(){var e=Object(W.a)(L.a.mark(function e(t){var n;return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.remoteUserName,a.videoCall.createOffer({media:t,success:function(e){var t={request:"call",username:n};a.videoCall.send({message:t,jsep:e})},error:function(e){console.error("Error creatign offer",e)},customizeSdp:function(e){}});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.callCloseHandler=function(){a.videoCall.hangup()},a.videoCall=null,a.state={janus:null,isJanusConnected:!1,currentState:null},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){var e=this;nl.a.init({debug:!0,dependencies:nl.a.useDefaultDependencies({adapter:Vc.a}),callback:function(){console.log("working fine janus")}});var t=new nl.a({server:"https://properclass.com:8089/janus",iceServers:[{urls:"turn:properclass.com:3478?transport=tcp",username:"properclass",credential:"proper199201"}],success:function(){console.log("server is conneted now go for plugin atatachment"),e.janusAttachment()},error:function(e){console.error("server config error",e)},destroyed:function(){}});this.setState({janus:t})}},{key:"render",value:function(){var e=this;console.log("Video Call state value",this.state);var t=this.state.currentState;return o.a.createElement("div",null,o.a.createElement("h1",null,t),o.a.createElement("div",{style:{width:"50%",marginTop:10,padding:10}},o.a.createElement(ye.a,{onChange:function(t){return e.onInputChange("username",t)},placeholder:"Enter your name"}),o.a.createElement(ve.b,{style:{margin:10},text:"Register",intent:"success",onClick:this.onUserRegister}),o.a.createElement(ye.a,{placeholder:"Enter remote user name",onChange:function(t){return e.onInputChange("remoteUserName",t)}}),o.a.createElement("div",null,o.a.createElement(ve.b,{intent:Z.a.SUCCESS,style:{margin:10},text:"Audio Call",onClick:function(){return e.onCallHandler({audio:!0,videoSend:!1,videoRecv:!0})}}),o.a.createElement(ve.b,{intent:Z.a.SUCCESS,style:{margin:10},text:"Video Call",onClick:function(){return e.onCallHandler({video:!0,audio:!0})}}),o.a.createElement(ve.b,{intent:Z.a.SUCCESS,style:{margin:10},text:"Screen Share",onClick:function(){return e.onCallHandler({video:"screen"})}}),o.a.createElement(ve.b,{intent:Z.a.DANGER,style:{margin:10},text:"Close Call",onClick:this.callCloseHandler}))),o.a.createElement("div",null,o.a.createElement("span",null,"local"),o.a.createElement("video",{playsInline:!0,controlsList:"noremoteplayback",autoPlay:!0,controls:!0,id:"left-video",style:{height:300,width:300}}),o.a.createElement("span",null,"remote"),o.a.createElement("video",{playsInline:!0,controlsList:"noremoteplayback",controls:!0,autoPlay:!0,id:"right-video",style:{height:300,width:300}})))}}]),t}(o.a.Component),il=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).janusAttachment=function(){a.state.janus.attach({plugin:"janus.plugin.videoroom",opaqueId:"videoroomtest-"+nl.a.randomString(12),success:function(e){console.log("Puligin handle",e),a.sfutest=e},error:function(e){console.error("Faild to attach plugin",e)},consentDialog:function(e){console.log("consetDialog",e)},mediaState:function(e,t){nl.a.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){nl.a.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},onmessage:function(e,t){console.log("onmessage",e,t);var n=e.videoroom;if("joined"===n){if(a.myid=e.id,a.mypvtid=e.private_id,a.setState({myid:e.id,mypvtid:e.private_id}),console.log("Successfully joined room ",e.room,"with ID",a.myid),void 0!==e.publishers&&null!==e.publishers){var r=e.publishers;console.log("Got a list of available publishers/feeds:",r);for(var o=0;o<r.length;o+=1){var i=r[o],c=i.id,s=i.display,l=i.audio,u=i.video;a.newRemoteFeed(c,s,l,u)}}}else if("event"===n){if(void 0!==e.publishers&&null!==e.publishers){var d=e.publishers;nl.a.log("Got a list of available publishers/feeds:",d),nl.a.debug(d);for(var m=0;m<d.length;m+=1){var p=d[m];c=p.id,s=p.display,l=p.audio,u=p.video;nl.a.log("  >> ["+c+"] "+s+" (audio: "+l+", video: "+u+")"),a.newRemoteFeed(c,s,l,u)}}else if(void 0!==e.leaving&&null!==e.leaving){var f=e.leaving;nl.a.log("Publisher left: ",f),a.setState({remoteStreams:Object(y.a)({},a.state.remoteStreams,Object(h.a)({},f,{leave:!0}))});for(var v=null,b=1;b<6;b+=1)if(null!==a.feeds[b]&&void 0!==a.feeds[b]&&a.feeds[b].rfid===f){v=a.feeds[b];break}null!=v&&(nl.a.log("Feed ",v.rfid,"(",v.rfdisplay,") has left the room, detaching"),a.feeds[v.rfindex]=null,v.detach())}else if(void 0!==e.unpublished&&null!==e.unpublished){var g=e.unpublished;if(nl.a.log("Publisher left: ",g),"ok"===g)return void a.sfutest.hangup();for(var C=null,w=1;w<6;w+=1)if(null!==a.feeds[w]&&void 0!==a.feeds[w]&&a.feeds[w].rfid===g){C=a.feeds[w];break}null!=C&&(nl.a.log("Feed ",C.rfid," (",C.rfdisplay,") has left the room, detaching"),a.feeds[C.rfindex]=null,C.detach())}}else"destroyed"===n&&console.log("The room has been destroyed!");void 0!==t&&null!==t&&(console.log("Handling SDP as well...",t),a.sfutest.handleRemoteJsep({jsep:t}))},onlocalstream:function(e){console.log("onlocalStream",e),document.getElementById("my-video").srcObject=e},onremotestream:function(e){console.log("onremotestream",e),document.getElementById("right-video").srcObject=e},oncleanup:function(){console.log("onCleanup called")},detached:function(){console.log("clear the stuff after plugin detach")}})},a.joinHandler=function(){var e=a.state.username;console.log("join handler called",a.myroom,e);var t={request:"join",room:a.myroom,ptype:"publisher",display:e};a.myusername=e,a.sfutest.send({message:t})},a.publishOwnFeed=function(e){a.sfutest.createOffer({media:e,success:function(e){console.log("Got publisher SDP!",e);a.sfutest.send({message:{request:"configure",audio:!0,video:!0},jsep:e})},error:function(e){console.error("error on publishing own feed",e)}})},a.newRemoteFeed=function(e,t,n,r){var o=null;a.state.janus.attach({plugin:"janus.plugin.videoroom",success:function(t){(o=t).simulcastStarted=!1,console.log("Plugin attached! (",o.getPlugin(),"id=",o.getId(),")"),console.log("  -- This is a subscriber");var n={request:"join",room:a.myroom,ptype:"subscriber",feed:e,private_id:a.mypvtid};"safari"!==nl.a.webRTCAdapter.browserDetails.browser||"vp9"!==r&&("vp8"!==r||nl.a.safariVp8)||(r&&(r=r.toUpperCase()),console.error("Publisher is using ",r,", but Safari doesnt support it: disabling video"),n.offer_video=!1),o.videoCodec=r,o.send({message:n})},error:function(e){console.error("  -- Error attaching plugin...",e)},onmessage:function(e,t){console.log(" ::: Got a message (subscriber) :::",e);var n=e.videoroom;if(console.log("Event: ",n),void 0!==e.error&&null!==e.error)console.error(e.error);else if(void 0!=n&&null!=n)if(console.log("Remote Feed Event",e),"attached"===n)console.log("create element for remote video");else if("event"===n){var r=e.substream,i=e.temporal;(null!==r&&void 0!==r||null!==i&&void 0!==i)&&(console.log("do simulcatd related work"),o.simulcastStarted||(o.simulcastStarted=!0))}void 0!==t&&null!==t&&(console.log("Handling SDP as well in subscriber feed...",t),o.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1},success:function(e){console.log("Got SDP! in feed answer",e);var t={request:"start",room:a.myroom};o.send({message:t,jsep:e})},error:function(e){console.error("WebRTC error:",e)}}))},webrtcState:function(e){console.log("Janus says this WebRTC PeerConnection (feed #"+o.rfindex+") is "+(e?"up":"down")+" now")},onlocalstream:function(e){},onremotestream:function(n){console.log("Remote feed #",o.rfindex),console.log("remote stream",n),a.setState({remoteStreams:Object(y.a)({},a.state.remoteStreams,Object(h.a)({},e,{id:e,stream:n,display:t,leave:!1}))})},oncleanup:function(){console.log(" ::: Got a cleanup notification (remote feed ",e,") :::")}})},a.inputHandler=function(e){a.setState({username:e.target.value})},a.onUnPublishHandler=function(){a.sfutest.send({message:{request:"unpublish"}})},a.onHangUp=function(){a.sfutest.hangup()},a.videoElement=function(e){var t=e.id,a=e.display;return o.a.createElement("div",null,o.a.createElement("video",{playsInline:!0,controlsList:"noremoteplayback",autoPlay:!0,id:t,controls:!0,style:{height:300,width:300}}),o.a.createElement("h2",null,a))},a.sfutest=null,a.opaqueId="videoroomtest-"+nl.a.randomString(12),a.myroom=1234,a.myusername=null,a.myid=null,a.mystream=null,a.mypvtid=null,a.feeds=[],a.state={janus:null,isJanusConnected:!1,mypvtid:null,myid:null,remoteStreams:{}},a.remoteFeed=null,a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){var e=this;nl.a.init({debug:!0,dependencies:nl.a.useDefaultDependencies({adapter:Vc.a}),callback:function(){console.log("working fine janus")}});var t=new nl.a({server:"http://properclass.com:8088/janus",iceServers:[{urls:"turn:properclass.com:3478?transport=tcp",username:"properclass",credential:"proper199201"}],success:function(){console.log("server is conneted now go for plugin atatachment"),e.janusAttachment()},error:function(e){console.error("server config error",e)},destroyed:function(){}});this.setState({janus:t})}},{key:"componentDidUpdate",value:function(){var e=this.state.remoteStreams;Object.keys(e).forEach(function(t){var a=document.getElementById(t);a&&(a.srcObject=e[t].stream)})}},{key:"render",value:function(){var e=this,t=this.state,a=t.myid,n=t.mypvtid,r=t.remoteStreams;return console.log("Remote Streams",this.state),o.a.createElement("div",null,o.a.createElement(ye.a,{onChange:this.inputHandler,placeholder:"enter your display name"}),o.a.createElement(ve.b,{intent:"success",style:{margin:10},text:"Join",onClick:this.joinHandler}),a&&n&&o.a.createElement("div",null,o.a.createElement(ve.b,{intent:"success",style:{margin:10},text:"Audio",onClick:function(){return e.publishOwnFeed({audioRecv:!1,videoRecv:!1,audioSend:!0,videoSend:!1})}}),o.a.createElement(ve.b,{intent:"success",style:{margin:10},text:"Video",onClick:function(){return e.publishOwnFeed({audioRecv:!1,videoRecv:!1,audioSend:!0,videoSend:!0})}}),o.a.createElement(ve.b,{intent:"success",style:{margin:10},text:"Screenshare",onClick:function(){return e.publishOwnFeed({audioRecv:!1,videoRecv:!1,audioSend:!0,video:"screen"})}}),o.a.createElement(ve.b,{intent:"success",style:{margin:10},text:"Un Publish",onClick:this.onUnPublishHandler}),o.a.createElement(ve.b,{intent:"danger",style:{margin:10},text:"Close Call",onClick:this.onHangUp})),o.a.createElement("div",null,o.a.createElement("span",null,"local"),o.a.createElement("video",{playsInline:!0,controlsList:"noremoteplayback",autoPlay:!0,id:"my-video",controls:!0,style:{height:300,width:300}}),Object.values(r).filter(function(e){return!e.leave}).map(function(t){return e.videoElement(t)})))}}]),t}(o.a.Component),cl=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).renderTest=function(){switch(a.state.currentTest){case"echo":return o.a.createElement(rl,null);case"videoCall":return o.a.createElement(ol,null);case"videoConference":return o.a.createElement(il,null);default:return null}},a.state={currentTest:null},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement("div",{style:{display:"flex"}},o.a.createElement(ve.b,{style:{margin:10},intent:"success",text:"Echo server",onClick:function(){return e.setState({currentTest:"echo"})}}),o.a.createElement(ve.b,{style:{margin:10},intent:"success",text:"Video Call",onClick:function(){return e.setState({currentTest:"videoCall"})}}),o.a.createElement(ve.b,{style:{margin:10},intent:"success",text:"Video Conference",onClick:function(){return e.setState({currentTest:"videoConference"})}})),this.renderTest())}}]),t}(o.a.Component),sl=a(296),ll=function(){return o.a.createElement("div",{style:{width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"}},o.a.createElement("img",{style:{objectFit:"contain",width:"100%"},alt:"error",src:sl}))},ul=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.popNotification,n=e.updateNav;return o.a.createElement(P.a,null,o.a.createElement("div",{className:"home-screen"},a.active&&o.a.createElement(Ys,{onClose:function(){return n({schema:"popNotification",data:{message:"",active:!1,intent:""}})},message:a.message,intent:a.intent}),o.a.createElement(M.a,null,o.a.createElement(H.a,{exact:!0,path:"/test",component:cl}),o.a.createElement(H.a,{path:"/error",component:ll}),o.a.createElement(H.a,{exact:!0,path:"/about",component:Ds}),o.a.createElement(H.a,{exact:!0,path:"/privacy-policy",component:Ts}),o.a.createElement(H.a,{exact:!0,path:"/terms-and-conditions",component:Ps}),o.a.createElement(H.a,{path:"/search",component:fa}),o.a.createElement(H.a,{exact:!0,path:"/support",component:Hs}),o.a.createElement(H.a,{exact:!0,path:"/career",component:Bs}),o.a.createElement(H.a,{exact:!0,path:"/report",component:Ws}),o.a.createElement(H.a,{exact:!0,path:"/business",component:zs}),o.a.createElement(H.a,{exact:!0,path:"/services",component:qs}),o.a.createElement(H.a,{exact:!0,path:"/archive",component:da}),o.a.createElement(H.a,{exact:!0,path:"/take-a-tour",component:xs}),o.a.createElement(H.a,{path:"/login",component:Ba}),o.a.createElement(H.a,{path:"/register",component:Ya}),o.a.createElement(H.a,{path:"/forgot-password",component:pi}),o.a.createElement(H.a,{path:"/class-work/:userSlug/:classId",component:li}),o.a.createElement(H.a,{path:"/class-template/:userSlug/:classId",component:tl}),o.a.createElement(H.a,{path:"/edit-blog/:id/:blogId",component:pr}),o.a.createElement(H.a,{path:"/create-blog/:id",component:pr}),o.a.createElement(H.a,{exact:!0,path:"/reset/:token",component:hi}),o.a.createElement(H.a,{exact:!0,path:"/email-verification/:token",component:Ci}),o.a.createElement(H.a,{path:"/blog/:userSlug/:blogSlug",component:kr}),o.a.createElement(H.a,{path:"/user/:userId",component:Jt}),o.a.createElement(H.a,{path:"/dashboard/:id",component:jr}),o.a.createElement(H.a,{exact:!0,path:"/",component:xa}),o.a.createElement(U.a,{to:"/error"})),t&&o.a.createElement(Is,null)))}}]),t}(o.a.Component);ul.defaultProps={user:null};var dl=Object(p.b)(function(e){var t=e.account,a=e.navigate;return{user:t.user,popNotification:a.popNotification}},Object(y.a)({},n))(ul),ml=function(e){function t(){var e,a;Object(s.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).state={},a}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){f.a.initialize("UA-165382110-1"),f.a.pageview("/")}},{key:"render",value:function(){return o.a.createElement(p.a,{store:R},o.a.createElement(dl,null))}}]),t}(r.Component);a(297),a(299),a(301),a(303),a(305);c.a.render(o.a.createElement(ml,null),document.getElementById("root"))},49:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAAKeAAACngG20ANEAAAEU0lEQVR4nO1aO2zUWBT138/2jKALVBRAQ0JmgCw0QaKCAAVCCNGChEQRGgqkFAgUihUSsFXoKNBWu1okOgQdElAAIeMJCQWCgg4qEmZsv3n+oRtiacjOMJ/cZ08yc0p/zr33+P187xXjOBb6GVJfRz8QYCDAQICBAD3gQ6YYCNADPmSKvhdAycLowsLCDkWWT9dfC8Lw0cjIyOe0fUntKLz4/v05RunZMAjGgzAcqlH6y32dEEGR5a+yorzQCPlveM+ef9Pwi7sAi4uL49R1Z1zXLURR1NY7kiQJpmmWiWleHh4efsHTP64ClG17xnGcSZ+xrt5XNU2wLOteoVi8jO7cKrgJMDc7+6RSqRzD4Mrn80/3j41NYHCtBZddADN4AHABJxZfPdAFgGGPGXwC4ARubF7UKQAL3vLS0vNu53wrwJqwZevWw5gLI+oIgNWeV/AA4AYbmJxoAsA+D1sdFl8zgA2whcWHJkDNdS+0u8+vB2ADbGHxoQkQRtE4FleatlAEgCFJPc/C4GoHYAtrGqAIEPrBvjSGfwKwBTYxuFAEiKJgGwZPFjb7Ph8wEKAHfMgUKAKIolRNOwgsmygC6Lr+EYMnC5toP0NvXr2KXddF4WoF0zSFPw4dEjG40NYAWZZfYnGlaQtNAI0QLgkL3rZQ8wGzr19/cRxnCI2wASzL+jp28CDawQt1G9QJuQYZXV4AbrCBSY+eFMXOB9aDR3IU/XNphFwyDOMDNi9wAjc2L7oAUN4yc7mjmCIAF3DyKJ1xmbCJCPl8ft3bFXDwCh7AvTQ2X56/5bnOJKU018l7hJCqYVr3RgujU/y8S6k4CtXgMAiuBj6bqDF/Z7PMMaS9dU39pKjaE1lRbqdRLU69URJqB3EcHwl8tqv+uqJqH0VRfMa7GLoWfd8pyr1BApKXcRTtTr54GITFZs+KoliVZGnlL48Qww6jaHbDlcchYL9Gj0OgURQVKKVCtwlTWBNUVXVkSbJlRbEVVf0HWxAUAeq7PzzPG+KVIa5fJLHEWJcAsMX5rDbRSfcHFkAMoutPVU17uHd09H63tF0JAIGzGj3P+8+vHSTtNJquz3QjREcCvJufv8hqdKpadXYix7FugBCWZb3UDWOqk6nRlgBwkPEZu1utVM6kPdQ7haZpFdOy/m63r6ilAGXbPkEpvU89b3sG8XSNXC5X1g3jVKvT5G8FKM29ve55dJpn0wNPwP8EMYxzhWLxcTMzTQUozc093AhDvhVgShCD3Nm3/8DNRo82FIBnVicLwAKZy+duNBLhf/mAzRa8sFpOr1aq0zCl1977RQBeLW69gEQE2MobCmCXSle+Ly9PbsbgE/wUofIX/JIn11YEgAue605v9AWvHTDG8tR1HiSPrggAvXdwo5cdxwScZGGXA0rRLpVmlr5929RDvxFWO9FPSoyx873nHn/A4S7w/T8lIY5Ta2/rNUDCpu9bZBRN13vAjWyg6brwAzLER5MVJ3BoAAAAAElFTkSuQmCC"},51:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=u(a(175)),r=u(a(176)),o=u(a(177)),i=u(a(178)),c=u(a(179)),s=u(a(180)),l=u(a(181));function u(e){return e&&e.__esModule?e:{default:e}}t.default={init:n.default,add:r.default,remove:o.default,update:i.default,map:s.default,all:c.default,get:l.default}},77:function(e,t,a){e.exports=a.p+"static/media/uploadicon512.d4c77ff2.png"},78:function(e,t,a){e.exports=a.p+"static/media/blog-img.156d4d85.jpg"},89:function(e,t,a){"use strict";var n;function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}Object.defineProperty(t,"__esModule",{value:!0}),t.PKT_RPC_REQUEST=function(e,t,a,n){return JSON.stringify([o,e,t,a,n])},t.PKT_RPC_RESPONSE=function(e,t,a){return JSON.stringify([i,e,t,a])},t.PKT_EVENT=function(e,t){return JSON.stringify([c,e,t])},t.PKT_ACTION=function(e){return JSON.stringify([s,e])},t.PKT_SCOPE_REQUEST=function(e,t,a){return JSON.stringify([l,e,t,a])},t.PKT_SCOPE_RESPONSE=function(e,t,a){return JSON.stringify([u,e,t,a])},t.PKT_CALL=function(e,t,a){return JSON.stringify([d,e,t,a])},t.createParser=function(){var e={parse:function(t){try{var a=JSON.parse(t);if(!Array.isArray(a))throw new Error("Invalid message format");var n=(c=a,Array.isArray(c)?c:Array.from(c)),r=n[0],o=n.slice(1),i=m[r];if(!i)throw new Error("Unknown message type - "+r);if(!e[i])throw new Error("No parser defined for - "+i);try{e[i].apply(null,o)}catch(s){throw new Error("Error executing parser - "+i+" - "+s.message)}}catch(s){e.onError?e.onError(s):console.error("Error parsing message",s)}var c}};return e};var o=1,i=2,c=3,s=4,l=5,u=6,d=7,m=(r(n={},o,"onRpcRequest"),r(n,i,"onRpcResponse"),r(n,c,"onEvent"),r(n,s,"onAction"),r(n,l,"onScopeRequest"),r(n,u,"onScopeResponse"),r(n,d,"onCall"),n)}},[[166,2,1]]]);